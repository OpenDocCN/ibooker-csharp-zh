# 前言

我认为这本书封面上的动物，一只棕榈猫鼬，与本书的主题相关。在看到封面之前，我对这种动物一无所知，因此我查找了相关信息。棕榈猫鼬被认为是害虫，因为它们会在阁楼上随处排泄，并在最不合时宜的时候用嘈杂的声音互相争斗。它们的肛门臭腺会分泌出令人作呕的分泌物。它们的濒危物种评级是“无忧”，这显然是政治正确的说法，“你可以杀死尽可能多的这些动物，没有人会想念它们。”棕榈猫鼬喜欢吃咖啡果实，它们将咖啡豆排泄出来。鲁瓦克咖啡是世界上最昂贵的咖啡之一，由从猫鼬排泄物中提取的咖啡豆制成。根据美国特种咖啡协会的说法，“它的味道很糟糕。”

这使得棕榈猫鼬成为并发和多线程开发的完美吉祥物。对于未曾接触过的人来说，并发和多线程是令人不愿意接受的。它们会导致行为良好的代码表现出最可怕的方式。竞态条件等问题会导致响亮的崩溃（似乎总是在生产环境或演示期间）。有些人甚至宣称“线程是邪恶的”，完全避免并发。有少数开发者对并发产生了兴趣，并且毫不畏惧地使用它；但大多数开发者在过去由于并发而受过伤，这种经历让他们对此望而却步。

然而，对于现代应用程序来说，并发迅速成为一项要求。如今的用户期望完全响应的界面，服务器应用程序必须达到前所未有的规模。并发可以解决这两种趋势。

幸运的是，现代化的库使并发变得*更*容易！并行处理和异步编程不再只是巫师的专属领域。通过提高抽象级别，这些库使响应式和可扩展的应用程序开发成为每个开发者现实可行的目标。如果你在过去遇到过困难重重的并发问题，那么我鼓励你使用现代工具再次尝试。我们可能永远不能说并发很简单，但它确实没有过去那么难了！

# 适合阅读本书的人

这本书是为那些想学习现代并发方法的开发者编写的。我假设你具有相当数量的.NET 经验，包括对泛型集合、可枚举对象和 LINQ 的理解。我*不*假设你有任何多线程或异步编程的知识。如果你在这些领域有些经验，你可能仍会发现这本书有帮助，因为它介绍了更安全、更易于使用的新库。

并发对任何类型的应用程序都有用。无论您是在桌面应用程序、移动应用程序还是服务器应用程序上工作；如今并发几乎是无处不在的要求。您可以使用本书中的示例使用户界面更加响应，服务器更具可扩展性。我们已经到了并发无处不在的时代，理解这些技术及其用途是专业开发者的必备知识。

# 我为什么写这本书

在我职业生涯的早期阶段，我通过艰难的方式学会了多线程。几年后，我又通过艰难的方式学会了异步编程。虽然这两者都是宝贵的经验，但我希望那时我能有一些今天可用的工具和资源。特别是，现代.NET 语言中的`async`和`await`支持是非常宝贵的。

然而，如果您今天查看有关学习并发性的书籍和其他资源，几乎所有这些资源都从介绍最低级别的概念开始。有关线程和序列化原语的优秀覆盖，高级技术则被推迟到后面，如果有的话。我认为这有两个原因。首先，许多并发的开发者，比如我自己，确实是先学习了低级别的概念，艰难地通过老式技术。其次，许多书籍已经数年未变，涵盖的是现在已经过时的技术；随着新技术的推出，这些书籍已经更新以包括它们，但不幸的是把它们放在了最后。

我认为这是反过来的。实际上，这本书*仅仅*涵盖了现代并发的方法。这并不是说理解所有低级概念没有价值。当我上大学学习编程时，有一门课程让我从几个门电路构建虚拟 CPU，还有另一门课程讲解汇编语言。在我的职业生涯中，我从未设计过 CPU，只写过几十行汇编，但是我的基础理解每天都在帮助我。尽管如此，最好还是从更高级别的抽象开始；我的第一门编程课不是用汇编语言。

本书填补了一个空白：它是使用现代方法介绍并发的入门和参考。它涵盖了几种不同的并发类型，包括并行、异步和反应式编程。然而，它不涉及任何老式技术，这些在许多其他书籍和在线资源中都有充分的覆盖。

# 导航本书

以下是本书的结构：

+   第一章介绍了本书涵盖的各种并发类型：并行、异步、反应式和数据流。

+   第二章到第六章是对这些并发类型更为详尽的介绍。

+   剩下的章节各自处理并发的特定方面，并作为常见问题解决方案的参考。

我建议阅读（或至少浏览）第一章，即使您已经熟悉某些并发类型。

###### 警告

由于本书正在印刷中，.NET Core 3.0 仍处于 beta 阶段，因此有关异步流的某些细节可能会发生变化。

# 在线资源

本书像是对多种不同并发类型的广泛介绍。我尽力包含了我和其他人认为最有帮助的技术，但这本书并非穷尽一切。以下资源是我发现的更彻底探索这些技术的最佳资源：

+   对于并行编程，我知道的最好资源是 Microsoft Press 的*Parallel Programming with Microsoft .NET*，其文本可以[在线获取](http://bit.ly/parallel-prog)。不幸的是，它已经有些过时了。关于 futures 的部分应改用异步代码，关于 pipelines 的部分应使用 Channels 或 TPL Dataflow。

+   对于异步编程，MSDN 是相当不错的，特别是[“异步编程”](http://bit.ly/async-prog)概述。

+   Microsoft 也提供了[TPL Dataflow 的文档。](http://bit.ly/dataflow-tpl)

+   System.Reactive（Rx）是一个在线上受欢迎并不断发展的库。在我看来，今天最好的 Rx 资源是[*Introduction to Rx*](http://www.introtorx.com/)，这是 Lee Campbell 的一本电子书。

# 本书中使用的约定

本书使用以下排版约定：

*斜体*

表示新术语、网址、电子邮件地址、文件名和文件扩展名。

`等宽`

用于程序清单，以及在段落中引用程序元素，如变量或函数名称、数据库、数据类型、环境变量、语句和关键字。

**`等宽粗体`**

显示用户应该按字面输入的命令或其他文本。

*`等宽斜体`*

显示应由用户提供值或由上下文确定值替换的文本。

###### 提示

这个元素表示一个提示或建议。

###### 注释

这个元素表示一般注释。

###### 警告

这个元素表示警告或注意事项。

# 使用代码示例

补充材料（代码示例、练习等）可从[*https://oreil.ly/concur-c-ckbk2*](https://oreil.ly/concur-c-ckbk2)下载。

本书旨在帮助您完成工作。通常情况下，如果本书提供了示例代码，您可以在您的程序和文档中使用它。除非您复制了代码的大部分，否则您无需联系我们请求许可。例如，编写一个使用本书多个代码片段的程序不需要许可。销售或分发包含奥莱利书籍示例的 CD-ROM 需要许可。引用本书回答问题并引用示例代码不需要许可。将本书的大量示例代码整合到您产品的文档中需要许可。

我们感谢，但不要求署名。署名通常包括标题、作者、出版商和 ISBN。例如：“*Concurrency in C# Cookbook*, Second Edition, by Stephen Cleary (O’Reilly). Copyright 2019 Stephen Cleary, 978-1-492-05450-4。”

如果您认为您使用的代码示例超出了合理使用范围或以上给出的许可，请随时通过*permissions@oreilly.com*与我们联系。

# 奥莱利在线学习

###### 注意

近 40 年来，[*奥莱利传媒*](http://oreilly.com)为企业的成功提供技术和商业培训、知识和洞见。

我们独特的专家和创新者网络通过书籍、文章、会议和我们的在线学习平台分享他们的知识和专长。奥莱利的在线学习平台为您提供按需访问的实时培训课程、深入学习路径、交互式编码环境，以及来自奥莱利和其他 200 多家出版商的大量文本和视频内容。更多信息，请访问[*http://oreilly.com*](http://oreilly.com)。

# 如何联系我们

有关本书的评论和问题，请发送至出版商：

+   奥莱利传媒公司

+   北格拉文斯坦高速公路 1005 号

+   加利福尼亚州塞巴斯托波尔 95472

+   800-998-9938（美国或加拿大）

+   707-829-0515（国际或本地）

+   707-829-0104（传真）

我们为本书设有网页，列出勘误、示例和任何额外信息。您可以访问[*https://oreil.ly/concur-c-ckbk2*](https://oreil.ly/concur-c-ckbk2)查看。

如需对本书提出评论或技术问题，请发送电子邮件至*bookquestions@oreilly.com*。

有关我们的书籍、课程、会议和新闻的更多信息，请访问我们的网站[*http://www.oreilly.com*](http://www.oreilly.com)。

在 Facebook 上找到我们：[*http://facebook.com/oreilly*](http://facebook.com/oreilly)

在 Twitter 上关注我们：[*http://twitter.com/oreillymedia*](http://twitter.com/oreillymedia)

在 YouTube 上观看我们：[*http://www.youtube.com/oreillymedia*](http://www.youtube.com/oreillymedia)

# 致谢

如果没有这么多人的帮助，本书将无法存在！

首先，我要首先感谢我的主耶稣基督。成为基督徒是我一生中最重要的决定！如果您想获取更多关于这个主题的信息，请随时通过[我的个人网页](http://stephencleary.com/)联系我。

其次，我要感谢我的家人，让我能有更多时间投入写作。当我开始写作时，一些作家朋友告诉我：“接下来一年要和家人说再见！” 我当时以为他们在开玩笑。我的妻子曼迪和我们的孩子 SD 和 Emma，在我白天工作后以及晚上和周末写作时非常理解和支持。非常感谢你们，我爱你们！

当然，如果没有我的编辑和技术审阅者：Stephen Toub、Petr Onderka（“svick”）、Nick Paldino（“casperOne”）、Lee Campbell 和 Pedro Felix，这本书不会有现在的水平。所以如果有任何错误通过了，完全是他们的错。开个玩笑！他们的意见在塑造（和修复）内容方面是无价的，当然，剩下的错误都是我自己的责任。特别感谢 Stephen Toub，他教会了我布尔参数技巧（Recipe 14.5），以及无数其他的`async`主题；还有 Lee Campbell，他帮助我学习了 System.Reactive，使我的观察者模式代码更具表现力。

最后，我想感谢我从中学到这些技巧的一些人：Stephen Toub、Lucian Wischik、Thomas Levesque、Lee Campbell、Stack Overflow 和 MSDN 论坛的成员，以及在我所在密歇根州及周边举办的软件会议的参与者。我很高兴能成为软件开发社区的一部分，如果这本书有任何价值，那是因为已经有很多人指引了道路。谢谢大家！
