# 前言

欢迎来到*学习 Blazor*。你可能来到这里是因为听说过 Blazor 的一些很酷的东西，想要试试看。那么，它是什么？Blazor 是一个开源的 Web 框架，用于使用 C#（读作“C Sharp”）、HTML 和层叠样式表（CSS）构建交互式客户端 Web UI 组件。¹ 作为 ASP.NET Core 的一项功能，Blazor 通过工具和库扩展了.NET 开发平台，用于构建 Web 应用程序。

WebAssembly 使得许多非 JavaScript 编程语言能够在浏览器上运行。Blazor 充分利用了 WebAssembly，并允许 C#开发者使用.NET 构建 UI 组件和客户端体验。Blazor 是一个单页面应用程序（SPA）框架，类似于 Angular、React、VueJS 和 Svelte，但它基于 C#而不是 JavaScript。

好吧，它是一个 Web 框架，但它与任何其他用于构建 Web UI 的客户端框架有何不同？

# 为什么选择 Blazor？

Blazor 对.NET 开发者和 Web 开发者都是一个改变游戏规则的工具！在这本书中，你将学习如何使用 Blazor WebAssembly 托管模型创建引人入胜的实时 Web 体验。选择 Blazor 作为你下一个 Web 应用程序开发框架的原因似乎不计其数。让我们从它为 Web 开发做了什么开始。

早在 90 年代初期，浏览网络就像阅读一系列链接文本文档一样——基本的 HTML。这种体验并不沉浸或连贯。当 CSS 和 JavaScript 出现时，动态响应用户交互的能力为网络体验增添了更多风采。尽管网页开始变得更有趣，但加载速度非常缓慢，人们期望的用户体验也较差，页面的渲染/缓冲过程是显而易见的。当时，通过拨号连接以 HTTP 协议向浏览器缓冲底层图像数据，观看图像分段渲染是完全可以接受的。然而，这种耐心并没有持久。人类天性使然，我们总是希望即刻得到想要的东西，对吧？如果你在浏览器上等待几秒钟以上，你会开始感到有些不安。随着网页内容变得更加复杂，开发框架出现以应对这种复杂性。

在这些颠覆性框架中，Blazor 与 WebAssembly 并驾齐驱。通过 Blazor，您可以在客户端和服务器场景上共享 C#代码，同时利用 Visual Studio 系列产品、强大的.NET CLI 以及其他流行的.NET 集成开发环境的工具。.NET 生态系统蓬勃发展，采用率飙升，长期支持（LTS）的吸引力继续推动企业开发。与 Angular 和 React 等其他 SPA 框架的 LTS 相比，.NET 因其每个 LTS 版本的三年支持政策而脱颖而出。保持与每个发布版本的更新非常有利。有关更多信息，请参阅[.NET 支持政策](https://oreil.ly/sQE70)。

就像任何其他 Web 应用程序一样，Blazor Web 应用程序可以创建为渐进式 Web 应用程序（PWA），以支持离线体验。它们也可以托管在本地桌面应用程序中，并安装在用户设备上。您的 Blazor WebAssembly 应用程序可以定义本地依赖项，例如来自 C 和 C++的依赖项。任何使用[Emscripten](https://emscripten.org)编译的内容都可以在 Blazor 中使用。在我看来，几乎没有什么需要权衡的地方；Web 开发平台需求旺盛且编程乐趣无穷。

当 WebAssembly 首次引入时，它最初只受到了适度的开发者社区关注和期待。2017 年，WebAssembly 被公开标准化，这使开发者能够探索超越仅有 JavaScript 的互动和功能的新可能性。这对 Web 开发者很重要，因为他们可以更轻松地与利润丰厚的应用商店开发平台竞争。JavaScript 继续发展，添加超越 ECMAScript 标准的功能。通过.NET 创建 Blazor 后，C#成为了 JavaScript 的真正竞争对手。

作为一名拥有超过十年实际网页应用程序开发经验的开发者，我可以证明，我一再地使用.NET 进行企业级生产应用程序的开发。仅.NET 的 API 表面积就非常庞大，并且已被全球数十亿台计算机系统使用。多年来，我使用各种技术构建了许多网页应用，包括 ASP.NET WebForms、AngularJS、Angular、VueJS、Svelte，甚至包括 React，然后是 ASP.NET Core 的 Model View Controller、Razor Pages 和 Blazor。Blazor 将一个成熟的生态系统的优势与 Web 的灵活性和优雅结合在一起，对.NET 和 Web 开发者都有很多提供。

# 谁应该阅读本书

这本书适用于具有 HTML、CSS、文档对象模型和 JavaScript 基本理解，并具有一定.NET 应用开发经验的.NET 开发者和 Web 开发者。这本书不适合完全初学编程的人。比如，当我告诉我妈妈我在写一本书时，她问我书的内容和她是否会喜欢读。我说，“不会。”她既不是.NET 开发者也不是 Web 开发者，所以我不认为她会在这本书中找到太多价值。但如果你是.NET 开发者或 Web 开发者，那么你会有所收获。

## 对于.NET 开发者

如果你是一名对 Web 应用开发有兴趣的.NET 开发者，本书将详细介绍如何利用你现有的.NET 技能并将它们应用到 Blazor 开发中。Web 应用平台对.NET 开发者来说是一个重要的机遇。所有流行的 JavaScript SPA 框架，如 Angular、React、VueJS 和 Svelte，在 Blazor 面前都有一个真正的竞争对手。由于 Blazor 基于.NET 和 C#，因此 Blazor 应用开发对你来说应该是很熟悉的。你可以在客户端和服务器之间共享库，使开发变得非常愉快。

## 对于 Web 开发者

如果你是之前曾经用过.NET 的 Web 开发者，这本书将扩展你掌握的两套编程技能。你所有的.NET 经验都可以延续，以及你对 Web 基础知识的了解。如果你是 SPA 开发者，这本书将向你展示比你习惯的更好的工具集。我们还介绍了许多新的 C#特性。如果你对 C#不熟悉，这本书将为你提供一个惯用的 C#视角和一个强烈的主观经验。

###### 提示

如果你自问，“什么是惯用的 C#？”那么，像所有编程语言一样，C#有一套编程习惯。编程习惯是一种编写更智能、更好的代码以完成任务的方式。惯用的 C#是一组习惯用法，用于使你的代码更易读和可维护。

你的 JavaScript 和客户端路由的开发经验，以及对 HTTP、微服务架构、依赖注入和基于组件的应用程序思维的深刻理解——所有这些东西都直接适用于 Blazor 开发。应用程序开发不应该如此困难，我确实相信 Blazor 使其变得更容易。具有丰富的数据绑定、强类型模板化、组件层次结构事件处理、日志记录、本地化、认证、PWA 支持和托管功能，你拥有所有构建引人入胜的 Web 体验的基础。

# 为什么写这本书

当有人问我：“你为什么想要写一本书？”我会停顿片刻，假装深思，然后回答：“O’Reilly 让我写的。”就这么简单。但说真的，当我收到一封来自 O’Reilly 的收购编辑的友好邮件，询问我是否有兴趣写一本关于 Blazor 的书时，我认真考虑了很多。首先，被邀请写书真的很酷！但我也知道接下这样的项目意味着要搁置一些事情。我需要暂时停止参加演讲活动，而这些活动在过去几年里是我生活的重要部分。然而，我乐于帮助他人，所以写书将以不同的方式帮助人们。写书也意味着要抽出时间离开我年幼的家庭。我的家人，尤其是我的妻子，一直非常温暖和支持。她相信我有能力帮助他人，并分享我的激情。最终，我决定，“是的！我想写一本书！”

对我来说，帮助开发者社区也有助于加强我对特定技术的理解。我热爱 Blazor！Blazor 对于 .NET 和 ASP.NET 微软开发团队来说是（并一直是）一项重大投资。他们不断推动创新，扩展了 C# 和整个 .NET 生态系统的影响力。这本书是每位*开发者必备*，也是我回馈我深爱的开发者社区的方式。我全身心投入到这本书中，我知道我对 Blazor 的热情透过书页流露出来。

# 如何使用本书

这不是你典型的“介绍 X 的”类型的书籍。这是一本技术书，将介绍如何使用 Blazor 构建带有 WebAssembly 和 C# 的单页应用程序。市面上有很多采用逐步方法的书籍，但本书并非如此。

当你阅读本书时，我希望你能有类似加入新团队时的体验。你将经历一些入职过程，了解一个现有应用程序，以及在此过程中学习各种领域知识。“Learning Blazor” 示例应用程序是一个相当大的解决方案，有超过十几个不同规模的项目。每个项目都包含或贡献给 Learning Blazor 应用程序中的特定功能。我们将这些项目作为 Blazor 中做事情的示例进行详细讲解。当我带你深入了解应用程序的内部工作时，你将学到 Blazor 应用程序开发的技巧。最终，你将获得开发 Blazor 应用程序所需的经验，并理解为什么会做出某些开发决策，并且你将获得如何完成任务的实际示例。你将读完本书，并获得启发来开发你的应用程序。

本书中的所有示例都是使用 Learning Blazor 应用程序（或模型应用程序）展示的。来自模型应用程序的源代码，连同本书，成为一个极好的学习资源和未来的参考点。源代码仓库可在 GitHub 上找到，并在 “代码必须活下去” 中分享。

# 本书的路线图和目标

本书结构如下：

+   第一章，“迈向 Blazor”，介绍了用于 Web 应用程序开发的 Blazor 的核心概念和基础知识。还介绍了本书的示例应用程序并讨论其架构。

+   第二章，“执行应用程序”，深入探讨了从第一个客户端请求到静态网站 URL 开始的应用程序执行方式。您将了解 HTML 如何呈现，如何调用其他资源的后续请求以及 Blazor 如何引导自身。

+   第三章，“组件化”，探讨了用户在应用程序中的表示方式。您将学习如何使用第三方身份验证提供程序验证用户身份。您将了解如何自定义身份验证状态的用户体验，以及使用 Razor 控制结构进行各种数据绑定的方法。

+   第四章，“定制用户登录体验”，详细介绍了为依赖注入注册客户端服务的过程。您将了解*组件化*的概念，以及如何使用 `RenderFragment` 方法定制组件。您还将学习如何编写和使用参数化的客户端本地语音合成，在 Blazor WebAssembly 中完全实现和配置。

+   第五章，“本地化应用程序”，演示了如何使用免费的基于 AI 的自动化持续交付流水线来支持本地化。您将学习如何使用框架提供的 `IStringLocalizer<T>` 类型及其相应的服务。

+   第六章，“演示实时 Web 功能”，介绍了实时 Web 功能，并展示了通知系统、实时推文流页面和警报功能。此外，您还将学习如何使用 ASP.NET Core SignalR 构建聊天应用程序。

+   第七章，“使用源生成器”，提出了使用源生成器改进 Blazor JavaScript 互操作性（interop）体验的案例。您将了解为何 C# 源生成器在应用程序开发中非常有用，以及它们如何节省大量时间。

+   第八章，“接受带验证的表单输入”，探讨了表单的工作原理。我们将介绍高级 `<form>` 输入验证。我们还将看看如何将本地语音识别整合到表单中，以提供用户另一种输入选项。您将学习如何使用 `EditContext` 和表单模型绑定。第八章还演示了一种接收使用 Reactive Extensions for .NET 实时更新的自定义状态验证模式。

+   第九章，“测试所有内容”，教您如何编写单元测试、组件测试甚至端到端测试，以确保您的应用程序正常工作。这些测试可以自动化运行，每次将应用程序推送到 GitHub 存储库时都会运行，使用 GitHub Actions。

# 本书使用约定

本书使用以下排版约定：

*斜体*

指示新术语、URL、电子邮件地址、文件名和文件扩展名

`Constant width`

用于程序清单，以及在段落中引用程序元素，如变量或函数名、数据库、数据类型、环境变量、语句和关键字

###### 提示

此元素表示一个提示或建议。

###### 注释

此元素表示一般备注。

###### 警告

此元素表示警告或注意事项。

# 使用代码示例

附加材料（代码示例、练习等）可在[*https://oreil.ly/learning-blazor-code*](https://oreil.ly/learning-blazor-code)下载。

如果您有技术问题或者在使用代码示例时遇到问题，请发送邮件至*bookquestions@oreilly.com*。

本书旨在帮助您完成工作。一般情况下，如果本书提供示例代码，您可以在您的程序和文档中使用它，无需征得我们的许可。除非您复制了代码的大部分内容，否则无需联系我们以获得许可。例如，编写一个使用本书多个代码块的程序不需要许可。销售或分发 O’Reilly 书籍中的示例代码需要许可。引用本书并引用示例代码回答问题无需许可。将本书的大量示例代码整合到您产品的文档中需要许可。

我们感谢但通常不需要署名。署名通常包括书名、作者、出版商和 ISBN。例如：“*学习 Blazor*，作者 David Pine（O’Reilly）。版权所有 2023 年 David Pine，978-1-098-11324-7。”

如果您认为您对代码示例的使用超出了合理使用范围或上述许可，请随时通过*permissions@oreilly.com*联系我们。

# O’Reilly 在线学习

###### 注释

超过 40 年来，[*O’Reilly Media*](http://oreilly.com)已为企业提供技术和商业培训、知识和洞见，帮助它们取得成功。

我们独特的专家和创新者网络通过书籍、文章和我们的在线学习平台分享他们的知识和专业知识。O’Reilly 的在线学习平台让您随需应变地访问现场培训课程、深度学习路径、交互式编码环境以及来自 O’Reilly 和其他 200 多家出版商的大量文本和视频。欲了解更多信息，请访问[*https://oreilly.com*](https://oreilly.com)。

# 如何联系我们

请将关于本书的评论和问题发送给出版商：

+   O’Reilly Media, Inc.

+   加利福尼亚州北格雷文斯坦大道 1005 号

+   加利福尼亚州塞巴斯托波尔，95472

+   800-998-9938（美国或加拿大）

+   707-829-0515（国际或当地）

+   707-829-0104（传真）

我们有一本书的网页，列出勘误、示例和任何额外信息。您可以访问[*https://oreil.ly/learning-blazor*](https://oreil.ly/learning-blazor)。

发送电子邮件至*bookquestions@oreilly.com*，对本书进行评论或提出技术问题。

要获取有关我们的图书和课程的新闻和信息，请访问[*https://oreilly.com*](https://oreilly.com)。

在 LinkedIn 上找到我们：[*https://linkedin.com/company/oreilly-media*](https://linkedin.com/company/oreilly-media)

在 Twitter 上关注我们：[*https://twitter.com/oreillymedia*](https://twitter.com/oreillymedia)

在 YouTube 上关注我们：[*https://www.youtube.com/oreillymedia*](https://www.youtube.com/oreillymedia)

# 致谢

我曾作为 ITkonekt 开发者大会的一部分前往塞尔维亚。我与三位令人惊叹的人士共乘一辆旅行面包车。其中一位是当时的.NET 基金会执行董事 Jon Galloway。第二位是 Jonathan LeBlanc，他是我唯一认识的因技术赢得艾美奖的人（现在也是 O’Reilly 的作者之一）。第三位是 Håkon Wium Lie，他因创建 CSS 而闻名，并曾担任 Opera 的 CTO。从他们身上学到了很多，这是一个很好的机会。

无论如何，在旅途中，事实表明，在我们乘坐的面包车里，我是唯一没有写书的人。他们立即鼓励我纠正这一点。他们告诉我要与世界分享我的知识，写一本书。听到我的尊敬的朋友和同事们相信我，我感动不已。我并没有立刻写书，但我仔细考虑了很多，等待时机成熟。现在是时候了！我想感谢 Jon、Jonathan 和 Håkon 对我的信任，以及他们对开发者社区的启发。

请允许我感谢一些贡献者，他们为本书引用的部分源代码做出了贡献。感谢 Ben Felda，为模型应用的主页瓷砖组件提供 SVG 和样式更新。感谢 Max Schmitt，帮助我简化了模型应用的构建验证工作流中 Playwright 测试框架的使用。感谢 Billy Mumby，在支持模型应用的任务列表功能中对底层数据存储的工作。您在我们维护的[Azure Cosmos DB Repository .NET SDK](https://oreil.ly/1rmND)中所做的工作，对开发者社区是巨大的财富。感谢 Weihan Li，为模型应用消费 Blazor 源生成器的贡献，特别是[Blazorators](https://oreil.ly/uBU3o)。感谢 Vsevolod Šliachtenko，在[Azure 资源转换器 GitHub Action](https://oreil.ly/1pGdr)上与我合作和工作。您优美地实现了请求批处理。感谢 GitHub 机器人，截至 2022 年 7 月，自动化了超过 73,000 行代码到 Learning Blazor 项目。

我想感谢我的导师和好朋友 David Fowler。David 长时间以来一直在指导我，他的宝贵教训我都视若珍宝。David 为我的“Have I Been Pwned” .NET HTTP Client 开源项目贡献了代码，简化了 Minimal API 示例。我们的交流经常是我一周的亮点；我与他分享代码、经验、职业挑战和思考，他则以他的智慧回应。他对我和许多其他人都是一个激励，并且我非常感激能从他身上学到东西。

感谢 O’Reilly 团队的支持与鼓励。我要正式感谢这本书的所有审阅人员：Rita Fernando、Carol Tumey、Erik Hopf、Gerald Versluis、John Kennedy、Chad Olson 和 Egil Hansen。没有他们不知疲倦的工作和彻底的审查——从编辑审查关注每个字词到深入的技术审查确保每行代码尽可能简单和优雅——这本书就不会变得如此深刻和有帮助。这种质量得益于数十年的专业实践经验，我对结果感到非常高兴。

我要感谢 Steve Sanderson 创建 Blazor。我非常喜欢使用这项技术编写应用程序。我还要感谢全球开源和.NET 社区的众多贡献者。你们是我的灵感源泉——谢谢你们！

最后，我要感谢我的家人。没有我了不起的妻子 Jennifer 的支持，这一切都不可能实现。她鼓励我成为最好的自己。她比我更早地相信我自己。我要感谢我的三个儿子 Lyric、Londyn 和 Lennyx。他们是未来的不断提醒，是我们在世界上找到的美好。每个孩子都独特地拥有探索精神、好奇心和快乐的一小部分。没有他们的火花和支持，你现在可能不会读到这些。谢谢！

¹ “使用 C#构建客户端 Web 应用程序：Blazor: .NET”，Microsoft，[*https://oreil.ly/iIaWE*](https://oreil.ly/iIaWE)。
