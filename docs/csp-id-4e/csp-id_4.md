## 语言特性按版本

本书主要按版本组织，但很难一眼看出每个版本引入的特性。这对于在 C# 7 的次要版本中引入的特性尤其如此，这些特性通常改进了 C# 7.0 中引入的特性。

此外，了解一个语言特性是否需要运行时或框架支持，或者它是否是纯编译器魔法，可能很有用。本附录旨在尽可能简单地提供所有这些信息。

我还没有提到的一个方面是泛型类型推断在各个版本中的演变。它已经改变了很多次，通常是以太复杂，无法用几句话来概括。我建议你把它当作一个既定事实，即每当引入一个新版本时，泛型类型推断可能已经得到了改进。

| 特性 | 备注和要求 | 章节 |
| --- | --- | --- |
| **C# 2** |
| 泛型 | 需要运行时和框架支持。 | 2.1 |
| 可空值类型 | 需要运行时和框架支持。 | 2.2 |
| 方法组转换 |   | 2.3.1 |
| 匿名方法 |   | 2.3.2 |
| 委托的可变性 |   | 2.3.3 |
| 迭代器（yield return） |   | 2.4 |
| 部分类型 |   | 2.5.1 |
| 静态类 |   | 2.5.2 |
| 属性的单独获取/设置访问 |   | 2.5.3 |
| 命名空间别名限定符 :: 语法 |   | 2.5.4 |
| 全局命名空间别名 |   | 2.5.4 |
| 外部别名 |   | 2.5.5 |
| 固定大小缓冲区 |   | 2.5.6 |
| InternalsVisibleToAttribute 支持 | 需要运行时和框架支持。 | 2.5.7 |
| **C# 3** |
| 部分方法 |   | 2.5.1 |
| 自动实现属性 |   | 3.1 |
| 隐式类型局部变量（var） |   | 3.2.2 |
| 隐式类型数组（new[]） |   | 3.2.3 |
| 对象初始化器 |   | 3.3.2 |
| 集合初始化器 |   | 3.3.3 |
| 匿名类型 |   | 3.4 |
| Lambda 表达式（委托） |   | 3.5 |
| Lambda 表达式（表达式树） | 需要框架支持（表达式树类型）。 | 3.5.3 |
| 扩展方法 | 需要框架支持（属性）。 | 3.6 |
| 查询表达式 |   | 3.7 |
| **C# 4** |
| 动态类型 | 需要框架支持（称为 *Dynamic Language Runtime* 但不是运行时的一部分）。 | 4.1 |
| 可选参数 |   | 4.2 |
| 命名参数 |   | 4.2 |
| 链接的主要互操作程序集 | 需要运行时和框架支持。 | 4.3.1 |
| COM 中可选参数的特殊规则 |   | 4.3.2 |
| 访问命名的索引器（仅 COM） |   | 4.3.3 |
| 接口和委托的泛型方差 | 对现有接口和委托的框架更改。（运行时支持已经存在。） | 4.4 |
| 锁语句的实现更改 | 需要框架支持：Monitor.Enter(object, ref bool)。 | 第三版，第 13.4.1 节 |
| 类似字段的事件的实现更改 |   | 第三版，第 13.4.2 节 |
| 在声明类内部使用类似字段的事件访问 |   | 第三版，第 13.4.2 节 |
| **C# 5** |
| Async/await | 需要框架支持（编译器使用的任务类型和附加基础设施）。 | 第五章 和 第六章 |
| foreach 迭代变量捕获的变化 | 行为变化，但仅针对几乎肯定在先前版本中已损坏的代码。 | 7.1 |
| 调用者信息属性 | 需要框架支持（属性本身）。 | 7.2 |
| **C# 6** |
| 只读自动实现属性 |   | 8.2.1 |
| 自动实现属性的初始化器 |   | 8.2.2 |
| 从包含自动实现属性的结构的构造函数中删除调用 this 的要求 |   | 8.2.3 |
| 表达式成员 |   | 8.3 |
| 嵌套字符串文字 | 当 FormattableString 类和 FormattableStringFactory 可用时，提供对 FormattableString 的额外支持。 | 9.2, 9.3 |
| nameof 运算符 |   | 9.5 |
| using static 指令 |   | 10.1 |
| 使用索引器的对象初始化器 |   | 10.2.1 |
| 使用扩展 Add 方法的集合初始化器 |   | 10.2.2 |
| null 条件?.运算符 |   | 10.3 |
| 异常过滤器 |   | 10.4 |
| 移除了在 try/catch、try/finally 和 try/catch 语句中等待的限制 |   | 5.4.2 |
| **C# 7.0** |
| 元组 | 需要框架支持（ValueTuple 类型）。 | 11.2–11.4 |
| 通过 Deconstruct 方法进行解构 | 直到 C# 7.2 编译器需要存在值元组类型，但不是 C# 7.2 *语言*功能。（实现更改，实际上。） | 12.1, 12.2 |
| 初始模式：常量模式、类型模式、var 模式 |   | 12.4 |
| 使用 is 运算符的模式 |   | 12.5 |
| 在 switch 语句中使用模式，包括守卫子句（when） |   | 12.6 |
| Ref 局部变量 |   | 13.2.1 |
| Ref 返回 |   | 13.2.2 |
| 二进制整数文字 |   | 14.3.1 |
| 数字文字中的下划线分隔符 |   | 14.3.2 |
| 从异步方法返回自定义任务类型 | 需要框架支持（属性）。 | 5.8 |
| 更多类型的表达式成员 |   | 8.3.3 |
| **C# 7.1** |
| 默认文字 |   | 14.5 |
| 改进类型模式以匹配泛型值 |   | 12.4.2 |
| 异步入口点（async Task Main） |   | 5.9 |
| 推断元组元素名称 |   | 11.2.2 |
| **C# 7.2** |
| 允许条件?:运算符与 ref 一起工作 |   | 13.2.3 |
| ref readonly 局部变量和返回类型 | 返回 ref readonly 的方法只能由理解它们的编译器调用。此外，InAttribute 在编译时是必需的，但自.NET 1.1 和.NET Standard 1.1 以来一直存在。 | 13.2.4 |
| in 参数 | 需要 IsReadOnlyAttribute，但如果目标框架中缺少它，则包含在输出中。 | 13.3 |
| 只读结构 | 如前所述，需要 IsReadOnlyAttribute。 | 13.4 |
| 具有 ref/in 参数的扩展方法 |   | 13.5 |
| 类似于 ref 的结构 | 如前所述，需要 IsReadOnlyAttribute。此外，类似于 ref 的结构应用了具有特定消息的 ObsoleteAttribute。类似于 ref-struct 的编译器版本将忽略此属性，但早期编译器将阻止使用该类型。 | 13.6 |
| 对 Span<T>的 stackalloc 支持 | 需要框架支持。 | 13.6.2 |
| 非尾随命名参数 |   | 14.6 |
| 私有受保护访问修饰符 |   | 14.7 |
| 在 0x 或 0b 基数指定符后面的数字字面量中的下划线分隔符 |   | 14.3.2 |
| **C# 7.3** |
| 通过字段访问固定大小的缓冲区，而不使用固定语句 |   | 2.5.6 |
| 元组的==和!=运算符 | 元组可用，但没有新的要求。 | 11.3.6 |
| 在字段、属性和构造函数初始化器中使用模式和 out 变量 |   | 14.2.2 |
| ref 局部变量的重新赋值 |   | 13.2.1 |
| stackalloc 语句中的初始化器 |   | 13.6.2 |
| 使用 GetPinnableReference 的基于模式的固定语句 |   | 13.6.2 |
| 现在允许在 Enum 和 Delegate 上使用泛型类型约束 |   | 14.8.1 |
| 新的未托管类型约束 | 具有未托管约束的类型和方法只能由足够新版本的编译器使用，以理解它。还需要 UnmanagedType 枚举，自.NET 1.1 和.NET Standard 1.1 以来可用。 | 14.8.1 |
| 自动实现属性的字段属性的放置 |   | 14.8.3 |

> ^a
> 
> 这指的是从一个具有兼容但非相同签名的函数构造委托。这与 C# 4 中引入的泛型方差不同。
