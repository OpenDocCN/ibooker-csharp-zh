<html><head></head><body><section data-pdf-bookmark="Chapter 2. Executing the App" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter-two">
<h1><span class="label">Chapter 2. </span>Executing the App</h1>


<p>In this chapter, you’ll learn how a Blazor WebAssembly app starts executing—from the rendering of static HTML to the invocation of JavaScript that bootstraps Blazor, you’ll be exploring the anatomy of the app. This includes the <code>Program</code> entry point and the startup conventions. You’ll learn about the router, client-side navigation, shared components, and layouts. You’ll also learn about top-level navigation and custom components in the app. All of this will be taught using the Learning Blazor sample application’s source code.</p>

<p>Try to embrace the mindset that you’re onboarding as a new developer to an existing application—much like you would in the real world. Try to imagine that you’re starting a new journey, where you’re getting brought up to speed on an existing codebase. The idea is that I’ll be your mentor; I’ll meticulously walk through the code, presenting it to you and explaining exactly what it’s doing and how it’s doing it. You’ll learn why certain decisions were made and what alternative approaches should be considered. You should have a grasp of how the model app works and will be prepared to work with it in future chapters.</p>

<p>In the previous chapter, you learned a bit about the web app development platform, the ASP.NET Core as a framework, open source development, the programming languages of the web, and development environments Now let’s talk code. As Linus Torvalds, the creator of Linux, said, “Talk is cheap. Show me the code.” The model app is the basis for the entire book, where you’ll learn how all of the major features of Blazor work and how to use other amazing features. We’ll look at the code together, and you’ll get to read the code and let it tell you its own story. In the next few sections, you’ll learn how the Blazor framework initializes the app and how the app starts executing. I suggest you check out <a href="https://webassemblyof.net"><em class="hyperlink">https://webassemblyof.net</em></a> to see what the final web app looks like. Feel free to click around and try out the various features to familiarize yourself with the app.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46365046717376">
<h5>A Love Letter for the Next Developer</h5>
<p>Let’s take a moment to show some love for code. Whether you’re a developer motivated by a paycheck or one who wants to leave the world a better place, we all appreciate what code can do. At the base level, code simply tells computers what to do, and that in itself is awesome. But good code, well-written code, is a masterpiece and is full of love for the next developer. If you write code well, you’re setting up the next developer who uses your code for success. That developer will be able to read, understand, debug, maintain, and extend your code. Poorly written code, on the other hand, is a terrible legacy to pass on. So remember that although the code itself is important, the human beings behind it are more important.</p>
</div></aside>






<section data-pdf-bookmark="Requesting the Initial Page" data-type="sect1"><div class="sect1" id="idm46365046715888">
<h1>Requesting the Initial Page</h1>

<p>Let’s start by evaluating what <a data-primary="applications" data-secondary="initial page, requesting" data-type="indexterm" id="initpg"/><a data-primary="initial page, requesting" data-type="indexterm" id="itgqs"/>happens when a client browser wants to access our application. It requests the initial page (given its URL), and HTML is returned from the server. Within the HTML itself, there are <code>&lt;link&gt;</code> and <code>&lt;script&gt;</code> elements. These define additional references to resources that our Blazor application needs to start accepting user input with components rendered from the Blazor markup. The resources include, but are not limited to, CSS, JavaScript, images, Wasm files, and .NET dynamic-link libraries (.dlls). These additional resources are requested as part of the initial page load, and while this is happening there can be no interaction with the app. Depending on the size of the peripheral resources and the connection speed of the client, the amount of time it takes for the app to become interactive will vary.</p>

<p>The <em>Time to Interactive</em> (TTI) is a measurement <a data-primary="TTI (Time to Interactive)" data-type="indexterm" id="idm46365046710256"/><a data-primary="Time to Interactive (TTI)" data-type="indexterm" id="idm46365046709488"/>of the amount of time it takes before a website is ready to accept user input. One of the trade-offs of using Blazor WebAssembly is that the initial load time of the app is a bit longer than that of Blazor Server. The app has to be downloaded to the browser before running, whereas with Blazor Server the app is rendered dynamically on the web host. This requires the .NET runtime and a configured web server.</p>
<div data-type="tip"><h6>Tip</h6>
<p>One advantage of using Blazor WebAssembly is that <a data-primary="applications" data-secondary="hosting as static web app" data-type="indexterm" id="idm46365046707696"/>the app can be hosted as a static web app. Serving static files is much faster and less error-prone than serving dynamic content. But it does come at a cost. The app will be downloaded to the client browser, and the client browser will have to download the entire app. This can be a large download, and it can be a bit slower than the app running on the server.</p>
</div>

<p>The TTI for Blazor WebAssembly can be a <a data-primary="TTI (Time to Interactive)" data-type="indexterm" id="idm46365046706064"/><a data-primary="Time to Interactive (TTI)" data-type="indexterm" id="idm46365046705344"/><a data-primary="Blazor WebAssembly" data-secondary="TTI (Time to Interactive)" data-type="indexterm" id="idm46365046704656"/><a data-primary="Blazor Server" data-secondary="TTI (Time to Interactive)" data-type="indexterm" id="idm46365046703696"/>bit longer than that of Blazor Server. Hypothetically, if the TTI is more than a few seconds, users will expect some sort of visual indication, such as an animated spinning gear cog to show that the app is loading.</p>

<p>With Blazor WebAssembly, you can <em>lazy load</em> full .NET assemblies. This is much like doing the equivalent thing in <a data-primary="lazy loading" data-type="indexterm" id="idm46365046701584"/>JavaScript—where various components are represented by JavaScript—but instead we get to use C#. This feature can make your application more efficient by fetching only the dependent assembly on demand and when needed. Before showing you how to lazy load assemblies, however, you’ll learn how the Blazor WebAssembly application startup loads assemblies.</p>

<p>Let’s start by examining the parts of <a data-primary="applications" data-secondary="initial page, requesting" data-startref="initpg" data-type="indexterm" id="idm46365046700304"/><a data-primary="initial page, requesting" data-startref="itgqs" data-type="indexterm" id="idm46365046698992"/>the initial page’s HTML content.</p>
</div></section>













<section data-pdf-bookmark="App Startup and Bootstrapping" data-type="sect1"><div class="sect1" id="app_startup">
<h1>App Startup and Bootstrapping</h1>

<p>The following HTML is served to the client, <a data-primary="applications" data-secondary="startup" data-type="indexterm" id="appstup"/><a data-primary="bootstrapping" data-type="indexterm" id="btspp"/>and it’s important to understand what the client browser will do when it renders it. Let’s jump in and take a look at the <em>wwwroot/index.html</em> file from the Web.Client project. I know it’s a lot, but read through it first, and we’ll go through it piece-by-piece after:</p>

<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="p">&lt;</code><code class="nt">html</code> <code class="na">class</code><code class="o">=</code><code class="s">"has-navbar-fixed-top"</code><code class="p">&gt;</code>

<code class="p">&lt;</code><code class="nt">head</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">meta</code> <code class="na">charset</code><code class="o">=</code><code class="s">"utf-8"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">meta</code> <code class="na">name</code><code class="o">=</code><code class="s">"viewport"</code>
        <code class="na">content</code><code class="o">=</code><code class="s">"</code>
<code class="s">		width=device-width, initial-scale=1.0,</code>
<code class="s">		maximum-scale=1.0, user-scalable=no"</code> <code class="p">/&gt;</code>

    <code class="p">&lt;</code><code class="nt">title</code><code class="p">&gt;</code>Learning Blazor<code class="p">&lt;/</code><code class="nt">title</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"stylesheet"</code><code class="p">&gt;</code>

    <code class="cm">&lt;!-- Bulma: micro extensions --&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		bulma-slider@2.0.4/dist/css/bulma-slider.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		bulma-quickview@2.0.0/dist/css/bulma-quickview.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		@creativebulma/bulma-tooltip@1.2.0/dist/bulma-tooltip.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		bulma-badge@3.0.1/dist/css/bulma-badge.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		@creativebulma/bulma-badge@1.0.1/dist/bulma-badge.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">type</code><code class="o">=</code><code class="s">"text/css"</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://unpkg.com/bulma-prefers-dark"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"/css/app.css"</code> <code class="na">rel</code><code class="o">=</code><code class="s">"stylesheet"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"Web.Client.styles.css"</code> <code class="na">rel</code><code class="o">=</code><code class="s">"stylesheet"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"/_content/Web.TwitterComponents/twitter-component.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"stylesheet"</code> <code class="p">/&gt;</code>

    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"manifest"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/manifest.json"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"apple-touch-icon"</code> <code class="na">sizes</code><code class="o">=</code><code class="s">"512x512"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/icon-512.png"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"apple-touch-icon"</code> <code class="na">sizes</code><code class="o">=</code><code class="s">"192x192"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/icon-192.png"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"icon"</code> <code class="na">type</code><code class="o">=</code><code class="s">"image/png"</code> <code class="na">sizes</code><code class="o">=</code><code class="s">"32x32"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/icon-32.png"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"icon"</code> <code class="na">type</code><code class="o">=</code><code class="s">"image/png"</code> <code class="na">sizes</code><code class="o">=</code><code class="s">"16x16"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/icon-16.png"</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">base</code> <code class="na">href</code><code class="o">=</code><code class="s">"/"</code> <code class="p">/&gt;</code>

    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"https://kit.fontawesome.com/b5bcf1e25a.js"</code>
            <code class="na">crossorigin</code><code class="o">=</code><code class="s">"anonymous"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"/js/app.js"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">head</code><code class="p">&gt;</code>

<code class="p">&lt;</code><code class="nt">body</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"app"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">section</code> <code class="na">id</code><code class="o">=</code><code class="s">"splash"</code> <code class="na">class</code><code class="o">=</code><code class="s">"hero is-fullheight-with-navbar"</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"hero-body"</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"container has-text-centered"</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="nt">img</code> <code class="na">src</code><code class="o">=</code><code class="s">"media/blazor-logo.png"</code>
                         <code class="na">class</code><code class="o">=</code><code class="s">"blazor-logo mb-5"</code> <code class="p">/&gt;</code>
                    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"fa-3x is-family-code"</code><code class="p">&gt;</code>
                        <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"has-text-weight-bold"</code><code class="p">&gt;</code>
                        Blazor WebAssembly:<code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code> Loading...
                        <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-sync fa-spin"</code><code class="p">&gt;&lt;/</code><code class="nt">i</code><code class="p">&gt;</code>
                    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
                <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
            <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">section</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"blazor-error-ui"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal is-active"</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-background"</code><code class="p">&gt;&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-content"</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">article</code> <code class="na">class</code><code class="o">=</code><code class="s">"message is-warning is-medium"</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"message-header"</code><code class="p">&gt;</code>
                        <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"icon"</code><code class="p">&gt;</code>
                                <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-exclamation-circle"</code><code class="p">&gt;&lt;/</code><code class="nt">i</code><code class="p">&gt;</code>
                            <code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code>Error<code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
                        <code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>
                    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"message-body"</code><code class="p">&gt;</code>
                        An unhandled error has occurred.
                        <code class="p">&lt;</code><code class="nt">button</code> <code class="na">class</code><code class="o">=</code><code class="s">"button is-danger is-pulled-right"</code>
                                <code class="na">onClick</code><code class="o">=</code><code class="s">"</code>
<code class="s">				window.location.assign(window.location.origin)"</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"icon"</code><code class="p">&gt;</code>
                                <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-redo"</code><code class="p">&gt;&lt;/</code><code class="nt">i</code><code class="p">&gt;</code>
                            <code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code>Reload<code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
                        <code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code>
                    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
                <code class="p">&lt;/</code><code class="nt">article</code><code class="p">&gt;</code>
            <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">button</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-close is-large"</code> <code class="na">aria-label</code><code class="o">=</code><code class="s">"close"</code><code class="p">&gt;&lt;/</code><code class="nt">button</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"/_content/Microsoft.Authentication.WebAssembly.Msal/</code>
<code class="s">		AuthenticationService.js"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"/_framework/blazor.webassembly.js"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">script</code><code class="p">&gt;</code><code class="nx">navigator</code><code class="p">.</code><code class="nx">serviceWorker</code><code class="p">.</code><code class="nx">register</code><code class="p">(</code><code class="s1">'service-worker.js'</code><code class="p">);&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">body</code><code class="p">&gt;</code>

<code class="p">&lt;/</code><code class="nt">html</code><code class="p">&gt;</code></pre>

<p>Let’s break down each of the primary sections. We’ll start with reading through the <code>&lt;head&gt;</code> tag’s child elements:</p>

<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">head</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">meta</code> <code class="na">charset</code><code class="o">=</code><code class="s">"utf-8"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">meta</code> <code class="na">name</code><code class="o">=</code><code class="s">"viewport"</code>
        <code class="na">content</code><code class="o">=</code><code class="s">"</code>
<code class="s">		width=device-width, initial-scale=1.0,</code>
<code class="s">		maximum-scale=1.0, user-scalable=no"</code> <code class="p">/&gt;</code>

    <code class="p">&lt;</code><code class="nt">title</code><code class="p">&gt;</code>Learning Blazor<code class="p">&lt;/</code><code class="nt">title</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"stylesheet"</code><code class="p">&gt;</code>

    <code class="cm">&lt;!-- Bulma: micro extensions --&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		bulma-slider@2.0.4/dist/css/bulma-slider.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		bulma-quickview@2.0.0/dist/css/bulma-quickview.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		@creativebulma/bulma-tooltip@1.2.0/dist/bulma-tooltip.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		bulma-badge@3.0.1/dist/css/bulma-badge.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://cdn.jsdelivr.net/npm/</code>
<code class="s">		@creativebulma/bulma-badge@1.0.1/dist/bulma-badge.min.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">type</code><code class="o">=</code><code class="s">"text/css"</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://unpkg.com/bulma-prefers-dark"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">as</code><code class="o">=</code><code class="s">"style"</code> <code class="na">onload</code><code class="o">=</code><code class="s">"this.rel='stylesheet'"</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"/css/app.css"</code> <code class="na">rel</code><code class="o">=</code><code class="s">"stylesheet"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"Web.Client.styles.css"</code> <code class="na">rel</code><code class="o">=</code><code class="s">"stylesheet"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">href</code><code class="o">=</code><code class="s">"/_content/Web.TwitterComponents/twitter-component.css"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"stylesheet"</code> <code class="p">/&gt;</code>

    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"manifest"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/manifest.json"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"apple-touch-icon"</code> <code class="na">sizes</code><code class="o">=</code><code class="s">"512x512"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/icon-512.png"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"apple-touch-icon"</code> <code class="na">sizes</code><code class="o">=</code><code class="s">"192x192"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/icon-192.png"</code> <code class="p">/&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"icon"</code> <code class="na">type</code><code class="o">=</code><code class="s">"image/png"</code> <code class="na">sizes</code><code class="o">=</code><code class="s">"32x32"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/icon-32.png"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"icon"</code> <code class="na">type</code><code class="o">=</code><code class="s">"image/png"</code> <code class="na">sizes</code><code class="o">=</code><code class="s">"16x16"</code> <code class="na">href</code><code class="o">=</code><code class="s">"/icon-16.png"</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">base</code> <code class="na">href</code><code class="o">=</code><code class="s">"/"</code> <code class="p">/&gt;</code>

    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"https://kit.fontawesome.com/b5bcf1e25a.js"</code>
            <code class="na">crossorigin</code><code class="o">=</code><code class="s">"anonymous"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"/js/app.js"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">head</code><code class="p">&gt;</code></pre>

<p>The app uses the web standard UTF-8 character set, and there’s also a <code>viewport</code> specification, both of which are very common <code>&lt;meta&gt;</code> tags in HTML. We set the initial <code>&lt;title&gt;</code> of the page to <code>"Learning Blazor"</code>. After the title is a set of <code>&lt;link&gt;</code> elements. If you spend time evaluating alternative options to the default Bootstrap CSS from the template, you may consider a CSS framework that takes zero JavaScript dependencies.</p>

<p>In this instance, Bulma <a data-primary="Bulma" data-type="indexterm" id="idm46365047840272"/><a data-primary="CSS libraries, Bulma" data-type="indexterm" id="idm46365047839568"/>was chosen as the CSS framework because it’s amazingly simple and clean. This is a perfect match for Blazor, as we can use C# instead of JavaScript to change styles at will. As described in <a href="https://oreil.ly/kstH3">the Bulma documentation</a>, “Bulma is a CSS library. This means it provides CSS classes to help you style your HTML code. To use Bulma, you can either use the pre-compiled <em>.css</em> file or install the <em>.sass</em> files so you can customize it to your needs.” Bulma provides everything needed to style the website; with extensibility in mind, you have modern utilities, helpers, elements, components, forms, and layout styles. Bulma also has a huge developer community following, where extensions are shared. These additional CSS packages depend on Bulma itself; they just override or extend existing class definitions. This is the same approach in any web app development and is not unique to Blazor.</p>

<p>When we see a <code>&lt;link&gt;</code> element that has a <code>rel</code> attribute set to <code>"preload"</code>, it indicates that these requests will happen asynchronously. This works by adding the <code>as="style" onload="this.rel='stylesheet'"</code> attributes. This lets the browser know that the <code>&lt;link&gt;</code> is for a style sheet. It will also eventually load the resource, and when it does it will set <code>rel</code> to <code>"stylesheet"</code>. Let’s think of <a data-primary="hot-swap on load" data-type="indexterm" id="idm46365045762000"/>this as the <em>hot-swap on load tactic</em>. We will pull in some additional CSS references for sliders, quick views, tooltips, and media-query-centric <code>@media (prefers-color-scheme: dark) <span class="keep-together">{ /* styles */ }</span></code> functionality. This exposes the ability to detect the client’s preferred color scheme and apply the appropriate styles. For example, an alternative color scheme to the default <code>white</code> is <code>dark</code>. These two color schemes account for the majority of all web user experiences.</p>

<p>We then define another <code>&lt;link&gt;</code> with an <code>href</code> to the <em>/css/app.css</em> path to the web server.</p>

<p>The important styles from Bulma are not using the <em>hot-swap on load tactic</em>. While the app is loading, it’s styled appropriately to communicate that the app is working (see <a data-type="xref" href="#blazor_webassembly_loading">Figure 2-1</a>). The app also preemptively declares <code>&lt;link rel="manifest" href="/​man⁠ifest.json" /&gt;</code> with the corresponding <code>&lt;link&gt;</code> icons. This is specifically to expose icons and the PWA capabilities. Per MDN’s <a href="https://oreil.ly/X62KY">HTML reference guide</a>, “the HTML &lt; base&gt; element specifies the base URL to use for all relative URLs in a document. There can be only one <code>&lt;base&gt;</code> element in a document.”</p>

<p>All applications should consider the <a data-primary="applications" data-secondary="iconography" data-type="indexterm" id="idm46365045752656"/><a data-primary="iconography" data-type="indexterm" id="idm46365045751296"/>usage of iconography where possible to make for a more accessible web experience. Icons, when done correctly, can immediately convey a message and intent, and often with little text. I proudly use Font Awesome; they have a free offering and provide seamless integration of it wherever it is needed in Blazor <a data-primary="scripts" data-type="indexterm" id="idm46365045750496"/>markup. A <code>&lt;script&gt;</code> points to my Font Awesome kit <a data-primary="Font Awesome kit" data-type="indexterm" id="idm46365045749280"/>registered to my app. The next line, immediately following the Font Awesome source, is the application’s JavaScript bits. There are three primary areas of focus in web app development, each within the <em>/js</em>, <em>/css</em>, and <em>/_content</em> directories. After familiarizing yourself with the child elements of the <code>&lt;head&gt;</code> node, we can move on. Next, we’ll <a data-primary="&lt;body&gt; nodes" data-primary-sortas="body nodes" data-type="indexterm" id="idm46365045746704"/>take a look at the content of the <code>&lt;body&gt;</code> nodes:</p>

<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">body</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"app"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">section</code> <code class="na">id</code><code class="o">=</code><code class="s">"splash"</code> <code class="na">class</code><code class="o">=</code><code class="s">"hero is-fullheight-with-navbar"</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"hero-body"</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"container has-text-centered"</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="nt">img</code> <code class="na">src</code><code class="o">=</code><code class="s">"media/blazor-logo.png"</code>
                         <code class="na">class</code><code class="o">=</code><code class="s">"blazor-logo mb-5"</code> <code class="p">/&gt;</code>
                    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"fa-3x is-family-code"</code><code class="p">&gt;</code>
                        <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"has-text-weight-bold"</code><code class="p">&gt;</code>
                        Blazor WebAssembly:<code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code> Loading...
                        <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-sync fa-spin"</code><code class="p">&gt;&lt;/</code><code class="nt">i</code><code class="p">&gt;</code>
                    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
                <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
            <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">section</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"blazor-error-ui"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal is-active"</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-background"</code><code class="p">&gt;&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-content"</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">article</code> <code class="na">class</code><code class="o">=</code><code class="s">"message is-warning is-medium"</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"message-header"</code><code class="p">&gt;</code>
                        <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"icon"</code><code class="p">&gt;</code>
                                <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-exclamation-circle"</code><code class="p">&gt;&lt;/</code><code class="nt">i</code><code class="p">&gt;</code>
                            <code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code>Error<code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
                        <code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>
                    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"message-body"</code><code class="p">&gt;</code>
                        An unhandled error has occurred.
                        <code class="p">&lt;</code><code class="nt">button</code> <code class="na">class</code><code class="o">=</code><code class="s">"button is-danger is-pulled-right"</code>
                                <code class="na">onClick</code><code class="o">=</code><code class="s">"</code>
<code class="s">				window.location.assign(window.location.origin)"</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"icon"</code><code class="p">&gt;</code>
                                <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-redo"</code><code class="p">&gt;&lt;/</code><code class="nt">i</code><code class="p">&gt;</code>
                            <code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code>Reload<code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
                        <code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code>
                    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
                <code class="p">&lt;/</code><code class="nt">article</code><code class="p">&gt;</code>
            <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">button</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-close is-large"</code> <code class="na">aria-label</code><code class="o">=</code><code class="s">"close"</code><code class="p">&gt;&lt;/</code><code class="nt">button</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"/_content/Microsoft.Authentication.WebAssembly.Msal/</code>
<code class="s">		AuthenticationService.js"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"/_framework/blazor.webassembly.js"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">script</code><code class="p">&gt;</code><code class="nx">navigator</code><code class="p">.</code><code class="nx">serviceWorker</code><code class="p">.</code><code class="nx">register</code><code class="p">(</code><code class="s1">'service-worker.js'</code><code class="p">);&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">body</code><code class="p">&gt;</code></pre>

<p class="pagebreak-after">The first tag in the <code>&lt;body&gt;</code> element is <code>&lt;div id="app"&gt;...&lt;/div&gt;</code>. This is the root of the Blazor application, the true SPA. It is very important to understand that the contents of this target element will be automatically and dynamically changed to represent the Wasm application’s manipulation of the DOM. Most SPA developers settle with letting the UX be a giant white wall of <code>10pt</code> default font with black text that reads “Loading…” It’s not okay for UX. Ideally, we’d want to provide <a data-primary="UX" data-secondary="visual cues" data-type="indexterm" id="idm46365045428416"/>visual cues to the user that the application is responsive and loading. One approach <a data-primary="Blazor WebAssembly" data-secondary="loading" data-type="indexterm" id="idm46365045427312"/>to achieve this is to have a <code>&lt;div&gt;</code> initially represent a basic splash screen. In this case, the model app will include the Blazor logo image and a message that reads <code>"Blazor WebAssembly: Loading..."</code> It will also show an animated loading spinner icon.</p>

<p><code>&lt;section id="splash"&gt;...&lt;/section&gt;</code> acts as the loading markup. It will be replaced when Blazor is ready. This markup is not Blazor but rather HTML and CSS. This markup will render similarly to that shown in <a data-type="xref" href="#blazor_webassembly_loading">Figure 2-1</a>. Without this markup, the default loading experience has black text and says “Loading.” This gives you the ability to customize the splash (or loading) screen UX.</p>
<div data-type="tip"><h6>Tip</h6>
<p>When writing your Blazor apps, you should <a data-primary="loading indicator" data-type="indexterm" id="idm46365045573392"/><a data-primary="UX" data-secondary="loading indicator" data-type="indexterm" id="idm46365045572688"/>consider adding a loading indicator to your application. This is a great way to give users a sense of progress and avoid a “white screen of death” when the application is first loaded.</p>
</div>

<figure><div class="figure" id="blazor_webassembly_loading">
<img alt="" src="assets/lblz_0201.png"/>
<h6><span class="label">Figure 2-1. </span>An indicator lets the user know the app is loading</h6>
</div></figure>

<p>In the <em>index.html</em> file, following the <em>app</em> node, there lies the “blazor-error-ui” <code>&lt;div&gt;</code> element. This is <a data-primary="&lt;div&gt; element" data-primary-sortas="div element" data-type="indexterm" id="idm46365045567680"/><a data-primary="index.html" data-type="indexterm" id="idm46365045566672"/>adjusted from the template to be a bit more suited to our app’s styling. This specific element identifier will be used by Blazor when it’s bootstrapping itself into the driver seat. If there are any unrecoverable errors, it will show this element. If all goes well, you shouldn’t see this.</p>

<p>After the error element are a few remaining <code>&lt;script&gt;</code> tags. These are the JavaScript references for our referenced components, such as authentication and our Twitter Component <a data-primary="&lt;script&gt; tags" data-primary-sortas="script tags" data-type="indexterm" id="idm46365045565008"/>library. The final two <code>&lt;script&gt;</code> tags are very important:</p>

<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"/_framework/blazor.webassembly.js"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
<code class="p">&lt;</code><code class="nt">script</code><code class="p">&gt;</code><code class="nx">navigator</code><code class="p">.</code><code class="nx">serviceWorker</code><code class="p">.</code><code class="nx">register</code><code class="p">(</code><code class="s1">'service-worker.js'</code><code class="p">);&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre>

<p>The first <code>&lt;script&gt;</code> tag’s <a data-primary="blazor.webassembly.js file" data-type="indexterm" id="idm46365045516560"/>referenced JavaScript (the <em>blazor.webassembly.js</em> file) is what starts the execution of Blazor WebAssembly. Without this line, this app would not render anything besides a never-ending loading page. This JavaScript file initiates the boot subroutine from Blazor, where WebAssembly takes hold, JavaScript interop lights up, and the fun starts! The various .NET executables, namely <em>.dlls</em>, are fetched, and the Mono runtime is prepared. As part of the Blazor boot <a data-primary="boot subroutine" data-type="indexterm" id="idm46365045548288"/>subroutine, the <em>app</em> element is <a data-primary="app element" data-type="indexterm" id="idm46365045547040"/>discovered in the document. The entry point of the app is invoked. This is where the .NET app starts executing in the context of WebAssembly.</p>

<p>The second <code>&lt;script&gt;</code> tag registers the application’s service worker JavaScript code. This exposes our app as a PWA, which is <a data-primary="applications" data-secondary="startup" data-startref="appstup" data-type="indexterm" id="idm46365045545344"/><a data-primary="bootstrapping" data-startref="btspp" data-type="indexterm" id="idm46365045544096"/><a data-primary="PWAs (progressive web apps)" data-type="indexterm" id="idm46365045543152"/><a data-primary="progressive web apps (PWAs)" data-type="indexterm" id="idm46365045542512"/>a nice feature. It’s a way to make your app available offline and service worker functionality. For more information about PWAs, see Microsoft’s <a href="https://oreil.ly/5Ji8p">“Overview of Progressive Web Apps (PWAs)” documentation</a>.</p>
</div></section>













<section data-pdf-bookmark="Blazor WebAssembly App Internals" data-type="sect1"><div class="sect1" id="idm46365045540832">
<h1>Blazor WebAssembly App Internals</h1>

<p>Every application has a required entry point. In a web client app, that is the initial request to the web server where the app is hosted. When the <em>_frame⁠work/​blazor.webassembly.js</em> file is running, it starts requesting .dlls, and the runtime starts the Blazor application’s executable. With Blazor WebAssembly, like most other .NET apps, the <em>Program.cs</em> is the entry point. <a data-type="xref" href="#blazor_webassembly_program">Example 2-1</a> is <a data-primary="Program.cs" data-type="indexterm" id="idm46365047391280"/>the Web.Client project’s <em>Program.cs</em> C# file of the model app.</p>
<div data-type="example" id="blazor_webassembly_program">
<h5><span class="label">Example 2-1. </span>Web.Client/Program.cs</h5>

<pre data-code-language="csharp" data-type="programlisting"><code class="kt">var</code> <code class="n">builder</code> <code class="p">=</code> <code class="n">WebAssemblyHostBuilder</code><code class="p">.</code><code class="n">CreateDefault</code><code class="p">(</code><code class="n">args</code><code class="p">);</code>
<code class="n">builder</code><code class="p">.</code><code class="n">RootComponents</code><code class="p">.</code><code class="n">Add</code><code class="p">&lt;</code><code class="n">App</code><code class="p">&gt;(</code><code class="s">"#app"</code><code class="p">);</code>
<code class="n">builder</code><code class="p">.</code><code class="n">RootComponents</code><code class="p">.</code><code class="n">Add</code><code class="p">&lt;</code><code class="n">HeadOutlet</code><code class="p">&gt;(</code><code class="s">"head::after"</code><code class="p">);</code>

<code class="k">if</code> <code class="p">(</code><code class="n">builder</code><code class="p">.</code><code class="n">HostEnvironment</code><code class="p">.</code><code class="n">IsDevelopment</code><code class="p">())</code>
<code class="p">{</code>
    <code class="n">builder</code><code class="p">.</code><code class="n">Logging</code><code class="p">.</code><code class="n">SetMinimumLevel</code><code class="p">(</code><code class="n">LogLevel</code><code class="p">.</code><code class="n">Debug</code><code class="p">);</code>
<code class="p">}</code>

<code class="n">builder</code><code class="p">.</code><code class="n">ConfigureServices</code><code class="p">();</code>

<code class="k">await</code> <code class="k">using</code> <code class="nn">var</code> <code class="n">host</code> <code class="p">=</code> <code class="n">builder</code><code class="p">.</code><code class="n">Build</code><code class="p">();</code>

<code class="n">host</code><code class="p">.</code><code class="n">TrySetDefaultCulture</code><code class="p">();</code>
<code class="k">await</code> <code class="n">host</code><code class="p">.</code><code class="n">RunAsync</code><code class="p">();</code></pre></div>

<p>Blazor relies on dependency injection as <a data-primary="DI (dependency injection)" data-type="indexterm" id="idm46365047339168"/><a data-primary="dependency injection" data-see="DI" data-type="indexterm" id="idm46365047338560"/>a first-class citizen of its core architecture.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>Dependency injection</em> (DI) is defined as an object declaring other objects as a dependency and a mechanism in which these dependencies are injected into the dependent object. A basic example of this would be <code>ServiceOne</code> requiring <code>ServiceTwo</code>, and a service provider instantiates <code>ServiceOne</code> given <code>ServiceTwo</code> as a dependency. In this contrived example, both <code>ServiceOne</code> and <code>ServiceTwo</code> would have to be registered with the service provider. <code>ServiceTwo</code> is instantiated by the provider and passed to <code>ServiceOne</code> as a dependency whenever <code>ServiceOne</code> is used.</p>
</div>

<p>The entry point is succinct and makes use of C#’s top-level program syntax, which requires less boilerplate, such as omitting a <code>class Program</code> object. We create a default <code>WebAssemblyHostBuilder</code> from the app’s <code>args</code>. The <code>builder</code> instance adds two root components: first, the <code>App</code> component paired with the <code>#app</code> selector, which will resolve our <code>&lt;div id="app"&gt;&lt;/div&gt;</code> element from the previously discussed <em>index.html</em> file. Second, we add a <code>HeadOutlet</code> component after the <code>&lt;head&gt;</code> content. This <code>Head​Out⁠let</code> is provided by Blazor, and it enables the ability to dynamically append or update <code>&lt;meta&gt;</code> tags or related <code>&lt;head&gt;</code> content to the HTML document.</p>

<p>When the application is running <a data-primary="development environment" data-type="indexterm" id="idm46365047273440"/>in a development environment, the minimum logging level is set appropriately to debug. The <code>builder</code> invokes <code>ConfigureServices</code>, which <a data-primary="ConfigureServices" data-type="indexterm" id="idm46365047271664"/>is an extension method that encapsulates the registration of various services the client app requires. The services that <a data-primary="services, registering" data-type="indexterm" id="idm46365047270800"/><a data-primary="registering services" data-type="indexterm" id="idm46365047270128"/>are registered include the following:</p>
<dl>
<dt><code>ApiAccessAuthorizationMessageHandler</code></dt>
<dd>
<p>The custom handler <a data-primary="ApiAccessAuthorizationMessageHandler" data-type="indexterm" id="idm46365047782128"/>used to authorize outbound HTTP requests using an access token</p>
</dd>
<dt><code>CultureService</code></dt>
<dd>
<p>An <a data-primary="CultureService" data-type="indexterm" id="idm46365047779888"/>intermediary custom service used specifically to encapsulate common logic related to the client <code>CultureInfo</code></p>
</dd>
<dt><code>HttpClient</code></dt>
<dd>
<p>A framework-provided HTTP <a data-primary="HttpClient" data-type="indexterm" id="idm46365047777216"/>client configured with the culture services’ two-letter ISO language name as a default request header</p>
</dd>
<dt><code>MsalAuthentication</code></dt>
<dd>
<p>The framework-provided Azure business-to-consumer (B2C) and Microsoft Authentication Library (MSAL), <a data-primary="MSAL (Microsoft Authentication Library)" data-type="indexterm" id="idm46365047774752"/><a data-primary="Microsoft Authentication Library (MSAL)" data-type="indexterm" id="idm46365047773984"/>which is bound <a data-primary="MsalAuthentication" data-type="indexterm" id="idm46365047773168"/>and configured for the app’s tenant</p>
</dd>
<dt><code>SharedHubConnection</code></dt>
<dd>
<p>A custom service <a data-primary="SharedHubConnection" data-type="indexterm" id="idm46365047770928"/><a data-primary="SignalR HubConnection" data-type="indexterm" id="idm46365047770192"/>that shares a single SignalR <code>HubConnection</code> with multiple components</p>
</dd>
<dt><code>AppInMemoryState</code></dt>
<dd>
<p>A custom service used <a data-primary="AppInMemoryState" data-type="indexterm" id="idm46365047767472"/>to expose in-memory application state</p>
</dd>
<dt><code>CoalescingStringLocalizer&lt;T&gt;</code></dt>
<dd>
<p>A generic custom <a data-primary="CoalescingStringLocalizer" data-type="indexterm" id="idm46365047765136"/>service that leverages a component-first localization attempt, falling back to a shared approach</p>
</dd>
<dt><code>GeoLocationService</code></dt>
<dd>
<p>The custom client <a data-primary="GeoLocationService" data-type="indexterm" id="idm46365047762688"/>service for querying geographical information given a longitude and latitude</p>
</dd>
</dl>

<p>After all the services are registered, we call <code>builder.Build()</code>, which returns a 
<span class="keep-together"><code>WebAssemblyHost</code></span> object, and this type implements the <code>IAsyncDisposable</code> interface. As such, we’re mindful to properly <code>await using</code> the <code>host</code> instance. This asynchronously uses the <code>host</code> and will implicitly dispose of it when it’s no longer needed.</p>








<section data-pdf-bookmark="Detecting Client Culture at Startup" data-type="sect2"><div class="sect2" id="detect-client-culture">
<h2>Detecting Client Culture at Startup</h2>

<p>You may have noticed that the <code>host</code> had another <a data-primary="client culture" data-type="indexterm" id="ccldt"/><a data-primary="startup" data-secondary="client culture detection" data-type="indexterm" id="sttccd"/>extension method that was used. The <code>host.TrySetDefaultCulture</code> method will attempt to set the default culture. The <code>culture</code> in this context is represented by the <a href="https://oreil.ly/PrM7u"><code>CultureInfo</code></a> .NET object and acts as the locale of the browser, such as <code>en-US</code>, for example. The extension method is defined with the <em>WebAssemblyHostExtensions.cs</em> C# file of <a data-primary="WebAssemblyHostExtensions.cs" data-type="indexterm" id="idm46365047750656"/>the Web.Client project:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code> <code class="nn">Learning.Blazor.Extensions</code><code class="p">;</code>

<code class="k">internal</code> <code class="k">static</code> <code class="k">class</code> <code class="nc">WebAssemblyHostExtensions</code>
<code class="p">{</code>
    <code class="k">internal</code> <code class="k">static</code> <code class="k">void</code> <code class="nf">TrySetDefaultCulture</code><code class="p">(</code><code class="k">this</code> <code class="n">WebAssemblyHost</code> <code class="n">host</code><code class="p">)</code>
    <code class="p">{</code>
        <code class="k">try</code>
        <code class="p">{</code>
            <code class="kt">var</code> <code class="n">localStorage</code> <code class="p">=</code>
                <code class="n">host</code><code class="p">.</code><code class="n">Services</code><code class="p">.</code><code class="n">GetRequiredService</code><code class="p">&lt;</code><code class="n">ILocalStorageService</code><code class="p">&gt;();</code>
            <code class="kt">var</code> <code class="n">clientCulture</code> <code class="p">=</code>
                <code class="n">localStorage</code><code class="p">.</code><code class="n">GetItem</code><code class="p">&lt;</code><code class="kt">string</code><code class="p">&gt;(</code><code class="n">StorageKeys</code><code class="p">.</code><code class="n">ClientCulture</code><code class="p">);</code>
            <code class="n">clientCulture</code> <code class="p">??=</code> <code class="s">"en-US"</code><code class="p">;</code>

            <code class="n">CultureInfo</code> <code class="n">culture</code> <code class="p">=</code> <code class="k">new</code><code class="p">(</code><code class="n">clientCulture</code><code class="p">);</code>
            <code class="n">CultureInfo</code><code class="p">.</code><code class="n">DefaultThreadCurrentCulture</code> <code class="p">=</code> <code class="n">culture</code><code class="p">;</code>
            <code class="n">CultureInfo</code><code class="p">.</code><code class="n">DefaultThreadCurrentUICulture</code> <code class="p">=</code> <code class="n">culture</code><code class="p">;</code>
        <code class="p">}</code>
        <code class="k">catch</code> <code class="p">(</code><code class="n">Exception</code> <code class="n">ex</code><code class="p">)</code> <code class="k">when</code> <code class="p">(</code><code class="n">Debugger</code><code class="p">.</code><code class="n">IsAttached</code><code class="p">)</code>
        <code class="p">{</code>
            <code class="n">_</code> <code class="p">=</code> <code class="n">ex</code><code class="p">;</code>
            <code class="n">Debugger</code><code class="p">.</code><code class="n">Break</code><code class="p">();</code>
        <code class="p">}</code>
    <code class="p">}</code>
<code class="p">}</code></pre>

<p>From the <code>host</code> instance, its <code>Services</code> property is <a data-primary="Services property" data-type="indexterm" id="idm46365047685376"/>available as an <code>IServiceProvider</code> type. This is exposed as <code>host.Services</code>, and we use it to resolve services from the DI container. This is referred to <a data-primary="service locator pattern" data-type="indexterm" id="idm46365047683712"/><a data-primary="patterns" data-secondary="service locator" data-type="indexterm" id="idm46365047683008"/>as the <em>service locator pattern</em> because services are located manually from a provider.</p>
<div data-type="tip"><h6>Tip</h6>
<p>You don’t need to use this pattern elsewhere because .NET handles things. In the spirit of “best practices,” you should always prefer the framework-provided DI (or third-party) container implementations. We’re using it only because we want to load the application in a specific culture, which starts early.</p>
</div>

<p>We don’t need to use this pattern anywhere else in the app, as the framework will automatically resolve the services we need through either constructor or property injection. We start by calling for <code>ILocalStorageService</code>, described in <a data-type="xref" href="ch07.html#chapter-seven">Chapter 7</a>. We then ask for it to retrieve a <code>string</code> value that corresponds to the <code>StorageKeys.ClientCulture</code> key. <code>StorageKeys</code> is a <code>static class</code> that exposes <a data-primary="StorageKeys static class" data-type="indexterm" id="idm46365047676256"/>various literals, constants, and verbatim values that the app makes use of for consistency. If the <code>clientCulture</code> value is <code>null</code>, we’ll assign a reasonable default of <code>"en-US"</code>.</p>

<p>Since these <code>culture</code> values come from the client, we cannot trust it—this is why we wrap the attempt to create a <code>CultureInfo</code> in a <code>try</code>/<code>catch</code> block. Finally, we run the application associated with the contextual <code>host</code> instance. From this entry point, the <code>App</code> component <a data-primary="client culture" data-secondary="detecting" data-startref="ccldt" data-type="indexterm" id="idm46365047670896"/><a data-primary="startup" data-secondary="client culture detection" data-startref="sttccd" data-type="indexterm" id="idm46365047669616"/>is the first Blazor component that starts.</p>
</div></section>













<section data-pdf-bookmark="Layouts, Shared Components, and Navigation" data-type="sect2"><div class="sect2" id="idm46365047668192">
<h2>Layouts, Shared Components, and Navigation</h2>

<p>The <em>App.razor</em> file is the first of <a data-primary="App.razor file, Web.Client project" data-type="indexterm" id="arzc"/>all Blazor components, and it contains the <code>&lt;Router&gt;</code>, which is used to provide data that corresponds to the navigation state. Consider the following <em>App.razor</em> file markup of the Web.Client project:</p>

<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">CascadingAuthenticationState</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">Error</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">Router</code> <code class="na">AppAssembly</code><code class="o">=</code><code class="s">"@typeof(App).Assembly"</code> <code class="na">Context</code><code class="o">=</code><code class="s">"routeData"</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">Found</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">AuthorizeRouteView</code> <code class="na">RouteData</code><code class="o">=</code><code class="s">"@routeData"</code>
                                    <code class="na">DefaultLayout</code><code class="o">=</code><code class="s">"@typeof(MainLayout)"</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="nt">NotAuthorized</code><code class="p">&gt;</code>
                        @if (context.User?.Identity?.IsAuthenticated ?? false)
                        {
                            <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>
                            You are not authorized to access this resource.
                            <code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>
                        }
                        else
                        {
                            <code class="p">&lt;</code><code class="nt">RedirectToLogin</code> <code class="p">/&gt;</code>
                        }
                    <code class="p">&lt;/</code><code class="nt">NotAuthorized</code><code class="p">&gt;</code>
                <code class="p">&lt;/</code><code class="nt">AuthorizeRouteView</code><code class="p">&gt;</code>
            <code class="p">&lt;/</code><code class="nt">Found</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">NotFound</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">LayoutView</code> <code class="na">Layout</code><code class="o">=</code><code class="s">"@typeof(MainLayout)"</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="nt">NotFoundPage</code> <code class="p">/&gt;</code>
                <code class="p">&lt;/</code><code class="nt">LayoutView</code><code class="p">&gt;</code>
            <code class="p">&lt;/</code><code class="nt">NotFound</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">Router</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">Error</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">CascadingAuthenticationState</code><code class="p">&gt;</code></pre>

<p>This is the top-level Blazor component of <a data-primary="App.razor file, Web.Client project" data-startref="arzc" data-type="indexterm" id="idm46365047660016"/><a data-primary="App component" data-type="indexterm" id="idm46365047659168"/>the app itself and is named appropriately as <code>App</code>. The <code>App</code> component is the first component that is rendered. It is the root component of the application, and all child components of the app are rendered within this component.</p>










<section data-pdf-bookmark="Blazor navigation essentials" data-type="sect3"><div class="sect3" id="blazor-navigation-essentials">
<h3>Blazor navigation essentials</h3>

<p>Let’s evaluate the <code>App</code> component <a data-primary="navigation" data-type="indexterm" id="idm46365046019872"/>markup in-depth and understand the various parts.</p>

<p>The <code>&lt;CascadingAuthenticationState&gt;</code> component is <a data-primary="&lt;CascadingAuthenticationState&gt; component" data-primary-sortas="CascadingAuthenticationState component" data-type="indexterm" id="idm46365046018176"/>the outermost component within our application. As the name implies, it will cascade the authentication state through to interested child components.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The approach of <em>cascading</em> state through component <a data-primary="cascading state" data-type="indexterm" id="idm46365046015584"/>hierarchies has become very common due to its ease of use and similarity to related patterns, like that of CSS. The same concept is also applicable at the OS level, with systems such as lightweight directory access protocol (LDAP) <a data-primary="LDAP (lightweight directory access protocol)" data-type="indexterm" id="idm46365046014752"/><a data-primary="lightweight directory access protocol (LDAP)" data-type="indexterm" id="idm46365046014048"/>permissions. Try thinking in graphs because this is a common pattern in software whenever there is a graph/tree to cascade over. That’s the idea behind cascading state.</p>
</div>

<p>As an example, an ancestor component can define a <code>&lt;CascadingValue&gt;</code> component with any value. This value can <a data-primary="&lt;CascadingValue&gt; component" data-primary-sortas="CascadingValue component" data-type="indexterm" id="idm46365046012224"/>flow down the component hierarchy to any number of descendant components. Consuming components use the <code>CascadingParameter</code> attribute to receive the value from the parent. This concept is covered in greater detail as we continue to explore the app. Let’s continue descending the component hierarchy.</p>

<p>The first nested child is the <code>Error</code> component. It’s a custom <a data-primary="Error.razor" data-type="indexterm" id="erzr"/>component that is defined in the <em>Error.razor</em> file:</p>

<pre data-code-language="html" data-type="programlisting"><code>@inject ILogger</code><code class="p">&lt;</code><code class="nt">Error</code><code class="p">&gt;</code><code> Logger </code><a class="co" href="#callout_executing_the_app_CO1-1" id="co_executing_the_app_CO1-1"><img alt="1" src="assets/1.png"/></a><code>

</code><code class="p">&lt;</code><code class="nt">CascadingValue</code><code> </code><code class="na">Value</code><code class="o">=</code><code class="s">this</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO1-2" id="co_executing_the_app_CO1-2"><img alt="2" src="assets/2.png"/></a><code>
    @ChildContent
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">CascadingValue</code><code class="p">&gt;</code><code>

@code { </code><a class="co" href="#callout_executing_the_app_CO1-3" id="co_executing_the_app_CO1-3"><img alt="3" src="assets/3.png"/></a><code>

    [Parameter]
    public RenderFragment? ChildContent { get; set; } = null!; </code><a class="co" href="#callout_executing_the_app_CO1-4" id="co_executing_the_app_CO1-4"><img alt="4" src="assets/4.png"/></a><code>

    public void ProcessError(Exception ex) </code><a class="co" href="#callout_executing_the_app_CO1-5" id="co_executing_the_app_CO1-5"><img alt="5" src="assets/5.png"/></a><code>
    {
        Logger.LogError("Error:ProcessError - Type: {Type} Message: {Message}",
            ex.GetType(), ex.Message);
    }
}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO1-1" id="callout_executing_the_app_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The <code>@inject</code> syntax is a Razor directive.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO1-2" id="callout_executing_the_app_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The <code>Error</code> component makes use of <em>cascades</em>.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO1-3" id="callout_executing_the_app_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>An <code>@code</code> directive is a way to add C# class-scoped members to a component.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO1-4" id="callout_executing_the_app_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The <code>ChildContent</code> property is a parameter.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO1-5" id="callout_executing_the_app_CO1-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The <code>ProcessError</code> method is accessible to all of the consuming components.</p></dd>
</dl>

<p>There are several common directives that you’ll learn as part of Blazor development. This specific directive instructs <a data-primary="property injection" data-type="indexterm" id="idm46365045920464"/><a data-primary="construction injection" data-type="indexterm" id="idm46365045919792"/>the Razor view engine to <em>inject</em> the <code>ILogger&lt;Error&gt;</code> service from the service provider. This is how Blazor components use DI, through property injection instead of constructor injection.</p>

<p>The <code>&lt;CascadingValue&gt;</code> markup includes the template rendering of an <code>@Child​Con⁠tent</code>. The <code>ChildContent</code> is both a <code>[Parameter]</code> and a <code>RenderFragment</code>. This allows for the <code>Error</code> component to render any child content, including Blazor components. When there is a single <code>RenderFragment</code> defined as part of a templated component, its child content can be represented as pure Razor markup.</p>

<p>A <code>RenderFragment</code> is a <a data-primary="RenderFragment" data-type="indexterm" id="idm46365045913264"/><a data-primary="RenderTreeBuilder" data-type="indexterm" id="idm46365045912528"/>void returning <code>delegate</code> type that accepts a <code>RenderTreeBuilder</code>. It represents a segment of UI content. The <code>RenderTreeBuilder</code> type is a low-level Blazor class that exposes methods for building a C# representation of the DOM.</p>

<p><code>&lt;CascadingValue&gt;</code> is a Blazor (or framework-provided) component that provides a cascading value to all <a data-primary="&lt;CascadingValue&gt; component" data-startref="CascadingValue component" data-type="indexterm" id="idm46365045909536"/>descendant components. <code>CascadingValue.Value</code> is assigned <code>this</code>, which is the <code>Error</code> component instance itself. This means that all descendant components will have access to the <code>ProcessError</code> method if they choose to consume it. Descendant components would need to define a <code>[CascadingParameter]</code> property of type <code>Error</code> for it to flow through to it.</p>

<p>The <code>Parameter</code> attribute is <a data-primary="Parameter attribute" data-type="indexterm" id="idm46365045904960"/>provided by Blazor as a way to denote that a property of a component is a parameter. These are available as binding targets from consuming components as attribute assignments in Razor markup.</p>

<p>The <code>ProcessError</code> method <a data-primary="ProcessError method" data-type="indexterm" id="idm46365045903040"/><a data-primary="methods" data-secondary="ProcessError" data-type="indexterm" id="idm46365045902304"/>expects an <code>Exception</code> instance, which it uses to log as an error. The child content of the <code>Error</code> component is the <code>Router</code>. The <code>Router</code> component is what enables our SPA’s client-side routing, meaning routing occurs on the client, and the page doesn’t <a data-primary="Error.razor" data-startref="erzr" data-type="indexterm" id="idm46365045899504"/>need to refresh.</p>
</div></section>













<section data-pdf-bookmark="The Router" data-type="sect3"><div class="sect3" id="idm46365046021632">
<h3>The Router</h3>

<p>The <code>Router</code> is a framework-provided component <a data-primary="Router" data-type="indexterm" id="idm46365048193840"/>that’s used in the <em>src/Web.Cli⁠ent/​App.razor</em> file. It specifies an <code>AppAssembly</code> parameter that is assigned to the <code>typeof(App).Assembly</code> by convention. Additionally, the <code>Context</code> parameter allows us to specify the name of the parameter. We assign the name of <code>routeData</code>, which overrides the default name of <code>context</code>. The <code>Router</code> also defines multiple named <code>RenderFragment</code> components; because there are multiple, we must explicitly specify child content. This is where the corresponding <code>RenderFragment</code> name comes in. For example, when the router is unable to find a matching route, we define what the page should render the <code>NotFound</code> content. Consider the following <code>NotFound</code> content section from the <code>Router</code> markup:</p>

<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">NotFound</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">LayoutView</code> <code class="na">Layout</code><code class="o">=</code><code class="s">"@typeof(MainLayout)"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">NotFoundPage</code> <code class="p">/&gt;</code>
    <code class="p">&lt;/</code><code class="nt">LayoutView</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">NotFound</code><code class="p">&gt;</code></pre>

<p>This layout is based on the <code>MainLayout</code> component and sets its child as the <code>NotFoundPage</code> component. Assuming the user navigates to a route that doesn’t exist, they’d end up on our custom HTTP 404 page, which is localized and styled consistently with our app. We’ll handle HTTP status code 401 in the next section. However, when the router does match an expected route, the <code>Found</code> content is rendered. Consider the following <code>Found</code> content section from the <code>Router</code> markup:</p>

<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">Found</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">AuthorizeRouteView</code> <code class="na">RouteData</code><code class="o">=</code><code class="s">"@routeData"</code>
        <code class="na">DefaultLayout</code><code class="o">=</code><code class="s">"@typeof(MainLayout)"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">NotAuthorized</code><code class="p">&gt;</code>
            @if (context.User?.Identity?.IsAuthenticated ?? false)
            {
                <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>HTTP 401<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>
            }
            else
            {
                <code class="p">&lt;</code><code class="nt">RedirectToLogin</code> <code class="p">/&gt;</code>
            }
        <code class="p">&lt;/</code><code class="nt">NotAuthorized</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">AuthorizeRouteView</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">Found</code><code class="p">&gt;</code></pre>
</div></section>













<section data-pdf-bookmark="Redirect to login when unauthenticated" data-type="sect3"><div class="sect3" id="redirect-to-login">
<h3>Redirect to login when unauthenticated</h3>

<p>If you recall from earlier, the <code>Found</code> content is just a <code>RenderFragment</code>. The child content, in this case, is the <code>AuthorizeRouteView</code> component. This route view is displayed only when the user is authorized to view it. It adheres to <code>MainLayout</code> as its default. The <code>RouteData</code> is assigned from the contextual <code>routeData</code>. The route data itself defines which component the router will render and the corresponding parameters from the route.</p>

<p>When the user is not authorized, we redirect <a data-primary="RedirectToLogin" data-type="indexterm" id="idm46365048083040"/>them to the login screen using the <code>RedirectToLogin</code> component:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="n">@inject</code><code> </code><code class="n">NavigationManager</code><code> </code><code class="n">Navigation</code><code> </code><a class="co" href="#callout_executing_the_app_CO2-1" id="co_executing_the_app_CO2-1"><img alt="1" src="assets/1.png"/></a><code>
</code><code>
</code><code class="n">@code</code><code> </code><code class="p">{</code><code>
</code><code>    </code><code class="k">protected</code><code> </code><code class="k">override</code><code> </code><code class="k">void</code><code> </code><code class="nf">OnInitialized</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_executing_the_app_CO2-2" id="co_executing_the_app_CO2-2"><img alt="2" src="assets/2.png"/></a><code>
</code><code>    </code><code class="p">{</code><code>
</code><code>        </code><code class="kt">string</code><code> </code><code class="n">returnUrl</code><code> </code><code class="p">=</code><code> </code><code class="n">Uri</code><code class="p">.</code><code class="n">EscapeDataString</code><code class="p">(</code><code class="n">Navigation</code><code class="p">.</code><code class="n">Uri</code><code class="p">)</code><code class="p">;</code><code>
</code><code>        </code><code class="n">Navigation</code><code class="p">.</code><code class="n">NavigateTo</code><code class="p">(</code><code>
</code><code>            </code><code class="err">$</code><code class="s">"authentication/login?returnUrl={returnUrl}"</code><code class="p">)</code><code class="p">;</code><code>
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO2-1" id="callout_executing_the_app_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The <code>RedirectToLogin</code> component requires the <code>NavigationManager</code>.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO2-2" id="callout_executing_the_app_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The <code>OnInitialized</code> method navigates to the authentication login page.</p></dd>
</dl>

<p>The <code>RedirectToLogin</code> component injects the <code>NavigationManager</code>, and when it’s initialized, it navigates to the <code>authentication/login</code> route with the escaped <code>returnUrl</code> query string. When the user is authorized, the route view renders <code>MainLayout</code>, which is a subclass of Blazor’s <code>LayoutComponentBase</code>. While the markup defines all of the layout of the app, it also splats <code>@Body</code> in the appropriate spot. This is another <code>RenderFragment</code> that is inherited from <code>LayoutComponentBase</code>. The body content is what the router ultimately controls for its client-side routing. In other words, as users navigate the site, the router dynamically updates the DOM with rendered Blazor components within the <code>@Body</code> segment.</p>

<p>We <code>override</code> the <code>OnInitialized</code> method. This is our first look at overriding 
<span class="keep-together"><code>ComponentBase</code></span> class functionality, but this is very common in Blazor. There are several <code>virtual</code> methods (methods that can be overridden) in the <code>ComponentBase</code> class, most of which represent different points of a component’s lifecycle.</p>
</div></section>













<section data-pdf-bookmark="Blazor component lifecycle" data-type="sect3"><div class="sect3" id="idm46365047983616">
<h3>Blazor component lifecycle</h3>

<p>Continuing from the <a data-primary="component lifecycle" data-type="indexterm" id="idm46365047982096"/>aforementioned <em>RedirectToLogin.razor.</em> file, there is an <code>override</code> method named <code>OnInitialized</code>. This method <a data-primary="OnInitialized method" data-type="indexterm" id="idm46365043411408"/><a data-primary="methods" data-secondary="OnInitialized" data-type="indexterm" id="idm46365043410672"/>is one of several lifecycle methods that will occur at specific points in the life of a component. Blazor components inherit the <code>Microsoft.AspNetCore.Components.ComponentBase</code> class. Please consider <a data-type="xref" href="#component_lifecycle_methods">Table 2-1</a> for reference.</p>
<table id="component_lifecycle_methods">
<caption><span class="label">Table 2-1. </span><code>ComponentBase</code> lifecycle methods</caption>
<thead>
<tr>
<th>Order</th>
<th>Method name(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>1</p></td>
<td><p><code>SetParametersAsync</code></p></td>
<td><p>Sets parameters supplied by the component’s parent in the render tree</p></td>
</tr>
<tr>
<td><p>2</p></td>
<td><p><code>OnInitialized</code><br/>
<code>OnInitializedAsync</code></p></td>
<td><p>Method invoked when the component is ready to start, having received its initial parameters from its parent in the render tree</p></td>
</tr>
<tr>
<td><p>3</p></td>
<td><p><code>OnParametersSet</code><br/>
</p><p><span class="keep-together"><code>OnParametersSetAsync</code></span></p></td>
<td><p>Method invoked when the component has received parameters from its parent in the render tree and the incoming values have been assigned to properties</p></td>
</tr>
<tr>
<td><p>4</p></td>
<td><p><code>OnAfterRender</code><br/>
<code>OnAfterRenderAsync</code></p></td>
<td><p>Method invoked after each time the component has been rendered</p></td>
</tr>
</tbody>
</table>
</div></section>













<section data-pdf-bookmark="The MainLayout component" data-type="sect3"><div class="sect3" id="idm46365043392832">
<h3>The MainLayout component</h3>

<p>The <em>MainLayout.razor</em> file, as the <a data-primary="MainLayout.razor" data-type="indexterm" id="mlyzr"/>name indicates, represents the main layout. Within this markup, the navigation bar (navbar), header, footer, and content areas are organized and structured:</p>

<pre data-code-language="html" data-type="programlisting"><code>@inherits LayoutComponentBase </code><a class="co" href="#callout_executing_the_app_CO3-1" id="co_executing_the_app_CO3-1"><img alt="1" src="assets/1.png"/></a><code>
@inject IStringLocalizer</code><code class="p">&lt;</code><code class="nt">MainLayout</code><code class="p">&gt;</code><code> Localizer

</code><code class="p">&lt;</code><code class="nt">section</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"hero is-fullheight-with-navbar"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO3-2" id="co_executing_the_app_CO3-2"><img alt="2" src="assets/2.png"/></a><code>
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"hero-head"</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">header</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar is-size-5 is-fixed-top"</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"container"</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-brand"</code><code class="p">&gt;</code><code>
                    </code><code class="p">&lt;</code><code class="nt">NavLink</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-item"</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">""</code><code> </code><a class="co" href="#callout_executing_the_app_CO3-3" id="co_executing_the_app_CO3-3"><img alt="3" src="assets/3.png"/></a><code>
                             </code><code class="na">Match</code><code class="o">=</code><code class="s">"NavLinkMatch.All"</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pr-2"</code><code class="p">&gt;</code><code>
                            </code><code class="p">&lt;</code><code class="nt">img</code><code> </code><code class="na">src</code><code class="o">=</code><code class="s">"media/blazor-logo.png"</code><code>
                                 </code><code class="na">height</code><code class="o">=</code><code class="s">"128"</code><code> </code><code class="na">alt</code><code class="o">=</code><code class="s">"Logo"</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>@Localizer["Home"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
                    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">NavLink</code><code class="p">&gt;</code><code>

                    </code><code class="p">&lt;</code><code class="nt">a</code><code> </code><code class="na">role</code><code class="o">=</code><code class="s">"button"</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-burger"</code><code> </code><code class="na">aria-label</code><code class="o">=</code><code class="s">"menu"</code><code>
                       </code><code class="na">aria-expanded</code><code class="o">=</code><code class="s">"false"</code><code> </code><code class="na">data-target</code><code class="o">=</code><code class="s">"navbar"</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">aria-hidden</code><code class="o">=</code><code class="s">"true"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">aria-hidden</code><code class="o">=</code><code class="s">"true"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">aria-hidden</code><code class="o">=</code><code class="s">"true"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
                    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">a</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"navbar"</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-menu"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO3-4" id="co_executing_the_app_CO3-4"><img alt="4" src="assets/4.png"/></a><code>
                    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-start"</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="nt">AuthorizeView</code><code class="p">&gt;</code><code>
                            </code><code class="p">&lt;</code><code class="nt">Authorized</code><code class="p">&gt;</code><code>
                                </code><code class="p">&lt;</code><code class="nt">NavBar</code><code> </code><code class="p">/</code><code class="p">&gt;</code><code>
                            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">Authorized</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">AuthorizeView</code><code class="p">&gt;</code><code>
                    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
                    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-end"</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="nt">AuthorizeView</code><code class="p">&gt;</code><code>
                            </code><code class="p">&lt;</code><code class="nt">Authorized</code><code class="p">&gt;</code><code>
                                </code><code class="p">&lt;</code><code class="nt">ThemeIndicatorComponent</code><code> </code><code class="p">/</code><code class="p">&gt;</code><code>
                                </code><code class="p">&lt;</code><code class="nt">AudioDescriptionComponent</code><code> </code><code class="p">/</code><code class="p">&gt;</code><code>
                                </code><code class="p">&lt;</code><code class="nt">LanguageSelectionComponent</code><code> </code><code class="p">/</code><code class="p">&gt;</code><code>
                                </code><code class="p">&lt;</code><code class="nt">NotificationComponent</code><code> </code><code class="p">/</code><code class="p">&gt;</code><code>
                            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">Authorized</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">AuthorizeView</code><code class="p">&gt;</code><code>
                        </code><code class="p">&lt;</code><code class="nt">LoginDisplay</code><code> </code><code class="p">/</code><code class="p">&gt;</code><code>
                    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">header</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"hero-body"</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"container has-text-centered is-fluid mx-5"</code><code class="p">&gt;</code><code>
            @Body </code><a class="co" href="#callout_executing_the_app_CO3-5" id="co_executing_the_app_CO3-5"><img alt="5" src="assets/5.png"/></a><code>
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

    </code><code class="p">&lt;</code><code class="nt">footer</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"footer"</code><code> </code><code class="na">style</code><code class="o">=</code><code class="s">"padding-bottom: 4rem;"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO3-6" id="co_executing_the_app_CO3-6"><img alt="6" src="assets/6.png"/></a><code>
        </code><code class="p">&lt;</code><code class="nt">PageFooter</code><code> </code><code class="p">/</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">footer</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">section</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO3-1" id="callout_executing_the_app_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The first two lines of this layout Razor file are two C# expressions, indicated by their leading <code>@</code> symbol.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO3-2" id="callout_executing_the_app_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p><code>&lt;section&gt;</code> is a native HTML element, and it’s perfectly valid with Razor syntax.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO3-3" id="callout_executing_the_app_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>Within the <code>&lt;section&gt;</code> element’s semantic header and navbar, <code>&lt;NavLink&gt;</code> is 
<span class="keep-together">referenced.</span></p></dd>
<dt><a class="co" href="#co_executing_the_app_CO3-4" id="callout_executing_the_app_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The next section of the navbar is built out, with a custom <code>NavBar</code> component.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO3-5" id="callout_executing_the_app_CO3-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The <code>@Body</code> render fragment is defined within the center of the DOM.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO3-6" id="callout_executing_the_app_CO3-6"><img alt="6" src="assets/6.png"/></a></dt>
<dd><p>The native HTML <code>footer</code> element is the parent to the custom <code>PageFooter</code> component, which is responsible for rendering the very bottom of the page.</p></dd>
</dl>

<p>These two directives represent various behaviors required within this component. The first <a data-primary="@inherits directive" data-primary-sortas="inherits directive" data-type="indexterm" id="idm46365043268256"/><a data-primary="directives" data-secondary="@inherits" data-type="indexterm" id="idm46365043266880"/><a data-primary="LayoutComponentBase class" data-type="indexterm" id="idm46365043295680"/>of the two is the <code>@inherits</code> directive, which instructs the component to inherit from the <code>LayoutComponentBase</code> class. This means that it’s a subclass of the framework’s <code>LayoutComponentBase</code> class. This layout base class is an implementation of <code>IComponent</code> and exposes a <code>Body</code> render fragment. This allows us to make 
<span class="keep-together">the content whatever</span> the app’s <code>Router</code> provides as output. The main layout component uses the <code>@inject</code> directive to request the service provider to resolve an <code>IString​Lo⁠calizer&lt;MainLayout&gt;</code>, which is assigned to a component-accessible member named <code>Localizer</code>. We’ll cover localization in <a data-type="xref" href="ch05.html#chapter-five">Chapter 5</a>.</p>

<p><code>&lt;section&gt;</code> is a native HTML element, <a data-primary="&lt;section&gt; element" data-primary-sortas="section element" data-type="indexterm" id="idm46365043289056"/>and it’s perfectly valid Razor syntax. Notice how we can transition from C# to HTML seamlessly, in either direction. We define some standard HTML, with a bit of semantic markup. It’s known that you have familiarity with HTML and CSS, and we won’t put too much emphasis on that. Because this is such a large project, we’d likely have this HTML and CSS provided by our imaginary UX department.</p>

<p>Within the <code>&lt;section&gt;</code> element’s semantic header and navbar, <code>&lt;NavLink&gt;</code> is referenced. This is a framework-provided <a data-primary="NavLink" data-type="indexterm" id="idm46365043263984"/>component. The <code>NavLink</code> component is used to expose the user interactive aspect of the component’s logic. It handles the routing of the Blazor application and relies on the value within the browser’s URL bar. This represents the app’s “Home” navigation route, and it’s branded with the Blazor logo.</p>

<p>The next section of the navigation bar is built out with a custom <code>NavBar</code> component. There is a bit of familiar protective markup, where the app specifies it’s available only when <code>AuthorizerView</code> has <code>Authorized</code> content to render in the browser. The earlier components mentioned were either left-aligned or centered, and the next components are grouped and pushed to the end or far-right-hand side of the navbar. Immediately to the right of this component grouping is a <code>LoginDisplay</code>. Let’s have a deep look into the <code>LoginDisplay</code> component (see also <a data-type="xref" href="#login_display">“Understanding the LoginDisplay component”</a>). This group of elements is theme-aware, meaning it will render in one of two ways, either the <code>dark</code> theme or the <code>light</code> theme (see <a data-type="xref" href="#header-footer-components">“The header and footer components”</a> for visual examples).</p>

<p>The <code>@Body</code> render fragment is defined within the center of the DOM. <code>@Body</code> is the primary aspect of the Blazor navigation <a data-primary="MainLayout.razor" data-startref="mlyzr" data-type="indexterm" id="idm46365043255664"/>and the output target for the router. In other words, as users navigate, the client-side routing renders HTML within the <code>@Body</code> placeholder.</p>
</div></section>













<section data-pdf-bookmark="The custom NavBar component" data-type="sect3"><div class="sect3" id="idm46365044779536">
<h3>The custom NavBar component</h3>

<p>Admittedly, there’s a lot to soak in <a data-primary="NavBar.razor" data-type="indexterm" id="nvbzr"/>from that layout component markup, but when you take the time to mentally parse each part, it will make sense. There are a few custom components, one of which is <code>&lt;NavBar /&gt;</code>. This references the <em>NavBar.razor</em> file:</p>

<pre data-code-language="html" data-type="programlisting"><code>@inherits LocalizableComponentBase</code><code class="p">&lt;</code><code class="nt">NavBar</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO4-1" id="co_executing_the_app_CO4-1"><img alt="1" src="assets/1.png"/></a><code>

</code><code class="p">&lt;</code><code class="nt">NavLink</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-item"</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">"/chat"</code><code> </code><code class="na">Match</code><code class="o">=</code><code class="s">"NavLinkMatch.Prefix"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO4-2" id="co_executing_the_app_CO4-2"><img alt="2" src="assets/2.png"/></a><code>
    </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"icon pr-2"</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">i</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"chat fas fa-comments"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>@Localizer["Chat"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">NavLink</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="nt">NavLink</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-item"</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">"/tweets"</code><code> </code><code class="na">Match</code><code class="o">=</code><code class="s">"NavLinkMatch.Prefix"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO4-3" id="co_executing_the_app_CO4-3"><img alt="3" src="assets/3.png"/></a><code>
    </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"icon pr-2"</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">i</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"twitter fab fa-twitter"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>@Localizer["Tweets"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">NavLink</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="nt">NavLink</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-item"</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">"/pwned"</code><code> </code><code class="na">Match</code><code class="o">=</code><code class="s">"NavLinkMatch.Prefix"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO4-4" id="co_executing_the_app_CO4-4"><img alt="4" src="assets/4.png"/></a><code>
    </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"icon pr-2"</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">i</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pwned fas fa-user-shield"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">translate</code><code class="o">=</code><code class="s">"no"</code><code class="p">&gt;</code><code>Pwned?</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">NavLink</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO4-1" id="callout_executing_the_app_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>Inherits from <code>LocalizableComponentBase</code> to take advantage of the base 
<span class="keep-together">functionality.</span></p></dd>
<dt><a class="co" href="#co_executing_the_app_CO4-2" id="callout_executing_the_app_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The <code>&lt;NavLink&gt;</code> component is provided by the framework and works with the router.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO4-3" id="callout_executing_the_app_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The second route is for tweets and corresponds to the <code>/tweets</code> route.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO4-4" id="callout_executing_the_app_CO4-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The third route is for Pwned? and corresponds to the <code>/pwned</code> route.</p></dd>
</dl>

<p>Like most custom components, this too inherits from <code>LocalizableComponentBase</code> to take advantage of the base functionality. The base functionality is detailed in <a data-type="xref" href="ch05.html#chapter-five">Chapter 5</a>. The framework-provided <code>&lt;NavLink&gt;</code> component works with the router. The first route is the chat room and corresponds to the <code>/chat</code> route. While each of the previous route names is retrieved using the <code>@Localizer</code> indexer, the “Pwned?” route is <a data-primary="NavBar.razor" data-startref="nvbzr" data-type="indexterm" id="idm46365046844608"/>not because it’s a brand name.</p>
</div></section>













<section data-pdf-bookmark="The header and footer components" data-type="sect3"><div class="sect3" id="header-footer-components">
<h3>The header and footer components</h3>

<p>The header for the app <a data-primary="headers" data-type="indexterm" id="hdrs"/><a data-primary="footers" data-type="indexterm" id="fotrs"/>contains links to Home, Chat, Tweets, Pwned, and Contact pages. These are all navigable routes that the <code>Router</code> will recognize. The icons to the right are for Theme, Audio Descriptions, Language Selection, Task List, Notifications, and Log out. The log-out functionality does rely on the app’s navigation to navigate to routes, but the other buttons could be considered utilitarian. They open modals for global functionality and expose user preferences. The header itself supports the <code>dark</code> and <code>light</code> themes, as shown in Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#dark_navbar">2-2</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#light_navbar">2-3</a>.</p>

<figure><div class="figure" id="dark_navbar">
<img alt="" src="assets/lblz_0202.png"/>
<h6><span class="label">Figure 2-2. </span>An example navigation header with the <code>dark</code> theme</h6>
</div></figure>

<figure><div class="figure" id="light_navbar">
<img alt="" src="assets/lblz_0203.png"/>
<h6><span class="label">Figure 2-3. </span>An example navigation header with the <code>light</code> theme</h6>
</div></figure>

<p>Let’s look at the <code>PageFooter</code> component first, defined in the <em>PageFooter.razor</em> file:</p>

<pre data-code-language="html" data-type="programlisting"><code>@inherits LocalizableComponentBase</code><code class="p">&lt;</code><code class="nt">PageFooter</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO5-1" id="co_executing_the_app_CO5-1"><img alt="1" src="assets/1.png"/></a><code>

</code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"columns has-text-centered"</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">p</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"column"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO5-2" id="co_executing_the_app_CO5-2"><img alt="2" src="assets/2.png"/></a><code>
        </code><code class="p">&lt;</code><code class="nt">strong</code><code> </code><code class="na">translate</code><code class="o">=</code><code class="s">"no"</code><code class="p">&gt;</code><code>
            Learning Blazor
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">strong</code><code class="p">&gt;</code><code> by
        </code><code class="p">&lt;</code><code class="nt">a</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">"@DavidPineUrl"</code><code> </code><code class="na">target</code><code class="o">=</code><code class="s">"_blank"</code><code class="p">&gt;</code><code>
            David Pine.
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">a</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">p</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"column"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO5-3" id="co_executing_the_app_CO5-3"><img alt="3" src="assets/3.png"/></a><code>
        The </code><code class="p">&lt;</code><code class="nt">a</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">"@CodeUrl"</code><code> </code><code class="na">target</code><code class="o">=</code><code class="s">"_blank"</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="nt">i</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"fab fa-github"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code><code> source code
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">a</code><code class="p">&gt;</code><code> is licensed
        </code><code class="p">&lt;</code><code class="nt">a</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">"@LicenseUrl"</code><code class="p">&gt;</code><code>
            MIT.
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">a</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">p</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"column"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO5-4" id="co_executing_the_app_CO5-4"><img alt="4" src="assets/4.png"/></a><code>
        </code><code class="p">&lt;</code><code class="nt">a</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">"/privacy"</code><code class="p">&gt;</code><code>@Localizer["Privacy"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">a</code><code class="p">&gt;</code><code> </code><code class="ni">&amp;bull;</code><code>
        </code><code class="p">&lt;</code><code class="nt">a</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">"/termsandconditions"</code><code class="p">&gt;</code><code>@Localizer["Terms"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">a</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">p</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"column"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO5-5" id="co_executing_the_app_CO5-5"><img alt="5" src="assets/5.png"/></a><code>
        @_frameworkDescription
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO5-1" id="callout_executing_the_app_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The component inherit from the <code>LocalizableComponentBase</code> class.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO5-2" id="callout_executing_the_app_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>Column one reads <code>"Learning Blazor by David Pine"</code>.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO5-3" id="callout_executing_the_app_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>In the second column, there are two links: one for the source codes’ MIT license and the GitHub source code link.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO5-4" id="callout_executing_the_app_CO5-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The third column contains links to the <em>Privacy</em> and <em>Terms and Conditions</em> pages.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO5-5" id="callout_executing_the_app_CO5-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The last column contains the .NET runtime version that the client browser is running.</p></dd>
</dl>

<p>We are establishing a pattern, by having custom components inherit from the 
<span class="keep-together"><code>LocalizableComponentBase</code></span> common base class. The custom <code>PageFooter</code> 
<span class="keep-together">component</span> is written by defining a four-column layout with centered text. From left to right starting at column one, the name of the application appears and a byline, 
<span class="keep-together"><code>"Learning Blazor by David Pine"</code></span>, is rendered with a nontranslatable bold phrase. The second column links to the source codes’ MIT license and the GitHub source code link.
The third column contains <a data-primary="Privacy page" data-type="indexterm" id="idm46365042893456"/><a data-primary="Terms and Conditions page" data-type="indexterm" id="idm46365042892816"/>links to the <em>Privacy</em> and <em>Terms and Conditions</em> pages, and the text is localized. Localization of Blazor apps is covered in <a data-type="xref" href="ch05.html#chapter-five">Chapter 5</a>. The .NET runtime version is useful because it tells the developer immediately what version of the framework is being used.</p>

<p>More often than not, I prefer to have my Razor markup files accompanied by a code-behind file. In this way, the separate files help to isolate concerns where markup exists in Razor and logic exists in C#. For simple components, components that have a few parameters, and markup elements, it’s fine to just have everything in a Razor file with an <code>@code</code> directive. But when using the code-behind approach, you might <a data-primary="component shadowing" data-type="indexterm" id="idm46365042889456"/>think of this as <em>component shadowing</em>, as the component’s markup is shadowed by a C# file from the Visual Studio editor, as shown in <a data-type="xref" href="#component_shadowing">Figure 2-4</a>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Component shadowing is the act of creating a C# file that matches the name of an existing Razor file but appends the <em>.cs</em> file extension. For example, the <em>PageFooter.razor</em> and <em>PageFooter.razor.cs</em> files exemplify component shadowing because they’re nested in the Visual Studio editor and together they both represent the <code>public partial PageFooter class</code>.</p>
</div>

<figure><div class="figure" id="component_shadowing">
<img alt="" src="assets/lblz_0204.png"/>
<h6><span class="label">Figure 2-4. </span>Component shadowing in Visual Studio Solution Explorer</h6>
</div></figure>

<p>Consider the <em>PageFooter.razor.cs</em> component <a data-primary="PageFooter.razor.cs" data-type="indexterm" id="idm46365042881424"/>shadow file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code><code> </code><code class="nn">Learning.Blazor.Shared</code><code>
</code><code class="p">{</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="k">partial</code><code> </code><code class="k">class</code><code> </code><code class="nc">PageFooter</code><code>
</code><code>    </code><code class="p">{</code><code>
</code><code>        </code><code class="k">const</code><code> </code><code class="kt">string</code><code> </code><code class="n">CodeUrl</code><code> </code><code class="p">=</code><code> </code><a class="co" href="#callout_executing_the_app_CO6-1" id="co_executing_the_app_CO6-1"><img alt="1" src="assets/1.png"/></a><code>
</code><code>            </code><code class="s">"https://github.com/IEvangelist/learning-blazor"</code><code class="p">;</code><code>
</code><code>        </code><code class="k">const</code><code> </code><code class="kt">string</code><code> </code><code class="n">LicenseUrl</code><code> </code><code class="p">=</code><code>
</code><code>            </code><code class="s">"https://github.com/IEvangelist/learning-blazor/blob/main/LICENSE"</code><code class="p">;</code><code>
</code><code>        </code><code class="k">const</code><code> </code><code class="kt">string</code><code> </code><code class="n">DavidPineUrl</code><code> </code><code class="p">=</code><code>
</code><code>            </code><code class="s">"https://davidpine.net"</code><code class="p">;</code><code>
</code><code>
</code><code>        </code><code class="k">private</code><code> </code><code class="kt">string?</code><code> </code><code class="n">_frameworkDescription</code><code class="p">;</code><code>
</code><code>
</code><code>        </code><code class="k">protected</code><code> </code><code class="k">override</code><code> </code><code class="k">void</code><code> </code><code class="nf">OnInitialized</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO6-2" id="co_executing_the_app_CO6-2"><img alt="2" src="assets/2.png"/></a><code>
</code><code>            </code><code class="n">_frameworkDescription</code><code> </code><code class="p">=</code><code> </code><code class="n">AppState</code><code class="p">.</code><code class="n">FrameworkDescription</code><code class="p">;</code><code>
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO6-1" id="callout_executing_the_app_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>Several constants are defined.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO6-2" id="callout_executing_the_app_CO6-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The <code>OnInitialized</code> lifecycle method assigns the framework description.</p></dd>
</dl>

<p>There are several <code>const string</code> fields defined that contain URL literals. These are used to bind to the Razor markup.
We <code>override</code> the <code>OnInitialized</code> lifecycle method and assign the <code>_frameDescription</code> value from the inherited <code>LocalizableComponentBase.AppState</code> variable.</p>

<p>The component is also theme-aware of the client browser preferences for either <code>light</code> or <code>dark</code>. For example, see Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#dark_footer">2-5</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#light_footer">2-6</a>.</p>

<figure><div class="figure" id="dark_footer">
<img alt="" src="assets/lblz_0205.png"/>
<h6><span class="label">Figure 2-5. </span>An example footer with the <code>dark</code> theme</h6>
</div></figure>

<figure><div class="figure" id="light_footer">
<img alt="" src="assets/lblz_0206.png"/>
<h6><span class="label">Figure 2-6. </span>An example footer with the <code>light</code> theme</h6>
</div></figure>

<p>The footer doesn’t strive for too much. It’s intentionally simple, providing only a few links to relevant information for the app.</p>

<p>The <code>MainLayout</code> component is <a data-primary="MainLayout.razor.cs" data-type="indexterm" id="mlyz"/>more than just Razor markup; it, too, has a shadowed component. Consider the <em>MainLayout.razor.cs</em> file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">using</code><code> </code><code class="nn">System.Runtime.InteropServices</code><code class="p">;</code><code>
</code><code class="k">using</code><code> </code><code class="nn">Learning.Blazor.Services</code><code class="p">;</code><code>
</code><code class="k">using</code><code> </code><code class="nn">Microsoft.AspNetCore.Components</code><code class="p">;</code><code>
</code><code>
</code><code class="k">namespace</code><code> </code><code class="nn">Learning.Blazor.Shared</code><code>
</code><code class="p">{</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="k">sealed</code><code> </code><code class="k">partial</code><code> </code><code class="k">class</code><code> </code><code class="nc">MainLayout</code><code> </code><code class="p">:</code><code> </code><code class="n">IDisposable</code><code> </code><a class="co" href="#callout_executing_the_app_CO7-1" id="co_executing_the_app_CO7-1"><img alt="1" src="assets/1.png"/></a><code>
</code><code>    </code><code class="p">{</code><code>
</code><code class="na">        [Inject]</code><code>
</code><code>        </code><code class="k">public</code><code> </code><code class="n">AppInMemoryState</code><code class="p">?</code><code> </code><code class="n">AppState</code><code> </code><code class="p">{</code><code> </code><code class="k">get</code><code class="p">;</code><code> </code><code class="k">set</code><code class="p">;</code><code> </code><code class="p">}</code><code> </code><a class="co" href="#callout_executing_the_app_CO7-2" id="co_executing_the_app_CO7-2"><img alt="2" src="assets/2.png"/></a><code>
</code><code>
</code><code>        </code><code class="k">protected</code><code> </code><code class="k">override</code><code> </code><code class="k">void</code><code> </code><code class="nf">OnInitialized</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_executing_the_app_CO7-3" id="co_executing_the_app_CO7-3"><img alt="3" src="assets/3.png"/></a><code>
</code><code>        </code><code class="p">{</code><code>
</code><code>            </code><code class="k">if</code><code> </code><code class="p">(</code><code class="n">AppState</code><code> </code><code class="k">is</code><code> </code><code class="n">not</code><code> </code><code class="k">null</code><code class="p">)</code><code>
</code><code>            </code><code class="p">{</code><code>
</code><code>                </code><code class="n">AppState</code><code class="p">.</code><code class="n">StateChanged</code><code> </code><code class="p">+</code><code class="p">=</code><code> </code><code class="n">StateHasChanged</code><code class="p">;</code><code>
</code><code>                </code><code class="n">AppState</code><code class="p">.</code><code class="n">FrameworkDescription</code><code> </code><code class="p">=</code><code>
</code><code>                    </code><code class="n">RuntimeInformation</code><code class="p">.</code><code class="n">FrameworkDescription</code><code class="p">;</code><code>
</code><code>            </code><code class="p">}</code><code>
</code><code>
</code><code>            </code><code class="k">base</code><code class="p">.</code><code class="n">OnInitialized</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code>        </code><code class="p">}</code><code>
</code><code>
</code><code>        </code><code class="k">void</code><code> </code><code class="n">IDisposable</code><code class="p">.</code><code class="n">Dispose</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_executing_the_app_CO7-4" id="co_executing_the_app_CO7-4"><img alt="4" src="assets/4.png"/></a><code>
</code><code>        </code><code class="p">{</code><code>
</code><code>            </code><code class="k">if</code><code> </code><code class="p">(</code><code class="n">AppState</code><code> </code><code class="k">is</code><code> </code><code class="n">not</code><code> </code><code class="k">null</code><code class="p">)</code><code>
</code><code>            </code><code class="p">{</code><code>
</code><code>                </code><code class="n">AppState</code><code class="p">.</code><code class="n">StateChanged</code><code> </code><code class="p">-</code><code class="p">=</code><code> </code><code class="n">StateHasChanged</code><code class="p">;</code><code>
</code><code>            </code><code class="p">}</code><code>
</code><code>        </code><code class="p">}</code><code>
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO7-1" id="callout_executing_the_app_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p><code>MainLayout</code> is a <code>sealed partial class</code>.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO7-2" id="callout_executing_the_app_CO7-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The <code>AppInMemoryState</code> instance is injected into the component.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO7-3" id="callout_executing_the_app_CO7-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The <code>OnInitialized</code> method is overridden to allow the subscription to the <code>AppInMemoryState.StateChanged</code> event.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO7-4" id="callout_executing_the_app_CO7-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The <code>Dispose</code> method unsubscribes from the <code>AppInMemoryState.StateChanged</code> event.</p></dd>
</dl>

<p>You’ll notice that <code>MainLayout</code> is a <code>sealed partial class</code>; it’s <code>partial</code> so that it can serve as code-behind to the Razor markup, and it’s <code>sealed</code> so that it’s not inheritable by other components. It implements the <code>IDisposable</code> interface to perform necessary cleanup. Let’s ensure that <a data-primary="component shadowing" data-type="indexterm" id="idm46365043922720"/><a data-primary="component inheritance" data-type="indexterm" id="idm46365043922016"/>we’re following the concepts of <em>component shadowing</em> and <em>component inheritance</em>.</p>

<p>The <code>AppInMemoryState</code> instance is injected into the component. This application state object is in-memory only; if the user refreshes the page, the state is lost.</p>

<p>The <code>OnInitialized</code> method is overridden from <a data-primary="OnInitialized method" data-type="indexterm" id="idm46365043918528"/><a data-primary="methods" data-secondary="OnInitialized" data-type="indexterm" id="idm46365043917824"/>the base, and it’s used to subscribe to the <code>AppInMemoryState.StateChanged</code> event. The event handler is the framework-provided <code>ComponentBase.StateHasChanged</code> method. Eventing is a common idiom of C#, and it can be very useful. The <code>StateHasChanged</code> method notifies the component that its state has changed. When applicable, this will cause the component to be rerendered. <code>AppState.FrameworkDescription</code> is assigned from <code>Runtime​Informa⁠tion.FrameworkDescription</code>. This is the value that was displayed in the right-hand column of the footer, such as “.NET 6.”</p>
<div data-type="tip"><h6>Tip</h6>
<p>The <code>StateHasChanged</code> method should be <a data-primary="StateHasChanged method" data-type="indexterm" id="idm46365043913088"/><a data-primary="methods" data-secondary="StateHasChanged" data-type="indexterm" id="idm46365043912352"/>called only when required to avoid potentially unnecessarily forcing a component to rerender. When calling this method in an asynchronous context, wrap it in an <code>await</code> statement passing it into <a data-primary="InvokeAsync method" data-type="indexterm" id="idm46365043910896"/><a data-primary="methods" data-secondary="InvokeAsync" data-type="indexterm" id="idm46365043910192"/>the <code>InvokeAsync</code> method. This will execute the supplied work item on the associated renderer’s synchronization context, ensuring it’s executed on the appropriate thread.</p>
</div>

<p>You may need to explicitly call <code>StateHasChanged</code> in the following conditions:</p>

<ul>
<li>
<p>An asynchronous handler involves multiple asynchronous phases.</p>
</li>
<li>
<p>The Blazor rendering and event-handling system receives a call from something external.</p>
</li>
<li>
<p>You need to render a component outside the subtree that is rerendered by a particular event.</p>
</li>
</ul>

<p>For more information about triggering a render, see Microsoft’s <a href="https://oreil.ly/Kt3cm">“ASP.NET Core Razor Component Rendering” documentation</a>.</p>

<p>The <code>Dispose</code> method <a data-primary="Dispose method" data-type="indexterm" id="idm46365043902224"/><a data-primary="methods" data-secondary="Dispose" data-type="indexterm" id="idm46365043901488"/><a data-primary="MainLayout.razor.cs" data-startref="mlyz" data-type="indexterm" id="idm46365043900544"/>ensures that if the <code>AppState</code> instance <code>is not null</code>, it will unsubscribe from the <code>AppInMemoryState.StateChanged</code> event. This kind of explicit cleanup helps to ensure that the component will not cause a memory leak due to event handlers not <a data-primary="headers" data-startref="hdrs" data-type="indexterm" id="idm46365043898096"/><a data-primary="footers" data-startref="fotrs" data-type="indexterm" id="idm46365043897152"/>being unsubscribed.</p>
</div></section>













<section data-pdf-bookmark="An in-memory app state model" data-type="sect3"><div class="sect3" id="idm46365046842544">
<h3>An in-memory app state model</h3>

<p>Blazor apps can store their <a data-primary="applications" data-secondary="state, in-memory methodology" data-type="indexterm" id="ppttmd"/><a data-primary="in-memory app state" data-type="indexterm" id="impps"/>state using an in-memory methodology. In this approach, you register your app state container as a singleton service, meaning there’s only one instance for the app to share. The service itself exposes an event that subscribes to the <code>StateHasChanged</code> method, and as properties on the state object <a data-primary="AppInMemoryState.cs" data-type="indexterm" id="aimys"/>are updated, they fire the event. Consider the <em>AppInMemoryState.cs</em> C# file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">using</code><code> </code><code class="nn">Learning.Blazor.BrowserModels</code><code class="p">;</code><code>
</code><code>
</code><code class="k">namespace</code><code> </code><code class="nn">Learning.Blazor.Services</code><code class="p">;</code><code>
</code><code>
</code><code class="k">public</code><code> </code><code class="k">sealed</code><code> </code><code class="k">class</code><code> </code><code class="nc">AppInMemoryState</code><code>
</code><code class="p">{</code><code>
</code><code>    </code><code class="k">private</code><code> </code><code class="k">readonly</code><code> </code><code class="n">ILocalStorageService</code><code> </code><code class="n">_localStorage</code><code class="p">;</code><code> </code><a class="co" href="#callout_executing_the_app_CO8-1" id="co_executing_the_app_CO8-1"><img alt="1" src="assets/1.png"/></a><code>
</code><code>    </code><code class="k">private</code><code> </code><code class="kt">string?</code><code> </code><code class="n">_frameworkDescription</code><code class="p">;</code><code>
</code><code>    </code><code class="k">private</code><code> </code><code class="n">ClientVoicePreference</code><code class="p">?</code><code> </code><code class="n">_clientVoicePreference</code><code class="p">;</code><code>
</code><code>    </code><code class="k">private</code><code> </code><code class="kt">bool?</code><code> </code><code class="n">_isDarkTheme</code><code class="p">;</code><code>
</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="nf">AppInMemoryState</code><code class="p">(</code><code class="n">ILocalStorageService</code><code> </code><code class="n">localStorage</code><code class="p">)</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code>
</code><code>        </code><code class="n">_localStorage</code><code> </code><code class="p">=</code><code> </code><code class="n">localStorage</code><code class="p">;</code><code>
</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="kt">string?</code><code> </code><code class="n">FrameworkDescription</code><code> </code><a class="co" href="#callout_executing_the_app_CO8-2" id="co_executing_the_app_CO8-2"><img alt="2" src="assets/2.png"/></a><code>
</code><code>    </code><code class="p">{</code><code>
</code><code>        </code><code class="k">get</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code> </code><code class="n">_frameworkDescription</code><code class="p">;</code><code>
</code><code>        </code><code class="k">set</code><code>
</code><code>        </code><code class="p">{</code><code>
</code><code>            </code><code class="n">_frameworkDescription</code><code> </code><code class="p">=</code><code> </code><code class="k">value</code><code class="p">;</code><code>
</code><code>            </code><code class="n">AppStateChanged</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_executing_the_app_CO8-3" id="co_executing_the_app_CO8-3"><img alt="3" src="assets/3.png"/></a><code>
</code><code>        </code><code class="p">}</code><code>
</code><code>    </code><code class="p">}</code><code>
</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="n">ClientVoicePreference</code><code> </code><code class="n">ClientVoicePreference</code><code>
</code><code>    </code><code class="p">{</code><code>
</code><code>        </code><code class="k">get</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code> </code><code class="n">_clientVoicePreference</code><code> </code><code class="p">?</code><code class="p">?</code><code class="p">=</code><code>
</code><code>            </code><code class="n">_localStorage</code><code class="p">.</code><code class="n">GetItem</code><code class="p">&lt;</code><code class="n">ClientVoicePreference</code><code class="p">&gt;</code><code class="p">(</code><code>
</code><code>                </code><code class="n">StorageKeys</code><code class="p">.</code><code class="n">ClientVoice</code><code class="p">)</code><code>
</code><code>            </code><code class="p">?</code><code class="p">?</code><code> </code><code class="k">new</code><code class="p">(</code><code class="s">"Auto"</code><code class="p">,</code><code> </code><code class="m">1</code><code class="p">)</code><code class="p">;</code><code>
</code><code>        </code><code class="k">set</code><code>
</code><code>        </code><code class="p">{</code><code>
</code><code>            </code><code class="n">_localStorage</code><code class="p">.</code><code class="n">SetItem</code><code class="p">(</code><code>
</code><code>                </code><code class="n">StorageKeys</code><code class="p">.</code><code class="n">ClientVoice</code><code class="p">,</code><code>
</code><code>                </code><code class="n">_clientVoicePreference</code><code> </code><code class="p">=</code><code> </code><code class="k">value</code><code> </code><code class="p">?</code><code class="p">?</code><code> </code><code class="k">new</code><code class="p">(</code><code class="s">"Auto"</code><code class="p">,</code><code> </code><code class="m">1</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>
</code><code>
</code><code>            </code><code class="n">AppStateChanged</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code>        </code><code class="p">}</code><code>
</code><code>    </code><code class="p">}</code><code>
</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="kt">bool</code><code> </code><code class="n">IsDarkTheme</code><code>
</code><code>    </code><code class="p">{</code><code>
</code><code>        </code><code class="k">get</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code> </code><code class="n">_isDarkTheme</code><code> </code><code class="p">?</code><code class="p">?</code><code class="p">=</code><code>
</code><code>            </code><code class="n">_localStorage</code><code class="p">.</code><code class="n">GetItem</code><code class="p">&lt;</code><code class="kt">bool</code><code class="p">&gt;</code><code class="p">(</code><code class="n">StorageKeys</code><code class="p">.</code><code class="n">PrefersDarkTheme</code><code class="p">)</code><code class="p">;</code><code>
</code><code>        </code><code class="k">set</code><code>
</code><code>        </code><code class="p">{</code><code>
</code><code>            </code><code class="n">_localStorage</code><code class="p">.</code><code class="n">SetItem</code><code class="p">(</code><code>
</code><code>                </code><code class="n">StorageKeys</code><code class="p">.</code><code class="n">PrefersDarkTheme</code><code class="p">,</code><code>
</code><code>                </code><code class="n">_isDarkTheme</code><code> </code><code class="p">=</code><code> </code><code class="k">value</code><code class="p">)</code><code class="p">;</code><code>
</code><code>
</code><code>            </code><code class="n">AppStateChanged</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code>        </code><code class="p">}</code><code>
</code><code>    </code><code class="p">}</code><code>
</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="n">Action</code><code class="p">&lt;</code><code class="n">IList</code><code class="p">&lt;</code><code class="n">Alert</code><code class="p">&gt;</code><code class="p">&gt;</code><code class="p">?</code><code> </code><code class="n">WeatherAlertReceived</code><code> </code><code class="p">{</code><code> </code><code class="k">get</code><code class="p">;</code><code> </code><code class="k">set</code><code class="p">;</code><code> </code><code class="p">}</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="n">Action</code><code class="p">&lt;</code><code class="n">ContactComponentModel</code><code class="p">&gt;</code><code class="p">?</code><code> </code><code class="n">ContactPageSubmitted</code><code> </code><code class="p">{</code><code> </code><code class="k">get</code><code class="p">;</code><code> </code><code class="k">set</code><code class="p">;</code><code> </code><code class="p">}</code><code>
</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="k">event</code><code> </code><code class="n">Action</code><code class="p">?</code><code> </code><code class="n">StateChanged</code><code class="p">;</code><code> </code><a class="co" href="#callout_executing_the_app_CO8-4" id="co_executing_the_app_CO8-4"><img alt="4" src="assets/4.png"/></a><code>
</code><code>
</code><code>    </code><code class="k">private</code><code> </code><code class="k">void</code><code> </code><code class="nf">AppStateChanged</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code> </code><code class="n">StateChanged</code><code class="p">?</code><code class="p">.</code><code class="n">Invoke</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_executing_the_app_CO8-5" id="co_executing_the_app_CO8-5"><img alt="5" src="assets/5.png"/></a><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO8-1" id="callout_executing_the_app_CO8-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>These fields and properties represent the various app states.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO8-2" id="callout_executing_the_app_CO8-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>We will render the <code>FrameworkDescription</code> property.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO8-3" id="callout_executing_the_app_CO8-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The <code>AppStateChanged</code> method is called.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO8-4" id="callout_executing_the_app_CO8-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>There is an <code>Action</code> field named <code>StateChanged</code>.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO8-5" id="callout_executing_the_app_CO8-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The <code>AppStateChanged</code> method invokes the <code>StateChanged</code> event.</p></dd>
</dl>

<p>Several backing fields are declared, which will be used to store the values of various publicly accessible properties that represent various app states.</p>

<p>As an example of the pattern used to communicate app state changes, consider the <code>FrameworkDescription</code> property. Its <code>get</code> accessor goes to the backing field, and the <code>set</code> accessor assigns to the backing field.</p>

<p>After the <code>value</code> has been assigned to the backing field, the <code>AppStateChanged</code> method is called. This pattern is followed for all properties and their corresponding backing fields.</p>

<p>The class exposes a nullable <code>Action</code> as an <code>event</code> named <code>StateChanged</code>. Interested parties can subscribe to this for change notifications.</p>

<p>The <code>AppStateChanged</code> method is expressed as the invocation of the <code>StateChanged</code> event. It’s conditionally a NOOP (or “no operation”) when the event is <code>null</code>.</p>

<p>This in-memory state management mechanism is used to expose client voice preferences, whether or not the client is preferring the dark theme, and the value for the framework description. To have the application state persist across browser sessions, you’d use an alternative approach, such as local storage. There are trade-offs in each approach; while using in-memory app state is less work, it will not persist beyond browser sessions. To persist beyond browser sessions, you <a data-primary="applications" data-secondary="state, in-memory methodology" data-startref="ppttmd" data-type="indexterm" id="idm46365043854256"/><a data-primary="in-memory app state" data-startref="impps" data-type="indexterm" id="idm46365044624160"/><a data-primary="AppInMemoryState.cs" data-startref="aimys" data-type="indexterm" id="idm46365044623216"/>rely on JavaScript interop to use a local storage mechanism.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you’re a JavaScript SPA developer, you might be familiar with the <em>Flux pattern</em>. It was introduced by Facebook <a data-primary="Flux pattern" data-type="indexterm" id="idm46365043831456"/>to provide a clear separation of concerns. The pattern grew in popularity with the React Redux project, which is a JavaScript implementation of the Flux pattern used in React. There is an implementation of this for Blazor known as <a href="https://oreil.ly/nI5v3">Fluxor</a> by Peter Morris. While it is beyond the scope of this book, it’s worth exploring as a potential in-memory state management option.</p>
</div>
</div></section>













<section data-pdf-bookmark="Understanding the LoginDisplay component" data-type="sect3"><div class="sect3" id="login_display">
<h3>Understanding the LoginDisplay component</h3>

<p>The <code>LoginDisplay</code> component renders only a <a data-primary="LoginDisplay component" data-type="indexterm" id="lgdsy"/>few things to the HTML, but there’s a bit of code to understand:</p>

<pre data-code-language="html" data-type="programlisting"><code>@inherits LocalizableComponentBase</code><code class="p">&lt;</code><code class="nt">LoginDisplay</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO9-1" id="co_executing_the_app_CO9-1"><img alt="1" src="assets/1.png"/></a><code>
@inject SignOutSessionStateManager SignOutManager

</code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-item"</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">AuthorizeView</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO9-2" id="co_executing_the_app_CO9-2"><img alt="2" src="assets/2.png"/></a><code>
        </code><code class="p">&lt;</code><code class="nt">Authorizing</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="nt">button</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"button is-rounded is-loading level-item"</code><code> </code><code class="na">disabled</code><code class="p">&gt;</code><code>
                @Localizer["LoggingIn"]
            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">Authorizing</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">Authorized</code><code class="p">&gt;</code><code>
            @{
                var user = context.User!;
                var userIdentity = user.Identity!;
                var userToolTip =
                    $"{userIdentity.Name} ({user.GetFirstEmailAddress()})";
            }
            </code><code class="p">&lt;</code><code class="nt">button</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"
		button is-rounded level-item has-tooltip-right has-tooltip-info"</code><code>
                </code><code class="na">data-tooltip</code><code class="o">=</code><code class="s">@(userToolTip)</code><code> </code><code class="err">@</code><code class="na">onclick</code><code class="o">=</code><code class="s">"OnLogOut"</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"icon"</code><code class="p">&gt;</code><code>
                    </code><code class="p">&lt;</code><code class="nt">i</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"fas fa-sign-out-alt"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>@Localizer["LogOut"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">Authorized</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">NotAuthorized</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="nt">button</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"button is-rounded level-item"</code><code> </code><code class="err">@</code><code class="na">onclick</code><code class="o">=</code><code class="s">"OnLogIn"</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"icon"</code><code class="p">&gt;</code><code>
                    </code><code class="p">&lt;</code><code class="nt">i</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"fas fa-sign-in-alt"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
                </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>@Localizer["LogIn"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">NotAuthorized</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">AuthorizeView</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO9-1" id="callout_executing_the_app_CO9-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The component defines two directives.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO9-2" id="callout_executing_the_app_CO9-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The component markup uses the framework-provided <code>AuthorizeView</code> 
<span class="keep-together">component.</span></p></dd>
</dl>

<p>The component defines two directives: one to specify that it <em>inherits</em> from 
<span class="keep-together"><code>LocalizableComponentBase</code></span> and one to <em>inject</em> the <code>SignOutSessionStateManager</code> service. <code>LocalizableComponentBase</code> is a custom base component, which is covered in 
<span class="keep-together"><a data-type="xref" href="ch05.html#chapter-five">Chapter 5</a></span>.</p>

<p>The component markup uses the <code>AuthorizeView</code> component and <a data-primary="AuthorizeView component" data-type="indexterm" id="idm46365043706656"/>its various authorized-state-dependent templates to render content when the user is currently authorizing, already authorized, or not authorized. Each of these states has independent markup.</p>

<p>When authorizing, the “logging in” message is localized and rendered to the screen. When the user is authorized, the <code>context</code> exposes the <code>ClaimsPrincipal</code> object that’s assigned to the <code>user</code> variable. Consider the <code>Localizer</code> object from the previous markup. This specific type comes from the inheritance of the custom <code>LocalizableComponentBase&lt;LoginDisplay&gt;</code> class. This <code>Localizer</code> exposes localization functionality that is based on Microsoft’s resource (<em>.resx</em>)-driven key/value pairs (KVPs) <a data-primary="key/value pairs (KVPs)" data-secondary="localization functionality" data-type="indexterm" id="idm46365042558320"/>and the frameworks’ <code>IStringLocalizer&lt;T&gt;</code> type. The custom <em>LocalizableComponent​Base.cs</em> class is located <a data-primary="LocalizableComponentBase.cs class" data-type="indexterm" id="idm46365042556336"/><a data-primary="Components directory" data-type="indexterm" id="idm46365042555568"/>in the <em>Components</em> directory.</p>

<p>The code creates a tool tip it will render—the string concatenation of the user’s name and email address. The tool tip is bound to the button element’s <code>data-tooltip</code> attribute. This is part of the Bulma CSS framework for tool tips. Hovering over the logout button will render the message. When the user is not authorized, we render a button with a localized login message.</p>

<p>Next, let’s take <a data-primary="LoginDisplay.cs" data-type="indexterm" id="idm46365042553360"/>a look at its shadowed component, the <em>LoginDisplay.cs</em> file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">using</code> <code class="nn">Microsoft.AspNetCore.Components.Web</code><code class="p">;</code>

<code class="k">namespace</code> <code class="nn">Learning.Blazor.Shared</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">partial</code> <code class="k">class</code> <code class="nc">LoginDisplay</code>
    <code class="p">{</code>
<code class="na">        [Inject]</code>
        <code class="k">public</code> <code class="n">NavigationManager</code> <code class="n">Navigation</code> <code class="p">{</code> <code class="k">get</code><code class="p">;</code> <code class="k">set</code><code class="p">;</code> <code class="p">}</code> <code class="p">=</code> <code class="k">null</code><code class="p">!;</code>

        <code class="k">void</code> <code class="nf">OnLogIn</code><code class="p">(</code><code class="n">MouseEventArgs</code> <code class="n">args</code><code class="p">)</code> <code class="p">=&gt;</code>
            <code class="n">Navigation</code><code class="p">.</code><code class="n">NavigateTo</code><code class="p">(</code><code class="s">"authentication/login"</code><code class="p">,</code> <code class="k">true</code><code class="p">);</code>

        <code class="k">async</code> <code class="n">Task</code> <code class="nf">OnLogOut</code><code class="p">(</code><code class="n">MouseEventArgs</code> <code class="n">args</code><code class="p">)</code>
        <code class="p">{</code>
            <code class="k">await</code> <code class="n">SignOutManager</code><code class="p">.</code><code class="n">SetSignOutState</code><code class="p">();</code>
            <code class="n">Navigation</code><code class="p">.</code><code class="n">NavigateTo</code><code class="p">(</code><code class="s">"authentication/logout"</code><code class="p">);</code>
        <code class="p">}</code>
    <code class="p">}</code>
<code class="p">}</code></pre>

<p>This component provides two functions that <a data-primary="Navigation service" data-type="indexterm" id="idm46365044480544"/>use the injected <code>Navigation</code> service. The <code>Navigation</code> property is assigned by the DI framework and is functionally equivalent to the component’s <code>@inject</code> directive syntax. Each method navigates to the desired authentication route. When <code>OnLogOut</code> is invoked, <code>SignOutManager</code> has its sign-out state set before navigating away. Each route is handled by the app’s corresponding authentication logic. The user will see their name next to a logout button when they’re authenticated, but if they’re not authenticated, they will see only a login button. Users can sign up with the application by providing and validating their email. This is managed by <a data-primary="Azure Active Directory (AD) business-to-consumer (B2C)" data-type="indexterm" id="idm46365044408832"/>Azure Active Directory (Azure AD) business-to-consumer (B2C). As an alternative to signing up with the application, you can <a data-primary="LoginDisplay component" data-startref="lgdsy" data-type="indexterm" id="idm46365044407968"/>use one of the available third-party authentication providers, such as Google, Twitter, and GitHub.</p>
</div></section>













<section data-pdf-bookmark="Native theme awareness" data-type="sect3"><div class="sect3" id="theme-indicator-component">
<h3>Native theme awareness</h3>

<p>An app’s ability to be color-scheme aware is highly <a data-primary="themes" data-type="indexterm" id="thms"/>recommended for all modern web apps. From CSS, it is easy to specify style rules that are scoped to media-dependent queryable values. Consider the following CSS:</p>

<pre data-code-language="css" data-type="programlisting"><code class="k">@media</code> <code class="p">(</code><code class="n">prefers</code><code class="o">-</code><code class="n">color</code><code class="o">-</code><code class="n">scheme</code><code class="o">:</code> <code class="n">dark</code><code class="p">)</code> <code class="p">{</code>
    <code class="c">/*</code>
<code class="c">        Styles here are only applied when the browser</code>
<code class="c">        has a specified color scheme of "dark".</code>
<code class="c">    */</code>
<code class="p">}</code></pre>

<p>The rules within this media query apply only when the browser is set to prefer the <code>dark</code> theme. These media queries can also be accessed programmatically from JavaScript. The <a href="https://oreil.ly/uFPAD"><code>window.matchMedia</code> method</a> is <a data-primary="window.matchMedia method" data-type="indexterm" id="idm46365044379920"/><a data-primary="methods" data-secondary="window.matchMedia" data-type="indexterm" id="idm46365044379248"/>used to detect changes to the client browser preferences. Let’s look first <a data-primary="ThemeIndicatorComponent.razor" data-type="indexterm" id="ticz"/>at the <em>ThemeIndicator​Com⁠ponent.razor</em> file:</p>

<pre data-code-language="html" data-type="programlisting"><code>@inherits LocalizableComponentBase</code><code class="p">&lt;</code><code class="nt">ThemeIndicatorComponent</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO10-1" id="co_executing_the_app_CO10-1"><img alt="1" src="assets/1.png"/></a><code>

</code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"navbar-item"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO10-2" id="co_executing_the_app_CO10-2"><img alt="2" src="assets/2.png"/></a><code>
    </code><code class="p">&lt;</code><code class="nt">button</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"button is-@(_buttonClass)
		has-tooltip-left has-tooltip-info is-rounded level-item"</code><code>
        </code><code class="na">data-tooltip</code><code class="o">=</code><code class="s">@Localizer</code><code>
            </code><code class="err">[</code><code class="na">AppState</code><code class="err">.</code><code class="na">IsDarkTheme</code><code> </code><code class="err">?</code><code> </code><code class="err">"</code><code class="na">DarkTheme</code><code class="err">"</code><code> </code><code class="na">:</code><code> </code><code class="err">"</code><code class="na">LightTheme</code><code class="err">"</code><code class="err">]</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"icon"</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="nt">i</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"fas fa-@(_iconClass)"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>

</code><code class="p">&lt;</code><code class="nt">HeadContent</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO10-3" id="co_executing_the_app_CO10-3"><img alt="3" src="assets/3.png"/></a><code>
    </code><code class="p">&lt;</code><code class="nt">meta</code><code> </code><code class="na">name</code><code class="o">=</code><code class="s">"twitter:widgets:theme"</code><code>
          </code><code class="na">content</code><code class="o">=</code><code class="s">'@(AppState.IsDarkTheme ? "dark" : "light")'</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">HeadContent</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO10-1" id="callout_executing_the_app_CO10-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>Inherits from the generic <code>LocalizableComponentBase</code> class.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO10-2" id="callout_executing_the_app_CO10-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The primary markup for <code>ThemeIndicatorComponent</code> is the button.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO10-3" id="callout_executing_the_app_CO10-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p><code>ThemeIndicatorComponent</code> makes use of <code>&lt;HeadContent&gt;</code>.</p></dd>
</dl>

<p>Hopefully, you’re noticing that a lot of components are inheriting from the generic <code>LocalizableComponentBase</code> class. Again, we’ll cover this in <a data-type="xref" href="ch05.html#chapter-five">Chapter 5</a>. Just know that it exposes a <code>Localizer</code> member that lets us get a localized string value given a string key via a free-range indexer.</p>

<p>The primary markup for <code>ThemeIndicatorComponent</code> is the button. The button’s <code>class</code> attribute is mixed, with verbatim class <a data-primary="Razor" data-secondary="expressions" data-type="indexterm" id="idm46365044153568"/>names and Razor expressions that are evaluated at runtime. The <code>_buttonClass</code> member is a C# string field that is bound to the <code>"is-"</code> prefix. This button also has a tool tip, and its message is conditionally assigned dependent on the ternary expression from the <code>_isDarkTheme</code> boolean value. The Font Awesome class is also bound to an <code>_iconClass</code> field member.</p>

<p><code>ThemeIndicatorComponent</code> makes use of <code>&lt;HeadContent&gt;</code>. This is a framework-provided component that allows us to dynamically update the HTML’s <code>&lt;head&gt;</code> content. It’s very powerful and useful for updating <code>&lt;meta&gt;</code> elements on the fly. When the theme is <code>dark</code>, the app specifies that the Twitter widgets should also be themed accordingly.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>While the <code>HeadContent</code> component <a data-primary="HeadContent" data-type="indexterm" id="idm46365044146608"/>can update <code>meta</code> tags, it’s still not ideal for search engine optimization (SEO) when using Blazor WebAssembly. This is because the <code>meta</code> tags are updated dynamically. To achieve static <code>meta</code> tag values, you’d have to <a data-primary="ThemeIndicatorComponent.razor" data-startref="ticz" data-type="indexterm" id="idm46365044144304"/>use Blazor WebAssembly prerendering. For more information about component integration scenarios, see Microsoft’s <a href="https://oreil.ly/NmB4A">“Prerender and Integrate ASP.NET Core Razor Components” documentation</a>.</p>
</div>

<p>Next, let’s look at its corresponding component <a data-primary="ThemeIndicatorComponent.razor.cs file" data-type="indexterm" id="ticr"/>shadow, the C# file <em>ThemeIndicator​Component.razor.cs</em>:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">using</code><code> </code><code class="nn">Learning.Blazor.Extensions</code><code class="p">;</code><code>
</code><code class="k">using</code><code> </code><code class="nn">Microsoft.JSInterop</code><code class="p">;</code><code>
</code><code>
</code><code class="k">namespace</code><code> </code><code class="nn">Learning.Blazor.Components</code><code>
</code><code class="p">{</code><code>
</code><code>    </code><code class="k">public</code><code> </code><code class="k">partial</code><code> </code><code class="k">class</code><code> </code><code class="nc">ThemeIndicatorComponent</code><code> </code><a class="co" href="#callout_executing_the_app_CO11-1" id="co_executing_the_app_CO11-1"><img alt="1" src="assets/1.png"/></a><code>
</code><code>    </code><code class="p">{</code><code>
</code><code>        </code><code class="k">private</code><code> </code><code class="kt">string</code><code> </code><code class="n">_buttonClass</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO11-2" id="co_executing_the_app_CO11-2"><img alt="2" src="assets/2.png"/></a><code>
</code><code>            </code><code class="n">AppState</code><code class="p">.</code><code class="n">IsDarkTheme</code><code> </code><code class="p">?</code><code> </code><code class="s">"light"</code><code> </code><code class="p">:</code><code> </code><code class="s">"dark"</code><code class="p">;</code><code>
</code><code>        </code><code class="k">private</code><code> </code><code class="kt">string</code><code> </code><code class="n">_iconClass</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code>
</code><code>            </code><code class="n">AppState</code><code class="p">.</code><code class="n">IsDarkTheme</code><code> </code><code class="p">?</code><code> </code><code class="s">"moon"</code><code> </code><code class="p">:</code><code> </code><code class="s">"sun"</code><code class="p">;</code><code>
</code><code>
</code><code>        </code><code class="k">protected</code><code> </code><code class="k">override</code><code> </code><code class="k">async</code><code> </code><code class="n">Task</code><code> </code><code class="nf">OnInitializedAsync</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_executing_the_app_CO11-3" id="co_executing_the_app_CO11-3"><img alt="3" src="assets/3.png"/></a><code>
</code><code>            </code><code class="n">AppState</code><code class="p">.</code><code class="n">IsDarkTheme</code><code> </code><code class="p">=</code><code>
</code><code>                </code><code class="k">await</code><code> </code><code class="n">JavaScript</code><code class="p">.</code><code class="n">GetCurrentDarkThemePreferenceAsync</code><code class="p">(</code><code>
</code><code>                    </code><code class="k">this</code><code class="p">,</code><code> </code><code class="n">nameof</code><code class="p">(</code><code class="n">UpdateDarkThemePreference</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="na">
        [JSInvokable]</code><code> </code><a class="co" href="#callout_executing_the_app_CO11-4" id="co_executing_the_app_CO11-4"><img alt="4" src="assets/4.png"/></a><code>
</code><code>        </code><code class="k">public</code><code> </code><code class="n">Task</code><code> </code><code class="nf">UpdateDarkThemePreference</code><code class="p">(</code><code class="kt">bool</code><code> </code><code class="n">isDarkTheme</code><code class="p">)</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code>
</code><code>            </code><code class="n">InvokeAsync</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code>
</code><code>            </code><code class="p">{</code><code>
</code><code>                </code><code class="n">AppState</code><code class="p">.</code><code class="n">IsDarkTheme</code><code> </code><code class="p">=</code><code> </code><code class="n">isDarkTheme</code><code class="p">;</code><code>
</code><code>
</code><code>                </code><code class="n">StateHasChanged</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code>            </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO11-1" id="callout_executing_the_app_CO11-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The <code>ThemeIndicatorComponent</code> component shadow is defined.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO11-2" id="callout_executing_the_app_CO11-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>There are a few conditional CSS classes that are bound to field values.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO11-3" id="callout_executing_the_app_CO11-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The component overrides <code>OnInitializedAsync</code>, where it performs a bit of app state theme logic.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO11-4" id="callout_executing_the_app_CO11-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The callback method named <code>UpdateDarkThemePreference</code>.</p></dd>
</dl>

<p><code>ThemeIndicatorComponent</code> is a read-only indicator of the current theme detected. There are only two types the app supports: Light and Dark. There are a few private fields, but you’ll recall that these are accessible to the markup and bound where needed. These two <code>string</code> fields are simple ternary expressions based on the <code>AppState.IsDarkTheme</code> value. The component overrides <code>OnInitializedAsync</code>, where it assigns the current state of the <code>AppState.IsDarkTheme</code> variable and calls the <code>Get​Cur⁠rentDarkThemePreference</code> method, which is an <code>IJSRuntime</code> extension method. This method requires the <code>ThemeIndicatorComponent</code> to reference itself and the callback method name. C#’s <code>nameof</code> expression produces the name of its argument, which in this case is the callback. This means that we’re registering our .NET component to receive a callback from the JavaScript side given a .NET object reference.</p>

<p>The callback method named <code>UpdateDarkThemePreference</code> expects the <code>isDarkTheme</code> value. The method must be decorated with the <code>JSInvokable</code> attribute for it to be callable from JavaScript. Since this callback can be invoked anytime after the component is initialized, it must use the combination of <code>InvokeAsync</code> and <code>StateHasChanged</code>:</p>
<dl class="pagebreak-after">
<dt><code>InvokeAsync</code></dt>
<dd>
<p>Executes the supplied work item on the associated renderer’s synchronization context.</p>
</dd>
<dt><code>StateHasChanged</code></dt>
<dd>
<p>Notifies the component that its state has changed. When applicable, this will cause the component to be <a data-primary="ThemeIndicatorComponent.razor.cs file" data-startref="ticr" data-type="indexterm" id="idm46365035825408"/>rerendered.</p>
</dd>
</dl>

<p>Let’s now consider <a data-primary="JSRuntimeExtensions.cs" data-type="indexterm" id="jsrxt"/>the following <em>JSRuntimeExtensions.cs</em> C# file for the <code>GetCurrentDarkThemePreferenceAsync</code> extension method:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">using</code><code> </code><code class="nn">Microsoft.JSInterop</code><code class="p">;</code><code>
</code><code>
</code><code class="k">namespace</code><code> </code><code class="nn">Learning.Blazor.Extensions</code><code class="p">;</code><code>
</code><code>
</code><code class="k">internal</code><code> </code><code class="k">static</code><code> </code><code class="k">class</code><code> </code><code class="nc">JSRuntimeExtensions</code><code>
</code><code class="p">{</code><code>
</code><code>    </code><code class="k">internal</code><code> </code><code class="k">static</code><code> </code><code class="k">async</code><code> </code><code class="n">ValueTask</code><code class="p">&lt;</code><code class="kt">bool</code><code class="p">&gt;</code><code> </code><code class="n">GetCurrentDarkThemePreferenceAsync</code><code class="p">&lt;</code><code class="n">T</code><code class="p">&gt;</code><code class="p">(</code><code>
</code><code>        </code><code class="k">this</code><code> </code><code class="n">IJSRuntime</code><code> </code><code class="n">javaScript</code><code class="p">,</code><code>
</code><code>        </code><code class="n">T</code><code> </code><code class="n">dotnetObj</code><code class="p">,</code><code> </code><a class="co" href="#callout_executing_the_app_CO12-1" id="co_executing_the_app_CO12-1"><img alt="1" src="assets/1.png"/></a><code>
</code><code>        </code><code class="kt">string</code><code> </code><code class="n">callbackMethodName</code><code class="p">)</code><code> </code><code class="k">where</code><code> </code><code class="n">T</code><code> </code><code class="p">:</code><code> </code><code class="k">class</code><code> </code><code class="p">=</code><code class="p">&gt;</code><code>
</code><code>        </code><code class="k">await</code><code> </code><code class="n">javaScript</code><code class="p">.</code><code class="n">InvokeAsync</code><code class="p">&lt;</code><code class="kt">bool</code><code class="p">&gt;</code><code class="p">(</code><code> </code><a class="co" href="#callout_executing_the_app_CO12-2" id="co_executing_the_app_CO12-2"><img alt="2" src="assets/2.png"/></a><code>
</code><code>            </code><code class="s">"app.getClientPrefersColorScheme"</code><code class="p">,</code><code> </code><a class="co" href="#callout_executing_the_app_CO12-3" id="co_executing_the_app_CO12-3"><img alt="3" src="assets/3.png"/></a><code>
</code><code>            </code><code class="s">"dark"</code><code class="p">,</code><code> </code><a class="co" href="#callout_executing_the_app_CO12-4" id="co_executing_the_app_CO12-4"><img alt="4" src="assets/4.png"/></a><code>
</code><code>            </code><code class="n">DotNetObjectReference</code><code class="p">.</code><code class="n">Create</code><code class="p">(</code><code class="n">dotnetObj</code><code class="p">)</code><code class="p">,</code><code> </code><a class="co" href="#callout_executing_the_app_CO12-5" id="co_executing_the_app_CO12-5"><img alt="5" src="assets/5.png"/></a><code>
</code><code>            </code><code class="n">callbackMethodName</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_executing_the_app_CO12-6" id="co_executing_the_app_CO12-6"><img alt="6" src="assets/6.png"/></a><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO12-1" id="callout_executing_the_app_CO12-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The <code>dotnetObj</code> parameter is generic and constrained to <code>class</code>.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO12-2" id="callout_executing_the_app_CO12-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The <code>javaScript</code> runtime instance calls interop methods.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO12-3" id="callout_executing_the_app_CO12-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The <code>"app.getClientPrefersColorScheme"</code> method is called.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO12-4" id="callout_executing_the_app_CO12-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>An argument with a value of <code>"dark"</code> is passed to the <code>"app.getClientPrefers​Co⁠lorScheme"</code> method.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO12-5" id="callout_executing_the_app_CO12-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p><code>DotNetObjectReference.Create(dotnetObj)</code> creates an instance of <code>DotNet​Ob⁠jectReference&lt;ThemeIndicatorComponent&gt;</code>.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO12-6" id="callout_executing_the_app_CO12-6"><img alt="6" src="assets/6.png"/></a></dt>
<dd><p><code>callbackMethodName</code> is the calling method name.</p></dd>
</dl>

<p>The extension method defines a generic type parameter, <code>T</code>, which is constrained to a <code>class</code>. The object instance, in this case, is <code>ThemeIndicatorComponent</code>, but it could be any <code>class</code>.</p>

<p>The <code>javaScript</code> runtime instance is used to call a <code>ValueTask&lt;bool&gt;</code> returning interop function. The <code>"app.getClientPrefersColorScheme"</code> method is a JavaScript method that is accessible on the <code>window</code> scope.</p>

<p>The hardcoded value of <code>"dark"</code> is passed to the <code>app.getClientPrefersColorScheme</code> function as the first parameter. It’s hardcoded because we know that we’re trying to evaluate whether or not the current client browser prefers the dark theme. When they do, this will return <code>true</code>.</p>

<p><code>DotNetObjectReference.Create(dotnetObj)</code> creates an instance of <code>DotNetObject​Re⁠ference&lt;ThemeIndicatorComponent&gt;</code>, and this is passed to the corresponding JavaScript function as the second parameter. This is used as a reference so that JavaScript can call back into the .NET component.</p>

<p><code>callbackMethodName</code> is a method name from the calling <code>ThemeIndicatorComponent</code> instance that is decorated with a <code>JSInvokable</code> attribute. This method can and will be <a data-primary="JSRuntimeExtensions.cs" data-startref="jsrxt" data-type="indexterm" id="idm46365035666544"/>called from JavaScript when needed.</p>

<p>Considering this is your first look at JavaScript interop, let me anticipate and answer a few questions you may have:</p>
<dl>
<dt>Question</dt>
<dd>
<p>Where is this JavaScript coming from, and what does it look like?</p>
</dd>
<dt>Answer</dt>
<dd>
<p>This JavaScript is part of the <em>app.js</em> file that was referenced in the <em>index.html</em>. It’s served under the <em>wwwroot</em> folder. We’ll look at the source in the next section.</p>
</dd>
<dt>Question</dt>
<dd>
<p>What capabilities does it have?</p>
</dd>
<dt>Answer</dt>
<dd>
<p>That depends on what you’re looking to achieve, but really, anything you might imagine. For this specific use case, the JavaScript will expose a utilitarian helper function named <code>getClientPrefersColorScheme</code>. Internally, JavaScript relies on the <code>window.matchMedia</code> APIs. The .NET code makes an interop call into JavaScript and passes a component reference. The JavaScript code registers an event handler to monitor whether the user changes their color scheme preference. The current preference is returned immediately back to .NET from JavaScript, but the event handler is still registered. If the user preference changes, using the given component reference, the JavaScript code will make an interop call back into .NET with the new color scheme preference. This exemplifies bidirectional interop.</p>
</dd>
<dt>Question</dt>
<dd>
<p>When do I need to write JavaScript interop code?</p>
</dd>
<dt>Answer</dt>
<dd>
<p>Whenever you need finite control over a sequence of JavaScript APIs. A good example is when you need to interact with a third-party library or when calling native JavaScript APIs. You’ll see some good examples for when it’s appropriate to write JavaScript interop code throughout the book.</p>
</dd>
</dl>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Blazor is responsible for manipulating the DOM. If Blazor doesn’t support the DOM manipulation your app requires, you might need to write JavaScript interop code to achieve the desired behavior. However, this should be rare. Ideally, you’d avoid having two different approaches to the same problem.</p>
</div>

<p>This specific JavaScript API uses the media query APIs, which <a data-primary="app.js" data-type="indexterm" id="apjjs"/>are native to JavaScript. Consider the <em>app.js</em> JavaScript file:</p>

<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code><code> </code><code class="nx">getClientPrefersColorScheme</code><code> </code><code class="o">=</code><code> </code><a class="co" href="#callout_executing_the_app_CO13-1" id="co_executing_the_app_CO13-1"><img alt="1" src="assets/1.png"/></a><code>
    </code><code class="p">(</code><code class="nx">color</code><code class="p">,</code><code> </code><code class="nx">dotnetObj</code><code class="p">,</code><code> </code><code class="nx">callbackMethodName</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code>
    </code><code class="kd">let</code><code> </code><code class="nx">media</code><code> </code><code class="o">=</code><code> </code><code class="nb">window</code><code class="p">.</code><code class="nx">matchMedia</code><code class="p">(</code><code class="sb">`</code><code class="sb">(prefers-color-scheme: </code><code class="si">${</code><code class="nx">color</code><code class="si">}</code><code class="sb">)</code><code class="sb">`</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_executing_the_app_CO13-2" id="co_executing_the_app_CO13-2"><img alt="2" src="assets/2.png"/></a><code>
    </code><code class="k">if</code><code> </code><code class="p">(</code><code class="nx">media</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="nx">media</code><code class="p">.</code><code class="nx">onchange</code><code> </code><code class="o">=</code><code> </code><code class="nx">args</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_executing_the_app_CO13-3" id="co_executing_the_app_CO13-3"><img alt="3" src="assets/3.png"/></a><code>
            </code><code class="nx">dotnetObj</code><code class="p">.</code><code class="nx">invokeMethodAsync</code><code class="p">(</code><code> </code><a class="co" href="#callout_executing_the_app_CO13-4" id="co_executing_the_app_CO13-4"><img alt="4" src="assets/4.png"/></a><code>
                </code><code class="nx">callbackMethodName</code><code class="p">,</code><code>
                </code><code class="nx">args</code><code class="p">.</code><code class="nx">matches</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">return</code><code> </code><code class="nx">media</code><code class="p">.</code><code class="nx">matches</code><code class="p">;</code><code> </code><a class="co" href="#callout_executing_the_app_CO13-5" id="co_executing_the_app_CO13-5"><img alt="5" src="assets/5.png"/></a><code>
</code><code class="p">}</code><code>

</code><code class="c1">// omitted for brevity...
</code><code>
</code><code class="nb">window</code><code class="p">.</code><code class="nx">app</code><code> </code><code class="o">=</code><code> </code><code class="nb">Object</code><code class="p">.</code><code class="nx">assign</code><code class="p">(</code><code class="p">{</code><code class="p">}</code><code class="p">,</code><code> </code><code class="nb">window</code><code class="p">.</code><code class="nx">app</code><code class="p">,</code><code> </code><code class="p">{</code><code>
    </code><code class="nx">getClientPrefersColorScheme</code><code class="p">,</code><code> </code><a class="co" href="#callout_executing_the_app_CO13-6" id="co_executing_the_app_CO13-6"><img alt="6" src="assets/6.png"/></a><code>
    </code><code class="c1">// omitted for brevity...
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_executing_the_app_CO13-1" id="callout_executing_the_app_CO13-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>Consider the <code>getClientPrefersColorScheme</code> function.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO13-2" id="callout_executing_the_app_CO13-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>A <code>media</code> instance is assigned from the call to <code>window.matchMedia</code>.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO13-3" id="callout_executing_the_app_CO13-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The <code>media.onchange</code> event handler property is assigned to an inline function.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO13-4" id="callout_executing_the_app_CO13-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>When the <code>media</code> instance changes, the .NET object has its callback invoked.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO13-5" id="callout_executing_the_app_CO13-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The <code>media.matches</code> value is returned.</p></dd>
<dt><a class="co" href="#co_executing_the_app_CO13-6" id="callout_executing_the_app_CO13-6"><img alt="6" src="assets/6.png"/></a></dt>
<dd><p><code>getClientPrefersColorScheme</code> is added to the <code>window.app</code> object.</p></dd>
</dl>

<p>The <code>getClientPrefersColorScheme</code> function <a data-primary="getClientPrefersColorScheme" data-type="indexterm" id="idm46365035452400"/>is defined as a <code>const</code> function with <code>color</code>, <code>dotnetObj</code>, and <code>callbackMethodName</code> parameters. A <code>media</code> instance is assigned from the call to <code>window.matchMedia</code>, given the media query string. The <code>media.onchange</code> event handler property is assigned to an inline function.</p>

<p>The event handler inline function relies on the <code>dotnetObj</code> instance, which is a reference to the calling Blazor component. This is JavaScript interop in which JavaScript calls into .NET. In other words, if the user changes their preferences, the <code>onchange</code> event is fired and the Blazor component has its <code>callbackMethodName</code> invoked.</p>

<p>The <code>media.matches</code> value is returned, indicating to the caller the current value of whether the media query string matches. <code>getClientPrefersColorScheme</code> is added to the <code>window.app</code> object.</p>

<p>Putting all of this together, you can reference <code>&lt;ThemeIndicatorComponent /&gt;</code> in any Blazor component, and you’d have a self-contained, color scheme–aware component. As the client preferences change, the component dynamically updates its current rendered HTML representation <a data-primary="themes" data-startref="thms" data-type="indexterm" id="idm46365035445136"/>of the color scheme. The component relies on <a data-primary="app.js" data-startref="apjjs" data-type="indexterm" id="idm46365035444160"/>JavaScript interop, and it’s seamless from C#.</p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm46365047394496">
<h1>Summary</h1>

<p>In this chapter, I guided you through the inner workings of how Blazor Web­Assem⁠bly starts. From the serving and processing of static HTML to the invocation of JavaScript that bootstraps Blazor, you explored the anatomy of the app. This includes the <code>Program</code> entry point and the startup conventions. You learned about the router, client-side navigation, shared components, and layouts. You also learned about top-level navigation components in the app and how content is rendered through <code>RenderFragment</code> placeholders. The model app demonstrated a native color scheme–aware component and an example of JavaScript interop. In the next chapter, you’ll see how to author custom Blazor components and how to use JavaScript interop. You’ll learn more about how Blazor uses authentication to verify a user’s identity and how to conditionally render markup. Finally, you’ll see how to use various data-binding techniques and rely on data from HTTP services.</p>
</div></section>







</div></section></body></html>