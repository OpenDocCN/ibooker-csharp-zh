<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Appendix A. Benchmarking AWS" data-type="appendix" epub:type="appendix"><div class="appendix" id="appendix-benchmark-aws">
<h1><span class="label">Appendix A. </span>Benchmarking AWS</h1>
<p><a data-primary="AWS (generally)" data-secondary="benchmarking" data-type="indexterm" id="ix_appendix-benchmark-aws-asciidoc0"/><a data-primary="benchmarking, AWS" data-type="indexterm" id="ix_appendix-benchmark-aws-asciidoc1"/>One way to get a more profound knowledge of AWS is to benchmark the performance of different machines.  Part of the value of AWS is the ability to use many various services and other abstractions to solve problems in the most efficient manner possible.  You can view many code examples in this <a href="https://github.com/noahgift/benchmarking-aws">example GitHub Repository on benchmarking</a>.  Notice that there are substantial differences in sysbench benchmarks from 1 core to a 36 core to a 96 core machine as shown in <a data-type="xref" href="#Figure-1-8">Figure A-1</a>.</p>
<figure><div class="figure" id="Figure-1-8">
<img alt="doac ab01" height="616" src="assets/doac_ab01.png" width="1022"/>
<h6><span class="label">Figure A-1. </span>Benchmarking AWS instances</h6>
</div></figure>
<p>As your organization determines the correct Amazon Linux 2 machine to run .NET Core on Linux, it would be a great idea to do some initial benchmarking.  To run these benchmarks in a repeatable manner on Amazon Linux 2, you can refer to this <a href="https://oreil.ly/IF5rR"><code>Makefile</code></a>.  Notice how <code>sysbench</code> only needs two lines to install and run the <code>./benchmark.sh</code> script.</p>
<p>The actual benchmark script is as follows:</p>
<pre data-code-language="bash" data-type="programlisting"><code class="ch">#!/usr/bin/env bash</code>
<code class="nv">CPU</code><code class="o">=</code><code class="sb">`</code>python -c <code class="s2">"import multiprocessing as mp;print(f'{mp.cpu_count()}')"</code><code class="sb">`</code>
<code class="nb">echo</code> <code class="s2">"Running with CPU Count and Threads: "</code> <code class="nv">$CPU</code>
sysbench cpu --threads<code class="o">=</code><code class="nv">$CPU</code> run</pre>
<p>The <code>makefile</code> command can be run as <code>make benchmark-sysbench-amazon</code>:</p>
<pre data-code-language="bash" data-type="programlisting">benchmark-sysbench-amazon:
	<code class="c1">#install sysbench</code>
	curl -s https://packagecloud.io/install/repositories/akopytov/<code class="se">\</code>
	sysbench/script.rpm.sh <code class="p">|</code> sudo bash
	sudo yum -y install sysbench
	<code class="c1">#run CPU benchmark</code>
	./benchmark.sh</pre>
<p>The benchmark script uses a “one-liner” to determine how many cores are available and then passes this into a CPU benchmark:</p>
<pre data-code-language="bash" data-type="programlisting"><code class="ch">#!/usr/bin/env bash</code>

<code class="nv">CPU</code><code class="o">=</code><code class="sb">`</code>python -c <code class="s2">"import multiprocessing as mp;print(f'{mp.cpu_count()}')"</code><code class="sb">`</code>
<code class="nb">echo</code> <code class="s2">"Running with CPU Count and Threads: "</code> <code class="nv">$CPU</code>
sysbench cpu --threads<code class="o">=</code><code class="nv">$CPU</code> run</pre>
<p>A free tool like <a href="https://oreil.ly/ROql2">Cinebench</a> works to benchmark a Windows OS.  It is always good to perform multiple measures, including an OS-level benchmark and application load test, on the actual environment in which an application gets deployed.<a data-startref="ix_appendix-benchmark-aws-asciidoc1" data-type="indexterm" id="idm45599647748448"/><a data-startref="ix_appendix-benchmark-aws-asciidoc0" data-type="indexterm" id="idm45599647747840"/></p>
</div></section></div></body></html>