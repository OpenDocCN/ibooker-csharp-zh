<html><head></head><body><section data-pdf-bookmark="Chapter 5. Encapsulation: Keep your Privates&#x2026; Private" data-type="chapter" epub:type="chapter"><div class="chapter" id="encapsulation_keep_your_privateshellippr">&#13;
<h1><span class="label">Chapter 5. </span>Encapsulation: <em>Keep your Privates… Private</em></h1>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/227fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="encapsulation" data-secondary="about" data-type="indexterm" id="idm46402345269672"/><strong>Ever wished for a little more privacy?</strong></p>&#13;
<p>Sometimes your objects feel the same way. Just like you don’t want anybody you don’t trust reading your journal or paging through your bank statements, good objects don’t let <strong><em>other</em></strong> objects go poking around their fields. In this chapter, you’re going to learn about the power of <strong>encapsulation</strong>, a way of programming that helps you make code that’s flexible, easy to use, and difficult to misuse. You’ll <strong>make your objects’ data private</strong>, and add <strong>properties</strong> to protect how that data is accessed.</p>&#13;
<section data-pdf-bookmark="Let’s help Owen roll for damage" data-type="sect1"><div class="sect1" id="letapostrophes_help_owen_roll_for_damage">&#13;
<h1>Let’s help Owen roll for damage</h1>&#13;
<p><a data-primary="constants" data-type="indexterm" id="idm46402345263832"/>Owen was so happy with his ability score calculator that he wanted to create more C# programs he can use for his games, and you’re going to help him. In the game he’s currently running, any time there’s a sword attack he rolls dice and uses a formula that calculates the damage. Owen wrote down how the <strong>sword damage formula</strong> works in his game master notebook.</p>&#13;
<p>Here’s <strong>a class called SwordDamage</strong> that does the calculation. Read through the code carefully—you’re about to create an app that uses it.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/228fig001.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Create a console app to calculate damage" data-type="sect1"><div class="sect1" id="create_a_console_app_to_calculate_damage">&#13;
<h1>Create a console app to calculate damage</h1>&#13;
<p><a data-primary="class diagrams" data-type="indexterm" id="idm46402345258696"/><a data-primary="damage calculator app" data-type="indexterm" id="idm46402345256216"/><a data-primary="exercises" data-secondary="class diagrams" data-type="indexterm" id="idm46402345255416"/>Let’s build a console app for Owen that uses the SwordDamage class. It will print a prompt to the console asking the user to specify whether the sword is magic and/or flaming, then it will do the calculation. Here’s an example of the output of the app:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/229fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/229fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0016">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>&#13;
<p><strong>Draw a class</strong> <strong>diagram</strong> for the SwordDamage class. <strong>Then create a new console app</strong> and add the SwordDamage class. While you’re carefully entering the code, take a really close look at how the SetMagic and SetFlaming methods work, and how they work a little differently from each other. Once you’re confident you understand it, you can build out the Main method. Here’s what it will do:</p>&#13;
<ol>&#13;
<li><p>Create a new instance of the SwordDamage class, and also a new instance of Random.</p></li>&#13;
<li><p>Write the prompt to the console and read the key. Call Console.ReadKey(false) so the key that the user typed is printed to the console. If the key isn’t 0, 1, 2, or 3, <code><strong>return</strong></code> to end the program.</p></li>&#13;
<li><p>Roll 3d6 by calling random.Next(1, 7) three times and adding the results together, and set the Roll field.</p></li>&#13;
<li><p>If the user pressed 1 or 3 call SetMagic(true): otherwise call SetMagic(false). You don’t need an <code>if</code> statement to do this: <code>key == ’1’</code> returns true, so you can use <code>||</code> to check the key directly inside the argument.</p></li>&#13;
<li><p>If the user pressed 2 or 3, call SetFlaming(true); otherwise call SetFlaming(false). Again, you can do this in a single statement using == and <code>||</code>.</p></li>&#13;
<li><p>Write the results to the console. Look carefully at the output and use <code>\n</code> to insert line breaks where needed.</p></li>&#13;
</ol>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0004">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<p><a data-primary="Checked events" data-type="indexterm" id="idm46402345235240"/><a data-primary="Unchecked events" data-type="indexterm" id="idm46402345234344"/><a data-primary="WPF (Windows Presentation Foundation)" data-type="indexterm" id="idm46402345233464"/>This console app rolls for damage by creating a new instance of the SwordDamage class that we gave you (and an instance of Random to generate the 3d6 rolls) and generates output that matches the example.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/230fig001.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<pre data-type="programlisting">public static void Main(string[] args)&#13;
{&#13;
    Random random = new Random();&#13;
    SwordDamage swordDamage = new SwordDamage();&#13;
    while (true)&#13;
    {&#13;
        Console.Write("0 for no magic/flaming, 1 for magic, 2 for flaming, " +&#13;
                       "3 for both, anything else to quit: ");&#13;
        char key = Console.ReadKey().KeyChar;&#13;
        if (key != ’0’ &amp;&amp; key != ’1’ &amp;&amp; key != ’2’ &amp;&amp; key != ’3’) return;&#13;
        int roll = random.Next(1, 7) + random.Next(1, 7) + random.Next(1, 7);&#13;
        swordDamage.Roll = roll;&#13;
        swordDamage.SetMagic(key == ’1’ || key == ’3’);&#13;
        swordDamage.SetFlaming(key == ’2’ || key == ’3’);&#13;
        Console.WriteLine("\nRolled " + roll + " for " + swordDamage.Damage + " HP\n");&#13;
    }&#13;
}</pre>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/230fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>Yes! We can build a WPF app that uses the same class.</strong></p>&#13;
<p>Let’s find a way to <strong>reuse</strong> the SwordDamage class in a WPF app. The first challenge for us is how to provide an <em>intuitive</em> user interface. A sword can be magic, flaming, both, or none, so we need to figure out how we want to handle that in a GUI—and there are a lot of options. We could have a radio button or dropdown list with four options, just like the console app gave four options. However, we think it would be cleaner and more visually obvious to use <strong>checkboxes</strong>.</p>&#13;
<p>In WPF, CheckBox uses the Content property to display the label to the right of the box, just like a Button uses the Content property for the text that it displays. We have SetMagic and SetFlaming methods, so we can use the CheckBox control’s <strong>Checked</strong> <strong>and Unchecked events</strong>, which let you specify methods that get called when the user checks or unchecks the box.</p>&#13;
<p><strong>Go to the <span style="color:#9D9EA0;">Visual Studio for Mac Learner’s Guide</span> for the Mac version of this project.</strong></p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Design the XAML for a WPF version of the damage calculator" data-type="sect1"><div class="sect1" id="design_the_xaml_for_a_wpf_version_of_the">&#13;
<h1>Design the XAML for a WPF version of the damage calculator</h1>&#13;
<p><strong>Create a new WPF app</strong>, and set the main window’s title to <code><strong>Sword Damage</strong></code>, height to <code><strong>175</strong></code>, and width to <code><strong>300</strong></code>. Add three rows and two columns to the grid. The top row should have two CheckBox controls labeled Flaming and Magic, the middle row a Button control labeled “Roll for damage” that spans both columns, and the bottom row a TextBlock control that spans both columns.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong><em>Do this!</em></strong></p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/231fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/231fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Here’s the XAML—you can definitely use the designer to build your form, but you should also feel comfortable editing the XAML by hand:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/231fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>Name the CheckBox controls <code>magic</code> and <code>flaming</code>, and the TextBlock control <code>damage</code>. Make sure the names appear in the XAML correctly in the <code>x:Name</code> properties.</strong></p>&#13;
</div>&#13;
</div></section>&#13;
<section data-pdf-bookmark="The code-behind for the WPF damage calculator" data-type="sect1"><div class="sect1" id="the_code_behind_for_the_wpf_damage_calcu">&#13;
<h1>The code-behind for the WPF damage calculator</h1>&#13;
<p><a data-primary="code-behind" data-type="indexterm" id="idm46402345205016"/><strong>Add this code-behind</strong> to your WPF app. It creates instances of SwordDamage and Random, and makes the checkboxes and button calculate damage:</p>&#13;
<p><strong><em>Do this!</em></strong></p>&#13;
<pre data-type="programlisting">public partial class MainWindow : Window&#13;
{&#13;
    Random random = new Random();&#13;
    SwordDamage swordDamage = new SwordDamage();&#13;
    public MainWindow()&#13;
    {&#13;
        InitializeComponent();&#13;
        swordDamage.SetMagic(false);&#13;
        swordDamage.SetFlaming(false);&#13;
        RollDice();&#13;
    }&#13;
    public void RollDice()&#13;
    {&#13;
        swordDamage.Roll = random.Next(1, 7) + random.Next(1, 7) + random.Next(1, 7);&#13;
        DisplayDamage();&#13;
    }&#13;
    void DisplayDamage()&#13;
    {&#13;
        damage.Text = "Rolled " + swordDamage.Roll + " for " + swordDamage.Damage + " HP";&#13;
    }&#13;
    private void Button_Click(object sender, RoutedEventArgs e)&#13;
    {&#13;
        RollDice();&#13;
    }&#13;
    private void Flaming_Checked(object sender, RoutedEventArgs e)&#13;
    {&#13;
        swordDamage.SetFlaming(true);&#13;
        DisplayDamage();&#13;
    }&#13;
    private void Flaming_Unchecked(object sender, RoutedEventArgs e)&#13;
    {&#13;
        swordDamage.SetFlaming(false);&#13;
        DisplayDamage();&#13;
    }&#13;
    private void Magic_Checked(object sender, RoutedEventArgs e)&#13;
    {&#13;
        swordDamage.SetMagic(true);&#13;
        DisplayDamage();&#13;
    }&#13;
    private void Magic_Unchecked(object sender, RoutedEventArgs e)&#13;
    {&#13;
        swordDamage.SetMagic(false);&#13;
        DisplayDamage();&#13;
    }&#13;
}</pre>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="ready_bake_cod">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/ready.png"/></span> Ready Bake Cod</h5>&#13;
<p>You’ve already seen that there are <em>many different ways</em> to write the code for a specific program. For most projects in this book it’s great if you can find a different—but equally effective—way to solve the problem. But for Owen’s damage calculator, we’d like you to <u>enter the code exactly as it appears here</u> because (spoiler alert) <strong>we’ve included a few bugs on purpose</strong>.</p>&#13;
</div></aside>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>Read through this code very carefully.Can you spot any bugs before you run it?</strong></p>&#13;
</div>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Tabletop talk (or maybe…dice discussion?)" data-type="sect1"><div class="sect1" id="tabletop_talk_left_parenthesisor_maybehe">&#13;
<h1>Tabletop talk (or maybe…dice discussion?)</h1>&#13;
<p>It’s game night! Owen’s entire gaming party is over, and he’s about to unveil his brand-new sword damage calculator. Let’s see how that goes.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/233fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>Jayden:</strong> Owen, what are you talking about?</p>&#13;
<p><strong>Owen:</strong> I’m talking about this new app that will calculate sword damage…<em><strong>automatically</strong></em>.</p>&#13;
<p><strong>Matthew:</strong> Because rolling dice is so very, very hard.</p>&#13;
<p><strong>Jayden:</strong> Come on, people, no need for sarcasm. Let’s give it a chance.</p>&#13;
<p><strong>Owen:</strong> Thank you,  Jayden. This is a perfect time, too, because Brittany just attacked the rampaging were-cow with her flaming magic sword. Go ahead, B. Give it a shot.</p>&#13;
<p><strong>Brittany:</strong> OK. We just started the app. I checked the Magic box. Looks like it’s got an old roll in there, let me click roll to do it again, and…</p>&#13;
<p><strong>Jayden:</strong> Wait, that’s not right. Now you rolled 14, but it still says 3 HP. Click it again. Rolled 11 for 3 HP. Click it some more. 9, 10, 5, all give 3 HP. Owen, what’s the deal?</p>&#13;
<p><strong>Brittany:</strong> Hey, it sort of works. If you click roll, then check the boxes a few times, eventually it gives the right answer. Looks like I rolled 10 for 22 HP.</p>&#13;
<p><strong>Jayden:</strong> You’re right. We just have to click things in a <strong>really specific order</strong>. <em>First</em> we click roll, <em>then</em> we check the right boxes, and <em>just to be sure</em> we check the Flaming box twice.</p>&#13;
<p><strong>Owen:</strong> You’re right. If we do things in <strong>exactly that order</strong>, the program works. But if we do it in any other order, it breaks. OK, we can work with this.</p>&#13;
<p><strong>Matthew:</strong> Or…maybe we can just do things the normal way, with real dice?</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/233fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Let’s try to fix that bug" data-type="sect1"><div class="sect1" id="letapostrophes_try_to_fix_that_bug">&#13;
<h1>Let’s try to fix that bug</h1>&#13;
<p><a data-primary="constructors" data-secondary="about" data-type="indexterm" id="idm46402345175128"/>When you run the program, what’s the first thing that it does? Let’s take a closer look at this method at the very top of the MainWindow class with the code-behind for the window:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/234fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/234fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>When a class has a constructor, it’s the very first thing that gets run when a new instance of that class is created. When your app starts up and creates an instance of MainWindow, first it initializes the fields—including creating a new SwordDamage object—and then it calls the constructor. So the program calls RollDice just before showing you the window, and we see the problem every time we click roll, so <u>maybe</u> we can fix this by hacking a solution into the RollDice method. <strong>Make these changes to the RollDice method</strong>:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/234fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Now <strong>test your code</strong>. Run your program and click the button a few times. So far so good—the numbers look correct. Now <strong>check the Magic box</strong> and click the button a few more times. OK, it looks like our fix worked! There’s just one more thing to test. <strong>Check the Flaming box</strong> and click the button and…<em><strong>oops!</strong></em> It’s still not working. When you click the button, it does the 1.75 magic multiplier, but it doesn’t add the extra 3 HP for flaming. You still need to check and uncheck the Flaming checkbox to get the right number. <u>So the program’s still broken.</u></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/234fig04.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>Always think about what caused a bug before you try to fix it.</strong></p>&#13;
<p>When something goes wrong in your code, it’s <strong><em><u>really tempting</u></em></strong> <em><strong>to jump right in</strong></em> and immediately start writing more code to try to fix it. It may feel like you’re taking action quickly, but it’s way too easy to just add more buggy code. It’s always safer to take the time to figure out what really caused the bug, rather than just try to stick in a quick fix.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use Debug.WriteLine to print diagnostic information" data-type="sect1"><div class="sect1" id="use_debugdotwriteline_to_print_diagnosti">&#13;
<h1>Use Debug.WriteLine to print diagnostic information</h1>&#13;
<p><a data-primary="Debug.WriteLine" data-type="indexterm" id="idm46402345156920"/><a data-primary="diagnostic information, printing" data-type="indexterm" id="idm46402345155704"/><a data-primary="null" data-type="indexterm" id="idm46402345154968"/><a data-primary="Output window" data-type="indexterm" id="idm46402345154200"/><a data-primary="String interpolation" data-type="indexterm" id="idm46402345153288"/>In the last few chapters you used the debugger to track down bugs, but that’s not the only way developers find problems in their code. In fact, when professional developers are trying to track down bugs in their code, one of the most common things they’ll do first is to <strong>add statements that print lines of output</strong>, and that’s exactly what we’ll do to track down this bug.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="string_interpolation">&#13;
<h5>String interpolation</h5>&#13;
<p>You’ve been using the + operator to concatenate your strings. It’s a pretty powerful tool—you can use any value (as long as it’s not <code>null</code>) and it will safely convert it to a string (usually by calling its ToString method). The problem is that concatenation can make your code really hard to read.</p>&#13;
<p>Luckily, C# gives us a great tool to concatenate strings more easily. It’s called string interpolation, and to use it all you need to do is put a dollar sign in front of your string. Then to include a variable, a field, or a complex expression—or even call a method!—you put it inside curly brackets. If you want to include curly brackets in your string, just include two of them, like this: <code>{{ }}</code></p>&#13;
</div></aside>&#13;
<p><strong>Open the Output window</strong> in Visual Studio by choosing Output (Ctrl+O W) from the View menu. Any text that you print by calling Console.WriteLine from a WPF app is displayed in this window. You should only use Console.WriteLine for <em>displaying output your users should see</em>. Instead, any time you want to print output lines just for debugging purposes you should use <strong>Debug.WriteLine</strong>. The Debug class is in the System.Diagnostics namespace, so start by adding a <code>using</code> line to the top of your SwordDamage class file:</p>&#13;
<pre data-type="programlisting">    using System.Diagnostics;</pre>&#13;
<p>Next, <strong>add a Debug.WriteLine statement</strong> to the end of the CalculateDamage method:</p>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">    public void CalculateDamage()</span>&#13;
<span style="color:#9D9EA0;">    {</span>&#13;
<span style="color:#9D9EA0;">        Damage = (int)(Roll * MagicMultiplier) + BASE_DAMAGE + FlamingDamage;</span>&#13;
        <strong>Debug.WriteLine($"CalculateDamage finished: {Damage} (roll: {Roll})");</strong>&#13;
<span style="color:#9D9EA0;">    }</span></pre>&#13;
<p>Now add another Debug.WriteLine statement to the end of the SetMagic method, and one more to the end of the SetFlaming method. They should be identical to the one in CalculateDamage, except that they print “SetMagic” or “SetFlaming” instead of “CalculateDamage” to the output:</p>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">    public void SetMagic(bool isMagic)</span>&#13;
<span style="color:#9D9EA0;">    {</span>&#13;
<span style="color:#9D9EA0;">        // the rest of the SetMagic method stays the same</span>&#13;
        <strong>Debug.WriteLine($"SetMagic finished: {Damage} (roll: {Roll})");</strong>&#13;
    }&#13;
<span style="color:#9D9EA0;">    public void SetFlaming(bool isFlaming)</span>&#13;
<span style="color:#9D9EA0;">    {</span>&#13;
<span style="color:#9D9EA0;">        // the rest of the SetFlaming method stays the same</span>&#13;
        <strong>Debug.WriteLine($"SetFlaming finished: {Damage} (roll: {Roll})");</strong>&#13;
<span style="color:#9D9EA0;">    }</span></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>Now your program will print useful diagnostic information to the Output window.</strong></p>&#13;
</div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">You can sleuth out this bug without setting any breakpoints. That’s something developers do all the time... so you should learn how to do it, too!</span></p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sleuth_it_out-idd0002">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/cap.png"/></span> Sleuth it out</h5>&#13;
<p><a data-primary="Debug.WriteLine" data-type="indexterm" id="idm46402345123592"/><a data-primary="Output window" data-type="indexterm" id="idm46402345122536"/>Let’s use the <strong>Output window</strong> to debug the app. Run your program and watch the Output window. As it loads, you’ll see a bunch of lines with messages informing you that the CLR loaded various DLLs (that’s normal, just ignore them for now).</p>&#13;
<p>Once you see the main window, press the Clear All (<span class="inlineimage"><img alt="Images" src="assets/236fig01i.png"/></span>) button to clear the Output window. Then check the Flaming box. When we took this screenshot our roll was 9, so this is what it printed:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/236fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>14 is the correct answer—9 plus base damage of 3 plus 2 for a flaming sword. So far so good.</p>&#13;
<p>And you can see from the Output window what happened: the SetFlaming method first called CalculateDamage, which calculated 12. It then added FLAME_DAMAGE for 14, and finally executed the Debug.WriteLine statement that you added.</p>&#13;
<p>Now press the button to roll again. The program should write three more lines to the Output window:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/236fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>We rolled a 12, so it <u>should</u> calculate 17 HP. So what does the debug output tell us about what happened?</p>&#13;
<p>First it called SetFlaming, which set Damage to 17—that’s correct: 12 + 3 (base) + 2 (flaming).</p>&#13;
<p>But then the program called the CalculateDamage method, which <strong>overwrote the Damage field</strong> and set it back to 15.</p>&#13;
<p>The problem is that <strong>SetFlaming was called before CalculateDamage</strong>, so even though it added the flame damage correctly, calling CalculateDamage afterward undid that. So the real reason that the program doesn’t work is that the fields and methods in the SwordDamage class <strong><em><u>need to be used in a very specific order</u></em></strong>:</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Aha! Now we actually know why the program is broken.</p>&#13;
</div>&#13;
<ol>&#13;
<li><p>Set the Roll field to the 3d6 roll.</p></li>&#13;
<li><p>Call the SetMagic method.</p></li>&#13;
<li><p>Call the SetFlaming method.</p></li>&#13;
<li><p>Do not call the CalculateDamage method, because SetFlaming does that for you.</p></li>&#13;
</ol>&#13;
<p><strong>And that’s why the console app worked, but the WPF didn’t.</strong> The console app used the SwordDamage class in the specific way that it works. The WPF app called the methods in the wrong order, so it got incorrect results.</p>&#13;
</div></aside>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>Debug.WriteLine</strong> <strong>is one of the most basic—and useful!—debugging tools in your developer toolbox. Sometimes the quickest way to sleuth out a bug in your code is to strategically add Debug.WriteLine statements to give you important clues that help you crack the case.</strong></p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/237fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="CLR (Common Language Runtime)" data-type="indexterm" id="idm46402345103912"/><a data-primary="Console.WriteLine" data-type="indexterm" id="idm46402345102920"/><a data-primary="constructors" data-secondary="about" data-type="indexterm" id="idm46402345102184"/><a data-primary="Debug.WriteLine" data-type="indexterm" id="idm46402345099880"/><a data-primary="encapsulation" data-secondary="about" data-type="indexterm" id="idm46402345099144"/><strong>People won’t always use your classes in exactly the way you expect.</strong></p>&#13;
<p>And most of the time those “people” who are using your classes are you! You might be writing a class today that you’ll be using tomorrow, or next month. Luckily, C# gives you a powerful technique to make sure your program always works correctly—even when people do things you never thought of. It’s called <strong>encapsulation</strong> and it’s really helpful for working with objects. The goal of encapsulation is to restrict access to the “guts” of your classes so that all of the class members are <strong><em><u>safe</u></em></strong> <em><strong>to use and difficult to misuse</strong></em>. This lets you design classes that are much more difficult to use incorrectly—and that’s a <em><strong>great way to prevent bugs</strong></em> like the one you sleuthed out in your sword damage calculator.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="relax">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/relax.png"/></span></h5>&#13;
<p><strong>We’ll do a lot more work with constructors later in the chapter.</strong></p>&#13;
<p>For now, just think of a constructor as a special method that you can use to initialize an object.</p>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0012">&#13;
<h5>there are no Dumb Questions</h5>&#13;
<p><strong>Q: What’s the difference between Console.WriteLine and Debug.WriteLine?</strong></p>&#13;
<p><strong>A:</strong> The Console class is used by console apps to get input from and send output to the user. It uses the three <strong>standard streams</strong> provided by your operating system: standard input (stdin), standard output (stdout), and standard error (stderr). Standard input is the text that goes into the program, and standard output is what it prints. (If you’ve ever piped input or output in a shell or command prompt using &lt;, &gt;, |, &lt;&lt;, &gt;&gt;, or || you’ve used stdin and stdout.) The Debug class is in the System.Diagnostics namespace, which gives you a hint about its use: it’s for helping diagnose problems by tracking down and fixing them. Debug.WriteLine sends its output to <strong>trace listeners</strong>, or special classes that monitor diagnostic output from your program and write them to the console, log files, or a diagnostic tool that collects data from your program for analysis.</p>&#13;
<p><strong>Q: Can I use constructors in my own code?</strong></p>&#13;
<p><strong>A:</strong> Absolutely. A constructor is a method that the CLR calls when it first creates a new instance of an object. It’s just an ordinary method—there’s nothing weird or special about it. You can add a constructor to any class by declaring a method <strong>without a return type</strong> (so no void, int, or other type at the beginning) that has the <strong>same name as the class</strong>. Any time the CLR sees a method like that in a class, it recognizes it as a constructor and calls it any time it creates a new object and puts it on the heap.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="It’s easy to accidentally misuse your objects" data-type="sect1"><div class="sect1" id="itapostrophes_easy_to_accidentally_misus">&#13;
<h1>It’s easy to accidentally misuse your objects</h1>&#13;
<p><a data-primary="objects" data-secondary="accidentally misusing" data-type="indexterm" id="idm46402345081464"/><a data-primary="objects" data-secondary="misusing" data-type="indexterm" id="idm46402345080456"/>Owen’s app ran into problems because we assumed that the CalculateDamage method would, well, calculate the damage. It turned out that <strong>it wasn’t safe to call that method directly</strong> because it replaced the Damage value and erased any calculations that were already done. Instead, we needed to let the SetFlaming method call CalculateDamage for us—but <strong>even that wasn’t enough</strong>, because we <em>also</em> had to make sure that SetMagic was always called first. So even though the SwordDamage class <em>technically</em> works, it causes problems when code calls it in an unexpected way.</p>&#13;
<p><strong>How the SwordDamage class <strong><em>expected to be used</em></strong></strong></p>&#13;
<p>The SwordDamage class gave the app a good method to calculate the total damage for a sword. All it had to do was set the roll, then call the SetMagic method, and finally call the SetFlaming method. If things are done in that order, the Damage field is updated with the calculated damage. But that’s not what the app did.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/238fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>How the SwordDamage class <strong><em>was actually used</em></strong></strong></p>&#13;
<p>Instead, it set the Roll field, then it called SetFlaming, which added the extra damage for the flaming sword to the Damage field. Then it called SetMagic, and finally it called CalculateDamage, which reset the Damage field and discarded the extra flaming damage.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/238fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Encapsulation means keeping some of the data in a class private" data-type="sect1"><div class="sect1" id="encapsulation_means_keeping_some_of_the">&#13;
<h1><u>Encapsulation</u> means keeping some of the data in a class private</h1>&#13;
<p><a data-primary="encapsulation" data-secondary="defined" data-type="indexterm" id="idm46402345071672"/><a data-primary="fields" data-secondary="private" data-type="indexterm" id="idm46402345066008"/><a data-primary="objects" data-secondary="accessing fields inside object" data-type="indexterm" id="idm46402345065032"/><a data-primary="private fields" data-type="indexterm" id="idm46402345064056"/>There’s a way to avoid the problem of misusing your objects: make sure that there’s only one way to use your class. C# helps you do that by letting you declare some of your fields as <code><strong>private</strong></code>. So far, you’ve only seen public fields. If you’ve got an object with a public field, any other object can read or change that field. If you make it a private field, then <strong>that field can only be accessed from inside that</strong> <strong>object</strong> (or by another instance <em>of the same class</em>).</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="relax-idd0001">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/relax.png"/></span></h5>&#13;
<p><strong>When in doubt, make it private.</strong></p>&#13;
<p>Worried about trying to figure out which fields and methods to make private? Start by making every member private, and change them to public only if you need to. <strong>In this case, laziness can work to your advantage</strong>. If you leave off the “private” or “public” declaration, then C# will just assume that your field or method is private.</p>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/239fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>By making the CalculateDamage method <strong><em>private</em></strong>, we prevent the app from accidentally calling it and resetting the Damage field. Changing the fields involved in the calculation to make them private keeps an app from interfering with the calculation. When you make some data private and then write code to use that data, it’s called <span style="color:#9D9EA0;"><em>encapsulation</em></span>. When a class protects its data and provides members that are safe to use and difficult to misuse, we say that it’s <span style="color:#9D9EA0;"><em>well-encapsulated</em></span>.</strong></p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="en_cap_su_la_tedcomma_adjdot">&#13;
<h5>en-cap-su-la-ted, adj.</h5>&#13;
<p>enclosed by a protective coating or membrane. <em>The divers were fully <strong>encapsulated</strong> by their submersible, and could only enter and exit through the airlock.</em></p>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use encapsulation to control access to your class’s methods and fields" data-type="sect1"><div class="sect1" id="use_encapsulation_to_control_access_to_y">&#13;
<h1>Use encapsulation to control access to your class’s methods and fields</h1>&#13;
<p><a data-primary="classes" data-secondary="encapsulation" data-type="indexterm" id="idm46402345046808"/><a data-primary="encapsulation" data-secondary="using to control access to class methods. fields, or properties" data-type="indexterm" id="idm46402345045352"/><a data-primary="Spy project" data-type="indexterm" id="idm46402345044184"/>When you make all of your fields and methods public, any other class can <em>access</em> them. Everything your class does and knows about becomes an open book for every other class in your program…and you just saw how that can cause your program to behave in ways you never expected.</p>&#13;
<p>That’s why the <code>public</code> and <code>private</code> keywords are called <strong>access modifiers</strong>: they modify access to class members. Encapsulation lets you control what you share and what you keep private inside your class. Let’s see how this works.</p>&#13;
<ol>&#13;
<li><p>Super-spy Herb Jones is a <em><strong>secret agent object in a 1960s spy game</strong></em> defending life, liberty, and the pursuit of happiness as an undercover agent in the USSR. His object is an instance of the SecretAgent class.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/240fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/240fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p>Agent Jones has a plan to help him evade the enemy agent object. He added an AgentGreeting method that takes a password as its parameter. If he doesn’t get the right password, he’ll only reveal his alias, Dash Martin.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/240fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p>Seems like a foolproof way to protect the agent’s identity, right? As long as the agent object that calls it doesn’t have the right password, the agent’s name is safe.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/240fig04.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
</ol>&#13;
</div></section>&#13;
<section data-pdf-bookmark="But is the RealName field REALLY protected?" data-type="sect1"><div class="sect1" id="but_is_the_realname_field_really_protect">&#13;
<h1>But is the RealName field <u>REALLY</u> protected?</h1>&#13;
<p>So as long as the enemy doesn’t know any SecretAgent object passwords, the agents’ real names are safe. Right? But that doesn’t do any good if that data’s kept in public fields.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/241fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-idd0012">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/brainpower.png"/></span> Brain Power</h5>&#13;
<p>Making the methods and fields in the damage calculator app private prevents bugs by keeping the app from using them directly. <strong>But there’s still a problem!</strong> We’ll still get the wrong answer if SetMagic is <em>called before</em> SetFlaming. Can the <code>private</code> keyword help you prevent that?</p>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Private fields and methods can only be accessed from instances of the same class" data-type="sect1"><div class="sect1" id="private_fields_and_methods_can_only_be_a">&#13;
<h1>Private fields and methods can only be accessed from instances of the same class</h1>&#13;
<p><a data-primary="fields" data-secondary="with no access" data-type="indexterm" id="idm46402345018552"/><a data-primary="methods" data-secondary="accessing private fields with public methods" data-type="indexterm" id="idm46402345017160"/><a data-primary="public methods" data-type="indexterm" id="idm46402345016056"/>There’s only one way that an object can get at the data stored inside another object’s private fields: by using the public fields and methods that return the data. EnemyAgent and AlliedAgent agents need to use the AgentGreeting method, but friendly spies that are also SecretAgent instances can see everything…because <strong>any class can</strong> <strong>see private fields in other instances of the</strong> <em><strong>same class</strong></em>.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/242fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/242fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0013">&#13;
<h5>there are no Dumb Questions</h5>&#13;
<p><strong>Q: Why would I ever want a field in an object that another object can’t read or write?</strong></p>&#13;
<p><strong>A:</strong> Sometimes a class needs to keep track of information that is necessary for it to operate, but that no other object really needs to see—and you already saw an example of this. In the last chapter you saw that the Random class used special <em>seed values</em> to initialize the pseudo-random number generator. Under the hood it turns out that every instance of the Random class actually contains an array of several dozen numbers that it uses to make sure that the Next method always gives you a random number. But that array is private—when you create an instance of Random you can’t access that array. If you had access to it, you might be able to put values in it that would cause it to give nonrandom values. So the seeds have been completely encapsulated from you.</p>&#13;
<p><strong>Q: OK, so I need to access private data through public methods. What happens if the class with the private field doesn’t give me a way to get at that data, but my object needs to use it?</strong></p>&#13;
<p><strong>A:</strong> Then you can’t access the data from outside the object. When you’re writing a class, you should always make sure that you give other objects some way to get at the data they need. Private fields are a very important part of encapsulation, but they’re only part of the story. Writing a class with good encapsulation means giving a sensible, easy-to-use way for other objects to get the data they need, without giving them access to hijack data your class depends on.</p>&#13;
<p><strong>Q: Hey, I just noticed that when I use “Generate method” in the IDE it uses the <code><strong>private</strong></code> keyword. Why does it do that?</strong></p>&#13;
<p><strong>A:</strong> Because it’s the safest thing for the IDE to do. Not only are the methods created with “Generate method” private, but when you double-click on a control to add an event handler the IDE creates a private method for that, too. The reason is that it’s <strong>safest to make a field or method private</strong> to prevent the kinds of bugs that we saw in the damage calculator. You can always make your class members public later if you need another class to access the data.</p>&#13;
</div></aside>&#13;
<blockquote>&#13;
<p><strong>The only way that one object can get to data stored in a private field inside another object of a <u>different</u> class is by using public methods that return the data.</strong></p>&#13;
</blockquote>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0017">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>&#13;
<p><a data-primary="exercises" data-secondary="private keyword" data-type="indexterm" id="idm46402345000344"/>Let’s get a little practice using the <code><strong>private</strong></code> keyword by <strong>creating a small Hi-Lo game</strong>. The game starts with a pot of 10 bucks, and it picks a random number from 1 to 10. The player will guess if the next number will be higher or lower. If the player guesses right they win a buck, otherwise they lose a buck. Then the next number becomes the current number, and the game continues.</p>&#13;
<p>Go ahead and <strong>create a new console app</strong> for the game. Here’s the Main method:</p>&#13;
<pre data-type="programlisting">    public static void Main(string[] args)&#13;
    {&#13;
        Console.WriteLine("Welcome to HiLo.");&#13;
        Console.WriteLine($"Guess numbers between 1 and {HiLoGame.MAXIMUM}.");&#13;
        HiLoGame.Hint();&#13;
        while (HiLoGame.GetPot() &gt; 0)&#13;
        {&#13;
            Console.WriteLine("Press h for higher, l for lower, ? to buy a hint,");&#13;
            Console.WriteLine($"or any other key to quit with {HiLoGame.GetPot()}.");&#13;
            char key = Console.ReadKey(true).KeyChar;&#13;
            if (key == ’h’) HiLoGame.Guess(true);&#13;
            else if (key == ’l’) HiLoGame.Guess(false);&#13;
            else if (key == ’?’) HiLoGame.Hint();&#13;
            else return;&#13;
        }&#13;
        Console.WriteLine("The pot is empty. Bye!");&#13;
&#13;
    }</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Don’t forget—it’s <u>not</u> cheating to peek at the solution!</p>&#13;
</div>&#13;
<p>Next, add a <strong>static class</strong> called HiLoGame and <strong>add the following members</strong>. Since this is a static class, all of the members need to be static. Make sure to include either <code><strong>public</strong></code> or <code><strong>private</strong></code> in the declaration for each member:</p>&#13;
<ol>&#13;
<li><p>A constant integer <strong>MAXIMUM</strong> that defaults to 10. Remember, you can’t use the <code>static</code> keyword with constants.</p></li>&#13;
<li><p>An instance of Random called <strong>random</strong>.</p></li>&#13;
<li><p>An integer field called <strong>currentNumber</strong> that’s initialized to the first random number to guess.</p></li>&#13;
<li><p>An integer field called <strong>pot</strong> with the number of bucks in the pot. <strong>Make this field</strong> <code><strong>private</strong></code><strong>.</strong></p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">We made pot private because we don’t want other classes to be able to add money, but the Main method still needs to be able to print the size of the pot to the console. Look carefully at the code in the Main method—can you figure out how to let the Main method get the value of the pot field without giving it a way to set the field?</span></p>&#13;
</div></li>&#13;
<li><p>A <strong>method</strong> called<strong/> <code><strong>Guess</strong></code> with a bool parameter called <strong>higher</strong> that does the following (look closely at the Main method to see how it’s called):</p>&#13;
<ul>&#13;
<li><p>It picks the next random number for the player to guess.</p></li>&#13;
<li><p>If the player guessed higher and the next number is &gt;= the current number <strong>OR</strong> if the player guessed lower and the next number is &lt;= the current number, <strong>write</strong> “You guessed right!” to the console and increment the pot.</p></li>&#13;
<li><p>Otherwise, <strong>write</strong> “Bad luck, you guessed wrong.” to the console and decrement the pot.</p></li>&#13;
<li><p><strong>Replace</strong> the current number with the one chosen at the beginning of the method and <strong>writes</strong> “The current number is” followed by the number to the console.</p></li>&#13;
</ul></li>&#13;
<li><p>A method called <strong>Hint</strong> that finds half the maximum, then writes either “The number is at least {half}” or “The number is at most {half}” to the console and decrements the pot.</p></li>&#13;
</ol>&#13;
<p><strong>BONUS QUESTION:</strong> If you make HiLoGame.random a public field, can you figure out a way to use what you know about how the Random class generates its numbers <strong><em>to help you cheat at the game</em></strong>?</p>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0005">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<p>Here’s the rest of the code for the Hi-Lo game. The game starts with a pot of 10 bucks, and it picks a random number from 1 to 10. The player will guess if the next number will be higher or lower. If the player guesses right they win a buck, otherwise they lose a buck. Then the next number becomes the current number, and the game continues.</p>&#13;
<p>Here’s the code for the HiLoGame class:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/244fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/245fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="private keyword" data-type="indexterm" id="idm46402344960712"/><strong>Because sometimes you want your class to hide information from the rest of the program.</strong></p>&#13;
<p>A lot of people find encapsulation a little odd the first time they come across it because the idea of hiding one class’s fields, properties, or methods from another class is a little counterintuitive. There are some very good reasons that you’ll want to think about what information should be exposed to the rest of the program.</p>&#13;
<blockquote>&#13;
<p>Encapsulation means having one class hide information from another. It helps you prevent bugs in your programs.</p>&#13;
</blockquote>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="watch_itexclamation_mark-idd0003">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/watchit.png"/></span> Watch it!</h5>&#13;
<p><strong>Encapsulation is not the same as security. Private fields are <u>not</u> secure.</strong></p>&#13;
<p><a data-primary="encapsulation" data-secondary="compared with security" data-type="indexterm" id="idm46402344955304"/><a data-primary="GetType method" data-type="indexterm" id="idm46402344952184"/><a data-primary="private keyword" data-type="indexterm" id="idm46402344951368"/><a data-primary="security, compared with encapsulation" data-type="indexterm" id="idm46402344950568"/><em>If you’re building <strong><em>a game with 1960s spies</em></strong>, encapsulation is a great way to prevent bugs. If you’re building <strong><em>a program for real spies</em></strong>, encapsulation is a <u>terrible way to</u> <u>protect their data</u>. For example, go back to your Hi-Lo game. Place a breakpoint on the first line of the Main method, add a watch for <strong>HiLoGame.random</strong>, and debug the program. If you <strong><em>expand the Non-Public Members section</em></strong> you can see all of the internals of the Random class, including an array called <code><strong><em>_seedArray</em></strong></code> that it uses to generate its pseudo-random numbers.</em></p>&#13;
<p><em>It’s not just the IDE that can see your objects’ <code><strong><em>privates</em></strong></code>. .NET has a tool called <strong><em>reflection</em></strong> that lets you write code to access objects in memory and look at their contents, even private fields. Here’s a quick example of how it works. <strong><em>Create a new console app</em></strong> and add a class called HasASecret:</em></p>&#13;
<pre data-type="programlisting">class HasASecret&#13;
{&#13;
<span style="color:#9D9EA0;">    // This class has a secret field. Does the private keyword make it secure?</span>&#13;
    private string secret = "xyzzy";&#13;
&#13;
}</pre>&#13;
<p><em>The reflection classes are in the <strong><em>System.Reflection namespace</em></strong>, so add this <code><strong><em>using</em></strong></code> statement to the file with the Main method:</em></p>&#13;
<pre data-type="programlisting">using System.Reflection;</pre>&#13;
<p><em>Here’s the main class with a Main method that creates a new instance of HasASecret, and then uses reflection to read its <strong><em>secret</em></strong> field. It calls the GetType method, which is a method that you can call from any object to get information about its type:</em></p>&#13;
<pre data-type="programlisting">class MainClass&#13;
{&#13;
    public static void Main(string[] args)&#13;
    {&#13;
        HasASecret keeper = new HasASecret();&#13;
<span style="color:#9D9EA0;">        // Uncommenting this Console.WriteLine statement causes a compiler error:</span>&#13;
<span style="color:#9D9EA0;">        // ’HasASecret.secret’ is inaccessible due to its protection level</span>&#13;
<span style="color:#9D9EA0;">        // Console.WriteLine(keeper.secret);</span>&#13;
<span style="color:#9D9EA0;">        // But we can still use reflection to get the value of the secret field</span>&#13;
        FieldInfo[] fields = keeper.GetType().GetFields(&#13;
                        BindingFlags.NonPublic | BindingFlags.Instance);&#13;
<span style="color:#9D9EA0;">        // This foreach loop will cause "xyzzy" to be printed to the console</span>&#13;
        foreach (FieldInfo field in fields)&#13;
        {&#13;
            Console.WriteLine(field.GetValue(keeper));&#13;
        }&#13;
    }&#13;
}</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>Every object has a GetType method that returns a Type object. The Type.GetFields method returns an array of FieldInfo objects, one for each of its fields. Each FieldInfo object contains information about its fields. If you call its GetValue method with an instance of an object, it will return the value stored in that object’s field—even if the field is private.</strong></p>&#13;
</div>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Why encapsulation? Think of an object as a black box…" data-type="sect1"><div class="sect1" id="why_encapsulationquestion_mark_think_of">&#13;
<h1>Why encapsulation? Think of an object as a black box…</h1>&#13;
<p><a data-primary="black box" data-type="indexterm" id="idm46402344929160"/><a data-primary="encapsulation" data-secondary="benefits for classes" data-type="indexterm" id="idm46402344928600"/>Sometimes you’ll hear a programmer refer to an object as a “black box,” and that’s a pretty good way of thinking about them. When we say something is a black box, we’re saying that we can see how it behaves, but we have no way of knowing how it actually works.</p>&#13;
<p>When you call an object’s method, you don’t really care how that method works—at least, not right now. All you care about is that it takes the inputs you gave it and does the right thing.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/247fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>You <em>could</em> include a lot more controls, like a window that shows you what’s going on inside the box, and knobs and dials that let you muck with its internals. But if they don’t actually do anything that your system needs, then they don’t do you any good and can only cause problems.</p>&#13;
<section data-pdf-bookmark="Encapsulation makes your classes…" data-type="sect2"><div class="sect2" id="encapsulation_makes_your_classeshellip">&#13;
<h2>Encapsulation makes your classes…</h2>&#13;
<ul>&#13;
<li><p><strong>Easier to use</strong></p>&#13;
<p>You already know that classes use fields to keep track of their state. Many of them use methods to keep those fields up to date—methods that no other class will ever call. It’s pretty common to have a class that has fields, methods, and properties that will never be called by any other class. If you make those members private, then they won’t show up in the IntelliSense window later when you need to use that class. Less clutter in the IDE will make your class easier to use.</p></li>&#13;
<li><p><strong>Less prone to bugs</strong></p>&#13;
<p>That bug in Owen’s program happened because the app accessed a method directly rather than letting the other methods in the class call it. If that method had been private, we could have avoided that bug.</p></li>&#13;
<li><p><strong>Flexible</strong></p>&#13;
<p>A lot of times, you’ll want to go back and add features to a program you wrote a while ago. If your classes are well-encapsulated, then you’ll know exactly how to use them and add on to them later.</p></li>&#13;
</ul>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-idd0013">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/brainpower.png"/></span> Brain Power</h5>&#13;
<p>How could building a poorly encapsulated class now make your programs harder to modify later?</p>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="A few ideas for encapsulating classes" data-type="sect2"><div class="sect2" id="a_few_ideas_for_encapsulating_classes">&#13;
<h2>A few ideas for encapsulating classes</h2>&#13;
<ul>&#13;
<li><p><a data-primary="encapsulation" data-secondary="ideas for" data-type="indexterm" id="idm46402344912216"/><a data-primary="fields" data-secondary="public" data-type="indexterm" id="idm46402344909160"/><a data-primary="methods" data-secondary="public" data-type="indexterm" id="idm46402344908184"/><a data-primary="private keyword" data-type="indexterm" id="idm46402344907208"/><a data-primary="public fields" data-type="indexterm" id="idm46402344906472"/><a data-primary="public methods" data-type="indexterm" id="idm46402344905736"/><strong>Is everything in your class public?</strong>If your class has nothing but public fields and methods, you probably need to spend a little more time thinking about encapsulation.</p></li>&#13;
<li><p><strong>Think about ways fields and methods can be misused.</strong>What can go wrong if they’re not set or called properly?</p></li>&#13;
<li><p><strong>What fields require some processing or calculation to happen when they’re set?</strong>Those are prime candidates for encapsulation. If someone writes a method later that changes the value in any one of them, it could cause problems for the work your program is trying to do.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/248fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p><strong>Only make fields and methods public if you need to.</strong>If you don’t have a reason to declare something public, don’t—you could make things really messy for yourself by making all of the fields in your program public. But don’t just go making everything private, either. Spending a little time up front thinking about which fields really need to be public and which don’t can save you a lot of time later.</p></li>&#13;
</ul>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/249fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="classes" data-secondary="encapsulation" data-type="indexterm" id="idm46402344897272"/><a data-primary="encapsulation" data-secondary="well encapsulated versus poorly encapsulated classes" data-type="indexterm" id="idm46402344896232"/><strong>Exactly! The difference is that the well-encapsulated one is built in a way that prevents bugs and is easier to use.</strong></p>&#13;
<p>It’s easy to take a well-encapsulated class and turn it into a poorly encapsulated class: do a search and replace to change every occurrence of <code>private</code> to <code>public</code>.</p>&#13;
<p>And that’s a funny thing about the <code>private</code> keyword: you can generally take any program and do that search and replace, and it will still compile and work in exactly the same way. That’s one reason that encapsulation can be a little difficult for some programmers to really “get” when they first see it.</p>&#13;
<p><strong><em>When you come back to code that you haven’t looked at in a long time, it’s easy to forget how you intended it to be used. Tha t’s where encapsulation can  make your life a lot easier!</em></strong></p>&#13;
<p>This book so far has been about making programs <strong>do things</strong>—perform certain behaviors. Encapsulation is a little different. It doesn’t change the way your program behaves. It’s more about the “chess game” side of programming: by hiding certain information in your classes when you design and build them, you set up a strategy for how they’ll interact later. The better the strategy, the <strong>more flexible and maintainable</strong> your programs will be, and the more bugs you’ll avoid.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">And just like chess, there are an almost unlimited number of possible encapsulation strategies!</span></p>&#13;
</div>&#13;
<blockquote>&#13;
<p>If you encapsulate your classes well <u>today</u>, that makes them a lot easier to reuse <u>tomorrow</u>.</p>&#13;
</blockquote>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-idd0010">&#13;
<h5>Bullet Points</h5>&#13;
<ul>&#13;
<li><p><a data-primary="CLR (Common Language Runtime)" data-type="indexterm" id="idm46402344883752"/>Always <strong>think about what caused a bug</strong> before you try to fix it. Take the time to really understand what’s going on.</p></li>&#13;
<li><p>Adding statements that print lines of output can be an effective debugging tool. Use <strong>Debug.WriteLine</strong> when you add statements to print diagnostic information.</p></li>&#13;
<li><p>A <strong>constructor</strong> is a method that the CLR calls when it first creates a new instance of an object.</p></li>&#13;
<li><p><strong>String interpolation</strong> makes string concatenation more readable. Use it by adding a $ in front of a string and including values in {curly brackets}.</p></li>&#13;
<li><p>The System.Console class writes its output to <strong>standard streams</strong> that provide the input and output for console apps.</p></li>&#13;
<li><p>The System.Diagnostics.Debug class writes its output to <strong>trace listeners</strong>—special classes that perform specific actions with diagnostic output—including one that writes that output to the IDE’s Output (Windows) or Application Output (macOS) window.</p></li>&#13;
<li><p>People won’t always use your classes in exactly the way you expect. <strong>Encapsulation</strong> is a technique for making your class members flexible and difficult to misuse.</p></li>&#13;
<li><p>Encapsulation usually involves using the <code><strong>private</strong></code> keyword to keep some of the fields or methods in a class private so they can’t be misused by other classes.</p></li>&#13;
<li><p>When a class protects its data and provides members that are safe to use and difficult to misuse, we say that it’s <strong>well-encapsulated</strong>.</p></li>&#13;
</ul>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/250fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Let’s use encapsulation to improve the SwordDamage class" data-type="sect1"><div class="sect1" id="letapostrophes_use_encapsulation_to_impr">&#13;
<h1>Let’s use encapsulation to improve the SwordDamage class</h1>&#13;
<p><a data-primary="encapsulation" data-secondary="improving SwordDamage class using" data-type="indexterm" id="idm46402344868872"/>We just covered some great ideas for encapsulating classes. Let’s see if we can start to apply those ideas to the SwordDamage class to keep it from being confused, misused, and abused by any app that we include it in.</p>&#13;
<section data-pdf-bookmark="Is every member of the SwordDamage class public?" data-type="sect2"><div class="sect2" id="is_every_member_of_the_sworddamage_class">&#13;
<h2>Is every member of the SwordDamage class public?</h2>&#13;
<p>Yes, indeed. The four fields (Roll, MagicMultiplier, FlamingDamage, and Damage) are public, and so are the three methods (CalculateDamage, SetMagic, and SetFlaming). We could stand to think about encapsulation.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Are fields or methods being misused?" data-type="sect2"><div class="sect2" id="are_fields_or_methods_being_misusedquest">&#13;
<h2>Are fields or methods being misused?</h2>&#13;
<p>Absolutely. In the first version of the damage calculator app, we called CalculateDamage when we should have just let the SetFlaming method call it. Even our attempt to fix it failed because we misused the methods by calling them in the wrong order.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Is there calculation required after setting a field?" data-type="sect2"><div class="sect2" id="is_there_calculation_required_after_sett">&#13;
<h2>Is there calculation required after setting a field?</h2>&#13;
<p>Certainly. After setting the Roll field, we really want the instance to calculate damage immediately.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="So what fields and methods really need to be public?" data-type="sect2"><div class="sect2" id="so_what_fields_and_methods_really_need_t">&#13;
<h2>So what fields and methods really need to be public?</h2>&#13;
<p>That’s a great question. Take some time to think about the answer. We’ll tackle it at the end of the chapter.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-idd0014">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/brainpower.png"/></span> Brain Power</h5>&#13;
<p>Think about those questions, then take another look at how the SwordDamage class works. What would you do to fix the SwordDamage class?</p>&#13;
</div></aside>&#13;
<blockquote>&#13;
<p><strong>Making members of a class private can <u>prevent bugs</u> caused by other classes calling its public methods or updating its public fields in <u>unexpected</u> ways.</strong></p>&#13;
</blockquote>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Encapsulation keeps your data safe" data-type="sect1"><div class="sect1" id="encapsulation_keeps_your_data_safe">&#13;
<h1>Encapsulation keeps your data safe</h1>&#13;
<p><a data-primary="encapsulation" data-secondary="data safety and" data-type="indexterm" id="idm46402344852456"/>We’ve seen how the <code>private</code> keyword <strong>protects class members from being accessed directly</strong>, and how that can prevent bugs caused by other classes calling methods or updating fields in ways we didn’t expect—like how your GetPot method in the Hi-Lo game gave read-only access to the private pot field, and only the Guess or Hint methods could modify it. This next class works in exactly the same way.</p>&#13;
<section data-pdf-bookmark="Let’s use encapsulation in a class" data-type="sect2"><div class="sect2" id="letapostrophes_use_encapsulation_in_a_cl">&#13;
<h2>Let’s use encapsulation in a class</h2>&#13;
<p><strong>Let’s build a PaintballGun class</strong> for a paintball arena video game. The player can pick up magazines of paintballs and reload at any time, so we want the class to keep track of the total number of balls the player has <em>and</em> the number of balls currently loaded. We’ll add a method to check if the gun is empty and needs to be reloaded. We also want it to keep track of the magazine size. Any time the player gets more ammo we want the gun to automatically reload a full magazine, so we’ll make sure that always happens by providing a method to set the number of balls that calls the Reload method.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/252fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Write a console app to test the PaintballGun class" data-type="sect1"><div class="sect1" id="write_a_console_app_to_test_the_paintbal">&#13;
<h1>Write a console app to test the PaintballGun class</h1>&#13;
<p><a data-primary="fields" data-secondary="private" data-type="indexterm" id="idm46402344849496"/><a data-primary="fields" data-secondary="public" data-type="indexterm" id="idm46402344848280"/><a data-primary="PaintBallGun class" data-type="indexterm" id="idm46402344847304"/><a data-primary="private fields" data-type="indexterm" id="idm46402344846472"/><a data-primary="public fields" data-type="indexterm" id="idm46402344839128"/><strong><em>Do this!</em></strong></p>&#13;
<p>Let’s try out our new PaintballGun class. <strong>Create a new console app</strong> and add the PaintballGun class to it. Here’s the Main method—it uses a loop to call the various methods in the class:</p>&#13;
<pre data-type="programlisting">static void Main(string[] args)&#13;
{&#13;
   PaintballGun gun = new PaintballGun();&#13;
   while (true)&#13;
   {&#13;
      Console.WriteLine($"{gun.GetBalls()} balls, {gun.GetBallsLoaded()} loaded");&#13;
      if (gun.IsEmpty()) Console.WriteLine("WARNING: You’re out of ammo");&#13;
      Console.WriteLine("Space to shoot, r to reload, + to add ammo, q to quit");&#13;
      char key = Console.ReadKey(true).KeyChar;&#13;
      if (key == ’ ’) Console.WriteLine($"Shooting returned {gun.Shoot()}");&#13;
      else if (key == ’r’) gun.Reload();&#13;
      else if (key == ’+’) gun.SetBalls(gun.GetBalls() + PaintballGun.MAGAZINE_SIZE);&#13;
      else if (key == ’q’) return;&#13;
  }&#13;
&#13;
}</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>A console app with a loop that tests an instance of a class should be really familiar by now. Make sure you can read the code and understand how it works.</p>&#13;
</div>&#13;
<section data-pdf-bookmark="Our class is well-encapsulated, but..." data-type="sect2"><div class="sect2" id="our_class_is_well_encapsulatedcomma_buth">&#13;
<h2>Our class is well-encapsulated, but...</h2>&#13;
<p>The class works, and we encapsulated it pretty well. The <strong>balls field is protected</strong>: it doesn’t let you set a negative number of balls, and it stays in sync with the ballsLoaded field. The Reload and Shoot methods work as expected, and there don’t seem to be any <em>obvious</em> ways we could accidentally misuse this class.</p>&#13;
<p>But have a closer look at this line from the Main method:</p>&#13;
<pre data-type="programlisting">       else if (key == ’+’) gun.SetBalls(gun.GetBalls() + PaintballGun.MAGAZINE_SIZE);</pre>&#13;
<p>Let’s be honest—that’s a downgrade from a field. If we still had a field, we could use the += operator to increase it by the magazine size. Encapsulation is great, but we don’t want it to make our class annoying or difficult to use.</p>&#13;
<p><strong><em>Is there a way to keep the balls field protected but still get the convenience of +=?</em></strong></p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="use_different_cases_for_private_and_publ">&#13;
<h5>Use different cases for private and public fields</h5>&#13;
<p>We used camelCase for the private fields and PascalCase for the public ones. PascalCase means capitalizing the first letter in every word in the variable name. camelCase is similar to PascalCase, except that the first letter is lowercase. It’s called camelCase because it makes the uppercase letters look like “humps” of a camel.</p>&#13;
<p>Using different cases for public and private fields is a convention a lot of programmers follow. Your code is easier to read if you use consistent case when choosing names for fields, properties, variables, and methods.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Properties make encapsulation easier" data-type="sect1"><div class="sect1" id="properties_make_encapsulation_easier">&#13;
<h1><u>Pro</u>p<u>ertie</u>s make encapsulation easier</h1>&#13;
<p><a data-primary="backing fields" data-type="indexterm" id="idm46402344824600"/><a data-primary="declaration" data-type="indexterm" id="idm46402344823864"/><a data-primary="encapsulation" data-secondary="properties and" data-type="indexterm" id="idm46402344823128"/><a data-primary="fields" data-secondary="backing fields, set by properties" data-type="indexterm" id="idm46402344822152"/><a data-primary="get accessor (getter)" data-type="indexterm" id="idm46402344818920"/><a data-primary="properties" data-type="indexterm" id="idm46402344818088"/><a data-primary="properties" data-secondary="encapsulation and" data-type="indexterm" id="idm46402344817256"/><a data-primary="set accessor (setter)" data-type="indexterm" id="idm46402344816104"/>So far you’ve learned about two kinds of class members, methods and fields. There’s a third kind of class member that helps you encapsulate your classes: they <strong>property</strong>. A property is a class member that <em><strong>looks like a field</strong></em> when it’s used, but it <em><strong>acts like a method</strong></em> when it runs.</p>&#13;
<p>A property is declared just like a field, with a type and a name, except instead of ending with a semicolon it’s followed by curly brackets. Inside those brackets are <strong>property accessors</strong>, or methods that either return or set the property value. There are two types of accessors:</p>&#13;
<ul>&#13;
<li><p>A <strong>get property accessor</strong>, usually just referred to as a <strong>get accessor</strong> or <strong>getter</strong>, that returns the value of the property. It starts with the <code><strong>get</strong></code> keyword, followed by a method inside curly brackets. The method must return a value that matches the type in the property declaration.</p></li>&#13;
<li><p>A <strong>set property accessor</strong>, usually just referred to as a <strong>set accessor</strong> or <strong>setter</strong>, that sets the value of the property. It starts with the <code><strong>set</strong></code> keyword, followed by a method inside curly brackets. Inside the method, the <code><strong>value</strong></code> keyword is a read-only variable that contains the value being set.</p></li>&#13;
</ul>&#13;
<p>It is very common for a property to get or set a <strong>backing field</strong>, which is what we call a private field that’s encapsulated by restricting access to it through a property.</p>&#13;
<section data-pdf-bookmark="Replace the GetBalls and SetBalls methods with a property" data-type="sect2"><div class="sect2" id="replace_the_getballs_and_setballs_method">&#13;
<h2>Replace the GetBalls and SetBalls methods with a property</h2>&#13;
<p><em><strong>Replace this!</strong></em></p>&#13;
<p>Here are the GetBalls and SetBalls methods from your PaintballGun class:</p>&#13;
<pre data-type="programlisting">    public int GetBalls() { return balls; }&#13;
    public void SetBalls(int numberOfBalls)&#13;
    {&#13;
        if (numberOfBalls &gt; 0)&#13;
            balls = numberOfBalls;&#13;
        Reload();&#13;
&#13;
    }</pre>&#13;
<p>Let’s replace them with a property. <strong>Delete both methods</strong>. Then <strong>add this Balls property</strong>:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/254fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Modify your Main method to use the Balls property" data-type="sect1"><div class="sect1" id="modify_your_main_method_to_use_the_balls">&#13;
<h1>Modify your Main method to use the Balls property</h1>&#13;
<p><a data-primary="debugging mode" data-type="indexterm" id="idm46402344796296"/><a data-primary="Main method" data-type="indexterm" id="idm46402344794920"/>Now that you’ve replaced the GetBalls and SetBalls methods with a single property called Balls, your code won’t build anymore. You need to update the Main method to use the Balls property instead of the old methods.</p>&#13;
<p>The GetBalls method was called in this Console.WriteLine statement:</p>&#13;
<p><strong><em>Update this!</em></strong></p>&#13;
<pre data-type="programlisting">  Console.WriteLine($"{gun.GetBalls()} balls, {gun.GetBallsLoaded()} loaded");</pre>&#13;
<p>You can fix that by <strong>replacing</strong> <code><strong>GetBalls()</strong></code> <strong>with</strong> <code><strong>Balls</strong></code>—when you do this, the statement will work just like before. Let’s have a look at the other place where GetBalls and SetBalls were used:</p>&#13;
<pre data-type="programlisting">  else if (key == ’+’) gun.SetBalls(gun.GetBalls() + PaintballGun.MAGAZINE_SIZE);</pre>&#13;
<p>This was that messy line of code that looked ugly and clunky. Properties are really useful because they work like methods but you use them like fields. So let’s use the Balls property like a field—<strong>replace that line</strong> with this statement that uses the += operator exactly like it would if Balls were a field:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/255fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Here’s the updated Main method:</p>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">static void Main(string[] args)</span>&#13;
<span style="color:#9D9EA0;">{</span>&#13;
<span style="color:#9D9EA0;">    PaintballGun gun = new PaintballGun();</span>&#13;
<span style="color:#9D9EA0;">    while (true)</span>&#13;
<span style="color:#9D9EA0;">    {</span>&#13;
<span style="color:#9D9EA0;">        Console.WriteLine($"</span><strong>{gun.Balls}</strong><span style="color:#9D9EA0;"> balls, {gun.GetBallsLoaded()} loaded");</span>&#13;
<span style="color:#9D9EA0;">        if (gun.IsEmpty()) Console.WriteLine("WARNING: You’re out of ammo");</span>&#13;
<span style="color:#9D9EA0;">        Console.WriteLine("Space to shoot, r to reload, + to add ammo, q to quit");</span>&#13;
<span style="color:#9D9EA0;">        char key = Console.ReadKey(true).KeyChar;</span>&#13;
<span style="color:#9D9EA0;">        if (key == ’ ’) Console.WriteLine($"Shooting returned {gun.Shoot()}");</span>&#13;
<span style="color:#9D9EA0;">        else if (key == ’r’) gun.Reload();</span>&#13;
<span style="color:#9D9EA0;">        else if (key == ’+’)</span> <strong>gun.Balls += PaintballGun.MAGAZINE_SIZE;</strong>&#13;
<span style="color:#9D9EA0;">        else if (key == ’q’) return;</span>&#13;
<span style="color:#9D9EA0;">    }</span>&#13;
&#13;
<span style="color:#9D9EA0;">}</span></pre>&#13;
<section data-pdf-bookmark="Debug your PaintballGun class to understand how the property works" data-type="sect2"><div class="sect2" id="debug_your_paintballgun_class_to_underst">&#13;
<h2>Debug your PaintballGun class to understand how the property works</h2>&#13;
<p>Use the debugger to really get a good sense of how your new Ball property works:</p>&#13;
<ul>&#13;
<li><p>Place a breakpoint inside the curly brackets of the get accessor (<code>return balls;</code>).</p></li>&#13;
<li><p>Place another breakpoint on the first line of the set accessor (<code>if (value &gt; 0)</code>).</p></li>&#13;
<li><p>Place a breakpoint at the top of the Main method and start debugging. Step over each statement.</p></li>&#13;
<li><p>When you step over Console.WriteLine, the debugger will hit the breakpoint in the getter.</p></li>&#13;
<li><p>Keep stepping over methods. When you execute the += statement, the debugger will hit the breakpoint in the setter. Add a watch for the backing field <strong>balls</strong> and the <code><strong>value</strong></code> keyword.</p></li>&#13;
</ul>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Auto-implemented properties simplify your code" data-type="sect1"><div class="sect1" id="auto_implemented_properties_simplify_you">&#13;
<h1>Auto-implemented properties simplify your code</h1>&#13;
<p><strong><em>Add this!</em></strong></p>&#13;
<p><a data-primary="backing fields" data-type="indexterm" id="idm46402344758568"/><a data-primary="properties" data-secondary="auto-implemented" data-type="indexterm" id="idm46402344757672"/><a data-primary="properties" data-secondary="creating with prop snippet" data-type="indexterm" id="idm46402344756520"/>A very common way to use a property is to create a backing field and provide get and set accessors for it. Let’s create a new BallsLoaded property that <strong>uses the existing ballsLoaded field</strong> as a backing field:</p>&#13;
<pre data-type="programlisting">    private int ballsLoaded = 0;&#13;
    public int BallsLoaded {&#13;
       get { return ballsLoaded; }&#13;
       set { ballsLoaded = value; }&#13;
&#13;
    }</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>This property uses a private</strong> <span style="color:#9D9EA0;"><u>backing field</u></span><strong>. Its getter returns the value in the field, and its setter updates the field.</strong></p>&#13;
</div>&#13;
<p>Now you can <strong>delete the GetBallsLoaded method</strong> and modify your Main method to use the property:</p>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">   Console.WriteLine($"{gun.Balls} balls, {</span><strong>gun.BallsLoaded</strong><span style="color:#9D9EA0;">} loaded");</span></pre>&#13;
<p>Run your program again. It should still work exactly the same way.</p>&#13;
<section data-pdf-bookmark="Use the prop snippet to create an auto-implemented property" data-type="sect2"><div class="sect2" id="use_the_prop_snippet_to_create_an_auto_i">&#13;
<h2>Use the prop snippet to create an <u>auto-implemented</u> property</h2>&#13;
<p>An <strong>auto-implemented property</strong>—sometimes called an <strong>automatic property</strong> or <strong>auto-property</strong>—is a property that has a getter that returns the value of the backing field, and a setter that updates it. In other words, it works just like the BallsLoaded property that you just created. There’s one important difference: when you create an automatic property <em><strong>you don’t define the backing field</strong></em>. Instead, the C# compiler creates the backing field for you, and the only way to update it is to use the get and set accessors.</p>&#13;
<p>Visual Studio gives you a really useful tool for creating automatic properties: a <strong>code snippet</strong>, or a small, reusable block of code that the IDE inserts automatically. Let’s use it to create a BallsLoaded auto-property.</p>&#13;
<ol>&#13;
<li><p><strong>Remove the BallsLoaded property and backing field.</strong> Delete the BallsLoaded property you added, because we’re going to replace it with an auto-implemented property. Then delete the ballsLoaded backing field (<code>private int ballsLoaded = 0;</code>) too, because any time you create an automatic property the C# compiler <u>generates a hidden backing field for you</u>.</p></li>&#13;
<li><p><strong>Tell the IDE to start the prop snippet.</strong> Put your cursor where the field used to be, and then <strong>type</strong> <code><strong>prop</strong></code> <strong>and</strong> <strong>press the Tab key twice</strong> to tell the IDE to start a snippet. It will add this line to your code:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/256fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>The snippet is a template that lets you edit parts of it—the prop snippet lets you edit the type and the property name. Press the Tab key once to switch to the property name, then <strong>change the name to</strong> <code><strong>BallsLoaded</strong></code> and press Enter to finalize the snippet</p>&#13;
<pre data-type="programlisting">public int BallsLoaded { get; set; }</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>You don’t have to declare a backing field for an automatic property because the C# compiler creates it automatically.</strong></p>&#13;
</div></li>&#13;
<li><p><strong>Fix the rest of the class.</strong> Since you removed the ballsLoaded field, your PaintballGun class doesn’t compile anymore. That has a quick fix—the <strong><u>b</u></strong>allsLoaded field appears five times in the code (once in the IsEmpty method, and twice in the Reload and Shoot methods). Change them to <strong><u>B</u></strong>allsLoaded—now your program works again.</p></li>&#13;
</ol>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use a private setter to create a read-only property" data-type="sect1"><div class="sect1" id="use_a_private_setter_to_create_a_read_on">&#13;
<h1>Use a private setter to create a read-only property</h1>&#13;
<p><a data-primary="get accessor (getter)" data-type="indexterm" id="idm46402344732264"/><a data-primary="methods" data-secondary="get and set accessors versus" data-type="indexterm" id="idm46402344728488"/><a data-primary="private setter" data-type="indexterm" id="idm46402344727512"/><a data-primary="properties" data-secondary="statements in" data-type="indexterm" id="idm46402344726776"/><a data-primary="read-only property" data-type="indexterm" id="idm46402344725800"/><a data-primary="set accessor (setter)" data-type="indexterm" id="idm46402344725064"/><a data-primary="value parameter, set accessors" data-type="indexterm" id="idm46402344724328"/>Let’s take another look at the auto-implemented property that you just created:</p>&#13;
<pre data-type="programlisting"> public int BallsLoaded { get; set; }</pre>&#13;
<p>This is definitely a great replacement for a property with get and set accessors that just update a backing field. It’s more readable and has less code than the ballsLoaded field and GetBallsLoaded method. So that’s an improvement, right?</p>&#13;
<p>But there’s one problem: <em><strong>we’ve broken the encapsulation</strong></em>. The whole point of the private field and public method was to make the number of balls loaded <u>read-only</u>. The Main method could easily set the BallsLoaded property. We made the field private and created a public method to get the value so that it could only be modified from <u>inside</u> the PaintballGun class.</p>&#13;
<section data-pdf-bookmark="Make the BallsLoaded setter private" data-type="sect2"><div class="sect2" id="make_the_ballsloaded_setter_private">&#13;
<h2>Make the BallsLoaded setter private</h2>&#13;
<p>Luckily, there’s a quick way to make our PaintballGun class well-encapsulated again. When you use a property, you can put an access modifier in front of the <code>get</code> or <code>set</code> keyword.</p>&#13;
<p>You can make a <strong>read-only property</strong> that can’t be set by another class by making its set accessor <code><strong>private</strong></code>. In fact, you can leave out the set accessor entirely for normal properties—but not automatic properties, which <em>must</em> have a set accessor or your code won’t compile.</p>&#13;
<p>So let’s <strong>make the set accessor private</strong>:</p>&#13;
<pre data-type="programlisting"> <span style="color:#9D9EA0;">public int BallsLoaded { get;</span> private <span style="color:#9D9EA0;"> set; }</span></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>You can make your automatic property read-only by making its setter private.</p>&#13;
</div>&#13;
<p>Now the BallsLoaded field is a <strong>read-only property</strong>. It can be read anywhere, but it can only be updated from inside the PaintballGun class. The PaintballGun class is well-encapsulated again.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0014">&#13;
<h5>there are no Dumb Questions</h5>&#13;
<p><strong>Q: We replaced methods with properties. Is there a difference between how a method works and how a getter or setter works?</strong></p>&#13;
<p><strong>A:</strong> No. Get and set accessors are a special kind of method—they look just like a field to other objects, and are called whenever that “field” is set. Getters always return a value that’s the same type as the field. A setter works just like a method with one parameter called <code>value</code> whose type is the same as the field.</p>&#13;
<p><strong>Q: So you can have ANY kind of statement in a property?</strong></p>&#13;
<p><strong>A:</strong> Absolutely. Anything you can do in a method, you can do in a property—you can even include complicated logic that does anything you can do in a normal method. A property can call other methods, access other fields, even create instances of objects. Just remember that they only get called when a property gets accessed, so they should only include statements that have to do with getting or setting the property.</p>&#13;
<p><strong>Q: Why would I need complicated logic in a get or set accessor? Isn’t it just a way of modifying fields?</strong></p>&#13;
<p><strong>A:</strong> Because sometimes you know that every time you set a field, you’ll have to do some calculation or perform some action. Think about Owen’s problem—he ran into trouble because the app didn’t call the SwordDamage methods in the right order after setting the Roll field. If we replaced all of the methods with properties, then we could make sure the setters do the damage calculation correctly. (In fact, you’re about to do exactly that at the end of the chapter!)</p>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="What if we want to change the magazine size?" data-type="sect1"><div class="sect1" id="what_if_we_want_to_change_the_magazine_s">&#13;
<h1>What if we want to change the magazine size?</h1>&#13;
<p><a data-primary="CLR (Common Language Runtime)" data-type="indexterm" id="idm46402344702904"/><a data-primary="constructors" data-secondary="about" data-type="indexterm" id="idm46402344701912"/>Right now the PaintballGun class uses a <code>const</code> for the magazine size:</p>&#13;
<pre data-type="programlisting">   public const int MAGAZINE_SIZE = 16;</pre>&#13;
<p><strong><em>Replace this!</em></strong></p>&#13;
<p>What if we want the game to set the magazine size when it instantiates the gun? Let’s <strong>replace it with a property</strong>.</p>&#13;
<ol>&#13;
<li><p><strong>Remove the MAGAZINE_SIZE constant and replace it with a read-only property.</strong></p>&#13;
<pre data-type="programlisting">    public int MagazineSize { get; private set; }</pre>&#13;
</li>&#13;
<li><p><strong>Modify the Reload method to use the new property.</strong></p>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">   if (balls &gt;</span> MagazineSize&#13;
<span style="color:#9D9EA0;">)        BallsLoaded =</span> MagazineSize;</pre></li>&#13;
<li><p><strong>Fix the line in the Main method that adds the ammo.</strong></p>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">   else if (key == ’+’) gun.Balls +=</span> gun.MagazineSize<span style="color:#9D9EA0;">;</span></pre></li>&#13;
</ol>&#13;
<section data-pdf-bookmark="But there’s a problem…how do we initialize MagazineSize?" data-type="sect2"><div class="sect2" id="but_thereapostrophes_a_problemhelliphow">&#13;
<h2>But there’s a problem…how do we initialize MagazineSize?</h2>&#13;
<p>The MAGAZINE_SIZE constant used to be set to 16. Now we’ve replaced it with an auto-property, and if we want, we can initialize it to 16 just like a field by <strong>adding an assignment to the end of the declaration</strong>:</p>&#13;
<pre data-type="programlisting">  public int MagazineSize { get; private set; } = 16;</pre>&#13;
<p>But what if we want the game to be able to <u>specify</u> the number of balls in the magazine? Maybe most guns are spawned loaded, but in some rapid onslaught levels we want some guns to spawn unloaded so the player needs to reload before firing. <em><strong>How do we do that?</strong></em></p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0015">&#13;
<h5>there are no Dumb Questions</h5>&#13;
<p><strong>Q: Can you explain what a constructor is again?</strong></p>&#13;
<p><strong>A:</strong> A <strong>constructor</strong> is a method that’s called when a new instance of a class is created. It’s always declared as a method with <strong><em>no return type</em></strong> and a name that <strong><em>matches the class name</em></strong>. To see how it works, <strong>create a new console app</strong> and add this ConstructorTest class with a constructor and a public field called <code><strong>i</strong></code>:</p>&#13;
<pre data-type="programlisting">public class ConstructorTest&#13;
{   &#13;
    public int i = 1;&#13;
    public ConstructorTest()&#13;
    {&#13;
      Console.WriteLine($"i is {i}");&#13;
    }&#13;
}</pre>&#13;
<p>Then <strong>add this</strong> <code><strong>new</strong></code> <strong>statement</strong> to the Main method: <code>new ConstructorTest();</code></p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong><em>Use the debugger to <u>really understand</u> how the constructor works.</em></strong></p>&#13;
<p><strong>Add three breakpoints:</strong></p>&#13;
<ul>&#13;
<li><p>At the field declaration (on <code>i = 1</code>)</p></li>&#13;
<li><p>On the first line of the constructor</p></li>&#13;
<li><p>On the bracket <code>}</code> after the last line of the Main method</p></li>&#13;
</ul>&#13;
<p>The debugger will first break at the field declaration, then in the constructor, and finally at the end of the Main method. There’s no mystery here—the CLR initializes the fields first, then runs the constructor, and finally picks up where it left off after the <code>new</code> statement.</p>&#13;
</div>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use a constructor with parameters to initialize properties" data-type="sect1"><div class="sect1" id="use_a_constructor_with_parameters_to_ini">&#13;
<h1>Use a constructor with <u>parameters</u> to initialize properties</h1>&#13;
<p><a data-primary="constructors" data-secondary="initializing properties using" data-type="indexterm" id="idm46402344666600"/><a data-primary="parameters" data-secondary="masking fields" data-type="indexterm" id="idm46402344665304"/><a data-primary="properties" data-secondary="initializing using constructors" data-type="indexterm" id="idm46402344662840"/><a data-primary="this keyword" data-type="indexterm" id="idm46402344661800"/>You saw earlier in the chapter that you can initialize an object with a constructor, or a special method that’s called when the object is first instantiated. Constructors are just like any other method—which means they can have <strong>parameters</strong>. We’ll use a constructor with parameters to initialize the properties.</p>&#13;
<p>The constructor you just created in the Q&amp;A answer looks like this: <code><strong>public ConstructorTest()</strong></code>. That’s a <strong>parameterless constructor</strong>, so just like any other method without parameters the declaration ends with <code>()</code>. Now let’s <strong>add a constructor with parameters</strong> to the PaintballGun class. Here’s the constructor to add:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/259fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Uh-oh—there’s a problem. As soon as you add the constructor, the IDE will tell you that the Main method has an error:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/259fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><em><strong>What do you think we need to do to fix this error?</strong></em></p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="watch_itexclamation_mark-idd0004">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/watchit.png"/></span> Watch it!</h5>&#13;
<p><strong>When a parameter has the same name as a field, it <u>masks</u> the field.</strong></p>&#13;
<p><em>The constructor’s balls parameter has the same name as the field called balls. Since they have the same name, the parameter takes precedence inside the body of the constructor. That’s called <strong>masking</strong>—when a parameter or a variable in a method has the same name as a field, using that name in the method refers to the parameter or variable, <u>not the field</u>. That’s why we need to use the <code><strong>this</strong></code> keyword in the PaintballGun constructor:</em></p>&#13;
<pre data-type="programlisting">   this.balls = balls;</pre>&#13;
<p><em>When we just use balls it refers to the parameter. We want to set the field, and since it has the same name, we need to use this.balls to refer to the field.</em></p>&#13;
<p><em>And by the way, this doesn’t just apply to constructors. It’s true for <strong>any</strong> method.</em></p>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Specify arguments when you use the “new” keyword" data-type="sect1"><div class="sect1" id="specify_arguments_when_you_use_the_quota">&#13;
<h1>Specify arguments when you use the “new” keyword</h1>&#13;
<p><a data-primary="arguments" data-secondary="specifying" data-type="indexterm" id="idm46402344641768"/>When you added the constructor, the IDE told you that the Main method has an error on the <code><strong>new</strong></code> statement (<code><strong>PaintballGun gun = new PaintballGun()</strong></code>). Here’s what that error looks like:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/260fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Read the text of the error—it’s telling you exactly what’s wrong. Your constructor now takes arguments, so it needs parameters. Start typing the <code>new</code> statement again, and the IDE will tell you exactly what you need to add:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/260fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>You’ve been using <code>new</code> to create instances of classes. So far, all of your classes have had parameterless constructors, so you never needed to provide any arguments.</p>&#13;
<p>Now you have a constructor with parameters, and like any method with parameters, it requires you to specify arguments with types that match those parameters.</p>&#13;
<p>Let’s modify your Main method to <strong>pass parameters to the PaintballGun constructor</strong>.</p>&#13;
<p><strong><em>Modify this!</em></strong></p>&#13;
<ol>&#13;
<li><p><strong>Add the ReadInt method that you wrote for Owen’s ability score calculator in <a href="ch04.html#types_and_references_getting_the_referen">#types_and_references_getting_the_referen</a>.</strong></p>&#13;
<p>You need to get the arguments for the constructor from somewhere. You already have a perfectly good method that prompts the user for int values, so it makes sense to reuse it here.</p></li>&#13;
<li><p><strong>Add code to read values from the console input.</strong></p>&#13;
<p>Now that you’ve added the ReadInt method from <a href="ch04.html#types_and_references_getting_the_referen">#types_and_references_getting_the_referen</a>, you can use it to get two int values. Add these four lines of code to the top of your Main method:</p>&#13;
<pre data-type="programlisting">int numberOfBalls = ReadInt(20, "Number of balls");&#13;
int magazineSize = ReadInt(16, "Magazine size");&#13;
    &#13;
Console.Write($"Loaded [false]: ");&#13;
bool.TryParse(Console.ReadLine(), out bool isLoaded);</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>If TryParse can’t parse the line, it will leave isLoaded with the default value, which for a bool is false.</strong></p>&#13;
</div></li>&#13;
<li><p><strong>Update the new statement to add arguments.</strong></p>&#13;
<p>Now that you have values in variables with types that match the parameters in the constructor, you can update the <code><strong>new</strong></code> statement to pass them to the constructor as arguments:</p>&#13;
<p><span style="color:#9D9EA0;">PaintballGun gun = new PaintballGun(</span><code><strong>numberOfBalls, magazineSize, isLoaded</strong></code><span style="color:#9D9EA0;">);</span></p></li>&#13;
<li><p><strong>Run your program.</strong></p>&#13;
<p>Now run your program. It will prompt you for the number of balls, the magazine size, and whether or not the gun is loaded. Then it will create a new instance of PaintballGun, passing arguments to its constructor that match your choices.</p></li>&#13;
</ol>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="pool_puzzle">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/puzzle.png"/></span>  Pool Puzzle</h5>&#13;
<p><a data-primary="code snippets" data-type="indexterm" id="idm46402344615960"/>Your <strong><em>job</em></strong> is to take code snippets from the pool and place them into the blank lines in the code. You <strong>may</strong> use the same snippet more than once, and you won’t need to use all the snippets. Your <strong><em>goal</em></strong> is to make classes that will compile and run and produce output that matches the sample.</p>&#13;
<p><strong>This program is a math quiz game that asks a series of random multiplication or addition questions and checks the answer. Here’s what it looks like when you play it:</strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/261fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="pool_puzzle_solution">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Pool Puzzle Solution</h5>&#13;
<p><a data-primary="code snippets" data-type="indexterm" id="idm46402344607496"/>Your <strong><em>job</em></strong> is to take code snippets from the pool and place them into the blank lines in the code. You <strong>may</strong> use the same snippet more than once, and you won’t need to use all the snippets. Your <strong><em>goal</em></strong> is to make classes that will compile and run and produce output that matches the sample.</p>&#13;
<p><strong>This program is a math quiz game that asks a series of random multiplication or addition questions and checks the answer. Here’s what it looks like when you play it:</strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/262fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<section data-pdf-bookmark="A few useful facts about methods and properties" data-type="sect2"><div class="sect2" id="a_few_useful_facts_about_methods_and_pro">&#13;
<h2>A few useful facts about methods and properties</h2>&#13;
<ul>&#13;
<li><p><a data-primary="CLR (Common Language Runtime)" data-type="indexterm" id="idm46402344599784"/><a data-primary="constructors" data-secondary="about" data-type="indexterm" id="idm46402344598616"/><a data-primary="methods" data-secondary="signature" data-type="indexterm" id="idm46402344597512"/><a data-primary="object initializers" data-type="indexterm" id="idm46402344596360"/><a data-primary="properties" data-type="indexterm" id="idm46402344595528"/><a data-primary="signature (method)" data-type="indexterm" id="idm46402344594696"/><strong>Every method in your class has a unique signature.</strong></p>&#13;
<p>The first line of a method, which contains the access modifier, return value, name, and parameters is called the method’s <strong>signature</strong>. Properties have signatures, too—they consist of the access modifier, type, and name.</p></li>&#13;
<li><p><strong>You can initialize properties in an object initializer.</strong></p>&#13;
<p>You used object initializers before:</p>&#13;
<pre data-type="programlisting">Guy joe = new Guy() { Cash = 50, Name = "Joe" };</pre>&#13;
<p>You can also specify properties in an object initializer. If you do, the constructor is run first, then the properties are set. And you can only initialize public fields and properties in the object initializer.</p></li>&#13;
<li><p><strong>Every class has a constructor, even if you didn’t add one yourself.</strong></p>&#13;
<p>The CLR needs a constructor to instantiate an object—it’s part of the behind-the-scenes mechanics of how .NET works. So if you don’t add a constructor to your class, the C# compiler automatically adds a parameterless constructor for you.</p></li>&#13;
<li><p><strong>You can keep a class from being instantiated by other classes by adding a private constructor.</strong></p></li>&#13;
</ul>&#13;
<p>Sometimes you need to have really careful control over how your objects are created. One way to do that is to make your constructor private—then it can only be called from inside the class. Take a minute and try it out:</p>&#13;
<pre data-type="programlisting">class NoNew {&#13;
   private NoNew() { Console.WriteLine("I’m alive!"); }&#13;
   public static NoNew CreateInstance() { return new NoNew(); }&#13;
}</pre>&#13;
<p>Add that NoNew class to a console app. If you try to add new NoNew(); to your Main method, the C# compiler gives you an error (’<em>NoNew.NoNew()’ is inaccessible due to its protection level</em>), but the <strong>NoNew.CreateInstance</strong>  method creates a new instance just fine.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><a data-primary="Aesthetics Game design... and beyond element" data-type="indexterm" id="idm46402344583784"/><a data-primary="Game design... and beyond elements" data-secondary="Aesthetics" data-type="indexterm" id="idm46402344583128"/>This is a really good time to talk about aesthetics in video games. If you think about it, encapsulation doesn’t really give you a way to do anything that you couldn’t before. You could still write the same programs without properties, constructors, and private methods—but they would sure look really different. That’s because not everything in programming is about making your code do something different. Often, it’s about making your code do the same thing but in a better way. Think about that when you read about aesthetics. They don’t change the way your game behaves, they change the way the player thinks and feels about the game.</p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="aesthetics_game_designhellip_and_beyond">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/game.png"/></span> <strong>Aesthetics Game design... and beyond</strong></h5>&#13;
<p>How did you feel the last time you played a game? Was it fun? Did you feel a thrill, a rush of adrenaline? Did it give you a sense of discovery or accomplishment? Did you get a feeling of competition or cooperation with other players? Was there an engaging story? Was it funny? Sad? Games bring out emotional responses in us, and that’s the idea behind aesthetics.</p>&#13;
<p>Does it seem weird to talk about feelings and video games? It shouldn’t—emotions and feelings have always played an important part in game design, and the most successful games have an important aesthetic aspect to them. Think about that satisfying feeling you get when you drop a long piece in Tetris and it clears four rows of blocks. Or that rush in Pac-Man when Blinky (the red ghost) is just pixels behind you when you swallow the power pellet.</p>&#13;
<ul>&#13;
<li><p>It’s obvious how <strong>art and visuals, music and sound</strong>, or story writing can influence aesthetics, but aesthetics is more than the artistic elements of a game. Aesthetics can come from the way the game is <strong>structured</strong>.</p></li>&#13;
<li><p>And it’s not just video games—you can find <strong>aesthetics in tabletop games</strong>. Poker is known for its emotional highs and lows, the feeling of pulling off a great bluff. Even a simple card game like Go Fish! has its own aesthetics: the growing back and forth, as players figure out each other’s hands; the crescendo toward a winner, as players put each new book on the table; the thrill of drawing that card you need; just saying “Go fish!” when asked for the wrong card.</p></li>&#13;
<li><p>Sometimes we talk about <strong>“fun”</strong> and <strong>“gameplay,”</strong> but it helps to get more precise when we’re talking about aesthetics.</p></li>&#13;
<li><p>When a game provides <strong>challenge</strong> it gives players obstacles to get past, creating a feeling of accomplishment and personal victory.</p></li>&#13;
<li><p>A game’s <strong>narrative</strong> draws the player into the drama of a story.</p></li>&#13;
<li><p>The pure <strong>tactile sensation</strong> of a game—the beat of a rhythm game, the satisfying “gulp” of eating a power pellet, the “vroom” and blur of an accelerating car—provides pleasure.</p></li>&#13;
<li><p>Playing a cooperative or mutliplayer game brings a sense of <strong>fellowship</strong> with others.</p></li>&#13;
<li><p>A game that provides <strong>fantasy</strong> not only transports a player to another world, but lets that player be another person (or non-person!) entirely.</p></li>&#13;
<li><p>Games with <strong>expression</strong> give the player self-discovery, a way to learn more about themselves.</p></li>&#13;
</ul>&#13;
<p>Believe it or not, we can use these ideas behind aesthetics to learn a <strong>larger lesson about development</strong> that applies to any kind of program or app, not just a game. Let these ideas sink in for now—we’ll return to this in the next chapter.</p>&#13;
</div></aside>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">Some developers are really skeptical when they read about aesthetics because they assume that only the mechanics of the game matter. Here’s a quick thought experiment to show how important aesthetics can be. Say you have two games with identical mechanics. There’s just one very tiny difference between them. In one game you’re kicking boulders out of the way to save a village. In the other game, you’re <u>kicking puppies and kittens</u> because you are a horrible person. Even if every other aspect of those games is identical, those are two very different games. That’s the power of aesthetics.</span></p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-idd0025">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil</h5>&#13;
<p><a data-primary="exercises" data-secondary="Sharpen your pencil" data-tertiary="code errors" data-type="indexterm" id="idm46402344559544"/><a data-primary="Sharpen Your Pencil exercises" data-secondary="code errors" data-type="indexterm" id="idm46402344557192"/><a data-primary="this keyword" data-type="indexterm" id="idm46402344556216"/>This code has problems. It’s supposed to be code for a simple gumball vending machine: you put in a coin and it dispenses gum. We’ve identified four specific problems that will cause bugs. Use the lines provided to write down what you think is wrong with the lines the arrows are pointing to.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/265fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-idd010">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil Solution</h5>&#13;
<p><a data-primary="constructors" data-secondary="about" data-type="indexterm" id="idm46402344550280"/><a data-primary="fields" data-secondary="masking" data-type="indexterm" id="idm46402344548552"/><a data-primary="parameters" data-secondary="masking fields" data-type="indexterm" id="idm46402344547432"/><a data-primary="this keyword" data-secondary="distinguishing fields from parameters with same name" data-type="indexterm" id="idm46402344546280"/>This code has problems. We pointed out four specific lines that will cause bugs. Here’s what’s wrong with them.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/266fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0016">&#13;
<h5>there are no Dumb Questions</h5>&#13;
<p><strong>Q:If my constructor is a method, why doesn’t it have a return type?</strong></p>&#13;
<p><strong>A:</strong> Your constructor doesn’t have a return type because <strong><em>every</em></strong> constructor is always void—which makes sense, because there’s no way for it to return a value. It would be redundant to make you type <code>void</code> at the beginning of each constructor.</p>&#13;
<p><strong>Q: Can I have a getter without a setter?</strong></p>&#13;
<p><strong>A:</strong> Yes! When you have a get accessor but no set, you create a read-only property. For example, the SecretAgent class might have a public read-only field with a backing field for the name:</p>&#13;
<pre data-type="programlisting">string spyNumber = "007";&#13;
public string SpyNumber {&#13;
   get { return spyNumber; }</pre>&#13;
<p><strong>Q: And I bet I can have a setter without a getter, right?</strong></p>&#13;
<p><strong>A:</strong> Yes—unless it’s an auto-property, in which case you’ll get an error (<em>“Auto-implemented properties must have get accessors”</em>). If you create a property with a setter but no getter, then your property <strong>can only be written</strong>. The SecretAgent class could use that for a property that other spies could write to, but not see:</p>&#13;
<pre data-type="programlisting">public string DeadDrop {&#13;
  set {&#13;
    StoreSecret(value);&#13;
  }&#13;
}</pre>&#13;
<p>Both of those techniques—set without get, or vice versa—can come in really handy when you’re doing encapsulation.</p>&#13;
</div></aside>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><a data-primary="encapsulation" data-secondary="exercises on" data-type="indexterm" id="idm46402344532808"/><a data-primary="exercises" data-secondary="encapsulation" data-type="indexterm" id="idm46402344531224"/><strong>Go to the</strong> <span style="color:#9D9EA0;">Visual Studio for Mac Learner’s Guide</span> <strong>for the Mac version of this exercise.</strong></p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0018">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>&#13;
<p>Use what you’ve learned about encapsulation to fix Owen’s sword damage calculator. First, modify the SwordDamage class to replace the fields with properties and add a constructor. Once that’s done, update the console app to use it. Finally, fix the WPF app. (This exercise will go more easily if you create a new console app for the first two parts and a new WPF app for the third.)</p>&#13;
<p><strong>Part 1: Modify SwordDamage so it’s a well-encapsulated class</strong></p>&#13;
<ol>&#13;
<li><p>Delete the Roll field and replace it with a property named Roll and a backing field named roll. The getter returns the value of the backing field. The setter updates the backing field, then calls the CalculateDamage method.</p></li>&#13;
<li><p>Delete the SetFlaming method and replace it with a property named Flaming and a backing field named flaming. It works like the Roll property—the getter returns the backing field, the setter updates it and calls CalculateDamage.</p></li>&#13;
<li><p>Delete the SetMagic method and replace it with a property named Magic and a backing field named magic that works exactly like the Flaming and Roll properties.</p></li>&#13;
<li><p>Create an auto-implemented property named Damage with a public get accessor and private set accessor.</p></li>&#13;
<li><p>Delete the MagicMultiplier and FlamingDamage fields. Modify the CalculateDamage method so it checks the <u>property</u> values for the Roll, Magic, and Flaming properties and does the entire calculation inside the method.</p></li>&#13;
<li><p>Add a constructor that takes the initial roll as its parameter. Now that the CalculateDamage method is only called from the property set accessors and constructor, there’s no need for another class to call it. Make it private.</p></li>&#13;
<li><p>Add XML code documentation to all of the public class members.</p></li>&#13;
</ol>&#13;
<p><strong>Part 2: Modify the console app to use the well-encapsulated SwordDamage class</strong></p>&#13;
<ol>&#13;
<li><p>Create a static method called RollDice that returns the results of a 3d6 roll. You’ll need to store the Random instance in a static field instead of a variable so both the Main method and RollDice can use it.</p></li>&#13;
<li><p>Use the new RollDice method for the SwordDamage constructor argument and to set the Roll property.</p></li>&#13;
<li><p>Change the code that calls SetMagic and SetFlaming to set the Magic and Flaming properties instead.</p></li>&#13;
</ol>&#13;
<p><strong>Part 3: Modify the WPF app to use the well-encapsulated SwordDamage class</strong></p>&#13;
<ol>&#13;
<li><p>Copy the code from Part 1 into a new WPF app. Copy the XAML from the project earlier in the chapter.</p></li>&#13;
<li><p>In the code-behind, declare the MainWindow.swordDamage field like this (and instantiate it in the constructor):</p>&#13;
<pre data-type="programlisting">SwordDamage swordDamage;</pre></li>&#13;
<li><p>In the MainWindow constructor, set the swordDamage field to a new instance of SwordDamage initialized with a random 3d6 roll. Then call the CalculateDamage method.</p></li>&#13;
<li><p>The RollDice and Button_Click methods are exactly the same as earlier in the chapter.</p></li>&#13;
<li><p>Change the DisplayDamage method to use string interpolation, but it should still display the same string as before.</p></li>&#13;
<li><p>Change the Checked and Unchecked event handlers for both checkboxes to use the Magic and Flaming properties instead of the old SetMagic and SetFlaming methods, then call DisplayDamage.</p></li>&#13;
</ol>&#13;
<p><strong>Test everything. Use the debugger or Debug.WriteLine statements to make sure that it REALLY works.</strong></p>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0006">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<p><strong>Now Owen finally has a class for calculating damage that’s much easier to use without running into bugs. Each property recalculates the damage, so it doesn’t matter what order you call them in. Here’s the code for the well-encapsulated SwordDamage class:</strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/268fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p/>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/269fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0007">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<p>Here’s the code for the code-behind for the WPF desktop app. The XAML is exactly the same.</p>&#13;
<p>We didn’t ask you to move the 3d6 roll into its own method. Do you think adding a RollDice method (like in the console app) would make this code easier to read? Or is it unnecessary? One way is not necessarily better or worse than the other! Try it both ways and decide what works best for you.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">Deciding whether or not to move a single line of duplicated code into its own method is a good example of code aesthetics. Beauty is in the eye of the beholder.</span></p>&#13;
</div>&#13;
<pre data-type="programlisting">public partial class MainWindow : Window&#13;
{&#13;
    Random random = new Random();&#13;
    SwordDamage swordDamage;&#13;
    public MainWindow()&#13;
    {&#13;
        InitializeComponent();&#13;
        swordDamage = new SwordDamage(random.Next(1, 7) + random.Next(1, 7)&#13;
                                      + random.Next(1, 7));&#13;
        DisplayDamage();&#13;
    }&#13;
    public void RollDice()&#13;
    {&#13;
        swordDamage.Roll = random.Next(1, 7) + random.Next(1, 7) + random.Next(1, 7);&#13;
        DisplayDamage();&#13;
    }&#13;
    void DisplayDamage()&#13;
    {&#13;
        damage.Text = $"Rolled {swordDamage.Roll} for {swordDamage.Damage} HP";&#13;
    }&#13;
    private void Button_Click(object sender, RoutedEventArgs e)&#13;
    {&#13;
        RollDice();&#13;
    }&#13;
    private void Flaming_Checked(object sender, RoutedEventArgs e)&#13;
    {&#13;
        swordDamage.Flaming = true;&#13;
        DisplayDamage();&#13;
    }&#13;
    private void Flaming_Unchecked(object sender, RoutedEventArgs e)&#13;
    {&#13;
        swordDamage.Flaming = false;&#13;
        DisplayDamage();&#13;
    }&#13;
    private void Magic_Checked(object sender, RoutedEventArgs e)&#13;
    {&#13;
        swordDamage.Magic = true;&#13;
        DisplayDamage();&#13;
    }&#13;
    private void Magic_Unchecked(object sender, RoutedEventArgs e)&#13;
    {&#13;
        swordDamage.Magic = false;&#13;
        DisplayDamage();&#13;
    }&#13;
}</pre>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="objectcross">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/icon3.png"/></span> Objectcross</h5>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Take a break, sit back, and give your right brain something to do. It’s your standard crossword; all of the solution words are from the first five chapters of the book.</p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/271fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>Across</strong></p>&#13;
<p>1. What (int) is doing in this line of code: x = (int) y;</p>&#13;
<p>4. Looks like a field but acts like a method</p>&#13;
<p>7. What kind of sequence is or ?</p>&#13;
<p>9. If you want to create instances of a class, don’t put this keyword in the declaration</p>&#13;
<p>12. A variable that points to an object</p>&#13;
<p>14. What an object is an instance of</p>&#13;
<p>15. The four whole-number types that only hold positive numbers</p>&#13;
<p>18. You can assign any value to a variable of this type</p>&#13;
<p>21. What you’re doing when you use $ and curly braces to include values in a string</p>&#13;
<p>23. Draw one of these for your class before you start writing code</p>&#13;
<p>26. How you start a variable declaration</p>&#13;
<p>27. The numeric type that holds the biggest numbers</p>&#13;
<p>28. What you use to pass information into a method</p>&#13;
<p>29. If you want to store a currency value, use this type</p>&#13;
<p><strong>Down</strong></p>&#13;
<p>2. Every object has this method that converts it to a string</p>&#13;
<p>3. An object’s fields keep track of its __________</p>&#13;
<p>5. namespace, for, while, using, and new are examples of _________ keywords</p>&#13;
<p>6. These define the behavior of a class</p>&#13;
<p>8. The kind of collection that happens when the last reference to an object goes away</p>&#13;
<p>10. What you’re doing when you use the + operator to stick two strings together</p>&#13;
<p>11. How a method tells you what to pass to it</p>&#13;
<p>13. += and -= are _________ assignment operators</p>&#13;
<p>16. The second part of a variable declaration</p>&#13;
<p>17. Where objects live</p>&#13;
<p>19. A variable declared directly in a class that all its members can access</p>&#13;
<p>20. What floats in a float</p>&#13;
<p>22. Tells a method to stop immediately, possibly sending a value back to the statement that called it</p>&#13;
<p>24. The statement you use to create an object</p>&#13;
<p>25. If a method’s return type is _________, it doesn’t return anything</p>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-idd0011">&#13;
<h5>Bullet Points</h5>&#13;
<ul>&#13;
<li><p><a data-primary="CLR (Common Language Runtime)" data-type="indexterm" id="idm46402344469288"/><a data-primary="properties" data-type="indexterm" id="idm46402344468264"/><a data-primary="this keyword" data-type="indexterm" id="idm46402344467528"/><strong>Encapsulation</strong> keeps your code safe by preventing classes from modifying it unexpectedly or otherwise misusing other classes’ members.</p></li>&#13;
<li><p>Fields that require some processing or calculation to happen when they’re set are <strong>prime candidates</strong> for encapsulation.</p></li>&#13;
<li><p>Think about ways fields and methods can be <strong>misused</strong>. Only make fields and methods public if you need to.</p></li>&#13;
<li><p>Using consistent case when choosing names for fields, properties, variables, and methods makes code easier to read. Many developers use <strong>camelCase</strong> for private fields and <strong>PascalCase</strong> for public ones.</p></li>&#13;
<li><p>A <strong>property</strong> is a class member that looks like a field when it’s used, but acts like a method when it runs.</p></li>&#13;
<li><p>A <strong>get accessor</strong> (or <strong>getter</strong>) is defined by the <code>get</code> keyword followed by a method that returns the value of the property.</p></li>&#13;
<li><p>A <strong>set accessor</strong> (or <strong>setter</strong>) is defined by the <code>set</code> keyword and followed by a method that sets the value of the property. Inside the method, the <code>value</code> keyword is a read-only variable that contains the value being set.</p></li>&#13;
<li><p>Properties often get or set a <strong>backing field</strong>, or a private field that’s encapsulated by restricting access to it through a property.</p></li>&#13;
<li><p>An <strong>auto-implemented property</strong>—sometimes called an <strong>automatic property</strong> or <strong>auto-property</strong>—is a property that has a getter that returns the value of the backing field, and a setter that updates it.</p></li>&#13;
<li><p>Use the <strong>prop snippet</strong> in Visual Studio to create an auto-implemented property by typing “prop” followed by two tabs.</p></li>&#13;
<li><p>Use the <code><strong>private</strong></code> <strong>keyword</strong> to restrict access to a get or set accessor. A read-only property has a private set accessor.</p></li>&#13;
<li><p>When an object is created, the CLR first <strong>sets</strong> all of the fields that have values set in their declarations and then <strong>executes</strong> the constructor, before <strong>returning</strong> to the <code>new</code> statement that created the object.</p></li>&#13;
<li><p>Use a <strong>constructor with parameters</strong> to initialize properties. Specify arguments to pass to the constructor when you use the <code>new</code> keyword.</p></li>&#13;
<li><p>A parameter with the same name as a field <strong>masks</strong> that field. Use the <code><strong>this</strong></code> <strong>keyword</strong> to access the field.</p></li>&#13;
<li><p>If you don’t add a constructor to your class, the C# compiler automatically adds a <strong>parameterless constructor</strong> for you.</p></li>&#13;
<li><p>You can keep a class from being instantiated by other classes by adding a <strong>private constructor</strong>.</p></li>&#13;
</ul>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="objectcross_solution">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/icon3.png"/></span> Objectcross Solution</h5>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/272fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>