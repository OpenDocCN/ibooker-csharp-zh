<html><head></head><body><section data-pdf-bookmark="Chapter 7. Interfaces, Casting, and &#x201C;is&#x201D;: Making Classes keep their Promises" data-type="chapter" epub:type="chapter"><div class="chapter" id="interfacescomma_castingcomma_and_quotati">
<h1><span class="label">Chapter 7. </span>Interfaces, Casting, and “is”: <em>Making Classes keep their Promises</em></h1>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/355fig01.png"/>
<h6/>
</div></figure>
<p><strong>Need an object to do a specific job? Use an interface.</strong> Sometimes you need to group your objects together based on the <strong>things they can do</strong> rather than the classes they inherit from—and that’s where <strong>interfaces</strong> come in. You can use an interface to define a <strong>specific job</strong>. Any instance of a class that <strong>implements</strong> the interface is <em>guaranteed to do that job</em>, no matter what other classes it’s related to. To make it all work, any class that implements an interface must promise to <strong>fulfill all of its obligations</strong>...or the compiler will break its kneecaps, see?</p>
<section data-pdf-bookmark="The beehive is under attack!" data-type="sect1"><div class="sect1" id="the_beehive_is_under_attackexclamation_m">
<h1>The beehive is under attack!</h1>
<p>An enemy hive is trying to take over the Queen’s territory, and keeps sending enemy bees to attack her workers. So she’s added a new elite Bee subclass called HiveDefender to defend the hive.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/356fig01.png"/>
<h6/>
</div></figure>
<section data-pdf-bookmark="So we need a DefendHive method, because enemies can attack at any time" data-type="sect2"><div class="sect2" id="so_we_need_a_defendhive_methodcomma_beca">
<h2>So we need a DefendHive method, because enemies can attack at any time</h2>
<p>We can add a HiveDefender subclass to the Bee class hierarchy by extending the Bee class, overriding its CostPerShift with the amount of honey each defender consumes every shift, and overriding the DoJob method to fly out to the enemy hive and attack the enemy bees.</p>
<p>But enemy bees can attack at any time. We want defenders to be able to defend the hive <strong><em>whether or not they’re currently doing their normal jobs.</em></strong></p>
<p>So in addition to DoJob, we’ll add a DefendHive method to any Bee that can defend the hive—not just the elite HiveDefender workers, butany of their sisters who can take up arms and protect their Queen. The Queen will call her workers’ DefendHive methods any time she sees that her hive is under attack.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/356fig02.png"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="We can use casting to call the DefendHive method..." data-type="sect1"><div class="sect1" id="we_can_use_casting_to_call_the_defendhiv">
<h1>We can use <u>casting</u> to call the DefendHive method...</h1>
<p><a data-primary="casting" data-secondary="calling methods using" data-type="indexterm" id="idm46402343018344"/>When you coded the Queen.DoJob method, you used a foreach loop to get each Bee reference in the <code>workers</code> array, then you used that reference to call worker.DoJob. If the hive is under attack, the Queen will want to call her defenders’ DefendHive methods. So we’ll give her a HiveUnderAttack method that gets called any time the hive is being attacked by enemy bees, and she’ll use a foreach loop to order her workers to defend the hive until all of the attackers are gone.</p>
<p>But there’s a problem. The Queen can use the Bee references to call DoJob because each subclass overrides Bee.DoJob, but she can’t use a Bee reference to call the DefendHive method, because that method isn’t part of the Bee class. So how does she call DefendHive?</p>
<p>Since DefendHive is only defined in each subclass, we’ll need to use <code>casting</code> to convert the Bee reference to the correct subclass in order to call its DefendHive method.</p>
<pre data-type="programlisting">public void HiveUnderAttack() {
    foreach (Bee worker in workers) {
        if (EnemyHive.AttackingBees &gt; 0) {
            if (worker.Job == "Hive Defender") {
                HiveDefender defender = <strong>(HiveDefender)</strong> worker;
                defender.DefendHive();
            } else if (worker.Job == "Nectar Defender") {
                NectarDefender defender = <strong>(NectarDefender)</strong> defender;
                defender.DefendHive();
            }
        }
    }
}</pre>
<section data-pdf-bookmark="...but what if we add more Bee subclasses that can defend?" data-type="sect2"><div class="sect2" id="hellipbut_what_if_we_add_more_bee_subcla">
<h2>...but what if we add more Bee subclasses that can defend?</h2>
<p>Some honey manufacturer and egg care bees want to step up and defend the hive, too. That means we’ll need to add more <code>else</code> blocks to her HiveUnderAttack method.</p>
<p><strong><em>This is getting complex.</em></strong> The Queen.DoJob method is nice and simple—a very short foreach loop that takes advantage of the Bee class model to call the specific version of the DoJob method that was implemented in the subclass. We can’t do that with DefendHive because it’s not part of the Bee class—and we don’t want to add it, because not all bees can defend the hive. <strong><em>Is there a better way to have <u>unrelated classes do the same job</u>?</em></strong></p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/357fig01.png"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="An interface defines methods and properties that a class must implement..." data-type="sect1"><div class="sect1" id="an_interface_defines_methods_and_propert">
<h1>An <u>interface</u> defines methods and properties that a class must implement...</h1>
<p><a data-primary="interfaces" data-secondary="defining methods and properties using" data-type="indexterm" id="idm46402343002808"/><a data-primary="methods" data-secondary="defining with interfaces" data-type="indexterm" id="idm46402343001336"/><a data-primary="properties" data-secondary="defining with interfaces" data-type="indexterm" id="idm46402342998600"/>An <strong>interface</strong> works just like an abstract class: you use abstract methods, and then you use the colon (:) to make a class implement that interface.</p>
<p>So if we wanted to add defenders to the hive, we could have an interface called IDefend. Here’s what that looks like. It uses the <code><strong>interface</strong></code> <strong>keyword</strong> to define the interface, and it includes a single member, an abstract method called Defend. All members in an interface are public and abstract by default, so C# keeps things simple by having you <strong><em>leave off the <code>public</code> and <code>abstract</code> keywords:</em></strong></p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/358fig01.png"/>
<h6/>
</div></figure>
<p>Any class that implements the IDefend interface <strong>must include a Defend method</strong> whose declaration matches the one in the interface. If it doesn’t, the compiler will give an error.</p>
<section data-pdf-bookmark="...but there’s no limit to the number of interfaces a class can implement" data-type="sect2"><div class="sect2" id="hellipbut_thereapostrophes_no_limit_to_t">
<h2>...but there’s no limit to the number of interfaces a class can implement</h2>
<p>We just said that you use a colon (:) to make a class implement an interface. What if that class is already using a colon to extend a base class? No problem! <strong>A class can implement many different interfaces, even if it already extends a base class:</strong></p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/358fig02.png"/>
<h6/>
</div></figure>
<p>Now we have a class that can act like a NectarCollector, but can also defend the hive. NectarCollector extends Bee, so if you <strong>use it from a Bee reference</strong> it acts like a Bee:</p>
<pre data-type="programlisting">    Bee worker = new NectarCollector();
    Console.WriteLine(worker.Job);
    worker.WorkTheNextShift();</pre>
<p>But if you <strong>use it from an IDefend reference</strong>, it acts like a hive defender:</p>
<pre data-type="programlisting">    IDefend defender = new NectarCollector();
    defender.Defend();</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>When a class implements an interface, it <u>must include</u> all of the methods and properties listed inside the interface or the code won’t build.</strong></p>
</div>
</div></section>
</div></section>
<section data-pdf-bookmark="Interfaces let unrelated classes do the same job" data-type="sect1"><div class="sect1" id="interfaces_let_unrelated_classes_do_the">
<h1>Interfaces let <u>unrelated</u> classes do the same job</h1>
<p>Interfaces can be a really powerful tool to help you design C# code that’s easy to understand and build. Start by thinking about <strong>specific jobs that classes need to do</strong>, because that’s what interfaces are all about.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/359fig01.png"/>
<h6/>
</div></figure>
<p>So how does this help the Queen? The IDefender interface lives <u>entirely outside the Bee class hierarchy</u>. So we can add a NectarDefender class that knows how to defend the hive, and <strong><em>it can still extend NectarCollector</em></strong>. The Queen can keep an array of all of her defenders:</p>
<pre data-type="programlisting">IDefender[] defenders = new IDefender[2];
defenders[0] = new HiveDefender();
defenders[1] = new NectarDefender();</pre>
<p>That makes it easy for her to rally her defenders:</p>
<pre data-type="programlisting">private void DefendTheHive() {
  foreach (IDefender defender in defenders)
  {
     defender.Defend();
  }
}</pre>
<p>And since it lives outside of the Bee class model, we can do this <strong><em>without modifying any existing code.</em></strong></p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/359fig02.png"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span class="inlineimage"><img alt="Images" src="assets/relax.png"/></span></p>
<p><strong>We’re going to give you a lot of examples of interfaces.</strong></p>
<p>Still a little puzzled about how interfaces work and why you would use them? Don’t worry—that’s normal! The syntax is pretty straightforward, but there’s <strong>a lot of subtlety</strong>. So we’ll spend more time on interfaces...and we’ll give you plenty of examples, and <u>lots of practice</u>.</p>
</div>
</div></section>
<section data-pdf-bookmark="Get a little practice using interfaces" data-type="sect1"><div class="sect1" id="get_a_little_practice_using_interfaces">
<h1>Get a little practice using interfaces</h1>
<p><a data-primary="IClown interface" data-type="indexterm" id="idm46402342964168"/><a data-primary="interfaces" data-secondary="naming" data-type="indexterm" id="idm46402342962280"/><a data-primary="interfaces" data-secondary="void method" data-type="indexterm" id="idm46402342961304"/><a data-primary="void method" data-type="indexterm" id="idm46402342960040"/>The best way to understand interfaces is to start using them. Go ahead and <strong>create a new Console App</strong> project.</p>
<p><strong><em>Do this!</em></strong></p>
<ol>
<li><p><strong>Add the Main method.</strong> Here’s the code for a class called TallGuy, along with code for the Main method that instantiates it using an object initializer and calls its TalkAboutYourself method. There’s nothing new here—we’ll use it in a minute:</p>
<pre data-type="programlisting">class TallGuy {
    public string Name;
    public int Height;

    public void TalkAboutYourself() {
        Console.WriteLine($"My name is {Name} and I’m {Height} inches tall.");
    }
}
class Program
{
    static void Main(string[] args)
    {
        TallGuy tallGuy = new TallGuy() { Height = 76, Name = "Jimmy" };
        tallGuy.TalkAboutYourself();
    }
}</pre></li>
<li><p><strong>Add an interface.</strong> We’re going to make TallGuy implement an interface. Add a new IClown interface to your project: right-click on the project in the Solution Explorer, <strong>select Add &gt;&gt; New Item...(Windows) or Add &gt;&gt; New File... (Mac), and choose Interface</strong>. Make sure it’s called <em>IClown.cs</em>. The IDE will create an interface that includes the interface declaration. Add a Honk method:</p>
<pre data-type="programlisting">interface IClown
{
    void Honk();
}</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You don’t <u>need</u> to add “public” or “abstract” inside the interface, because it automatically makes every property and method public and asbtract.</p>
</div>
</li>
<li><p><strong>Try coding the rest of the IClown interface.</strong> Before you go on to the next step, see if you can create the rest of the IClown interface, and modify the TallGuy class to implement this interface. In addition to the void method called Honk that doesn’t take any parameters, your IClown interface should also have a read-only string property called FunnyThingIHave that has a get accessor but no set accessor.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="interface_names_start_with_i">
<h5><strong>Interface names start with I</strong></h5>
<p>Whenever you create an interface, you should make its name start with an uppercase I. There’s no rule that says you <span style="color:#9D9EA0;">need</span> to do it, but it makes your code a lot easier to understand. You can see for yourself just how much easier that can make your life. Just go into the IDE to any blank line inside any method and type “I”—IntelliSense shows .NET interfaces.</p>
</div></aside></li>
<li><p><strong>Here’s the IClown interface.</strong> Did you get it right? It’s OK if you put the Honk method first—the order of the members doesn’t matter in an interface, just like it doesn’t matter in a class.</p>
<pre data-type="programlisting">interface IClown
{
    string FunnyThingIHave { get; }
    void Honk();
}</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The IClown interface requires any class that implements it to have a void method called Honk and a string property called FunnyThingIHave that has a get accessor.</p>
</div>
</li>
<li><p><strong>Modify the TallGuy class so that it implements IClown.</strong> Remember, the colon operator is always followed by the base class to inherit from (if any), and then a list of interfaces to implement, all separated by commas. Since there’s no base class and only one interface to implement, the declaration looks like this:</p>
<pre data-type="programlisting">class TallGuy: <strong>IClown</strong></pre>
<p>Then make sure the rest of the class is the same, including the two fields and the method. Select Build Solution from the Build menu in the IDE to compile and build the program. You’ll see two errors:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/361fig01.png"/>
<h6/>
</div></figure>
</li>
<li><p><strong>Fix the errors by adding the missing interface members.</strong> The errors will go away as soon as you add all of the methods and properties defined in the interface. So go ahead and implement the interface. Add a read-only string property called FunnyThingIHave with a get accessor that always returns the string “big shoes”. Then add a Honk method that writes “Honk honk!” to the console.</p>
<p>Here’s what it’ll look like:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/361fig02.png"/>
<h6/>
</div></figure>
</li>
<li><p><strong>Now your code will compile.</strong> Update your Main method so that it prints the TallGuy object’s FunnyThingIHave property and then calls its Honk method:</p>
<pre data-type="programlisting">static void Main(string[] args) {
    TallGuy tallGuy = new TallGuy() { Height = 76, Name = "Jimmy" };
    tallGuy.TalkAboutYourself();
    Console.WriteLine($"The tall guy has {tallGuy.FunnyThingIHave}");
    tallGuy.Honk();
}</pre></li>
</ol>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-idd0029">
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil</h5>
<p><a data-primary="exercises" data-secondary="Sharpen your pencil" data-tertiary="interfaces" data-type="indexterm" id="idm46402342929752"/><a data-primary="interfaces" data-secondary="exercises on" data-type="indexterm" id="idm46402342928152"/><a data-primary="Sharpen Your Pencil exercises" data-secondary="interfaces" data-type="indexterm" id="idm46402342926968"/>Here’s your chance to demonstrate your artistic abilities. On the left, you’ll find sets of class and interface declarations. Your job is to draw the associated class diagrams on the right. Don’t forget to use a dashed line for implementing an interface and a solid line for inheriting from a class.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/362fig01.png"/>
<h6/>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-idd0030">
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil</h5>
<p>On the left, you’ll find sets of class diagrams. Your job is to turn these into valid C# declarations. <strong>We did number 1 for you.</strong> Notice how the class declarations are just a pair of curly braces <code>{ }</code>? That’s because these classes don’t have any members. (But they’re still valid classes that build!)</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/363fig01.png"/>
<h6/>
</div></figure>
</div></aside>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/364fig01.png"/>
<h6/>
</div></figure>
<p><a data-primary="interfaces" data-secondary="abstract classes and" data-type="indexterm" id="idm46402342915656"/>Tonight’s talk: <strong>An abstract class and an interface butt heads over the pressing question, “Who’s more important?</strong></p>
<table>
<tbody>
<tr>
<td><strong>Abstract Class:</strong></td>
<td><strong>Interface:</strong></td>
</tr>
<tr>
<td>I think it’s obvious who’s more important between the two of us. Programmers need me to get their jobs done. Let’s face it. You don’t even come close.</td>
<td/>
</tr>
<tr>
<td/>
<td>Nice. This oughta be good.</td>
</tr>
<tr>
<td>You can’t really think you’re more important than me. You don’t even use real inheritance—you only get implemented.</td>
<td/>
</tr>
<tr>
<td/>
<td>Great, here we go again. “Interfaces don’t use real inheritance.” “Interfaces only implement.” That’s just plain ignorant. Implementation is as good as inheritance. In fact, it’s better!</td>
</tr>
<tr>
<td>Better? You’re nuts. I’m much more flexible than you. Sure, I can’t be instantiated—but then, neither can you. Unlike you, I have the <strong>awesome power</strong> of inheritance. The poor saps that extend you can’t take advantage of <code>virtual</code> and <code>override</code> at all!</td>
<td/>
</tr>
<tr>
<td/>
<td>Yeah? What if you want a class that inherits from you <strong><em>and</em></strong> your buddy? <strong>You can’t inherit from two classes.</strong> You have to choose which class to inherit from. That’s just plain rude! There’s no limit to the number of interfaces a class can implement. Talk about flexible! With me, a programmer can make a class do anything.</td>
</tr>
</tbody>
</table>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-idd013">
<h5><span class="inlineimage"><img alt="Images" src="assets/Common.png"/></span> Sharpen your pencil Solution</h5>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/364fig02.png"/>
<h6/>
</div></figure>
</div></aside>
<table>
<tbody>
<tr>
<td><strong>Abstract Class:</strong></td>
<td><strong>Interface:</strong></td>
</tr>
<tr>
<td>You might be overstating your power a little bit.</td>
<td>Really, now? Well, let’s think about just how powerful I can be for developers that use me. I’m all about the job—when they get an interface reference, they don’t need to know anything about what’s going on inside that object at all.</td>
</tr>
<tr>
<td>And you think that’s a good thing? Ha! When you use me and my subclasses, you know exactly what’s going on inside all of us. I can handle any behavior that all of my subclasses need, and they just need to inherit it. Transparency is a powerful thing, kiddo!</td>
<td>Nine times out of 10, a programmer wants to make sure an object has certain properties and methods, but doesn’t really care how they’re implemented.</td>
</tr>
<tr>
<td>Really? I doubt that—programmers always care what’s in their properties and methods.</td>
<td>OK, sure. Eventually. But think about how many times you’ve seen a programmer write a method that takes an object that just needs to have a certain method, and it doesn’t really matter right at that very moment exactly how the method’s built—just that it’s there. So bang! The programmer just needs to use an interface. Problem solved!</td>
</tr>
<tr>
<td>Yeah, sure, tell a coder they can’t code.</td>
<td>Ugh, you’re <strong><em>so frustrating!</em></strong></td>
</tr>
</tbody>
</table>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-idd014">
<h5><span class="inlineimage"><img alt="Images" src="assets/Common.png"/></span> Sharpen your pencil Solution</h5>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/365fig01.png"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-pdf-bookmark="You can’t instantiate an interface, but you can reference an interface" data-type="sect1"><div class="sect1" id="you_canapostrophet_instantiate_an_interf">
<h1>You can’t instantiate an interface, but you can <u>reference</u> an interface</h1>
<p><a data-primary="Beehive Management System project" data-secondary="interfaces" data-type="indexterm" id="idm46402342880456"/><a data-primary="instantiation" data-type="indexterm" id="idm46402342878824"/><a data-primary="interfaces" data-secondary="new keyword" data-type="indexterm" id="idm46402342878008"/><a data-primary="interfaces" data-secondary="references" data-type="indexterm" id="idm46402342877000"/><a data-primary="new keyword" data-secondary="interfaces" data-type="indexterm" id="idm46402342875880"/><a data-primary="references" data-secondary="interface" data-type="indexterm" id="idm46402342874904"/>Say you need an object that has a Defend method so you can use it in a loop to defend the hive. Any object that implemented the IDefender interface would do. It could be a HiveDefender object, a NectarDefender object, or even a HelpfulLadyBug object. As long as it implements the IDefender interface, that <u>guarantees</u> that it has a Defend method. You just need to call it.</p>
<p>That’s where <strong>interface references</strong> come in. You can use one to refer to an object that implements the interface you need and you’ll always be sure that it has the right methods for your purpose—even if you don’t know much else about it.</p>
<section data-pdf-bookmark="If you try to instantiate an interface, your code won’t build" data-type="sect2"><div class="sect2" id="if_you_try_to_instantiate_an_interfaceco">
<h2>If you try to instantiate an interface, your code won’t build</h2>
<p>You can create an array of IWorker references, but you can’t instantiate an interface. What you <em>can</em> do is point those references at new instances of classes that implement IWorker. Now you can have an array that holds many different kinds of objects!</p>
<p>If you try to instantiate an interface, the compiler will complain.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/366fig01.png"/>
<h6/>
</div></figure>
<p>You can’t use the <code>new</code> keyword with an interface, which makes sense—the methods and properties don’t have any implementation. If you could create an object from an interface, how would it know how to behave?</p>
</div></section>
<section data-pdf-bookmark="Use the interface to reference an object you already have" data-type="sect2"><div class="sect2" id="use_the_interface_to_reference_an_object">
<h2>Use the interface to <u>reference</u> an object you already have</h2>
<p>So you can’t instantiate an interface...but you <strong><em>can</em> use the interface to make a reference variable</strong>, and use it to reference an object that <strong><em>implements</em></strong> the interface.</p>
<p>Remember how you could pass a Tiger reference to any method that expects an Animal, because Tiger extends Animal? Well, this is the same thing—you can use an instance of a class that implements IDefender in any method or statement that expects an IDefender.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/366fig002.png"/>
<h6/>
</div></figure>
<p>These are ordinary <code>new</code> statements, just like you’ve been using for most of the book. The only difference is that you’re <strong>using a variable of type IDefender</strong> to reference them.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/366fig02.png"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="pool_puzzle-idd0001">
<h5>Pool Puzzle</h5>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/puzzle.png"/>
<h6/>
</div></figure>
<p>Your <strong><em>job</em></strong> is to take code snippets from the pool and place them into the blank lines in the code and output. You may use the same snippet more than once, and you won’t need to use all the snippets. Your <strong><em>goal</em></strong> is to make a set of classes that will compile and run and produce the output listed.</p>
</div></aside>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/367fig01.png"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="pool_puzzle_solution-idd0001">
<h5>Pool Puzzle Solution</h5>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/puzzle.png"/>
<h6/>
</div></figure>
<p>Your <strong><em>job</em></strong> is to take code snippets from the pool and place them into the blank lines in the code and output. You may use the same snippet more than once, and you won’t need to use all the snippets. Your <strong><em>goal</em></strong> is to make a set of classes that will compile and run and produce the output listed.</p>
</div></aside>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Output</strong></p>
<p><strong>5 Acts</strong></p>
<p><strong>7 Clowns</strong></p>
<p><strong>7 Of2016</strong></p>
</div>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/368fig01.png"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="Interface references are ordinary object references" data-type="sect1"><div class="sect1" id="interface_references_are_ordinary_object">
<h1>Interface references are ordinary object references</h1>
<p><a data-primary="garbage collection" data-type="indexterm" id="idm46402342837352"/><a data-primary="objects" data-secondary="references" data-type="indexterm" id="idm46402342835992"/><a data-primary="references" data-secondary="object" data-type="indexterm" id="idm46402342834984"/>You already know all about how objects live in the heap. When you work with an interface reference, it’s just another way to refer to the same objects you’ve already been using. Let’s take a closer look at how interfaces would be used to reference objects in the heap.</p>
<ol>
<li><p><strong>We’ll start by creating objects as usual.</strong></p>
<p>Here’s code to create some bees: it creates an instance of HiveDefender and an instance of NectarDefender—and both of those classes implement the IDefender interface.</p>
<pre data-type="programlisting">HiveDefender bertha = new HiveDefender();
NectarDefender gertie = new NectarDefender();</pre>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/369fig01.png"/>
<h6/>
</div></figure>
</li>
<li><p><strong>Next we’ll add IDefender references.</strong></p>
<p>You can use interface references just like you use any other reference type. These two statements use interfaces to create <strong>new references to existing objects</strong>. You can only point an interface reference at an instance of a class that implements it.</p>
<pre data-type="programlisting">IDefender def2 = gertie;
IDefender captain = bertha;</pre>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/369fig02.png"/>
<h6/>
</div></figure>
</li>
<li><p><strong>An interface reference will keep an object alive.</strong></p>
<p>When there aren’t any references pointing to an object, it disappears. There’s no rule that says those references all have to be the same type! An interface reference is just as good as any other object reference when it comes to keeping track of objects so they don’t get garbage-collected.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/369fig03.png"/>
<h6/>
</div></figure>
</li>
<li><p><strong>Use an interface like any other type.</strong></p>
<p>You can create a new object with a <code>new</code> statement and assign it straight to an interface reference variable in a single line of code. You can <strong>use interfaces to create arrays</strong> that can reference any object that implements the interface.</p>
<pre data-type="programlisting">IDefender[] defenders = new IDefender[3];
defenders[0] = new HiveDefender();
defenders[1] = bertha;
defenders[2] = captain;</pre>
</li>
</ol>
</div></section>
<section data-pdf-bookmark="The RoboBee 4000 can do a worker bee’s job without using valuable honey" data-type="sect1"><div class="sect1" id="the_robobee_4000_can_do_a_worker_beeapos">
<h1>The RoboBee 4000 can do a worker bee’s job without using valuable honey</h1>
<p><a data-primary="Beehive Management System project" data-secondary="RoboBee class" data-type="indexterm" id="idm46402342815656"/><a data-primary="RoboBee class" data-type="indexterm" id="idm46402342814152"/>Bee-siness was booming last quarter, and the Queen had enough spare budget to buy the latest in hive technology: the RoboBee 4000. It can do the work of three different bees, and best of all it doesn’t consume any honey! It’s not exactly environmentally friendly, though—it runs on gas. So how can we use interfaces to integrate RoboBee into the hive’s day-to-day business?</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/370fig01.png"/>
<h6/>
</div></figure>
<pre data-type="programlisting">class Robot
{
   public void ConsumeGas() {
     <span style="color:#9D9EA0;">// Not environmentally friendly</span>
   }
}
class RoboBee4000 : Robot, IWorker
{
   public string Job {
     get { return "Egg Care"; }
   }
   public void WorkTheNextShift()
   {
     <span style="color:#9D9EA0;">// Do the work of three bees!</span>
   }
}</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Let’s take a close look at the class diagram to see how we can use an interface to integrate a RoboBee class into the Beehive Management System. Remember, we’re using dotted lines to show that an object implements an interface.</p>
</div>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/370fig02.png"/>
<h6/>
</div></figure>
<p>Now all we need to do is modify the Beehive Management System to use the IWorker interface instead of the abstract Bee class any time it needs to reference a worker.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0024">
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>
<p><a data-primary="exercises" data-secondary="interfaces" data-type="indexterm" id="idm46402342801672"/><a data-primary="interfaces" data-secondary="exercises on" data-type="indexterm" id="idm46402342800488"/>Modify the Beehive Management System to use the IWorker interface instead of the abstract Bee class any time it needs to reference a worker.</p>
<p>Your job is to add the IWorker interface to your project, then refactor your code to make the Bee class implement it and modify the Queen class so it only uses IWorker references. Here’s what the updated class diagram looks like:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/371fig01.png"/>
<h6/>
</div></figure>
<p>Here’s what you’ll need to do:</p>
<ul>
<li><p>Add the IWorker interface to your Beehive Management System project.</p></li>
<li><p>Modify the Bee class to implement IWorker.</p></li>
<li><p>Modify the Queen class to replace any Bee reference with an IWorker reference.</p></li>
</ul>
<p>If that doesn’t sound like much code, that’s because it’s not. After you add the interface, you only need to change one line of code in the Bee class and three lines of code in the Queen class.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0015">
<h5><span class="inlineimage"><img alt="Images" src="assets/Common-1.png"/></span> Exercise Solution</h5>
<p>Your job was to modify the Beehive Management System to use the IWorker interface instead of the abstract Bee class any time it needs to reference a worker. You had to add the IWorker interface, then modify the Bee and Queen classes. This didn’t take a lot of code—that’s because using interfaces doesn’t require a lot of extra code.</p>
<blockquote>
<p><strong>Any class can implement <u>ANY</u> interface as long as it keeps the promise of implementing the interface’s methods and properties.</strong></p>
</blockquote>
<p><strong>First you added the IWorker interface to your project</strong></p>
<pre data-type="programlisting">interface IWorker
{
    string Job { get; }
    void WorkTheNextShift();
}</pre>
<p><strong>Then you modified Bee to implement the IWorker interface</strong></p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">abstract class Bee</span> <strong>: IWorker</strong>
<span style="color:#9D9EA0;">{</span>
<span style="color:#9D9EA0;">    /* The rest of the class stays the same */</span>
<span style="color:#9D9EA0;">}</span></pre>
<p>And finally, you modified Queen to use IWorker references instead of Bee references</p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">class Queen : Bee</span>
<span style="color:#9D9EA0;">{</span>
    <span style="color:#9D9EA0;">private</span> <strong>IWorker</strong><span style="color:#9D9EA0;">[] workers = new</span> <strong>IWorker</strong><span style="color:#9D9EA0;">[0];</span>

    <span style="color:#9D9EA0;">private void AddWorker</span>(<strong>IWorker</strong> <span style="color:#9D9EA0;">worker)</span>
    <span style="color:#9D9EA0;">{</span>
        <span style="color:#9D9EA0;">if (unassignedWorkers &gt;= 1)</span>
        <span style="color:#9D9EA0;">{</span>
            <span style="color:#9D9EA0;">unassignedWorkers--;</span>
            <span style="color:#9D9EA0;">Array.Resize(ref workers, workers.Length + 1);</span>
            <span style="color:#9D9EA0;">workers[workers.Length - 1] = worker;</span>
        <span style="color:#9D9EA0;">}</span>
    <span style="color:#9D9EA0;">}</span>

    <span style="color:#9D9EA0;">private string WorkerStatus(string job)</span>
    <span style="color:#9D9EA0;">{</span>
        <span style="color:#9D9EA0;">int count = 0;</span>
        <span style="color:#9D9EA0;">foreach (<strong>IWorker</strong> worker in workers)</span>
            <span style="color:#9D9EA0;">if (worker.Job == job) count++;</span>
        <span style="color:#9D9EA0;">string s = "s";</span>
        <span style="color:#9D9EA0;">if (count == 1) s = "";</span>
        <span style="color:#9D9EA0;">return $"{count} {job} bee{s}";</span>
    <span style="color:#9D9EA0;">}</span>

   <span style="color:#9D9EA0;">/* Everything else in the Queen class stays the same */</span>
<span style="color:#9D9EA0;">}</span></pre>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Try modifying WorkerStatus to change the IWorker in the foreach loop back to a Bee:</strong></p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">foreach</span> (Bee <span style="color:#9D9EA0;">worker in workers)</span></pre>
<p><strong>Then run your code—it works just fine! Now try changing it to a NectarCollector. This time you get a System.InvalidCastException. Why do you think that happens?</strong></p>
</div>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0020">
<h5>there are no Dumb Questions</h5>
<p><a data-primary="automatic properties" data-type="indexterm" id="idm46402342749400"/><a data-primary="get accessor (getter)" data-type="indexterm" id="idm46402342748264"/><a data-primary="interfaces" data-secondary="public" data-type="indexterm" id="idm46402342747176"/><a data-primary="properties" data-secondary="in interfaces" data-type="indexterm" id="idm46402342746120"/><a data-primary="public interfaces" data-type="indexterm" id="idm46402342744968"/><a data-primary="set accessor (setter)" data-type="indexterm" id="idm46402342744120"/><strong>Q: When I put a property in an interface, it looks just like an automatic property. Does that mean I can only use automatic properties when I implement an interface?</strong></p>
<p><strong>A:</strong> No, not at all. It’s true that a property inside an interface looks very similar to an automatic property—like the Job property in the IWorker interface on the next page—but they’re definitely not automatic properties. You could implement the Job property like this:</p>
<pre data-type="programlisting">public Job {
    get; private set; 
}</pre>
<p>You need that private set, because automatic properties require you to have both a set and a get (even if they’re private). Alternatively, you could implement it like this:</p>
<pre data-type="programlisting">public Job {
  get {
    return "Egg Care";    
  }
}</pre>
<p>and the compiler will be perfectly happy with that. You can also add a setter—the interface requires a get, but it doesn’t say you can’t have a set, too. (If you use an automatic property to implement it, you can decide for yourself whether you want the set to be private or public.)</p>
<p><strong>Q: Isn’t it weird that there are no access modifiers in my interfaces? Should I be marking methods and properties public?</strong></p>
<p><strong>A:</strong> You don’t need the access modifiers because everything in an interface is automatically public by default. If you have an interface that has this:</p>
<pre data-type="programlisting">void Honk();</pre>
<p>It says that you need a public void method called Honk, but it doesn’t say what that method needs to do. It can do anything at all—no matter what it does, the code will compile as long as some method is there with the right signature.</p>
<p>Does that look familiar? That’s because we’ve seen it before—in abstract classes, back in <a href="ch06.html#inheritance_your_objectapostrophes_famil">#inheritance_your_objectapostrophes_famil</a>. When you declare methods or properties in an interface without bodies, they’re <strong>automatically public and abstract</strong>, just like the abstract members that you used in your abstract classes. They work just like any other abstract methods or properties—because even though you’re not using the <strong>abstract</strong> keyword, it’s implied. That’s why every class that implements an interface <strong>must implement every member</strong>.</p>
<p>The folks who designed C# could have made you mark each of those members public and abstract, but it would have been redundant. So they made the members public and abstract by default to make it all clearer.</p>
</div></aside>
<blockquote>
<p><strong>Everything in a public interface is automatically public, because you’ll use it to define the public methods and properties of any class that implements it.</strong></p>
</blockquote>
</div></section>
<section data-pdf-bookmark="The IWorker’s Job property is a hack" data-type="sect1"><div class="sect1" id="the_iworkerapostrophes_job_property_is_a">
<h1>The IWorker’s Job property is a <u>hack</u></h1>
<p><a data-primary="hack" data-type="indexterm" id="idm46402342734168"/><a data-primary="separation of concerns" data-type="indexterm" id="idm46402342731480"/>The Beehive Management System uses the Worker.Job property like this: <code>if (worker.Job == job)</code></p>
<p>Does something seem a bit odd about that? It does to us. We think it’s a <strong>hack</strong>, or a clumsy, inelegant solution. Why do we think the Jobproperty is a hack? Imagine what would happen if you had a typo like this:</p>
<pre data-type="programlisting">class EggCare : Bee {
   public EggCare(Queen queen) : base("Egg C<u><strong>ra</strong></u>e")

   <span style="color:#9D9EA0;">// Oops! Now we’ve got a bug in the EggCare class,</span>
   <span style="color:#9D9EA0;">// even though the rest of the class is the same.</span>
}</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>We misspelled “Egg Care”—that’s a mistake anyone could make! Can you imagine how hard it would be to track down the bugs that this simple typo would cause?</p>
</div>
<p>Now the code has no way to figure out if a Worker reference is pointing to an instance of EggCare. That would be a really nasty bug to try to fix. So we know this code is error-prone...but how is it a hack?</p>
<p>We’ve talked about <strong>separation of concerns</strong>: all of the code to address a specific problem should be kept together. The Job property <strong><em>violates the principle of separation of concerns</em></strong>. If we have a Worker reference, we shouldn’t need to check a string to figure out whether it points to an EggCare object or a NectarCollector object. The Job property returns “Egg Care” for an EggCare object and “Nectar Collector” for a NectarCollector object and is <u>only</u> used to check the object’s type. But we’re already keeping track of that information: <strong><em>it’s the object’s type</em></strong>.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/373fig01.png"/>
<h6/>
</div></figure>
<p><strong>That’s right! C# gives you tools to work with types.</strong></p>
<p>You don’t ever need a property like Job to keep track of the type of a class with strings like “Egg Care” or “Nectar Collector”. C# gives you tools that let you check the type of an object.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="hackcomma_noundot">
<h5>hack, noun.</h5>
<p>in engineering, an ugly, clumsy, or inelegant solution to a problem that will be difficult to maintain. <em>Lila spent an extra hour refactoring the <strong>hack</strong> in her code so she wouldn’t have to deal with bugs later.</em> (synonym: kludge [klooj])</p>
</div></aside>
</div></section>
<section data-pdf-bookmark="Use “is” to check the type of an object" data-type="sect1"><div class="sect1" id="use_quotation_markisquotation_mark_to_ch">
<h1>Use “is” to check the type of an object</h1>
<p><a data-primary="is keyword" data-type="indexterm" id="idm46402342717672"/><a data-primary="objects" data-secondary="checking type of" data-type="indexterm" id="idm46402342714040"/>What would it take to get rid of the Job property hack? Right now the Queen has her <code>workers</code> array, which means that all she can get is an IWorker reference. She uses the Job property to figure out which workers are EggCare workers and which ones are NectarCollectors:</p>
<pre data-type="programlisting">foreach (IWorker worker in workers) {
if (worker.Job == "Egg Care") {
    WorkNightShift((EggCare)worker);
}

void WorkNightShift(EggCare worker) {
   <span style="color:#9D9EA0;">// Code to work the night shift</span>
}</pre>
<p>We just saw how that code will fail miserably if we accidentally type “Egg Crae” instead of “Egg Care”. And if you set a HoneyManufacturer’s Job to “Egg Care” accidentally, you’ll get one of those InvalidCastException errors. It would be great if the compiler could detect problems like that as soon as we write them, just like we use private or abstract members to get it to detect other kinds of problems.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/375fig01.png"/>
<h6/>
</div></figure>
<p>C# gives us a tool to do exactly that: we can use the <code><strong>is</strong></code> <strong>keyword</strong> to check an object’s type. If you have an object reference, you can <strong>use <code>is</code> to find out if it’s a specific type:</strong></p>
<pre data-type="programlisting">  <strong>objectReference is ObjectType newVariable</strong></pre>
<p>If the object that objectReference is pointing to has ObjectType as its type, then it returns true and creates a new reference called <code>newVariable</code> with that type.</p>
<p>So if the Queen wants to find all of her EggCare workers and have them work a night shift, she can use the <code>is</code> keyword:</p>
<pre data-type="programlisting">  <strong>foreach (IWorker worker in workers) {</strong>
      <strong>if (worker is EggCare eggCareWorker) {</strong>
          <strong>WorkNightShift(eggCareWorker);</strong>
      <strong>}</strong>
  <strong>}</strong></pre>
<p>The <code>if</code> statement in this loop uses <code>is</code> to check each IWorker reference. Look closely at the conditional test:</p>
<pre data-type="programlisting">    worker is EggCare eggCareWorker</pre>
<p>If the object referenced by the <code>worker</code> variable is an EggCare object, that test returns true, and the <code>is</code> statement assigns the reference to a new EggCare variable called <code>eggCareWorker</code>. This is just like casting, but the <code>is</code> statement is <strong>doing the casting for you <u>safely.</u></strong></p>
<blockquote>
<p><strong>The <span style="color:#9D9EA0;"><u>is</u></span> keyword returns true if an object matches a type, and can declare a variable with a reference to that object.</strong></p>
</blockquote>
</div></section>
<section data-pdf-bookmark="Use “is” to access methods in a subclass" data-type="sect1"><div class="sect1" id="use_quotation_markisquotation_mark_to_ac">
<h1>Use “is” to access methods in a subclass</h1>
<p><a data-primary="methods" data-secondary="accessing with is keyword" data-type="indexterm" id="idm46402342692280"/><a data-primary="subclasses" data-secondary="using is keyword to access methods in" data-type="indexterm" id="idm46402342690824"/>Let’s pull together everything we’ve talked about so far into a new project by creating a simple class model with Animal at the top, Hippo and Canine classes that extend Animal, and a Wolf class that extends Canine.</p>
<p><em><strong>Do this!</strong></em></p>
<p>Create a new console app and <strong>add these Animal, Hippo, Canine, and Wolf classes</strong> to it:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/376fig01.png"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>In <a href="ch06.html#inheritance_your_objectapostrophes_famil">#inheritance_your_objectapostrophes_famil</a> we learned that we could use different references to call different methods on the same object. When you didn’t use the override and virtual keywords, if your reference variable had the type Locksmith it called Locksmith.ReturnContents, but if it was a JewelThief type it called JewelThief.ReturnContents. We’re doing something similar here.</strong></p>
</div>
<p>Next, fill in the Main method. Here’s what it does:</p>
<ul>
<li><p>It creates an array of Hippo and Wolf objects, then uses a foreach loop to go through each of them.</p></li>
<li><p>It uses the Animal reference to call the MakeNoise method.</p></li>
<li><p>If it’s a Hippo, the Main method calls its Hippo.Swim method.</p></li>
<li><p>If it’s a Wolf, the Main method calls its Wolf.HuntInPack method.</p></li>
</ul>
<p>The problem is that if you have an Animal reference pointing to a Hippo object, you can’t use it to call Hippo.Swim:</p>
<pre data-type="programlisting">    Animal animal = new Hippo();
    animal.Swim(); <span style="color:#9D9EA0;">// &lt;-- this line will not compile!</span></pre>
<p>It doesn’t matter that your object is a Hippo. If you’re using an Animal variable, you can only access the fields, methods, and properties of Animal.</p>
<p>Luckily, there’s a way around this. If you’re 100% sure that you have a Hippo object, then you can <strong>cast your Animal reference to a Hippo</strong>—and then you can access its Hippo.Swim method:</p>
<pre data-type="programlisting">    Hippo hippo = (Hippo)animal;
    hippo.Swim(); <span style="color:#9D9EA0;">// It’s the same object, but now you can call the Hippo.Swim method.</span></pre>
<p>Here’s <strong>the Main method that uses the</strong> <code><strong>is</strong></code> <strong>keyword</strong> to call Hippo.Swim or Wolf.HuntInPack:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/377fig01.png"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Take a few minutes and use the debugger to really understand what’s going on here. Put a breakpoint on the first line of the foreach loop; add watches for <code>animal, hippo</code>, and <code>wolf</code>; and step through it.</strong></p>
</div>
</div></section>
<section data-pdf-bookmark="What if we want different animals to swim or hunt in packs?" data-type="sect1"><div class="sect1" id="what_if_we_want_different_animals_to_swi">
<h1>What if we want different animals to swim or hunt in packs?</h1>
<p>Did you know that lions are pack hunters? Or that tigers can swim? And what about dogs, which hunt in packs AND swim? If we want to add the Swim and HuntInPack methods to all of the animals in our zoo simulator model that need them, the  foreach loop is just going to get longer and longer.</p>
<p>The beauty of defining an abstract method or property in a base class and overriding it in a subclass is that <strong>you don’t need to know anything about the subclass</strong> to use it. You can add all of the Animal subclasses you want, and this loop will still work:</p>
<pre data-type="programlisting">foreach (Animal animal in animals) {
    animal.MakeNoise();
}</pre>
<p>The MakeNoise method will <strong>always be implemented by the object.</strong></p>
<p>In fact, you can treat it like a <strong>contract</strong> that the compiler enforces.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>So is there a way to treat the HuntInPack and Swim methods like contracts too, so we can use more general variables with them­—just like we do with the Animal class?</strong></p>
</div>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/378fig01.png"/>
<h6/>
</div></figure>
</div></section>
<section data-pdf-bookmark="Use interfaces to work with classes that do the same job" data-type="sect1"><div class="sect1" id="use_interfaces_to_work_with_classes_that">
<h1>Use interfaces to work with classes that <u>do the same job</u></h1>
<p><a data-primary="interfaces" data-secondary="defining two" data-type="indexterm" id="idm46402342658824"/><a data-primary="is keyword" data-type="indexterm" id="idm46402342657240"/>Classes that swim have a Swim method, and classes that hunt in packs have a HuntInPack method. OK, that’s a good start. Now we want to write code that works with objects that swim or hunt in packs­—and that’s where interfaces shine. Let’s use the <code><strong>interface</strong></code> <strong>keyword</strong> to define two interfaces and <strong>add an abstract member</strong> to each interface:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/379fig01.png"/>
<h6/>
</div></figure>
<p><strong><em>Add this!</em></strong></p>
<p>Next, <strong>make the Hippo and Wolf classes implement the interfaces</strong> by adding an interface to the end of each class declaration. Use a <strong>colon</strong> (:) to implement an interface, just like you do when you’re extending a class. If it’s already extending a class, you just add a comma after the superclass and then the interface name. Then you just need to make sure the class <strong>implements <u>all</u> the interface members</strong>, or you’ll get a compiler error.</p>
<pre data-type="programlisting">    class Hippo : Animal, <span style="color:#9D9EA0;">ISwimmer</span> {
<span style="color:#9D9EA0;">        /* The code stays exactly the same - it MUST include the Swim method */</span>
    }

    class Wolf : Canine, <span style="color:#9D9EA0;">IPackHunter</span> {
<span style="color:#9D9EA0;">        /* The code stays exactly the same - it MUST include the HuntInPack method */</span>
    }</pre>
<section data-pdf-bookmark="Use the “is” keyword to check if the Animal is a swimmer or pack hunter" data-type="sect2"><div class="sect2" id="use_the_quotation_markisquotation_mark_k">
<h2>Use the “is” keyword to check if the Animal is a swimmer or pack hunter</h2>
<p>You can use the <code><strong>is</strong></code> <strong>keyword</strong> to check if a specific object implements an interface—and it works no matter what other classes that object implements. If the <code>animal</code> variable references an object that implements the ISwimmer interface, then <code>animal is ISwimmer</code> will return true and you can safely cast it to an ISwimmer reference to call its Swim method:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/379fig02.png"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="Safely navigate your class hierarchy with “is”" data-type="sect1"><div class="sect1" id="safely_navigate_your_class_hierarchy_wit">
<h1><u>Safely</u> navigate your class hierarchy with “is”</h1>
<p><a data-primary="class hierarchy" data-type="indexterm" id="idm46402342637544"/><a data-primary="is keyword" data-type="indexterm" id="idm46402342636552"/>When you did the exercise to replace Bee with IWorker in the Beehive Management System, were you able to get it to throw the InvalidCastException? <strong><em>Here’s why it threw the exception.</em></strong></p>
<p><span class="inlineimage"><img alt="Images" src="assets/380fig01.png"/></span> <strong>You <u>can</u> safely convert a NectarCollector reference to an IWorker reference.</strong></p>
<p>All NectarCollectors are Bees (meaning they extend the Bee base class), so you can always use the = operator to take a reference to a NectarCollector and assign it to a Bee variable.</p>
<pre data-type="programlisting">  HoneyManufacturer lily = new HoneyManufacturer();
  Bee hiveMember = lily;</pre>
<p>And since Bee implements the IWorker interface, you can safely convert it to an IWorker reference too.</p>
<pre data-type="programlisting">  HoneyManufacturer daisy = new HoneyManufacturer();
  IWorker worker = daisy;</pre>
<p>Those type conversions are <u>safe</u>: they’ll never throw an IllegalCastException because they only assign more specific objects to variables with more general types <em>in the same class hierarchy</em>.</p>
<p><span class="inlineimage"><img alt="Images" src="assets/380fig02.png"/></span> <strong>You <u>can’t</u> safely convert a Bee reference to a NectarCollector reference.</strong></p>
<p>You can’t <u>safely</u> go in the other direction—converting a Bee to a NectarCollector—because not all Bee objects are instances of NectarCollector. A HoneyManufacturer is <em>definitely not</em> a NectarCollector. So this:</p>
<pre data-type="programlisting">  IWorker pearl = new HoneyManufacturer();
  NectarCollector irene = (NectarCollector)pearl;</pre>
<p>is an <strong>invalid cast</strong> that tries to cast an object to a variable that doesn’t match its type.</p>
<p><span class="inlineimage"><img alt="Images" src="assets/380fig03.png"/></span> <strong>The “is” keyword lets you convert types <u>safely.</u></strong></p>
<p>Luckily, <strong>the <code>is</code> keyword is safer than casting with parentheses</strong>. It lets you check that the type matches, and only casts the reference to a new variable if the types match.</p>
<pre data-type="programlisting">  if (pearl is NectarCollector irene) {
     <span style="color:#9D9EA0;">/* Code that uses a NectarCollector object */</span>
  }</pre>
<p>This code will never throw an InvalidCastException because it only executes the code that uses a NectarCollector object if <code>pearl</code> is a NectarCollector.</p>
</div></section>
<section data-pdf-bookmark="C# has another tool for safe type conversion: the “as” keyword" data-type="sect1"><div class="sect1" id="chash_has_another_tool_for_safe_type_con">
<h1>C# has another tool for safe type conversion: the “as” keyword</h1>
<p><a data-primary="as keyword" data-type="indexterm" id="idm46402342615320"/><a data-primary="exercises" data-secondary="Sharpen your pencil" data-tertiary="is keyword" data-type="indexterm" id="idm46402342613800"/><a data-primary="is keyword" data-type="indexterm" id="idm46402342612440"/><a data-primary="null" data-type="indexterm" id="idm46402342611576"/><a data-primary="Sharpen Your Pencil exercises" data-secondary="is keyword" data-type="indexterm" id="idm46402342610712"/>C# gives you another tool for safe casting: the <strong><code>as</code> keyword</strong>. It also does safe type conversion. Here’s how it works. Let’s say you have an IWorker reference called <code>pearl</code>, and you want to safely cast it to a NectarCollector variable <code>irene</code>. You can convert it safely to a NectarCollector like this:</p>
<pre data-type="programlisting"> NectarCollector irene = pearl as NectarCollector;</pre>
<p>If the types are compatible, this statement sets the <code>irene</code> variable to reference the same object as the <code>pearl</code> variable. If the type of the object doesn’t match the type of the variable, it doesn’t throw an exception. Instead, it just <strong>sets the variable to <code>null</code></strong>, which you can check with an <code>if</code> statement:</p>
<pre data-type="programlisting"> if (irene != null) {
    <span style="color:#9D9EA0;">/* Code that uses a NectarCollector object */</span>
 }</pre>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="watch_itexclamation_mark-idd0006">
<h5><span class="inlineimage"><img alt="Images" src="assets/watchit.png"/></span> Watch it!</h5>
<p><strong>The “is” keyword works differently in very old versions of C#.</strong></p>
<p>The <code><em>is</em></code> keyword has been in C# for a long time, but it wasn’t until C# 7.0 was released in 2017 that <code><em>is</em></code> let you declare a new variable. So if you’re using Visual Studio 2015, you won’t be able to do this:   <code><em>if (pearl is NectarCollector irene) { ... }</em></code></p>
<p>Instead, you’ll need to use the <code><em>as</em></code> keyword to do the conversion, then test the result to see if it’s <code><em>null</em></code>:</p>
<pre data-type="programlisting">NectarCollector irene = pearl as NectarCollector;
if (irene != null) { <span style="color:#9D9EA0;"><em>/* code that uses the irene reference */</em></span> <em>}</em></pre>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-idd0031">
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil</h5>
<p>The array on the left uses types from the Bee class model. Two of these types won’t compile—cross them out. On the right are three statements that use the <code>is</code> keyword. Write down which values of <code>i</code> would make each of them evaluate to <code>true</code>.</p>
<pre data-type="programlisting">    IWorker[] bees = new IWorker[8];
    bees[0] = new HiveDefender();
    bees[1] = new NectarCollector();
    bees[2] = bees[0] as IWorker;
    bees[3] = bees[1] as NectarCollector;
    bees[4] = IDefender;
    bees[5] = bees[0];
    bees[6] = bees[0] as Object;
    bees[7] = new IWorker();</pre>
<ol>
<li><p><code>(bees[i] is IDefender)</code></p>
<p>..........................................</p></li>
<li><p><code>(bees[i] is IWorker)</code></p>
<p>..........................................</p></li>
<li><p><code>(bees[i] is Bee)</code></p>
<p>..........................................</p></li>
</ol>
</div></aside>
</div></section>
<section data-pdf-bookmark="Use upcasting and downcasting to move up and down a class hierarchy" data-type="sect1"><div class="sect1" id="use_upcasting_and_downcasting_to_move_up">
<h1>Use upcasting and downcasting to move up and down a class hierarchy</h1>
<p><a data-primary="class hierarchy" data-type="indexterm" id="idm46402342580616"/><a data-primary="downcasting" data-secondary="moving up/down class hierarchy using" data-type="indexterm" id="idm46402342579560"/><a data-primary="upcasting" data-secondary="moving up/down class hierarchy using" data-type="indexterm" id="idm46402342578696"/>Class diagrams typically have the base class at the top, its subclasses below it, their subclasses below them, etc. The higher a class is in the diagram, the more abstract it is; the lower the class is in the diagram, the more concrete it is. “Abstract higher, concrete lower” isn’t a hard-and-fast rule—it’s a <strong>convention</strong> that makes it easier for us to see at a glance how our class models work.</p>
<p>In <a href="ch06.html#inheritance_your_objectapostrophes_famil">#inheritance_your_objectapostrophes_famil</a> we talked about how you can always use a subclass in place of the base class it inherits from, but you can’t always use a base class in place of a subclass that extends it. You can also think about this another way: in a sense, you’re <strong>moving up or down the class hierarchy</strong>. For example, if you start with this:</p>
<pre data-type="programlisting">   NectarCollector ida = new NectarCollector();</pre>
<p>You can use the = operator to do normal assignment (for superclasses) or casting (for interfaces). That’s like <strong><em>moving up</em></strong> the class hierarchy. This is called <strong>upcasting</strong>:</p>
<pre data-type="programlisting">  <span style="color:#9D9EA0;">// Upcast the NectarCollector to a Bee</span>
  Bee beeReference = ida;

  <span style="color:#9D9EA0;">// This upcast is safe because all Bees are IWorkers</span>
  IWorker worker = (IWorker)beeReference;</pre>
<p>And you can navigate in the other direction by using the <code>is</code> operator to safely <strong><em>move down</em></strong> the class hierarchy. This is called <strong>downcasting</strong>:</p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">  // Downcast the IWorker to NectarCollector</span>
  if (worker is NectarCollector rose) { <span style="color:#9D9EA0;">/* code that uses the rose reference */</span> }</pre>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/382fig01.png"/>
<h6/>
</div></figure>
</div></section>
<section data-pdf-bookmark="A quick example of upcasting" data-type="sect1"><div class="sect1" id="a_quick_example_of_upcasting">
<h1>A quick example of upcasting</h1>
<p><a data-primary="exercises" data-secondary="Sharpen your pencil" data-tertiary="is keyword" data-type="indexterm" id="idm46402342563912"/><a data-primary="is keyword" data-type="indexterm" id="idm46402342562472"/><a data-primary="Sharpen Your Pencil exercises" data-secondary="is keyword" data-type="indexterm" id="idm46402342561672"/><a data-primary="upcasting" data-secondary="example of" data-type="indexterm" id="idm46402342560520"/>If you’re trying to figure out how to cut down your energy bill each month, you don’t really care what each of your appliances does—you only care that they consume power. So if you were writing a program to monitor your electricity consumption, you’d probably just write an Appliance class. But if you needed to distinguish a coffee maker from an oven, you’d have to build a class hierarchy and add the methods and properties that are specific to a coffee maker or oven to your CoffeeMaker and Oven classes, which would inherit from an Appliance class that has their common methods and properties.</p>
<p>Then you could write a method to monitor the power consumption:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/383fig02.png"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/383fig01.png"/>
<h6/>
</div></figure>
<p>If you wanted to use that method to monitor the power consumption for a coffee maker, you could create an instance of CoffeeMaker and pass its reference directly to the method:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/383fig03.png"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-idd015">
<h5><span class="inlineimage"><img alt="Images" src="assets/Common.png"/></span> Sharpen your pencil Solution</h5>
<p>The array on the left uses types from the Bee class model. Two of these types won’t compile—cross them out. On the right are three statements that use the <code>is</code> keyword. Write down which values of <code>i</code> would make each of them evaluate to <code>true</code>.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/383fig04.png"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-pdf-bookmark="Upcasting turns your CoffeeMaker into an Appliance" data-type="sect1"><div class="sect1" id="upcasting_turns_your_coffeemaker_into_an">
<h1>Upcasting turns your CoffeeMaker into an Appliance</h1>
<p><a data-primary="Appliance project" data-type="indexterm" id="idm46402342543864"/><a data-primary="base classes" data-secondary="upcasting" data-type="indexterm" id="idm46402342542552"/><a data-primary="interfaces" data-secondary="upcasting and" data-type="indexterm" id="idm46402342541432"/><a data-primary="objects" data-secondary="upcasting" data-type="indexterm" id="idm46402342540456"/><a data-primary="subclasses" data-secondary="upcasting" data-type="indexterm" id="idm46402342539448"/><a data-primary="upcasting" data-secondary="about" data-type="indexterm" id="idm46402342538264"/>When you substitute a subclass for a base class—like substituting a CoffeeMaker for an Appliance, or a Hippo for an Animal—it’s called <strong>upcasting</strong>. It’s a really powerful tool to use when you build class hierarchies. The only drawback to upcasting is that you can only use the properties and methods of the base class. In other words, when you treat a CoffeeMaker like an Appliance, you can’t tell it to make coffee or fill it with water. You <em>can</em> tell whether or not it’s plugged in, since that’s something you can do with any Appliance (which is why the PluggedIn property is part of the Appliance class).</p>
<ol>
<li><p><strong>Let’s create some objects.</strong></p>
<p>Let’s start by creating instances of the CoffeeMaker and Oven classes as usual:</p>
<pre data-type="programlisting">  CoffeeMaker misterCoffee = new CoffeeMaker();
  Oven oldToasty = new Oven();</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>You don’t need to add this code to an app—just read through the code and start to get a sense of how upcasting and downcasting work. You’ll get <span style="color:#9D9EA0;"><u>lots</u></span> of practice with them later in the book.</strong></p>
</div>
</li>
<li><p><strong>What if we want to create an array of Appliances?</strong></p>
<p>You can’t put a CoffeeMaker in an Oven[] array, and you can’t put an Oven in a CoffeeMaker[] array. You <strong><em>can</em></strong> put both of them in an Appliance[] array:</p>
<pre data-type="programlisting">  Appliance[] kitchenWare = new Appliance[2];
  kitchenWare[0] = misterCoffee;
  kitchenWare[1] = oldToasty;</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You can use upcasting to create an array of Appliances that can hold both CoffeeMakers and Ovens.</p>
</div>
</li>
<li><p><strong>But you can’t treat just <u>any</u> Appliance like an Oven.</strong></p>
<p>When you’ve got an Appliance reference, you can <strong>only</strong> access the methods and properties that have to do with appliances. You <strong>can’t</strong> use the CoffeeMaker methods and properties through the Appliance reference <strong><em>even if you know it’s really a CoffeeMaker</em></strong>. So these statements will work just fine, because they treat a CoffeeMaker object like an Appliance:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/384fig001.png"/>
<h6/>
</div></figure>
<p>your code won’t compile, and the IDE will display an error:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/384fig01.png"/>
<h6/>
</div></figure>
<p>Once you upcast from a subclass to a base class, you can only access the methods and properties that <strong>match the reference</strong> that you’re using to access the object.</p></li>
</ol>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/384fig02.png"/>
<h6/>
</div></figure>
</div></section>
<section data-pdf-bookmark="Downcasting turns your Appliance back into a CoffeeMaker" data-type="sect1"><div class="sect1" id="downcasting_turns_your_appliance_back_in">
<h1>Downcasting turns your Appliance back into a CoffeeMaker</h1>
<p><a data-primary="Appliance project" data-type="indexterm" id="idm46402342514616"/><a data-primary="as keyword" data-type="indexterm" id="idm46402342513272"/><a data-primary="downcasting" data-secondary="about" data-type="indexterm" id="idm46402342512472"/>Upcasting is a great tool, because it lets you use a CoffeeMaker or an Oven anywhere you just need an Appliance. But it’s got a big drawback—if you’re using an Appliance reference that points to a CoffeeMaker object, you can only use the methods and properties that belong to Appliance. That’s where <strong>downcasting</strong> comes in: that’s how you take your <strong>previously upcast reference</strong> and change it back. You can figure out if your Appliance is really a CoffeeMaker using the <code><strong>is</strong></code> keyword, and if it is you can convert it back to a CoffeeMaker.</p>
<ol>
<li><p><strong>We’ll start with the CoffeeMaker we already upcast.</strong></p>
<p>Here’s the code that we used:</p>
<pre data-type="programlisting">  Appliance powerConsumer = new CoffeeMaker();
  powerConsumer.ConsumePower();</pre></li>
<li><p><strong>What if we want to turn the Appliance back into a CoffeeMaker?</strong></p>
<p>Let’s say we’re building an app that looks in an array of Appliance references so it can make our CoffeeMaker start brewing. We can’t just use our Appliance reference to call the CoffeeMaker method:</p>
<pre data-type="programlisting">  Appliance someAppliance = appliances[5];
  someAppliance.StartBrewing()</pre>
<p>That statement won’t compile—you’ll get that “‘Appliance’ does not contain a definition for ‘StartBrewing’” compiler error because StartBrewing is a member of CoffeeMaker but you’re using an Appliance reference.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/385fig001.png"/>
<h6/>
</div></figure></li>
<li><p><strong>But since we know it’s a CoffeeMaker, let’s use it like one.</strong></p>
<p>The <code>is</code> keyword is the first step. Once you know that you’ve got an Appliance reference that’s pointing to a CoffeeMaker object, you can use <code><strong>is</strong></code> to downcast it. That lets you use the CoffeeMaker class’s methods and properties. Since CoffeeMaker inherits from Appliance, it still has its Appliance methods and properties.</p>
<pre data-type="programlisting">  if (someAppliance is CoffeeMaker javaJoe) {
     javaJoe.StartBrewing();
  }</pre>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/385fig002.png"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/385fig01.png"/>
<h6/>
</div></figure>
</li>
</ol>
</div></section>
<section data-pdf-bookmark="Upcasting and downcasting work with interfaces, too" data-type="sect1"><div class="sect1" id="upcasting_and_downcasting_work_with_inte">
<h1>Upcasting and downcasting work with interfaces, too</h1>
<p><a data-primary="downcasting" data-secondary="interfaces and" data-type="indexterm" id="idm46402342493320"/><a data-primary="interfaces" data-secondary="downcasting and" data-type="indexterm" id="idm46402342491640"/><a data-primary="interfaces" data-secondary="upcasting and" data-type="indexterm" id="idm46402342490584"/><a data-primary="reference variables" data-secondary="multiple references to single object" data-tertiary="accessing different methods and properties" data-type="indexterm" id="idm46402342489400"/><a data-primary="upcasting" data-secondary="interfaces and" data-type="indexterm" id="idm46402342488056"/>Interfaces work really well  with upcasting and downcasting. Let’s add an ICooksFood interface for any class that can heat up food. Next, we’ll add a Microwave class—both Microwave and Oven implement the ICooksFood interface. Now a reference to an Oven object can be an ICooksFood reference, a Microwave reference, or an Oven reference. That means we have three different types of references that could point to an Oven object—and each of them can access different members, depending on the reference’s type. Luckily, the IDE’s IntelliSense can help you figure out exactly what you can and can’t do with each of them:</p>
<pre data-type="programlisting">Oven misterToasty = new Oven();
misterToasty.</pre>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/386fig01.png"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>As soon as you type the dot, the IntelliSense window will pop up with a list of all of the members you can use. <code>misterToasty</code> is an Oven reference pointing to an Oven object, so it can access <u><span style="color:#9D9EA0;">all</span></u> of the methods and properties. It’s the <span style="color:#9D9EA0;"><u>most specific type</u></span>, so you can only point it at Oven objects.</p>
</div>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/386fig04.png"/>
<h6/>
</div></figure>
<p>To access ICooksFood interface members, convert it to an ICooksFood reference:</p>
<pre data-type="programlisting">if (misterToasty is ICooksFood cooker) {
    cooker.</pre>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/386fig02.png"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><code>cooker</code> is an ICooksFood reference pointing to that same Oven object. It can only access ICooksFood members, but it can also point to a Microwave object.</p>
</div>
<p>This is the same Oven class that we used earlier, so it also extends the Appliance base class. If you use an Appliance reference to access the object, you’ll only see members of the Appliance class:</p>
<pre data-type="programlisting">if (misterToasty is Appliance powerConsumer)
    powerConsumer.</pre>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/386fig03.png"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><code>powerConsumer</code> is an Appliance reference. It only lets you get to the public fields, methods, and properties in Appliance. It’s more general than an Oven reference (so you could point it at a CoffeeMaker object if you wanted to).</p>
</div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Three different references that point to the <span style="color:#9D9EA0;">same</span> object can access <span style="color:#9D9EA0;">different</span> methods and properties, depending on the reference’s <span style="color:#9D9EA0;">type</span>.</p>
</div>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0021">
<h5>there are no Dumb Questions</h5>
<p><strong><a data-primary="interfaces" data-secondary="why use" data-type="indexterm" id="idm46402342462872"/>Q: So back up—I think you told me that I can always upcast but I can’t always downcast. Why?</strong></p>
<p><strong>A:</strong> Because an upcast won’t work if you’re trying to set an object equal to a class that it doesn’t inherit from or an interface that it doesn’t implement. The compiler can figure out immediately that you didn’t upcast properly and give you an error. When we say “you can always upcast but can’t always downcast” it’s just like saying “every oven is an appliance but not every appliance is an oven.”</p>
<p><strong>Q: I read online that an interface is like a contract, but I don’t really get why. What does that mean?</strong></p>
<p><strong>A:</strong> Yes, many people like to say that an interface is like a contract. (“How is an interface like a contract?” is a really common question during job interviews.) When you make your class implement an interface, you’re telling the compiler that you promise to put certain methods into it. The compiler will hold you to that promise. That’s like a court forcing you to stick to the terms of a contract. If that helps you understand interfaces, then definitely think of them that way.</p>
<p>But we think that it’s easier to remember how interfaces work if you think of an interface as a kind of checklist. The compiler runs through the checklist to make sure that you actually put all of the methods from the interface into your class. If you didn’t, it’ll bomb out and not let you compile.</p>
<p><strong>Q: Why would I want to use an interface? It seems like it’s just adding restrictions, without actually changing my class at all.</strong></p>
<p><strong>A:</strong> Because when your class implements an interface, you can use that interface as a type to declare a reference that can point to any instance of a class that implements it. That’s really useful to you—it lets you create one reference type that can work with a whole bunch of different kinds of objects.</p>
<p>Here’s a quick example. A horse, an ox, a mule, and a steer can all pull a cart. In our zoo simulator, Horse, Ox, Mule, and Steer would all be different classes. Let’s say you had a cart-pulling ride in your zoo, and you wanted to create an array of any animal that could pull carts around. Uh-oh—you can’t just create an array that will hold all of those. If they all inherited from the same base class you could create an array of those, but it turns out that they don’t. So what’ll you do?</p>
<p>That’s where interfaces come in handy. You can create an IPuller interface that has methods for pulling carts around. Then you can declare your array like this:</p>
<pre data-type="programlisting">IPuller[] pullerArray;</pre>
<p>Now you can put a reference to any animal you want in that array, as long as it implements the IPuller interface.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>An interface is like a <span style="color:#9D9EA0;">checklist</span> that the compiler runs through to make sure your class implemented a certain set of methods.</p>
</div>
</div></aside>
</div></section>
<section data-pdf-bookmark="Interfaces can inherit from other interfaces" data-type="sect1"><div class="sect1" id="interfaces_can_inherit_from_other_interf">
<h1>Interfaces can inherit from other interfaces</h1>
<p><a data-primary="Beehive Management System project" data-secondary="interfaces" data-type="indexterm" id="idm46402342454872"/><a data-primary="inheritance" data-secondary="interface" data-type="indexterm" id="idm46402342448152"/><a data-primary="interfaces" data-secondary="inheriting from other interfaces" data-type="indexterm" id="idm46402342447080"/>As we’ve mentioned, when one class inherits from another, it gets all of the methods and properties from the base class. <strong>Interface inheritance</strong> is simpler. Since there’s no actual method body in any interface, you don’t have to worry about calling base class constructors or methods. The inherited interfaces <strong>accumulate all of the members</strong> of the interfaces that they extend.</p>
<p>So what does this look like in code? Let’s add an IDefender interface that inherits from IWorker:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/388fig001.png"/>
<h6/>
</div></figure>
<p>When a class implements an interface, it must implement every property and method in that interface. If that interface inherits from another one, then all of <em>those</em> properties and methods need to be implemented, too. So any class that implements IDefender not only must implement all of the IDefender members, but also all of the IWorker members. Here’s a class model that includes IWorker and IDefender, and <strong>two separate hierarchies</strong> that implement them.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/388fig01.png"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0025">
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>
<p><a data-primary="clowns" data-secondary="Fingers the clown" data-type="indexterm" id="idm46402342435288"/><a data-primary="exercises" data-secondary="interfaces" data-type="indexterm" id="idm46402342434152"/><a data-primary="IClown interface" data-type="indexterm" id="idm46402342433032"/><a data-primary="interfaces" data-secondary="exercises on" data-type="indexterm" id="idm46402342432232"/>Create a new console app with classes that implement the IClown interface. Can you figure out how to get the code at the bottom to build?</p>
<ol>
<li><p>Start with the IClown interface you created earlier:</p>
<pre data-type="programlisting">interface IClown {
    string FunnyThingIHave { get; }
    void Honk();
}</pre></li>
<li><p>Extend IClown by creating <strong>a new interface called IScaryClown</strong> that extends IClown. It should have a string property called ScaryThingIHave with a get accessor but no set accessor, and a void method called ScareLittleChildren.</p></li>
<li><p>Create these classes that implement the interfaces:</p>
<ul>
<li><p>A <strong>class called FunnyFunny</strong> that implements IClown. It uses a <u>private</u> string variable called funnyThingIHave to store a funny thing. The FunnyThingIHave getter uses funnyThingIHave as a backing field. Use a constructor that takes a parameter and uses it to set the private field. The Honk method prints: <em>“Hi kids! I have a ”</em> followed by the funny thing and a period.</p></li>
<li><p>A <strong>class called ScaryScary</strong> that implements IScaryClown. It uses a private variable to store an integer called scaryThingCount. The constructor sets both the scaryThingCount field and the funnyThingIHave field that ScaryScary inherited from FunnyFunny. The ScaryThingIHave getter returns a string with the number from the constructor followed by <em>“ spiders”</em>. The ScareLittleChildren method writes <em>“Boo! Gotcha! Look at my...!”</em> to the console, replacing “...” with the clown’s scary thing.</p></li>
</ul>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/389fig01.png"/>
<h6/>
</div></figure>
</li>
<li><p>Here’s some new code for the Main method—but it’s not working. Can you figure out how to fix it so it builds and prints messages to the console?</p>
<pre data-type="programlisting">static void Main(string[] args)
{
    IClown fingersTheClown = new ScaryScary("big red nose", 14);
    fingersTheClown.Honk();
    IScaryClown iScaryClownReference = fingersTheClown;
    iScaryClownReference.ScareLittleChildren();
}</pre>
<p>Before you run the code, <strong>write down the output</strong> that the Main method will print to the console (once you fix it):</p>
<p>.................................................................................</p>
<p>.................................................................................</p>
<p>Then run the code and see if you got the answer right.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/389fig02.png"/>
<h6/>
</div></figure>
</li>
</ol>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0016">
<h5><span class="inlineimage"><img alt="Images" src="assets/Common-1.png"/></span> Exercise Solution</h5>
<p>Create a new console app with classes that implement the IClown interface. Can you figure out how to get the code at the bottom to build?</p>
<p>The IScaryClown interface extends IClown and adds a property and a method:</p>
<pre data-type="programlisting">interface IScaryClown : IClown
{
    string ScaryThingIHave { get; }
    void ScareLittleChildren();
}</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The IScaryClown interface <span style="color:#9D9EA0;"><u>inherits</u></span> from the IClown interface. That means any class that implements IScaryClown not only needs to have a ScaryThingIHave property and a ScareLittleChildren method, but also a FunnyThingIHave property and a Honk method.</p>
</div>
<p>The FunnyFunny class implements the IClown interface and uses a constructor to set a backing field:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/390fig01.png"/>
<h6/>
</div></figure>
<p>The ScaryScary class extends the FunnyFunny class and implements the IScaryClown interface. Its constructor uses the <code>base</code> keyword to call the FunnyFunny constructor to set the private backing field:</p>
<pre data-type="programlisting">class ScaryScary : FunnyFunny, IScaryClown
{

    private int scaryThingCount;

    public ScaryScary(string funnyThing, int scaryThingCount) : base(funnyThing)
    {
        this.scaryThingCount = scaryThingCount;
    }

    public string ScaryThingIHave { get { return $"{scaryThingCount} spiders"; } }

    public void ScareLittleChildren()
    {
        Console.WriteLine($"Boo! Gotcha! Look at my {ScaryThingIHave}!");
    }
}</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>FunnyFunny.funnyThingIHave is a private field, so ScaryScary can’t access it—it needs to use the <code><strong>base</strong></code> keyword to call the FunnyFunny constructor.</p>
</div>
<p>To fix the Main method, replace lines 3 and 4 of the method with these lines that use the <code>is</code> operator:</p>
<pre data-type="programlisting">if (fingersTheClown is IScaryClown iScaryClownReference)
{
    iScaryClownReference.ScareLittleChildren();
}</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>You can set a FunnyFunny reference equal to a ScaryScary object because ScaryScary inherits from FunnyFunny. You can’t set any IScaryClown reference to just any clown, because you don’t know if that clown is scary. That’s why you need to use the is keyword.</strong></p>
</div>
</div></aside>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/391fig01.png"/>
<h6/>
</div></figure>
<p><strong>Absolutely! Making fields read-only helps prevent bugs.</strong></p>
<p><a data-primary="readonly keyword" data-type="indexterm" id="idm46402342394184"/>Go back to the ScaryScary.scaryThingCount field—the IDE put dots underneath the first two letters of the field name. Hover over the dots to get the IDE to pop up a window:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/391fig02.png"/>
<h6/>
</div></figure>
<p>Press Ctrl+. to pop up a list of actions, and choose “<strong>Add readonly modifier</strong>” to add the <code>readonly</code> <strong>keyword</strong> to the declaration:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/391fig03.png"/>
<h6/>
</div></figure>
<p>Now the field can <u>only be set</u> when it’s declared or in the constructor. If you try to change its value anywhere else in the method, you’ll get a compiler error:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/391fig04.png"/>
<h6/>
</div></figure>
<p>The <code>readonly</code> keyword...just another way C# helps you keep your data safe.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="the_readonly_keyword">
<h5><strong>The readonly keyword</strong></h5>
<p>An important reason that we use encapsulation is to prevent one class from accidentally overwriting another class’s data. What’s preventing a class from overwriting its own data? The “readonly” keyword can help with that. Any field that you mark readonly can only be modified in its declaration or in the constructor.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0022">
<h5>there are no Dumb Questions</h5>
<p><a data-primary="access modifiers" data-type="indexterm" id="idm46402342380712"/><a data-primary="encapsulation" data-secondary="better, using protected modifier" data-type="indexterm" id="idm46402342379528"/><a data-primary="fields" data-secondary="versus properties" data-type="indexterm" id="idm46402342378552"/><a data-primary="interfaces" data-secondary="object references versus interface references" data-type="indexterm" id="idm46402342377400"/><a data-primary="interfaces" data-secondary="references" data-type="indexterm" id="idm46402342375896"/><a data-primary="interfaces" data-secondary="why use" data-type="indexterm" id="idm46402342374744"/><a data-primary="object references" data-type="indexterm" id="idm46402342373672"/><a data-primary="properties" data-secondary="versus fields" data-type="indexterm" id="idm46402342372792"/><a data-primary="references" data-secondary="object versus interface" data-type="indexterm" id="idm46402342371640"/><strong>Q: Why would I want to use an interface instead of just writing all of the methods I need directly into my class?</strong></p>
<p><strong>A:</strong> When you use interfaces, you still write methods in your classes. Interfaces let you group those classes by the kind of work they do. They help you be sure that every class that’s going to do a certain kind of work does it using the same methods. The class can do the work however it needs to, and because of the interface, you don’t need to worry about how it gets the job done.</p>
<p>Here’s an example: you can have a Truck class and a Sailboat class that implement ICarryPassenger. Say the ICarryPassenger interface stipulates that any class that implements it has to have a ConsumeEnergy method. Your program could use them both to carry passengers even though the Sailboat class’s ConsumeEnergy method uses wind power and the Truck class’s method uses diesel fuel.</p>
<p>Imagine if you didn’t have the ICarryPassenger interface. Then it would be tough to tell your program which vehicles could carry people and which couldn’t. You would have to look through each class that your program might use and figure out whether or not there was a method for carrying people from one place to another. Then you’d have to call each of the vehicles your program was going to use with whatever method was defined for carrying passengers. And since there’s no standard interface, they could be named all sorts of things or buried inside other methods. You can see how that gets confusing pretty fast.</p>
<p><strong>Q: Why do I need to use properties in interfaces? Can’t I just include fields?</strong></p>
<p><strong>A:</strong> Good question. An interface only defines the way a class should do a specific kind of job. It’s not an object by itself, so you can’t instantiate it and it can’t store information. If you added a field that was just a variable declaration, then C# would have to store that data somewhere—and an interface can’t store data by itself. A property is a way to make something that looks like a field to other objects, but since it’s really a method, it doesn’t actually store any data.</p>
<p><strong>Q: What’s the difference between a regular object reference and an interface reference?</strong></p>
<p><strong>A:</strong> You already know how a regular, everyday object reference works. If you create an instance of Skateboard called <code>vertBoard</code>, and then a new reference to it called <code>halfPipeBoard</code>, they both point to the same thing. But if Skateboard implements the interface IStreetTricks and you create an interface reference to Skateboard called <code>streetBoard</code>, it will only know the methods in the Skateboard class that are also in the IStreetTricks interface.</p>
<p>All three references are actually pointing to the same object. If you call the object using the <code>halfPipeBoard</code> or <code>vertBoard</code> references, you’ll be able to access any method or property in the object. If you call it using the <code>streetBoard</code> reference, you’ll only have access to the methods and properties in the interface.</p>
<p><strong>Q: Then why would I ever want to use  an interface reference, if it limits what I can do with the object?</strong></p>
<p><strong>A:</strong> Interface references give you a way of working with a bunch of different kinds of objects that do the same thing. You can create an array using the interface reference type that will let you pass information to and from the methods in ICarryPassenger whether you’re working with a Truck object, a Horse object, a Unicycle object, or a Car object. The way each of those objects does the job is probably a little different, but with interface references, you know that they all have the same methods that take the same parameters and have the same return types. So, you can call them and pass information to them in exactly the same way.</p>
<p><strong>Q: Remind me again why would I make a class member protected instead of private or public?</strong></p>
<p><strong>A:</strong> Because it helps you encapsulate your classes better. There are a lot of times when a subclass needs access to some internal part of its base class. For example, if you need to override a property, it’s pretty common to use the backing field in the base class in the get accessor, so that it returns some sort of variation of it. When you build classes, you should only make something public if you have a reason to do it. Using the <code>protected</code> access modifier lets you expose it only to the subclass that needs it, and keep it private from everyone else.</p>
</div></aside>
<blockquote>
<p><strong>Interface references only know about the methods and properties that are defined in the interface.</strong></p>
</blockquote>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-idd0015">
<h5>Bullet Points</h5>
<ul>
<li><p><a data-primary="null" data-type="indexterm" id="idm46402342352024"/>An <strong>interface</strong> defines methods and properties that a class must implement.</p></li>
<li><p>Interfaces define their <strong>required members</strong> using abstract methods and properties.</p></li>
<li><p>By default, all interface members are <strong>public and abstract</strong> (so the <code>public</code> and <code>abstract</code> keywords are typically left off each member).</p></li>
<li><p>When you use a <strong>colon (:)</strong> to make a class implement an interface, the class <strong>must implement <em>all of its members</em></strong> or the code won’t compile.</p></li>
<li><p>A class can <strong>implement multiple interfaces</strong> (and it doesn’t run into the Deadly Diamond of Death because the interfaces have no implementation).</p></li>
<li><p>Interfaces are really useful because they let <strong>unrelated</strong> classes do the <strong>same job.</strong></p></li>
<li><p>Whenever you create an interface, you should make its name start with an <strong>uppercase</strong> I (that’s just a convention; it’s not enforced by the compiler).</p></li>
<li><p>We use <strong>dashed arrows</strong> to draw interface implementation relationships in our class diagrams.</p></li>
<li><p>You <strong>can’t use the <code>new</code> keyword</strong> to instantiate an interface because its members are abstract.</p></li>
<li><p>You can use an <strong>interface as a type</strong> to reference an object that implements it.</p></li>
<li><p>Any class can <strong>implement <em>any</em> interface</strong> as long as it keeps the promise of implementing the interface’s methods and properties.</p></li>
<li><p>Everything in a public interface is <strong>automatically public</strong>, because you’ll use it to define the public methods and properties of any class that implements it.</p></li>
<li><p>A <strong>hack</strong> is an ugly, clumsy, or inelegant solution to a problem that will be difficult to maintain.</p></li>
<li><p>The <code><strong>is keyword</strong></code> returns true if an object matches a type. You can also use it to declare a variable and set it to reference the object you’re checking.</p></li>
<li><p><strong>Upcasting</strong> typically means using normal assignment or casting to move up the class hierarchy, or assign a superclass variable to reference a subclass object.</p></li>
<li><p>The <code>is</code> keyword lets you <strong>downcast</strong>—safely move down the class hierarchy—to use a subclass variable to reference a superclass object.</p></li>
<li><p>Upcasting and downcasting <strong>work with interfaces</strong>, too—you can upcast an object reference to an interface reference, or downcast from an interface reference.</p></li>
<li><p>The <code><strong>as keyword</strong></code> is like a cast, except instead of throwing an exception it returns <code>null</code> if the cast is invalid.</p></li>
<li><p>When you mark a field with the <code><strong>readonly</strong> keyword</code> it can only be set in the field initializer or constructor.</p></li>
</ul>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="make_it_stick">
<h5><span class="inlineimage"><img alt="Images" src="assets/makeit.png"/></span> Make it Stick</h5>
<p>To remember how interfaces work: you <span style="color:#9D9EA0;">extend</span> a class, but <span style="color:#9D9EA0;">implement</span> an interface. Extending something means taking what’s already there and stretching it out (in this case, by adding behavior). Implementing means putting an agreement into effect—you’ve agreed to add all the interface members (and the compiler holds you to that agreement).</p>
</div></aside>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Look up “implement” in the dictionary—one definition is “to put a decision, plan, or agreement into effect.”</p>
</div>
<p><a data-primary="default implementations" data-type="indexterm" id="idm46402342320296"/><a data-primary="static fields" data-type="indexterm" id="idm46402342321656"/><a data-primary="static methods" data-type="indexterm" id="idm46402342319432"/><a data-primary="static properties" data-type="indexterm" id="idm46402342318632"/><strong>Actually, you <u>can</u> add code to your interfaces by including <span style="color:#9D9EA0;">static members</span> and <span style="color:#9D9EA0;">default implementations</span>.</strong></p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/394fig01.png"/>
<h6/>
</div></figure>
<p>Interfaces aren’t just about making sure classes that implement them include certain members. Sure, that’s their main job. But interfaces can also contain code, just like the other tools you use to create your class model.</p>
<p>The easiest way to add code to an interface is to add <strong>static methods, properties, and fields</strong>. These work exactly like static members in classes: they can store data of any type—including references to objects—and you can call them just like any other static method: <code>Interface.MethodName();</code></p>
<p>You can also include code in your interfaces by adding <strong>default implementations</strong> for methods. To add a default implementation, you just add a method body to the method in your interface. This method is <u>not</u> part of the object—this is not the same as inheritance—and you can only access it using an interface reference. It <u>can</u> call methods implemented by the object, as long as they’re part of the interface.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="watch_itexclamation_mark-idd0007">
<h5><span class="inlineimage"><img alt="Images" src="assets/watchit.png"/></span> Watch it!</h5>
<p><strong>Default interface implementations are a recent C# feature.</strong></p>
<p><em>If you’re using an old version of Visual Studio, you may not be able to use default implementations because they were added in C# 8.0, which first shipped in Visual Studio 2019 version 16.3.0, released in September 2019. Support for the current version of C# may not be available in older versions of Visual Studio.</em></p>
</div></aside>
</div></section>
<section data-pdf-bookmark="Interfaces can have static members" data-type="sect1"><div class="sect1" id="interfaces_can_have_static_members">
<h1>Interfaces can have static members</h1>
<p><a data-primary="clowns" data-secondary="clown car" data-type="indexterm" id="idm46402342300232"/><a data-primary="fields" data-secondary="private" data-type="indexterm" id="idm46402342304168"/><a data-primary="interfaces" data-secondary="static members in" data-type="indexterm" id="idm46402342303016"/><a data-primary="private fields" data-type="indexterm" id="idm46402342301864"/>Everybody loves it when way too many clowns pack themselves into a tiny clown car! So let’s update the IClown interface to add static methods that generate a clown car description. Here’s what we’ll add:</p>
<ul>
<li><p>We’ll be using random numbers, so we’ll add a static reference to an instance of Random. It only needs to be used in IClown for now, but we’ll also use it in IScaryClown soon, so go ahead and mark it <code>protected</code>.</p></li>
<li><p>A clown car is only funny if it’s packed with clowns, so we’ll add a static int property with a private static backing field and a setter that only accepts values over 10.</p></li>
<li><p>A method called ClownCarDescription returns a string that describes the clown car.</p></li>
</ul>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/395fig001a.png"/>
<h6/>
</div></figure>
<p>Here’s the code—it uses a static field, property, and method just like you’d see in a class:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/395fig001.png"/>
<h6/>
</div></figure>
<p>Now you can update the Main method to access the static IClown members:</p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">static void Main(string[] args)</span>
<span style="color:#9D9EA0;">{</span>
     
   IClown.CarCapacity = 18;
   Console.WriteLine(IClown.ClownCarDescription());
   
   <span style="color:#9D9EA0;">// the rest of the Main method stays the same</span>
<span style="color:#9D9EA0;">}</span></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Try adding a <u>private field</u> to your interface. You can add one—but only if it’s static! If you remove the static keyword, the compiler will tell you that interfaces can’t contain instance fields.</strong></p>
</div>
<p>These static interface members behave exactly like the static class members that you’ve used in previous chapters. Public members can be used from any class, private members can only be used from inside IClown, and protected members can be used from IClown or any interface that extends it.</p>
</div></section>
<section data-pdf-bookmark="Default implementations give bodies to interface methods" data-type="sect1"><div class="sect1" id="default_implementations_give_bodies_to_i">
<h1>Default implementations give bodies to interface methods</h1>
<p><a data-primary="@ character" data-type="indexterm" id="idm46402342279912"/><a data-primary="default implementations" data-type="indexterm" id="idm46402342285320"/><a data-primary="escape sequences" data-type="indexterm" id="idm46402342284696"/><a data-primary="\n (line feed character)" data-type="indexterm" id="idm46402342283864"/><a data-primary="string literals" data-type="indexterm" id="idm46402342283032"/>All of the methods that you’ve seen in interfaces so far—except for the static methods—have been <u>abstract</u>: they don’t have bodies, so any class that implements the interface <u>must provide</u> an implementation for the method.</p>
<p>But you can also provide a <strong>default implementation</strong> for any of your interface methods. Here’s an example:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/396fig01.png"/>
<h6/>
</div></figure>
<p>You can call the default implementation—but you <strong>must use an interface reference</strong> to make the call:</p>
<pre data-type="programlisting">    IWorker worker = new NectarCollector();
    worker.Buzz();</pre>
<p>But this code will not compile—it will give you the error <em>“NectarCollector’ does not contain a definition for ‘Buzz’”</em>:</p>
<pre data-type="programlisting">    NectarCollector pearl = new NectarCollector();
    pearl.Buzz();</pre>
<p>The reason is that when an interface method has a default implementation, that makes it a <u>virtual</u> method, just like the ones you used in classes. Any class that implements the interface has the option to implement the method. The virtual method is <strong><em>attached to the interface</em></strong>. Like any other interface implementation, <u>it’s not inherited</u>. That’s a good thing—if a class inherited default implementations from every interface that it implemented, then if two of those interfaces had methods with the same name the class would run into the Deadly Diamond of Death.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="use_commercial_at_to_create_verbatim_str">
<h5>Use @ to create verbatim string literals</h5>
<p>The @ character has special meaning in C# programs. When you put it at the beginning of a string literal, it tells the C# compiler that the literal should be interpreted verbatim. That means slashes are not used for escape sequences—so @“\n” will contain a slash character and an n character, not a newline. It also tells the C# compiler to include any line breaks. So this: @“Line 1</p>
<p>Line 2” is the same as “Line1\nLine2” (including the line break).</p>
</div></aside>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">You can use verbatim string literals to create multiline strings that include line breaks. They work great with string interpolation—just add a $ to the beginning.</span></p>
</div>
</div></section>
<section data-pdf-bookmark="Add a ScareAdults method with a default implementation" data-type="sect1"><div class="sect1" id="add_a_scareadults_method_with_a_default">
<h1>Add a ScareAdults method with a default implementation</h1>
<p><a data-primary="clowns" data-secondary="terrifying" data-type="indexterm" id="idm46402342261128"/><a data-primary="IScaryClown interface" data-type="indexterm" id="idm46402342264520"/>Our IScaryClown interface is state-of-the-art when it comes to simulating scary clowns. But there’s a problem: it only has a method to scare little children. What if we want our clowns to terrify the living $#!* out of adults too?</p>
<p>We <strong><em>could</em></strong> add an abstract ScareAdults method to the IScaryClown interface. But what if we already had dozens of classes that implemented IScaryClown? And what if most of them would be perfectly fine with the same implementation of the ScareAdults method? That’s where default implementations are really useful. A default implementation lets you add a method to an interface that’s already in use <strong>without having to update any of the classes that implement it</strong>. Add a ScareAdults method with a default implementation to IScaryClown:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/397fig01.png"/>
<h6/>
</div></figure>
<p><strong><em>Add this!</em></strong></p>
<p>Take a close look at how the ScareAdults method works. That method only has two statements, but there’s a lot packed into them. Let’s break down exactly what’s going on:</p>
<ul>
<li><p>The Console.WriteLine statement uses a verbatim literal with string interpolation. The literal starts with <code>$@</code> to tell the C# compiler two things: the <code>$</code> tells it to use string interpolation, and the <code>@</code> tells it to use a verbatim literal. That means the string will include three line breaks.</p></li>
<li><p>The literal uses string interpolation to call <code>r</code>andom.Next(4, 10), which uses the private static random field that IScaryClown inherited from IClown.</p></li>
<li><p>We’ve seen throughout the book that when there’s a static field, that means there’s <u>only one copy</u> of that field. So there’s just one instance of Random that both IClown and IScaryClown share.</p></li>
<li><p>The last line of the ScareAdults method calls ScareLittleChildren. That method is <u>abstract</u> in the IScaryClown interface, so it will call the version of ScareLittleChildren in the class that implements IScaryClown.</p></li>
<li><p>That means ScareAdults will call the version of ScareLittleChildren that’s defined in whatever class implements IScaryClown.</p></li>
</ul>
<p>Call your new default implementation by modifying the block after the <code>if</code> statement in your Main method to call ScareAdults instead of ScareLittleChildren:</p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">    if (fingersTheClown is IScaryClown iScaryClownReference)</span>
<span style="color:#9D9EA0;">    {</span>
        iScaryClownReference.ScareAdults();
<span style="color:#9D9EA0;">    }</span></pre>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/398fig01.png"/>
<h6/>
</div></figure>
<p><a data-primary="WPF (Windows Presentation Foundation)" data-type="indexterm" id="idm46402342242344"/><strong>C# developers use interfaces <em>all the time</em>, especially when we use <span style="color:#9D9EA0;">libraries, frameworks, and APIs.</span></strong></p>
<p>Developers always stand on the shoulders of giants. You’re about halfway through this book, and in the first half you’ve written code that prints text to the console, draws windows with buttons, and renders 3D objects. You didn’t need to write code to specifically output individual bytes to the console, or draw the lines and text to display buttons in a window, or do the math needed to display a sphere—you took advantage of code that other people wrote:</p>
<ul>
<li><p>You’ve used <strong>frameworks</strong> like .NET Core and WPF.</p></li>
<li><p>You’ve used <strong>APIs</strong> like the Unity scripting API.</p></li>
<li><p>The frameworks and APIs contain <strong>class libraries</strong> that you access with <code>using</code> directives at the top of your code.</p></li>
</ul>
<p>And when you’re using libraries, frameworks, and APIs, you use interfaces a lot. See for yourself: open up a .NET Core or WPF application, click inside of any method, and type <code><strong>I</strong></code> to pop up an IntelliSense window. Any potential match that has the <span class="inlineimage"><img alt="Images" src="assets/398fig02a.png"/></span> symbol next to it is an interface. These are all interfaces that you can use to work with the framework.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/398fig02.png"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>There’s no Mac equivalent to the WPF feature discussed next, so the <span style="color:#9D9EA0;">Visual Studio for Mac Learner’s Guide</span> skips this section.</strong></p>
</div>
</div></section>
<section data-pdf-bookmark="Data binding updates WPF controls automatically" data-type="sect1"><div class="sect1" id="data_binding_updates_wpf_controls_automa">
<h1>Data binding updates WPF controls automatically</h1>
<p><a data-primary="controls" data-type="indexterm" id="idm46402342227640"/><a data-primary="controls" data-secondary="updating automatically with data binding" data-type="indexterm" id="idm46402342226536"/><a data-primary="Windows UI controls" data-see="controls" data-type="indexterm" id="idm46402342225400"/><a data-primary="WPF (Windows Presentation Foundation)" data-secondary="data binding" data-type="indexterm" id="idm46402342224280"/><a data-primary="WPF (Windows Presentation Foundation)" data-secondary="data context" data-type="indexterm" id="idm46402342223128"/>Here’s a great example of a real-world use case for an interface: <strong>data binding</strong>. Data binding is a really useful feature in WPF that lets you set up your controls so their properties are automatically set based on a property in an object, and when that property changes your controls’ properties are automatically kept up to date.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/399fig01.png"/>
<h6/>
</div></figure>
<p>Here’s an overview of the steps to modify your Beehive Management System—we’ll dig into them next:</p>
<ol>
<li><p><strong>Modify the Queen class to implement the INotifyPropertyChanged interface.</strong></p>
<p>This interface lets the Queen announce that the status report has been updated.</p>
</li>
<li><p><strong>Modify the XAML to create an instance of Queen.</strong></p>
<p>We’ll bind the TextBox.Text property to the Queen’s StatusReport property.</p>
</li>
<li><p><strong>Modify the code-behind so the “queen” field uses the instance of Queen we just created.</strong></p>
<p>Right now the queen field in <em>MainWindow.xaml.cs</em> has a field initializer with a <code>new</code> statement to create an instance of Queen. We’ll modify it to use the instance we created with XAML instead.</p>
</li>
</ol>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/399fig02.png"/>
<h6/>
</div></figure>
</div></section>
<section data-pdf-bookmark="Modify the Beehive Management System to use data binding" data-type="sect1"><div class="sect1" id="modify_the_beehive_management_system_to">
<h1>Modify the Beehive Management System to use data binding</h1>
<p><a data-primary="Beehive Management System project" data-secondary="data binding and" data-type="indexterm" id="idm46402342209464"/>You only need to make a few changes to add data binding to your WPF app.</p>
<p><strong><em>Do this!</em></strong></p>
<ol>
<li><p><strong>Modify the Queen class to implement the INotifyPropertyChanged interface.</strong></p>
<p>Update the Queen class declaration to make it implement INotifyPropertyChanged. That interface is in the System.ComponentModel namespace, so you’ll need to add a <code>using</code> directive to the top of the class:</p>
<pre data-type="programlisting">using System.ComponentModel;</pre>
<p>Now you can add <code>INotifyPropertyChanged</code> to the end of the class declaration. The IDE will draw a red squiggly underline beneath it—which is what you’d expect, since you haven’t implemented the interface by adding its members yet.</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/400fig01.png"/>
<h6/>
</div></figure>
<p>Press Alt+Enter or Ctrl+. to show potential fixes <strong>and choose “Implement interface”</strong> from the context menu. The IDE will add a line of code to your class with the <code><strong>event keyword</strong></code>, which you haven’t seen yet:</p>
<pre data-type="programlisting">public event PropertyChangedEventHandler PropertyChanged;</pre>
<p>But guess what? You’ve used events before! The DispatchTimer you used in <a href="ch01.html#start_building_with_chash_build_somethin">#start_building_with_chash_build_somethin</a> has a Tick event, and WPF Button controls have a Click event. <strong><em>Now your Queen class has a PropertyChanged event.</em></strong> Any class that you use for data binding fires—or <strong>invokes</strong>—its PropertyChanged event to let WPF know a property has changed.</p>
<p>Your Queen class needs to fire its event, just like the DispatchTimer fires its Tick event on an interval and the Button fires its Click event when the user clicks on it. So <strong>add this OnPropertyChanged method</strong>:</p>
<pre data-type="programlisting">    protected void OnPropertyChanged(string name)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }</pre>
<p>Now you just need to <strong>modify the UpdateStatusReport method</strong> to call OnPropertyChanged:</p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">    private void UpdateStatusReport()</span>
<span style="color:#9D9EA0;">    {</span>
<span style="color:#9D9EA0;">        StatusReport = $"Vault report:\n{HoneyVault.StatusReport}\n" +</span>
<span style="color:#9D9EA0;">        $"\nEgg count: {eggs:0.0}\nUnassigned workers: {unassignedWorkers:0.0}\n" +</span>
<span style="color:#9D9EA0;">        $"{WorkerStatus("Nectar Collector")}\n{WorkerStatus("Honey Manufacturer")}" +</span>
<span style="color:#9D9EA0;">        $"\n{WorkerStatus("Egg Care")}\nTOTAL WORKERS: {workers.Length}";</span>
        <strong>OnPropertyChanged("StatusReport");</strong>
<span style="color:#9D9EA0;">    }</span></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You added an <u><span style="color:#9D9EA0;">event</span></u> to your Queen class, and added a method that uses the <span style="color:#9D9EA0;"><u>?. operator</u></span> to invoke the event. That’s all you need to know about events for now—at the end of the book we’ll point you to a downloadable chapter that teaches you more about events.</p>
</div></li>
<li><p><strong>Modify the XAML to create an instance of Queen.</strong></p>
<p>You’ve created objects with the <code>new</code> keyword, and you’ve used Unity’s Instantiate method. XAML gives you another way to create new instances of your classes. <strong>Add this to your XAML</strong> just <u>above</u> the <code>&lt;Grid&gt;</code> tag:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/401fig01.png"/>
<h6/>
</div></figure>
<p>Next, <strong>modify the</strong> <code>&lt;Grid&gt;</code> <strong>tag</strong> to add a DataContext attribute:</p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">&lt;Grid</span> DataContext="{StaticResource queen}"&gt;</pre>
<p>Finally, <strong>add a Text attribute to the <code>&lt;TextBox&gt;</code> tag</strong> to bind it to the Queen’s StatusReport property:</p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">&lt;TextBox</span> Text="{Binding StatusReport, Mode=OneWay}"</pre>
<p>Now the TextBox will update automatically any time the Queen object invokes its PropertyChanged event.</p></li>
<li><p><strong>Modify the code-behind to use the instance of Queen in the window’s resources.</strong></p>
<p>Right now the queen field in <em>MainWindow.xaml.cs</em> has a field initializer with a <code>new</code> statement to create an instance of Queen. We’ll modify it to use the instance we created with XAML instead.</p>
<p>First, comment out (or delete) the three occurrences of the line that sets statusReport.Text. There’s one in the MainWindow constructor and two in the Click event handlers:</p>
<pre data-type="programlisting"><span style="color:#9D9EA0;">// statusReport.Text = queen.StatusReport;</span></pre>
<p>Next, modify the Queen field declaration to remove the field initializer (<code>new Queen();</code>) from the end:</p>
<pre data-type="programlisting">private readonly Queen queen;</pre>
<p>Finally, modify the constructor to set the queen field like this:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/401fig02.png"/>
<h6/>
</div></figure>
<p>This code uses a <strong>dictionary</strong> called Resources. <em>(This is a <u>sneak peek at dictionaries</u>! You’ll learn about them in the next chapter.)</em> Now run your game. It works exactly like before, but now the TextBox updates automatically any time the Queen updates the status report.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Congratulations! You just used an interface to add data binding to your WPF app.</strong></p>
</div></li>
</ol>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0023">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: I think I understand everything that we just did. Can you go over it again, just in case I missed something?</strong></p>
<p><strong>A:</strong> Absolutely. The Beehive Management System app you built in <a href="ch06.html#inheritance_your_objectapostrophes_famil">#inheritance_your_objectapostrophes_famil</a> updated its TextBox (statusReport) by setting its Text property in code like this:</p>
<pre data-type="programlisting">statusReport.Text = queen.StatusReport;</pre>
<p>You modified that app to use data binding to automatically update the TextBox any time the Queen object updates its StatusReport property. You did this by making three changes. First, you modified the Queen class to implement the INotifyPropertyChanged interface so it could notify the UI of any changes to the property. Then you modified the XAML to create an instance of Queen and bind the TextBox.Text property to the Queen object’s StatusReport property. Finally, you modified the code-behind to use the instance created by the XAML and remove the lines that set statusReport.Text.</p>
<p><strong>Q: And what exactly is the interface for?</strong></p>
<p><strong>A:</strong> The INotifyPropertyChanged interface gives you a way to tell WPF that a property changed, so it can update any controls that bind to it. When you implement it, you’re building a class that can do a specific job: notifying WPF apps of property changes. The interface has a single member, an event called PropertyChanged. When you use your class for data binding, WPF checks to see if it implements INotifyPropertyChanged, and if it does, it attaches an event handler to your class’s PropertyChanged event, just like you attached event handlers to your Buttons’ click events.</p>
<p><strong>Q: I noticed that when I open the window in the designer, the status report TextBox isn’t blank anymore. Is that because of data binding?</strong></p>
<p><strong>A:</strong> Good eye! Yes, when you modified the XAML to add the <code>&lt;Window.Resources&gt;</code> section to create a new instance of the Queen object, the Visual Studio XAML designer created an instance of the object. When you modified the Grid to add a data context and added binding to the TextBox’s Text property, the designer used that information to display the text. So once you use data binding, your classes aren’t just being instantiated when your program runs. Visual Studio will create instances of your objects <strong><em>while you’re editing in the XAML window</em></strong>. This is a really powerful feature of the IDE, because it lets you change properties in your code and see the results in the designer as soon as you rebuild your code.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="watch_itexclamation_mark-idd0008">
<h5><span class="inlineimage"><img alt="Images" src="assets/watchit.png"/></span> Watch it!</h5>
<p><strong>Data binding works with properties, not fields.</strong></p>
<p><em>You can only use data binding with <strong>public properties</strong>. If you try to bind a WPF control attribute to a public field instead, you won’t see any changes—but you won’t get an exception, either.</em></p>
</div></aside>
</div></aside>
</div></section>
<section data-pdf-bookmark="Polymorphism means that one object can take many different forms" data-type="sect1"><div class="sect1" id="polymorphism_means_that_one_object_can_t">
<h1>Polymorphism means that one object can take many different forms</h1>
<p><a data-primary="as keyword" data-type="indexterm" id="idm46402342152696"/><a data-primary="downcasting" data-secondary="using as keyword" data-type="indexterm" id="idm46402342155096"/><a data-primary="polymorphism" data-type="indexterm" id="idm46402342154088"/><a data-primary="reference variables" data-secondary="interface type, pointing to object implementing interface" data-type="indexterm" id="idm46402342153320"/><a data-primary="reference variables" data-secondary="setting equal to instance of different class" data-type="indexterm" id="idm46402342140584"/><a data-primary="subclasses" data-secondary="upcasting" data-type="indexterm" id="idm46402342139480"/><a data-primary="upcasting" data-secondary="using subclass instead of base class" data-type="indexterm" id="idm46402342138328"/>Any time you use a RoboBee in place of an IWorker, or a Wolf in place of an Animal, or even an aged Vermont cheddar in a recipe that just calls for cheese, you’re using <strong>polymorphism</strong>. That’s what you’re doing any time you upcast or downcast. It’s taking an object and using it in a method or a statement that expects something else.</p>
<section data-pdf-bookmark="Keep your eyes open for polymorphism!" data-type="sect2"><div class="sect2" id="keep_your_eyes_open_for_polymorphismexcl">
<h2>Keep your eyes open for polymorphism!</h2>
<p>You’ve been using polymorphism throughout—we just didn’t use that word to describe it. While you’re writing code over the next few chapters, be on the lookout for the many different ways you use it.</p>
<p>Here’s a list of four typical ways that you’ll use polymorphism. We’re providing an example of each of them, though you won’t see these particular lines in the exercises. As soon as you write similar code in an exercise in later chapters in the book, come back to this page and <strong>check it off the following list</strong>:</p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/403fig01.png"/>
<h6/>
</div></figure>
<blockquote>
<p><strong>You’re using <span style="color:#9D9EA0;">polymorphism</span> when you take an instance of one class and use it in a statement or a method that expects a different type, like a parent class or an interface that the class implements.</strong></p>
</blockquote>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">The idea that you could combine your data and your code into classes and objects was a revolutionary one when it was first introduced—but that’s how you’ve been building all your C# programs so far, so you can think of it as just plain programming.</span></p>
</div>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/404fig01.png"/>
<h6/>
</div></figure>
<p><a data-primary="abstraction, as principle of OOP" data-type="indexterm" id="idm46402342126664"/><a data-primary="encapsulation" data-secondary="as principle of OOP" data-type="indexterm" id="idm46402342125320"/><a data-primary="functions" data-type="indexterm" id="idm46402342124280"/><a data-primary="inheritance" data-secondary="as principle of OOP" data-type="indexterm" id="idm46402342122104"/><a data-primary="OOP (object-oriented programming)" data-type="indexterm" id="idm46402342121016"/><strong>You’re an object-oriented programmer.</strong></p>
<p>There’s a name for what you’ve been doing. It’s called <strong>object-oriented programming</strong>, or OOP. Before languages like C# came along, people didn’t use objects and methods when writing their code. They just used functions (which is what they call methods in a non-OO program) that were all in one place—as if each program were just one big static class that only had static methods. It made it a lot harder to create programs that modeled the problems they were solving. Luckily, you’ll never have to write programs without OOP, because it’s a core part of C#.</p>
</div></section>
<section data-pdf-bookmark="The four core principles of object-oriented programming" data-type="sect2"><div class="sect2" id="the_four_core_principles_of_object_orien">
<h2>The four core principles of object-oriented programming</h2>
<p>When programmers talk about OOP, they’re referring to four important principles. They should seem very familiar to you by now because you’ve been working with every one of them. We just told you about polymorphism, and you’ll recognize the first three principles from <a href="ch05.html#encapsulation_keep_your_privateshellippr">#encapsulation_keep_your_privateshellippr</a> and <a href="ch06.html#inheritance_your_objectapostrophes_famil">#inheritance_your_objectapostrophes_famil</a>: <strong>inheritance, abstraction</strong>, and <strong>encapsulation.</strong></p>
<figure class="informal"><div class="figure">
<img alt="Images" src="assets/404fig02.png"/>
<h6/>
</div></figure>
</div></section>
</div></section>
</div></section></body></html>