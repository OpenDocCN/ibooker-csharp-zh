<html><head></head><body><section data-pdf-bookmark="Chapter 4. Customizing the User Login Experience" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter-four">
<h1><span class="label">Chapter 4. </span>Customizing the User Login Experience</h1>


<p>In this chapter, you’re going to build on your understanding of how to authenticate a user in the context of a Blazor WebAssembly application and customize the authentication experience. You’ll see a familiar web client startup configuration pattern and continue to explore a few other areas of the app, such as the registration of client-side services. From there, I’ll take your knowledge of JavaScript interop further with a compelling example, using browser native speech synthesis. You’ll learn how the app’s header functions, and you’ll see a pattern for implementing modal dialogs as a shared infrastructure within a small base component hierarchy. As part of this, you’ll learn how to write and handle custom events.</p>






<section data-pdf-bookmark="A Bit More on Blazor Authentication" data-type="sect1"><div class="sect1" id="idm46365024685616">
<h1>A Bit More on Blazor Authentication</h1>

<p>When you use the app, your identity <a data-primary="authentication" data-type="indexterm" id="idm46365024683920"/>is used to uniquely identify you as a user of the app. This is true in most app scenarios, including the defaults for both Blazor hosting models when authentication is configured. A single user can log in from multiple clients to use the Learning Blazor application. Then a user is authenticated, meaning that the user has entered their credentials or been redirected through an authentication workflow. These workflows define a series of sequential steps that must be followed precisely and successfully to yield an authenticated user. Here are the basic steps:</p>
<ol>
<li>
<p><em>Get an authorization code:</em> Run the <code>/authorize</code> endpoint providing the requested <code>scope</code>, where the user interacts with the <a data-primary="authentication" data-secondary="codes" data-type="indexterm" id="idm46365024891520"/><a data-primary="authorization" data-secondary="codes" data-type="indexterm" id="idm46365024890544"/>framework-provided UI.</p>
</li>
<li>
<p><em>Get an access token:</em> When successful, from the <a data-primary="authentication" data-secondary="access token" data-type="indexterm" id="idm46365024888272"/><a data-primary="authorization" data-secondary="access token" data-type="indexterm" id="idm46365024645872"/><a data-primary="access tokens" data-type="indexterm" id="idm46365024644928"/>authorization code you’ll get a token from the <code>/token</code> endpoint.</p>
</li>
<li>
<p><em>Use the token:</em> Use the access token to make requests to the various HTTP Web APIs.</p>
</li>
<li>
<p><em>Refresh the token:</em> Tokens typically expire, and when they do, they’re refreshed automatically with an authenticated user. This lets users continue to work without being prompted to constantly sign in.</p>
</li>

</ol>

<p>The authentication user flow is <a data-primary="authentication" data-secondary="user flow" data-type="indexterm" id="idm46365024640688"/>visualized in <a data-type="xref" href="#authentication-user-flow">Figure 4-1</a>.</p>

<figure><div class="figure" id="authentication-user-flow">
<img alt="" src="assets/lblz_0401.png"/>
<h6><span class="label">Figure 4-1. </span>Authentication user flow</h6>
</div></figure>

<p>I’m <em>not</em> going to share how to create an Azure AD B2C tenant, because that’s beyond the scope of this book. Besides, there are plenty of good resources for that sort of thing. For more information, see Microsoft’s <a href="https://oreil.ly/C2FgB">“Create an Azure Active Directory B2C Tenant” tutorial</a>. Just know that a tenant exists, and it contains two app registrations. There’s a WebAssembly Client app configured as a SPA and an API app configured as a server. It’s rather feature-rich, with the ability to customize the client’s HTML workflow. As an admin, I configured what user scopes exist and what claims are returned/requested.</p>

<p>During the authentication process, the possible states are listed in the section <a data-type="xref" href="#customizing-client-auth8-ux">“Customizing the client’s authorization experience”</a>.</p>

<p>The user is represented as <a data-primary="key/value pairs (KVPs)" data-secondary="claims" data-type="indexterm" id="idm46365024655472"/><a data-primary="claims" data-type="indexterm" id="idm46365024654496"/>a series of key/value pairs (KVPs), called <em>claims</em>. The keys are named and fairly well standardized. The values are stored, maintained, and retrieved from the trusted third-party entity, also known as <em>authentication providers</em>—think Google, GitHub, Facebook, Microsoft, and Twitter.</p>








<section data-pdf-bookmark="Client-Side Custom Authorization Message Handler Implementation" data-type="sect2"><div class="sect2" id="idm46365024637424">
<h2>Client-Side Custom Authorization Message Handler Implementation</h2>

<p>The Learning Blazor app defines a custom <a data-primary="AuthorizationMessageHandler" data-type="indexterm" id="atzhd"/><a data-primary="Learning Blazor app" data-secondary="authorization message" data-type="indexterm" id="lblzzg"/>implementation of <code>Authorization​Mes⁠sageHandler</code>. In a Blazor WebAssembly app, you can attach tokens to outgoing requests using the framework-provided <code>AuthorizationMessageHandler</code> type. Let’s take a <a data-primary="ApiAccessAuthorizationMessageHandler.cs" data-type="indexterm" id="aaag"/>look at the <em>ApiAccessAuthorizationMessageHandler.cs</em> C# file for its implementation:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code> <code class="nn">Learning.Blazor.Handlers</code><code class="p">;</code>

<code class="k">public</code> <code class="k">sealed</code> <code class="k">class</code> <code class="nc">ApiAccessAuthorizationMessageHandler</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO1-1" id="co_customizing_the_user_login_experience_CO1-1"><img alt="1" src="assets/1.png"/></a>
    <code class="p">:</code> <code class="n">AuthorizationMessageHandler</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="nf">ApiAccessAuthorizationMessageHandler</code><code class="p">(</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO1-2" id="co_customizing_the_user_login_experience_CO1-2"><img alt="2" src="assets/2.png"/></a>
        <code class="n">IAccessTokenProvider</code> <code class="n">provider</code><code class="p">,</code>
        <code class="n">NavigationManager</code> <code class="n">navigation</code><code class="p">,</code>      <a class="co" href="#callout_customizing_the_user_login_experience_CO1-3" id="co_customizing_the_user_login_experience_CO1-3"><img alt="3" src="assets/3.png"/></a>
        <code class="n">IOptions</code><code class="p">&lt;</code><code class="n">WebApiOptions</code><code class="p">&gt;</code> <code class="n">options</code><code class="p">)</code> <code class="p">:</code> <code class="k">base</code><code class="p">(</code><code class="n">provider</code><code class="p">,</code> <code class="n">navigation</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
        <code class="n">ConfigureHandler</code><code class="p">(</code>
            <code class="n">authorizedUrls</code><code class="p">:</code> <code class="k">new</code><code class="p">[</code><code class="p">]</code>
            <code class="p">{</code>
                <code class="n">options</code><code class="p">.</code><code class="n">Value</code><code class="p">.</code><code class="n">WebApiServerUrl</code><code class="p">,</code>
                <code class="n">options</code><code class="p">.</code><code class="n">Value</code><code class="p">.</code><code class="n">PwnedWebApiServerUrl</code><code class="p">,</code>
                <code class="s">"https://learningblazor.b2clogin.com"</code>
            <code class="p">}</code><code class="p">,</code>
            <code class="n">scopes</code><code class="p">:</code> <code class="k">new</code><code class="p">[</code><code class="p">]</code> <code class="p">{</code> <code class="n">AzureAuthenticationTenant</code><code class="p">.</code><code class="n">ScopeUrl</code> <code class="p">}</code><code class="p">)</code><code class="p">;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO1-4" id="co_customizing_the_user_login_experience_CO1-4"><img alt="4" src="assets/4.png"/></a>
<code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO1-1" id="callout_customizing_the_user_login_experience_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p><code>ApiAccessAuthorizationMessageHandler</code> is a sealed class.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO1-2" id="callout_customizing_the_user_login_experience_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>Its constructor takes <code>IAccessTokenProvider</code>, <code>NavigationManager</code>, and <code>IOp⁠tions​&lt;WebApiOptions&gt;</code> parameters.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO1-3" id="callout_customizing_the_user_login_experience_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The <code>base</code> constructor takes <code>IAccessTokenProvider</code> and <code>NavigationManager</code>.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO1-4" id="callout_customizing_the_user_login_experience_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The <code>ConfigureHandler</code> method is called by the constructor, setting the 
<span class="keep-together"><code>authorizedUrls</code></span> and <code>scopes</code> properties.</p></dd>
</dl>

<p>The framework exposes <code>AuthorizationMessageHandler</code>. It can be registered as an <code>HttpClient</code> instance HTTP message handler, ensuring that access tokens are appended to outgoing HTTP requests.</p>

<p>The implementation will need the configured <code>IOptions&lt;WebApiOptions&gt;</code> abstraction. This code is requesting the DI service provider to resolve a strongly typed configuration object.</p>

<p>Subclasses should use the base class’s <code>ConfigureHandler</code> method <a data-primary="ConfigureHandler method" data-type="indexterm" id="idm46365025783792"/><a data-primary="methods" data-secondary="ConfigureHandler" data-type="indexterm" id="idm46365025783056"/>to configure themselves. The <code>authorizedUrls</code> array is assigned given the Web API and Pwned Web API servers’ URLs. This implementation essentially takes a few configured URLs and sets them as the allow-listed URLs. It also configures an app-specific <code>scope</code> URL, which is set as the handler’s <code>scopes</code> argument to the <code>ConfigureHandler</code> function. This handler can then be added to an <code>IHttpClientBuilder</code> instance using the <code>AddHttpMessageHandler&lt;ApiAccessAuthorizationMessageHandler&gt;</code> fluent API call, where you map and configure an <code>HttpClient</code> for DI. This is shown later in <a data-type="xref" href="#web-client-configure-services">“The Web.Client ConfigureServices Functionality”</a>. All of the HTTP requests made from the configured <code>HttpClient</code> instance will append <a data-primary="ApiAccessAuthorizationMessageHandler.cs" data-startref="aaag" data-type="indexterm" id="idm46365025574992"/>the appropriate <code>Authorization</code> header with the short-lived access token.</p>

<p>With C# 10’s constant interpolated strings, the <a data-primary="interpolated strings" data-type="indexterm" id="idm46365025573008"/><a data-primary="strings, interpolated" data-type="indexterm" id="idm46365025572304"/>tenant host and public app identifier are formatted along with the API requesting <code>scope</code>. This is a <code>const</code> value <a data-primary="AzureAuthenticationTenant class" data-type="indexterm" id="idm46365025570672"/>defined in a <code>class</code> named <code>AzureAuthenticationTenant</code>, as shown <a data-primary="AzureAuthenticationTenant.cs" data-type="indexterm" id="idm46365025568976"/>in the following <em>Azure​Authen⁠ticationTenant.cs</em> C# file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code> <code class="nn">Learning.Blazor</code><code class="p">;</code>

<code class="k">static</code> <code class="k">class</code> <code class="nc">AzureAuthenticationTenant</code>
<code class="p">{</code>
    <code class="k">const</code> <code class="kt">string</code> <code class="n">TenantHost</code> <code class="p">=</code>
        <code class="s">"https://learningblazor.onmicrosoft.com"</code><code class="p">;</code>

    <code class="k">const</code> <code class="kt">string</code> <code class="n">TenantPublicAppId</code> <code class="p">=</code>
        <code class="s">"ee8868e7-73ad-41f1-88b4-dc698429c8d4"</code><code class="p">;</code>

    <code class="c1">/// &lt;summary&gt;</code>
    <code class="c1">/// Gets a formatted string value</code>
    <code class="c1">/// that represents the scope URL:</code>
    <code class="c1">/// &lt;c&gt;{tenant-host}/{app-id}/User.ApiAccess&lt;/c&gt;.</code>
    <code class="c1">/// &lt;/summary&gt;</code>
    <code class="k">internal</code> <code class="k">const</code> <code class="kt">string</code> <code class="n">ScopeUrl</code> <code class="p">=</code>
        <code class="err">$</code><code class="s">"{TenantHost}/{TenantPublicAppId}/User.ApiAccess"</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>The class is defined as <code>static</code> because I do not intend to let developers create an instance of my object. The object exposes a single <code>const string</code> value named <code>ScopeUrl</code>. The first <code>const string</code> is <code>TenantHost</code>. The second <code>const string</code> is the public application identifier (App Id), or <code>TenantPublicAppId</code>. The <code>ScopeUrl</code> value is formatted as the host and App Id, with an ending segment representing the scope specifier <code>"User.ApiAccess"</code>.</p>

<p>This is just a utilitarian <code>static class</code>, and it’s a welcome alternative to having a hardcoded URL in <a data-primary="static classes" data-type="indexterm" id="idm46365025588704"/><a data-primary="classes" data-secondary="static" data-type="indexterm" id="idm46365025588000"/>the source. This approach is preferable with each segment of the fully qualified URL specified as a name identifier. These named values are to represent the Learning Blazor Azure B2C user scope. This configuration is handled in the section <a data-type="xref" href="#web-client-configure-services">“The Web.Client ConfigureServices Functionality”</a>. Next, we’ll cover the customization of the client authorization UX.</p>










<section data-pdf-bookmark="Customizing the client’s authorization experience" data-type="sect3"><div class="sect3" id="customizing-client-auth8-ux">
<h3>Customizing the client’s authorization experience</h3>

<p>The client-side configuration will <a data-primary="authorization" data-secondary="client experience" data-type="indexterm" id="atzxp"/>handle setting up the client’s frontend Blazor code to depend on specific services, clients, and authenticated endpoints. The user experiences an authentication flow, and while parts of that flow are configurable from Azure AD B2C, we’re also able to manage what the user experiences leading up to and returning from various states of the authentication flow. This is possible with the <code>"/authentication/{action}"</code> page’s route <a data-primary="Authentication.razor" data-type="indexterm" id="auct"/>template, and this belongs to the <em>Authentication.razor</em> markup:</p>

<pre data-code-language="html" data-type="programlisting"><code>@page "/authentication/{action}"
@inherits LocalizableComponentBase</code><code class="p">&lt;</code><code class="nt">Authentication</code><code class="p">&gt;</code>

<code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"is-size-3"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">RemoteAuthenticatorView</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO2-1" id="co_customizing_the_user_login_experience_CO2-1"><img alt="1" src="assets/1.png"/></a>
        <code class="na">Action</code><code class="o">=</code><code class="s">@Action</code>
        <code class="na">LogOut</code><code class="o">=</code><code class="s">@LocalizedLogOutFragment</code>
        <code class="na">LogOutSucceeded</code><code class="o">=</code><code class="s">@LocalizedLoggedOutFragment</code>
        <code class="na">LogOutFailed</code><code class="o">=</code><code class="s">@LocalizedLogOutFailedFragment</code>
        <code class="na">LogInFailed</code><code class="o">=</code><code class="s">@LocalizedLogInFailedFragment</code><code class="p">&gt;</code>

        <code class="p">&lt;</code><code class="nt">LoggingIn</code><code class="p">&gt;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO2-2" id="co_customizing_the_user_login_experience_CO2-2"><img alt="2" src="assets/2.png"/></a>
            <code class="p">&lt;</code><code class="nt">LoadingIndicator</code> <code class="na">Message</code><code class="o">=</code><code class="s">@Localizer["CheckingLoginState"]</code>
                              <code class="na">HideLogo</code><code class="o">=</code><code class="s">"true"</code> <code class="p">/</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">LoggingIn</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">CompletingLogOut</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">LoadingIndicator</code> <code class="na">Message</code><code class="o">=</code><code class="s">@Localizer["ProcessingLogoutCallback"]</code>
                              <code class="na">HideLogo</code><code class="o">=</code><code class="s">"true"</code> <code class="p">/</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">CompletingLogOut</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">CompletingLoggingIn</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">LoadingIndicator</code> <code class="na">Message</code><code class="o">=</code><code class="s">@Localizer["CompletingLogin"]</code>
                              <code class="na">HideLogo</code><code class="o">=</code><code class="s">"true"</code> <code class="p">/</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">CompletingLoggingIn</code><code class="p">&gt;</code>

    <code class="p">&lt;</code><code class="p">/</code><code class="nt">RemoteAuthenticatorView</code><code class="p">&gt;</code>
<code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO2-1" id="callout_customizing_the_user_login_experience_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The <code>Authentication</code> page <a data-primary="RemoteAuthenticatorView" data-type="indexterm" id="idm46365024477600"/>renders a <code>RemoteAuthenticatorView</code> component.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO2-2" id="callout_customizing_the_user_login_experience_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>Several component templates exist to render different fragments of the authentication flow.</p></dd>
</dl>

<p>Like most of the app’s components, the <code>Authentication</code> page is a component that also <code>@inherits LocalizableComponentBase</code>. It is considered a page since it defines an <code>@page "/authentication/{action}"</code> directive. The component is rendered when the client-side routing handles a navigation event in response to the browser’s URL requesting of the <code>/authentication/{action}</code> route, where <code>{action}</code> corresponds to the state of the remote authentication flow.</p>

<p>The component markup wraps the framework-provided <code>RemoteAuthenticatorView</code> component with a single <code>div</code> and <code>class</code> attribute to control the overall layout.</p>

<p>The <code>RemoteAuthenticatorView</code> component itself is where the customization capability comes from. This component exposes templated render fragment parameters. It is with this capability that you can provide a custom experience for the following <a data-primary="authentication" data-secondary="flow states" data-type="indexterm" id="idm46365024289792"/>authentication flow states:</p>
<dl>
<dt><code>LogOut</code></dt>
<dd>
<p>The UI to display while the <em>log out</em> event is being handled</p>
</dd>
<dt><code>LogOutSucceeded</code></dt>
<dd>
<p>The UI to display while the <em>log out succeeded</em> event is being handled</p>
</dd>
<dt><code>LogOutFailed</code></dt>
<dd>
<p>The UI to display while the <em>log out failed</em> event is being handled</p>
</dd>
<dt><code>LogInFailed</code></dt>
<dd>
<p>The UI to display while the <em>log in failed</em> event is being handled</p>
</dd>
<dt><code>LoggingIn</code></dt>
<dd>
<p>The UI to display while the <em>logging in</em> event is being handled</p>
</dd>
<dt><code>CompletingLogOut</code></dt>
<dd>
<p>The UI to display while the <em>completing log out</em> event is being handled</p>
</dd>
<dt><code>CompletingLoggingIn</code></dt>
<dd>
<p>The UI to display while the <em>completing logging in</em> event is being handled</p>
</dd>
</dl>

<p>Since these are all framework-provided <code>RenderFragment</code> types, we can customize what is rendered. We can assign to the <code>RemoteAuthenticatorView</code> component’s parameter properties inline or using multiple templated-parameter syntaxes. The <code>LoggingIn</code>, <code>CompletingLogOut</code>, and <code>CompletingLoggingIn</code> parameters are assigned to using the markup syntax, where other components can be referenced directly.</p>

<p>These three parameters are assigned <a data-primary="LoadingIndicator component" data-type="indexterm" id="idm46365025332992"/>given the custom <code>LoadingIndicator</code> component. The <code>LoadingIndicator</code> component conditionally renders the Blazor logo along with the loading indicator message and animated/styled spinning icon. All states of the authentication flow hide the Blazor logo, but they could choose to render it by setting the <code>LoadingIndicator.HideLogo</code> parameter to <code>false</code>. Each passes a localized text message to the loading indicator message. These three states are transitional, so when I was designing this approach I determined it best to use messaging that aligns with that expectation.</p>

<p>That’s not to say that you couldn’t just as easily use humorous nonsense instead. The authentication flow state is interesting only when you’re learning about it the first few times—beyond that we’re all nerds here now, so let’s get creative! We could replace these states with random facts—who doesn’t love hearing something interesting? I’ll leave that to you; send me a pull request, and I might just create a community-supported messaging list. The point is that it is entirely customizable. The following list contains the initial states <a data-primary="Authentication.razor" data-startref="auct" data-type="indexterm" id="idm46365025330112"/>that I’ve configured for the app:</p>
<dl>
<dt><code>LoggingIn</code></dt>
<dd>
<p>Relies on the <code>"CheckingLoginState"</code> localized message with the following value: <code>"Reading about the amazing Ada Lovelace (world's first computer <span class="keep-together">programmer)."</span></code></p>
</dd>
<dt><code>CompletingLogOut</code></dt>
<dd>
<p>Relies on the <code>"ProcessingLogoutCallback"</code> localized message: <code>"Things aren't always as they seem."</code></p>
</dd>
<dt><code>CompletingLogin</code></dt>
<dd>
<p>Relies on the <code>"CompletingLogin"</code> localized message: <code>"Plugging in the random wires lying around."</code></p>
</dd>
</dl>

<p>The <code>Authentication</code> page component’s shadow uses a slightly different technique to satisfy the <code>RenderFragment</code> delegate. Recall that a framework-provided <code>Render​Frag⁠ment</code> is a <code>void</code> returning <code>delegate</code> type, and it defines a <code>RenderTreeBuilder</code> parameter. With <a data-primary="Authentication.razor.cs" data-type="indexterm" id="aucrz"/>that in mind, consider the <em>Authentication.razor.cs</em> C# file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">using</code> <code class="nn">Microsoft.AspNetCore.Components.Rendering</code><code class="p">;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO3-1" id="co_customizing_the_user_login_experience_CO3-1"><img alt="1" src="assets/1.png"/></a>

<code class="k">namespace</code> <code class="nn">Learning.Blazor.Pages</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">sealed</code> <code class="k">partial</code> <code class="k">class</code> <code class="nc">Authentication</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO3-2" id="co_customizing_the_user_login_experience_CO3-2"><img alt="2" src="assets/2.png"/></a>
    <code class="p">{</code>
<code class="na">        [Parameter]</code> <code class="k">public</code> <code class="kt">string?</code> <code class="n">Action</code> <code class="p">{</code> <code class="k">get</code><code class="p">;</code> <code class="k">set</code><code class="p">;</code> <code class="p">}</code> <code class="p">=</code> <code class="k">null</code><code class="p">!</code><code class="p">;</code>

        <code class="k">private</code> <code class="k">void</code> <code class="nf">LocalizedLogOutFragment</code><code class="p">(</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO3-3" id="co_customizing_the_user_login_experience_CO3-3"><img alt="3" src="assets/3.png"/></a>
            <code class="n">RenderTreeBuilder</code> <code class="n">builder</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="n">ParagraphElementWithLocalizedContent</code><code class="p">(</code>
                <code class="n">builder</code><code class="p">,</code> <code class="n">Localizer</code><code class="p">,</code> <code class="s">"ProcessingLogout"</code><code class="p">)</code><code class="p">;</code>

        <code class="k">private</code> <code class="k">void</code> <code class="nf">LocalizedLoggedOutFragment</code><code class="p">(</code>
            <code class="n">RenderTreeBuilder</code> <code class="n">builder</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="n">ParagraphElementWithLocalizedContent</code><code class="p">(</code>
                <code class="n">builder</code><code class="p">,</code> <code class="n">Localizer</code><code class="p">,</code> <code class="s">"YouAreLoggedOut"</code><code class="p">)</code><code class="p">;</code>

        <code class="k">private</code> <code class="n">RenderFragment</code> <code class="nf">LocalizedLogInFailedFragment</code><code class="p">(</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO3-4" id="co_customizing_the_user_login_experience_CO3-4"><img alt="4" src="assets/4.png"/></a>
            <code class="kt">string</code> <code class="n">errorMessage</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="n">ParagraphElementWithLocalizedErrorContent</code><code class="p">(</code>
                <code class="n">errorMessage</code><code class="p">,</code> <code class="n">Localizer</code><code class="p">,</code> <code class="s">"ErrorLoggingInFormat"</code><code class="p">)</code><code class="p">;</code>

        <code class="k">private</code> <code class="n">RenderFragment</code> <code class="nf">LocalizedLogOutFailedFragment</code><code class="p">(</code>
            <code class="kt">string</code> <code class="n">errorMessage</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="n">ParagraphElementWithLocalizedErrorContent</code><code class="p">(</code>
                <code class="n">errorMessage</code><code class="p">,</code> <code class="n">Localizer</code><code class="p">,</code> <code class="s">"ErrorLoggingOutFormat"</code><code class="p">)</code><code class="p">;</code>

        <code class="k">private</code> <code class="k">static</code> <code class="k">void</code> <code class="nf">ParagraphElementWithLocalizedContent</code><code class="p">(</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO3-5" id="co_customizing_the_user_login_experience_CO3-5"><img alt="5" src="assets/5.png"/></a>
            <code class="n">RenderTreeBuilder</code> <code class="n">builder</code><code class="p">,</code>
            <code class="n">CoalescingStringLocalizer</code><code class="p">&lt;</code><code class="n">Authentication</code><code class="p">&gt;</code> <code class="n">localizer</code><code class="p">,</code>
            <code class="kt">string</code> <code class="n">resourceKey</code><code class="p">)</code>
        <code class="p">{</code>
            <code class="n">builder</code><code class="p">.</code><code class="n">OpenElement</code><code class="p">(</code><code class="m">0</code><code class="p">,</code> <code class="s">"p"</code><code class="p">)</code><code class="p">;</code>
            <code class="n">builder</code><code class="p">.</code><code class="n">AddContent</code><code class="p">(</code><code class="m">1</code><code class="p">,</code> <code class="n">localizer</code><code class="p">[</code><code class="n">resourceKey</code><code class="p">]</code><code class="p">)</code><code class="p">;</code>
            <code class="n">builder</code><code class="p">.</code><code class="n">CloseElement</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="p">}</code>

        <code class="k">private</code> <code class="k">static</code> <code class="n">RenderFragment</code> <code class="nf">ParagraphElementWithLocalizedErrorContent</code><code class="p">(</code>
            <code class="kt">string</code> <code class="n">errorMessage</code><code class="p">,</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO3-6" id="co_customizing_the_user_login_experience_CO3-6"><img alt="6" src="assets/6.png"/></a>
            <code class="n">CoalescingStringLocalizer</code><code class="p">&lt;</code><code class="n">Authentication</code><code class="p">&gt;</code> <code class="n">localizer</code><code class="p">,</code>
            <code class="kt">string</code> <code class="n">resourceKey</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="n">builder</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="p">{</code>
                <code class="n">builder</code><code class="p">.</code><code class="n">OpenElement</code><code class="p">(</code><code class="m">0</code><code class="p">,</code> <code class="s">"p"</code><code class="p">)</code><code class="p">;</code>
                <code class="n">builder</code><code class="p">.</code><code class="n">AddContent</code><code class="p">(</code><code class="m">1</code><code class="p">,</code> <code class="n">localizer</code><code class="p">[</code><code class="n">resourceKey</code><code class="p">,</code> <code class="n">errorMessage</code><code class="p">]</code><code class="p">)</code><code class="p">;</code>
                <code class="n">builder</code><code class="p">.</code><code class="n">CloseElement</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
            <code class="p">}</code><code class="p">;</code>
    <code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO3-1" id="callout_customizing_the_user_login_experience_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The component uses the <code>Rendering</code> namespace <a data-primary="namespaces" data-secondary="Rendering" data-type="indexterm" id="idm46365024268512"/><a data-primary="Rendering namespace" data-type="indexterm" id="idm46365024267504"/>to consume <code>RenderTreeBuilder</code> and <code>RenderFragment</code> types.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO3-2" id="callout_customizing_the_user_login_experience_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The <code>Authentication</code> page has several states.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO3-3" id="callout_customizing_the_user_login_experience_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>Each method either satisfies the <code>RenderFragment</code> delegate signature or returns a <code>RenderFragment</code> type.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO3-4" id="callout_customizing_the_user_login_experience_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>A localized message is rendered when the authentication flow state has failed to log in.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO3-5" id="callout_customizing_the_user_login_experience_CO3-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The <code>ParagraphElementWithLocalizedContent</code> method creates a <code>p</code> element with a localized message.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO3-6" id="callout_customizing_the_user_login_experience_CO3-6"><img alt="6" src="assets/6.png"/></a></dt>
<dd><p>The <code>ParagraphElementWithLocalizedErrorContent</code> method differs by accepting a formattable error message.</p></dd>
</dl>

<p>The <code>RenderFragment</code>, <code>RenderFragment&lt;T&gt;</code>, and <code>RenderTreeBuilder</code> types were first discussed in <a data-type="xref" href="ch02.html#blazor-navigation-essentials">“Blazor navigation essentials”</a> and are part of the <code>Micro⁠soft​.AspNetCore.Components.Rendering</code> namespace, while the <code>Authentication</code> page component is in <code>Learning.Blazor.Pages</code>.</p>

<p>The <code>Authentication</code> page component is opaque in that it defines a <code>string</code> property named <code>Action</code> and binds it to the framework-provided <code>RemoteAuthenticatorView.Action</code> property of the same name. This component is also a <code>partial class</code>, serving as the markup’s shadow with code-behind.</p>

<p>The <code>LocalizedLogOutFragment</code> method is <code>private</code>; however, the <code>partial class</code> markup component has access to it. This method is assigned to the rendering responsibility when the client browser has finished handling the <em>log out</em> authentication flow. Its parameter is the <code>RenderTreeBuilder builder</code> instance. The builder is immediately passed to the <code>ParagraphElementWithLocalizedContent</code> method along with <code>Localizer</code> and a const string value of <code>"ProcessingLogout"</code>. This pattern is repeated for the <code>LocalizedLoggedOutFragment</code> method delegating to the same helper function, changing only the third parameter to <code>"YouAreLoggedOut"</code>. These two methods are <code>void</code> returning and <code>RenderTreeBuilder</code> parameter accepting. This means that they match the <code>RenderFragment</code> delegate expected signature.</p>

<p>For education, I’ll show a few more ways to customize using a slightly different approach. Notice that <code>LocalizedLogInFailedFragment</code> is <em>not</em> <code>void</code> returning, nor is it <code>RenderTreeBuilder</code> parameter accepting. Instead, this method returns a <code>RenderFragment</code> and accepts a <code>string</code>. This is possible as there are two <code>RenderFragment</code> delegates:</p>

<ul>
<li>
<p><code>delegate void RenderFragment(RenderTreeBuilder builder);</code></p>
</li>
<li>
<p><code>delegate RenderFragment RenderFragment&lt;TValue&gt;(TValue value);</code></p>
</li>
</ul>

<p>The <code>ParagraphElementWithLocalizedContent</code> method uses the <code>RenderTreeBuilder builder</code>, <code>CoalescingStringLocalizer&lt;Authentication&gt; localizer</code>, and <code>string resourceKey</code> parameters. Using the <code>builder</code>, an opening <code>&lt;p&gt;</code> HTML element is built. Content is added given the value of the <code>localizer[resourceKey]</code> evaluation. Finally, the closing <code>&lt;/p&gt;</code> HTML element is built. This method is being used by the <em>log out</em> and <em>logged out</em> authentication flow events:</p>

<ul>
<li>
<p><code>"ProcessingLogout"</code> renders the “If you’re not changing the world, you’re standing still” message.</p>
</li>
<li>
<p><code>"YouAreLoggedOut"</code> renders the “Bye for now!” message.</p>
</li>
</ul>

<p>The <code>ParagraphElementWithLocalizedErrorContent</code> method is similar to the 
<span class="keep-together"><code>ParagraphElementWithLocalizedContent</code></span> method in that it defines identical parameters, but it returns different things. In this case, the generic <code>Render​Frag⁠ment&lt;string&gt;</code> delegate type is inferred, even though the <code>RenderFragment</code> delegate type is explicitly returned. This method is being used by the <em>log in failed</em> and <em>log out failed</em> authentication flow events:</p>

<ul>
<li>
<p>When login fails, display a formatted message of <code>"There was an error trying to log you in: '{0}'"</code>.</p>
</li>
<li>
<p>When logout fails, display a formatted message of <code>"There was an error trying to log you out: '{0}'"</code>.</p>
</li>
</ul>

<p>The <code>{0}</code> values within the message formats are used <a data-primary="AuthorizationMessageHandler" data-startref="atzhd" data-type="indexterm" id="idm46365025716000"/><a data-primary="Learning Blazor app" data-secondary="authorization message" data-startref="lblzzg" data-type="indexterm" id="idm46365025715056"/><a data-primary="authorization" data-secondary="client experience" data-startref="atzxp" data-type="indexterm" id="idm46365025713840"/><a data-primary="Authentication.razor.cs" data-startref="aucrz" data-type="indexterm" id="idm46365025712624"/>as placeholders for the raw and untranslated error messages.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="The Web.Client ConfigureServices Functionality" data-type="sect2"><div class="sect2" id="web-client-configure-services">
<h2>The Web.Client ConfigureServices Functionality</h2>

<p>You should recall the common nomenclature <a data-primary="ConfigureServices extension method" data-type="indexterm" id="cfgx"/><a data-primary="methods" data-secondary="ConfigureServices extension method" data-type="indexterm" id="mtfgv"/>of the top-level WebAssembly app entry point, a C# top-level program. This was initially shown in <a data-type="xref" href="ch02.html#blazor_webassembly_program">Example 2-1</a> and covered the <code>ConfigureServices</code> extension method. We didn’t discuss the specifics of the client-side service registration. A majority of that work happens <a data-primary="WebAssemblyHostBuilderExtensions.cs" data-type="indexterm" id="wbssy"/>in the <em>WebAssembly​HostBuilderExtensions.cs</em> C# file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code> <code class="nn">Learning.Blazor.Extensions</code><code class="p">;</code>

<code class="k">internal</code> <code class="k">static</code> <code class="k">class</code> <code class="nc">WebAssemblyHostBuilderExtensions</code>
<code class="p">{</code>
    <code class="k">internal</code> <code class="k">static</code> <code class="n">WebAssemblyHostBuilder</code> <code class="nf">ConfigureServices</code><code class="p">(</code>
        <code class="k">this</code> <code class="n">WebAssemblyHostBuilder</code> <code class="n">builder</code><code class="p">)</code>
    <code class="p">{</code>
        <code class="kt">var</code> <code class="p">(</code><code class="n">services</code><code class="p">,</code> <code class="n">configuration</code><code class="p">)</code> <code class="p">=</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO4-1" id="co_customizing_the_user_login_experience_CO4-1"><img alt="1" src="assets/1.png"/></a>
            <code class="p">(</code><code class="n">builder</code><code class="p">.</code><code class="n">Services</code><code class="p">,</code> <code class="n">builder</code><code class="p">.</code><code class="n">Configuration</code><code class="p">)</code><code class="p">;</code>

        <code class="n">services</code><code class="p">.</code><code class="n">AddMemoryCache</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddScoped</code><code class="p">&lt;</code><code class="n">ApiAccessAuthorizationMessageHandler</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">Configure</code><code class="p">&lt;</code><code class="n">WebApiOptions</code><code class="p">&gt;</code><code class="p">(</code>
            <code class="n">configuration</code><code class="p">.</code><code class="n">GetSection</code><code class="p">(</code><code class="n">nameof</code><code class="p">(</code><code class="n">WebApiOptions</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code class="p">;</code>

        <code class="k">static</code> <code class="n">WebApiOptions</code><code class="p">?</code> <code class="n">GetWebApiOptions</code><code class="p">(</code>
            <code class="n">IServiceProvider</code> <code class="n">serviceProvider</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="n">serviceProvider</code><code class="p">.</code><code class="n">GetService</code><code class="p">&lt;</code><code class="n">IOptions</code><code class="p">&lt;</code><code class="n">WebApiOptions</code><code class="p">&gt;</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code>
                <code class="p">?</code><code class="p">.</code><code class="n">Value</code><code class="p">;</code>

        <code class="kt">var</code> <code class="n">addHttpClient</code> <code class="p">=</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO4-2" id="co_customizing_the_user_login_experience_CO4-2"><img alt="2" src="assets/2.png"/></a>
            <code class="k">static</code> <code class="nf">IHttpClientBuilder</code> <code class="p">(</code>
                <code class="n">IServiceCollection</code> <code class="n">services</code><code class="p">,</code> <code class="kt">string</code> <code class="n">httpClientName</code><code class="p">,</code>
                <code class="n">Func</code><code class="p">&lt;</code><code class="n">WebApiOptions</code><code class="p">?</code><code class="p">,</code> <code class="kt">string?</code><code class="p">&gt;</code> <code class="n">webApiOptionsUrlFactory</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
                <code class="n">services</code><code class="p">.</code><code class="n">AddHttpClient</code><code class="p">(</code>
                    <code class="n">httpClientName</code><code class="p">,</code> <code class="p">(</code><code class="n">serviceProvider</code><code class="p">,</code> <code class="n">client</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="p">{</code>
                <code class="kt">var</code> <code class="n">options</code> <code class="p">=</code> <code class="n">GetWebApiOptions</code><code class="p">(</code><code class="n">serviceProvider</code><code class="p">)</code><code class="p">;</code>
                <code class="kt">var</code> <code class="n">apiUrl</code> <code class="p">=</code> <code class="n">webApiOptionsUrlFactory</code><code class="p">(</code><code class="n">options</code><code class="p">)</code><code class="p">;</code>
                <code class="k">if</code> <code class="p">(</code><code class="n">apiUrl</code> <code class="k">is</code> <code class="p">{</code> <code class="n">Length</code><code class="p">:</code> <code class="p">&gt;</code> <code class="m">0</code> <code class="p">}</code><code class="p">)</code>
                    <code class="n">client</code><code class="p">.</code><code class="n">BaseAddress</code> <code class="p">=</code> <code class="k">new</code> <code class="n">Uri</code><code class="p">(</code><code class="n">apiUrl</code><code class="p">)</code><code class="p">;</code>

                <code class="kt">var</code> <code class="n">cultureService</code> <code class="p">=</code>
                    <code class="n">serviceProvider</code><code class="p">.</code><code class="n">GetRequiredService</code><code class="p">&lt;</code><code class="n">CultureService</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>

                <code class="n">client</code><code class="p">.</code><code class="n">DefaultRequestHeaders</code><code class="p">.</code><code class="n">AcceptLanguage</code><code class="p">.</code><code class="n">ParseAdd</code><code class="p">(</code>
                    <code class="n">cultureService</code><code class="p">.</code><code class="n">CurrentCulture</code><code class="p">.</code><code class="n">TwoLetterISOLanguageName</code><code class="p">)</code><code class="p">;</code>
            <code class="p">}</code><code class="p">)</code>
            <code class="p">.</code><code class="n">AddHttpMessageHandler</code><code class="p">&lt;</code><code class="n">ApiAccessAuthorizationMessageHandler</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>

        <code class="n">_</code> <code class="p">=</code> <code class="n">addHttpClient</code><code class="p">(</code>
            <code class="n">services</code><code class="p">,</code> <code class="n">HttpClientNames</code><code class="p">.</code><code class="n">ServerApi</code><code class="p">,</code>
            <code class="n">options</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">options</code><code class="p">?</code><code class="p">.</code><code class="n">WebApiServerUrl</code><code class="p">)</code><code class="p">;</code>
        <code class="n">_</code> <code class="p">=</code> <code class="n">addHttpClient</code><code class="p">(</code>
            <code class="n">services</code><code class="p">,</code> <code class="n">HttpClientNames</code><code class="p">.</code><code class="n">PwnedServerApi</code><code class="p">,</code>
            <code class="n">options</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">options</code><code class="p">?</code><code class="p">.</code><code class="n">PwnedWebApiServerUrl</code><code class="p">)</code><code class="p">;</code>
        <code class="n">_</code> <code class="p">=</code> <code class="n">addHttpClient</code><code class="p">(</code>
            <code class="n">services</code><code class="p">,</code> <code class="n">HttpClientNames</code><code class="p">.</code><code class="n">WebFunctionsApi</code><code class="p">,</code>
            <code class="n">options</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">options</code><code class="p">?</code><code class="p">.</code><code class="n">WebFunctionsUrl</code> <code class="p">?</code><code class="p">?</code>
                <code class="n">builder</code><code class="p">.</code><code class="n">HostEnvironment</code><code class="p">.</code><code class="n">BaseAddress</code><code class="p">)</code><code class="p">;</code>

        <code class="n">services</code><code class="p">.</code><code class="n">AddScoped</code><code class="p">&lt;</code><code class="n">WeatherFunctionsClientService</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddScoped</code><code class="p">(</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO4-3" id="co_customizing_the_user_login_experience_CO4-3"><img alt="3" src="assets/3.png"/></a>
            <code class="n">sp</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">sp</code><code class="p">.</code><code class="n">GetRequiredService</code><code class="p">&lt;</code><code class="n">IHttpClientFactory</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code>
                <code class="p">.</code><code class="n">CreateClient</code><code class="p">(</code><code class="n">HttpClientNames</code><code class="p">.</code><code class="n">ServerApi</code><code class="p">)</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddLocalization</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddMsalAuthentication</code><code class="p">(</code>
            <code class="n">options</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="p">{</code>
                <code class="n">configuration</code><code class="p">.</code><code class="n">Bind</code><code class="p">(</code>
                    <code class="s">"AzureAdB2C"</code><code class="p">,</code> <code class="n">options</code><code class="p">.</code><code class="n">ProviderOptions</code><code class="p">.</code><code class="n">Authentication</code><code class="p">)</code><code class="p">;</code>
                <code class="n">options</code><code class="p">.</code><code class="n">ProviderOptions</code><code class="p">.</code><code class="n">LoginMode</code> <code class="p">=</code> <code class="s">"redirect"</code><code class="p">;</code>
                <code class="kt">var</code> <code class="k">add</code> <code class="p">=</code> <code class="n">options</code><code class="p">.</code><code class="n">ProviderOptions</code><code class="p">.</code><code class="n">DefaultAccessTokenScopes</code><code class="p">.</code><code class="n">Add</code><code class="p">;</code>

                <code class="k">add</code><code class="p">(</code><code class="s">"openid"</code><code class="p">)</code><code class="p">;</code>
                <code class="k">add</code><code class="p">(</code><code class="s">"offline_access"</code><code class="p">)</code><code class="p">;</code>
                <code class="k">add</code><code class="p">(</code><code class="n">AzureAuthenticationTenant</code><code class="p">.</code><code class="n">ScopeUrl</code><code class="p">)</code><code class="p">;</code>
            <code class="p">}</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddOptions</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddAuthorizationCore</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddSingleton</code><code class="p">&lt;</code><code class="n">SharedHubConnection</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddSingleton</code><code class="p">&lt;</code><code class="n">AppInMemoryState</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddSingleton</code><code class="p">&lt;</code><code class="n">CultureService</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddSingleton</code><code class="p">(</code><code class="k">typeof</code><code class="p">(</code><code class="n">CoalescingStringLocalizer</code><code class="p">&lt;</code><code class="p">&gt;</code><code class="p">)</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddScoped</code>
            <code class="p">&lt;</code><code class="n">IWeatherStringFormatterService</code><code class="p">,</code> <code class="n">WeatherStringFormatterService</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddScoped</code><code class="p">&lt;</code><code class="n">GeoLocationService</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddHttpClient</code><code class="p">&lt;</code><code class="n">GeoLocationService</code><code class="p">&gt;</code><code class="p">(</code><code class="n">client</code> <code class="p">=</code><code class="p">&gt;</code>
        <code class="p">{</code>
            <code class="kt">var</code> <code class="n">apiHost</code> <code class="p">=</code> <code class="s">"https://api.bigdatacloud.net"</code><code class="p">;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO4-4" id="co_customizing_the_user_login_experience_CO4-4"><img alt="4" src="assets/4.png"/></a>
            <code class="kt">var</code> <code class="n">reverseGeocodeClientRoute</code> <code class="p">=</code> <code class="s">"data/reverse-geocode-client"</code><code class="p">;</code>
            <code class="n">client</code><code class="p">.</code><code class="n">BaseAddress</code> <code class="p">=</code>
                <code class="k">new</code> <code class="nf">Uri</code><code class="p">(</code><code class="err">$</code><code class="s">"{apiHost}/{reverseGeocodeClientRoute}"</code><code class="p">)</code><code class="p">;</code>
            <code class="n">client</code><code class="p">.</code><code class="n">DefaultRequestHeaders</code><code class="p">.</code><code class="n">AcceptEncoding</code><code class="p">.</code><code class="n">ParseAdd</code><code class="p">(</code><code class="s">"gzip"</code><code class="p">)</code><code class="p">;</code>
        <code class="p">}</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddJokeServices</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddLocalStorageServices</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="n">services</code><code class="p">.</code><code class="n">AddSpeechRecognitionServices</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>

        <code class="k">return</code> <code class="n">builder</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO4-1" id="callout_customizing_the_user_login_experience_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The <code>(IServiceCollection services, IConfiguration configuration)</code> tuple is being used to capture <a data-primary="IServiceCollection extension method" data-type="indexterm" id="idm46365023393168"/><a data-primary="IConfiguration extension method" data-type="indexterm" id="idm46365023408784"/><a data-primary="methods" data-secondary="IServiceCollection extension method" data-type="indexterm" id="idm46365023408096"/><a data-primary="methods" data-secondary="IConfiguration extension method" data-type="indexterm" id="idm46365023407136"/>the <code>services</code> and <code>configuration</code> as locals.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO4-2" id="callout_customizing_the_user_login_experience_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>A static local function <code>addHttpClient</code> is defined.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO4-3" id="callout_customizing_the_user_login_experience_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p><code>IHttpClientFactory</code> is being added as a singleton.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO4-4" id="callout_customizing_the_user_login_experience_CO4-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The geolocation API has its <code>HttpClient</code> configured.</p></dd>
</dl>

<p>The file-scoped namespace <a data-primary="namespaces" data-secondary="Learning.Blazor.Extensions" data-type="indexterm" id="idm46365025472880"/><a data-primary="Learning.Blazor.Extensions" data-type="indexterm" id="idm46365025471952"/>is <code>Learning.Blazor.Extensions</code>, which shares all extension’s functionality for the client code. The extensions class is <code>internal</code>, and like all extensions classes, it is required to be <code>static</code>. The <code>ConfigureServices</code> method is named this way because it might seem familiar to ASP.NET Core developers who were accustomed to startup conventions, but it doesn’t have to be named this way. To allow for method chaining, this extension method returns the <code>WebAssemblyHostBuilder</code> object that it extends.</p>

<p>Declare and assign the <code>services</code> and <code>configuration</code> objects from the <code>builder</code>. Then it’s off to the races as we add the scoped aforementioned <code>ApiAccessAuthorizationMessageHandler</code> as <a data-primary="WebApiOptions object" data-type="indexterm" id="idm46365023669312"/>a service. The <code>WebApiOptions</code> instance is configured, essentially binding them from the resolved <code>configuration</code> instance’s <code>WebApiOptions</code> object. There is a static local function named <code>GetWebApiOptions</code> that returns a questionable <code>WebApiOptions</code> object given an <code>IServiceProvider</code> instance.</p>

<p>To avoid <a data-primary="code" data-secondary="duplicating" data-type="indexterm" id="idm46365022853072"/>duplicating code, <code>addHttpClient</code> is a static local function that encapsulates the adding and configuring of an HTTP client. It returns an <code>IHttpClientBuilder</code> instance given the <code>services</code>, an <code>httpClientName</code>, and a function that acts as a factory. The function is named <code>webApiOptionsUrlFactory</code>, and it returns a nullable string given the configured options object. The lambda expression delegates to the <code>AddHttpClient</code> extension method on the <code>IServiceCollection</code> type. This configures the HTTP <code>client</code> base address from the configured URL. It also sets the <code>"Accept-Language"</code> default request header to the currently configured <code>Culture​Ser⁠vice</code> instance’s ISO 639-1 two-letter code. There are two calls to this <code>addHttp​Client</code> expression: setting up the Web API server endpoint and the “Have I Been Pwned” server endpoint.</p>

<p>A few additional services are added, and the <a data-primary="MSAL (Microsoft Authentication Library)" data-type="indexterm" id="idm46365022864624"/><a data-primary="Microsoft Authentication Library (MSAL)" data-type="indexterm" id="idm46365023043360"/>Microsoft Authentication Library (MSAL) services are configured and bound to the <code>"AzureAdB2C"</code> section of the <code>configuration</code> instance. <code>LoginMode</code> is assigned to <code>"redirect"</code>, which causes the app to redirect the user to Azure AD B2C to complete sign-in. Another example of the improvements to lambda expressions is how we declare and assign a variable named <code>add</code>, which delegates to the <code>DefaultAccessTokenScopes.Add</code> functionality on the collection method. It expects a string and is <code>void</code> returning. The <code>add</code> variable is then invoked three times, adding the <code>"openid"</code>, <code>"offline_access"</code>, and <code>ScopeUrl</code> scopes. Many of the remaining services are then registered.</p>

<p><code>HttpClient</code> is added <a data-primary="HttpClient" data-type="indexterm" id="idm46365025468352"/>and configured, which will be used when DI resolves the <code>Geo​Lo⁠cationService</code>. The big data cloud, API host, and route are used as the base address for the <code>client</code>. The additional dependencies are then registered, which include the Joke Services and Local Storage packages. <code>IJSInProcessRuntime</code> is <a data-primary="IJSInProcessRuntime" data-type="indexterm" id="idm46365025466176"/>registered as a single instance, resolved by a cast from <code>IJSRuntime</code>. This is possible only with Blazor WebAssembly. This is discussed in much more detail in <a data-type="xref" href="ch07.html#chapter-seven">Chapter 7</a>. Finally, <code>builder</code> is returned, completing the fluent <code>ConfigureServices</code> API.</p>

<p>This single extension method is the code that is responsible for configuring the DI of the client-side app. You will have noticed that the HTTP message handler was configured for the <code>HttpClient</code> instances that will forward the bearer tokens on behalf of the client from <code>ApiAccessAuthorizationMessageHandler</code>. This is important, as not all API endpoints require an authenticated user, but <a data-primary="ConfigureServices extension method" data-startref="cfgx" data-type="indexterm" id="idm46365023520944"/><a data-primary="methods" data-secondary="ConfigureServices extension method" data-startref="mtfgv" data-type="indexterm" id="idm46365023519936"/><a data-primary="WebAssemblyHostBuilderExtensions.cs" data-startref="wbssy" data-type="indexterm" id="idm46365023518704"/>those that do will be accessible only when correctly configured this way.</p>
</div></section>





</div></section>













<section data-pdf-bookmark="Native Speech Synthesis" data-type="sect1"><div class="sect1" id="native-speech-synthesis">
<h1>Native Speech Synthesis</h1>

<p>You’ve seen how to register all the client-side <a data-primary="Learning Blazor app" data-secondary="native speech synthesis" data-type="indexterm" id="lztvy"/><a data-primary="native speech synthesis" data-type="indexterm" id="vpyth"/>services for DI and how to consume registered services in components. In the previous chapter, you saw how the home page renders its tiled content. If you recall, each tile had some markup that included <code>AdditiveSpeechComponent</code>. While I showed you <a data-primary="AdditiveSpeechComponent" data-type="indexterm" id="dvpp"/>how to consume this component, I didn’t yet expand upon how it works. Any component that attaches to <code>Additive​S⁠peechComponent</code> will be able to use a native speech synthesis service. Clicking on the audio buttons, which are shown in <a data-type="xref" href="#home-page-tiles">Figure 4-2</a>, will trigger the speech synthesis service to speak the text of the tile.</p>

<figure><div class="figure" id="home-page-tiles">
<img alt="" src="assets/lblz_0402.png"/>
<h6><span class="label">Figure 4-2. </span>Home page tiles</h6>
</div></figure>

<p><code>AdditiveSpeechComponent</code> exposes a single <code>Message</code> parameter. The consuming components reference this component and assign a <a data-primary="AdditiveSpeechComponent.razor" data-type="indexterm" id="adppz"/>message. Consider the <em>Additive​S⁠peechComponent.razor</em> markup file:</p>

<pre class="pagebreak-before" data-code-language="html" data-type="programlisting">@inherits LocalizableComponentBase<code class="p">&lt;</code><code class="nt">AdditiveSpeechComponent</code><code class="p">&gt;</code>

<code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"is-top-right-overlay"</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">button</code> <code class="na">class</code><code class="o">=</code><code class="s">"button is-rounded is-theme-aware-button p-4 @_dynamicCSS"</code>
        <code class="na">disabled</code><code class="o">=</code><code class="s">@_isSpeaking</code> <code class="err">@</code><code class="na">onclick</code><code class="o">=</code><code class="s">OnSpeakButtonClickAsync</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"icon is-small"</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-volume-up"</code><code class="p">&gt;&lt;/</code><code class="nt">i</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code></pre>

<p><code>AdditiveSpeechComponent</code> inherits <code>LocalizableComponentBase</code> to use three common services that are injected into the base class. The <code>AppInMemoryState</code>, <code>CultureService</code>, and <code>IJSRuntime</code> services are common enough to warrant this inheritance.</p>

<p>The markup is a <code>div</code> element with a descriptive <code>class</code> attribute, which overlays the element in the top-righthand corner of the consuming component. The <code>div</code> element is a parent to a rounded and theme-aware <code>button</code> with a bit of dynamic CSS. The button itself is <code>disabled</code> when the <code>_isSpeaking</code> bit evaluates as <code>true</code>. This is the first component markup we’re covering that shows Blazor event handling. When the user clicks the button, the <code>OnSpeakButtonClickAsync</code> event handler is called.</p>

<p>You can specify event <a data-primary="Document Object Model (DOM)" data-secondary="event handlers" data-type="indexterm" id="idm46365023140576"/><a data-primary="events" data-secondary="DOM, handlers" data-type="indexterm" id="idm46365023139600"/>handlers for all valid DOM events. The syntax follows a very specific pattern: <code>@on{EventName}={EventHandler}</code>. This syntax is applied as an element attribute, where:</p>

<ul>
<li>
<p><code>{EventName}</code> is the <a href="https://oreil.ly/ToPqA">DOM event name</a></p>
</li>
<li>
<p><code>{EventHandler}</code> is the name of the method that will handle the event</p>
</li>
</ul>

<p>For example, <code>@onclick=OnSpeakButtonClickAsync</code> assigns the <code>OnSpeakButtonClickAsync</code> event handler to the <code>click</code> event of the element; in other words, when the click is fired, it <a data-primary="AdditiveSpeechComponent.razor" data-startref="adppz" data-type="indexterm" id="idm46365022884816"/>calls <code>OnSpeakButtonClickAsync</code>.</p>

<p>The <code>OnSpeakButtonClickAsync</code> method is defined in the component shadow, and it is <code>Task</code> returning. This means that in addition to synchronous event handlers, asynchronous event handlers are fully supported. With Blazor event handlers, changes to the UI are automatically triggered, so you will not have to manually call <code>State​Ha⁠sChanged</code> to signal <a data-primary="AdditiveSpeechComponent.razor.cs" data-type="indexterm" id="adprzc"/>rerendering. The <em>AdditiveSpeechComponent.razor.cs</em> C# file looks like this:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code> <code class="nn">Learning.Blazor.Components</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">partial</code> <code class="k">class</code> <code class="nc">AdditiveSpeechComponent</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO5-1" id="co_customizing_the_user_login_experience_CO5-1"><img alt="1" src="assets/1.png"/></a>
    <code class="p">{</code>
        <code class="k">private</code> <code class="kt">bool</code> <code class="n">_isSpeaking</code> <code class="p">=</code> <code class="k">false</code><code class="p">;</code>
        <code class="k">private</code> <code class="kt">string</code> <code class="n">_dynamicCSS</code>
        <code class="p">{</code>
            <code class="k">get</code>
            <code class="p">{</code>
                <code class="k">return</code> <code class="kt">string</code><code class="p">.</code><code class="n">Join</code><code class="p">(</code><code class="s">" "</code><code class="p">,</code> <code class="n">GetStyles</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">.</code><code class="n">Trim</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>

                <code class="n">IEnumerable</code><code class="p">&lt;</code><code class="kt">string</code><code class="p">&gt;</code> <code class="n">GetStyles</code><code class="p">(</code><code class="p">)</code>
                <code class="p">{</code>
                    <code class="k">if</code> <code class="p">(</code><code class="kt">string</code><code class="p">.</code><code class="n">IsNullOrWhiteSpace</code><code class="p">(</code><code class="n">Message</code><code class="p">)</code><code class="p">)</code>
                        <code class="k">yield</code> <code class="k">return</code> <code class="s">"is-hidden"</code><code class="p">;</code>

                    <code class="k">if</code> <code class="p">(</code><code class="n">_isSpeaking</code><code class="p">)</code>
                        <code class="k">yield</code> <code class="k">return</code> <code class="s">"is-flashing"</code><code class="p">;</code>
                <code class="p">}</code><code class="p">;</code>
            <code class="p">}</code>
        <code class="p">}</code>
<code class="na">
        [Parameter]</code>
        <code class="k">public</code> <code class="kt">string?</code> <code class="n">Message</code> <code class="p">{</code> <code class="k">get</code><code class="p">;</code> <code class="k">set</code><code class="p">;</code> <code class="p">}</code> <code class="p">=</code> <code class="k">null</code><code class="p">!</code><code class="p">;</code>

        <code class="k">async</code> <code class="n">Task</code> <code class="nf">OnSpeakButtonClickAsync</code><code class="p">(</code><code class="p">)</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO5-2" id="co_customizing_the_user_login_experience_CO5-2"><img alt="2" src="assets/2.png"/></a>
        <code class="p">{</code>
            <code class="k">if</code> <code class="p">(</code><code class="n">Message</code> <code class="k">is</code> <code class="k">null</code> <code class="n">or</code> <code class="p">{</code> <code class="n">Length</code><code class="p">:</code> <code class="m">0</code> <code class="p">}</code><code class="p">)</code>
            <code class="p">{</code>
                <code class="k">return</code><code class="p">;</code>
            <code class="p">}</code>

            <code class="kt">var</code> <code class="p">(</code><code class="n">voice</code><code class="p">,</code> <code class="n">voiceSpeed</code><code class="p">)</code> <code class="p">=</code> <code class="n">AppState</code><code class="p">.</code><code class="n">ClientVoicePreference</code><code class="p">;</code>
            <code class="kt">var</code> <code class="n">bcp47Tag</code> <code class="p">=</code> <code class="n">Culture</code><code class="p">.</code><code class="n">CurrentCulture</code><code class="p">.</code><code class="n">Name</code><code class="p">;</code>

            <code class="n">_isSpeaking</code> <code class="p">=</code> <code class="k">true</code><code class="p">;</code>

            <code class="k">await</code> <code class="n">JavaScript</code><code class="p">.</code><code class="n">SpeakMessageAsync</code><code class="p">(</code>
                <code class="k">this</code><code class="p">,</code>
                <code class="n">nameof</code><code class="p">(</code><code class="n">OnSpokenAsync</code><code class="p">)</code><code class="p">,</code>
                <code class="n">Message</code><code class="p">,</code>
                <code class="n">voice</code><code class="p">,</code>
                <code class="n">voiceSpeed</code><code class="p">,</code>
                <code class="n">bcp47Tag</code><code class="p">)</code><code class="p">;</code>
        <code class="p">}</code>
<code class="na">
        [JSInvokable]</code>
        <code class="k">public</code> <code class="n">Task</code> <code class="nf">OnSpokenAsync</code><code class="p">(</code><code class="kt">double</code> <code class="n">elapsedTimeInMilliseconds</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO5-3" id="co_customizing_the_user_login_experience_CO5-3"><img alt="3" src="assets/3.png"/></a>
            <code class="n">InvokeAsync</code><code class="p">(</code><code class="p">(</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="p">{</code>
                <code class="n">_isSpeaking</code> <code class="p">=</code> <code class="k">false</code><code class="p">;</code>

                <code class="n">Logger</code><code class="p">.</code><code class="n">LogInformation</code><code class="p">(</code>
                    <code class="s">"Spoke utterance in {ElapsedTime} milliseconds"</code><code class="p">,</code>
                    <code class="n">elapsedTimeInMilliseconds</code><code class="p">)</code><code class="p">;</code>

                <code class="n">StateHasChanged</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
            <code class="p">}</code><code class="p">)</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO5-1" id="callout_customizing_the_user_login_experience_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p><code>AdditiveSpeechComponent</code> maintains several bits of component state.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO5-2" id="callout_customizing_the_user_login_experience_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The <code>OnSpeakButtonClickAsync</code> method conditionally speaks a message.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO5-3" id="callout_customizing_the_user_login_experience_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The <code>OnSpokenAsync</code> method is called after the message has been spoken.</p></dd>
</dl>

<p>The class has an <code>_isSpeaking</code> field that defaults to <code>false</code>. This value is used to determine how to render <code>&lt;button&gt;</code>. The <code>_dynamicCSS</code> property only has a <code>get</code> accessor, which makes it read-only. It determines the styles applied to <code>&lt;button&gt;</code>. The <code>Message</code> property is a <code>Parameter</code>, which is what allows it to be assigned from consuming components.</p>

<p>The event handler that was assigned to handle the button’s <code>click</code> event is the 
<span class="keep-together"><code>OnSpeakButtonClickAsync</code></span> method. When there is a meaningful value from 
<span class="keep-together"><code>Message</code>,</span> this handler gets <code>voice</code> and <code>voiceSpeed</code> from the in-memory app state service, as well as the <a href="https://oreil.ly/cZ57I">Best Current Practices (BCP 47) language tag</a> value from the current culture. The <code>_isSpeaking</code> bit is set to <code>true</code>, and a call to <code>JavaScript.SpeakMessage​A⁠sync</code> is awaited given <code>this</code> component, the name of the <code>OnSpokenAsync</code> callback, <code>Message</code>, <code>voice</code>, <code>voiceSpeed</code>, and <code>bcp47Tag</code>. This pattern might start looking a bit familiar; as much or as little as your app needs to rely on native functionality from the browser, it can use JavaScript interop.</p>

<p>The <code>OnSpokenAsync</code> method is <a data-primary="OnSpokenAsync method" data-type="indexterm" id="idm46365023679424"/><a data-primary="methods" data-secondary="OnSpokenAsync" data-type="indexterm" id="idm46365023678688"/>declared as <code>JSInvokable</code>. Since this callback happens asynchronously and at an undetermined time, the component couldn’t know when to rerender, so you must tell it to with <code>StateHasChanged</code>.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Anytime you define a method that is <code>JSInvokable</code> that alters the state of the component, you must call <code>StateHasChanged</code> to signal a rerender.</p>
</div>

<p>The <code>OnSpokenAsync</code>  handler is expressed as <code>InvokeAsync</code>, which executes the given work item on the renders synchronization context. It sets <code>_isSpeaking</code> to <code>false</code>, logs the total amount of time the message <a data-primary="AdditiveSpeechComponent.razor.cs" data-startref="adprzc" data-type="indexterm" id="idm46365023565872"/>was spoken, and then notifies the component that its state has changed.</p>

<p>The markup is minimal, and the code <a data-primary="JSRuntimeExtensions.cs" data-type="indexterm" id="runext"/>behind is clean but powerful. Let’s lean into the <em>JSRuntimeExtensions.cs</em> C# file to see what <code>SpeakMessageAsync</code> looks like:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code> <code class="nn">Learning.Blazor.Extensions</code><code class="p">;</code>

<code class="k">internal</code> <code class="k">static</code> <code class="k">partial</code> <code class="k">class</code> <code class="nc">JSRuntimeExtensions</code>
<code class="p">{</code>
    <code class="k">internal</code> <code class="k">static</code> <code class="n">ValueTask</code> <code class="n">SpeakMessageAsync</code><code class="p">&lt;</code><code class="n">T</code><code class="p">&gt;(</code>
        <code class="k">this</code> <code class="n">IJSRuntime</code> <code class="n">jsRuntime</code><code class="p">,</code>
        <code class="n">T</code> <code class="n">dotnetObj</code><code class="p">,</code>
        <code class="kt">string</code> <code class="n">callbackMethodName</code><code class="p">,</code>
        <code class="kt">string</code> <code class="n">message</code><code class="p">,</code>
        <code class="kt">string</code> <code class="n">defaultVoice</code><code class="p">,</code>
        <code class="kt">double</code> <code class="n">voiceSpeed</code><code class="p">,</code>
        <code class="kt">string</code> <code class="n">lang</code><code class="p">)</code> <code class="k">where</code> <code class="n">T</code> <code class="p">:</code> <code class="k">class</code> <code class="p">=&gt;</code>
        <code class="n">jsRuntime</code><code class="p">.</code><code class="n">InvokeVoidAsync</code><code class="p">(</code>
            <code class="s">"app.speak"</code><code class="p">,</code>
            <code class="n">DotNetObjectReference</code><code class="p">.</code><code class="n">Create</code><code class="p">(</code><code class="n">dotnetObj</code><code class="p">),</code>
            <code class="n">callbackMethodName</code><code class="p">,</code> <code class="n">message</code><code class="p">,</code> <code class="n">defaultVoice</code><code class="p">,</code> <code class="n">voiceSpeed</code><code class="p">,</code> <code class="n">lang</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>Extending the <code>IJSRuntime</code> functionality with meaningful names makes me happy. I find joy in these small victories, but it does make for a more enjoyable experience when reading the code. Being able to read it as <code>JavaScript.SpeakMessageAsync</code> is self-descriptive. This extension method delegates to the <code>IJSRuntime.InvokeVoi⁠d​Async</code> method, calling <code>"app.speak"</code> given <code>DotNetObjectReference</code>, the callback method name, a <code>message</code>, <code>voice</code>, voice speed, and language. I could have called <code>InvokeVoidAsync</code> directly from the component, but I prefer the 
<span class="keep-together">descriptive method</span> name of the extension method. This is the pattern that I recommend, as it 
<span class="keep-together">helps to</span> encapsulate the logic and it’s easier to consume from multiple call points. The JavaScript code that this <a data-primary="AdditiveSpeechComponent" data-startref="dvpp" data-type="indexterm" id="idm46365022177504"/><a data-primary="JSRuntimeExtensions.cs" data-startref="runext" data-type="indexterm" id="idm46365022176528"/>extension method relies on is part of the 
<span class="keep-together"><em>wwwroot/js/app.js</em> file:</span></p>

<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">cancelPendingSpeech</code> <code class="o">=</code> <code class="p">(</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO6-1" id="co_customizing_the_user_login_experience_CO6-1"><img alt="1" src="assets/1.png"/></a>
    <code class="k">if</code> <code class="p">(</code><code class="nb">window</code><code class="p">.</code><code class="nx">speechSynthesis</code>
    <code class="o">&amp;&amp;</code> <code class="nb">window</code><code class="p">.</code><code class="nx">speechSynthesis</code><code class="p">.</code><code class="nx">pending</code> <code class="o">===</code> <code class="kc">true</code><code class="p">)</code> <code class="p">{</code>
        <code class="nb">window</code><code class="p">.</code><code class="nx">speechSynthesis</code><code class="p">.</code><code class="nx">cancel</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code><code class="p">;</code>

<code class="kr">const</code> <code class="nx">speak</code> <code class="o">=</code> <code class="p">(</code><code class="nx">dotnetObj</code><code class="p">,</code> <code class="nx">callbackMethodName</code><code class="p">,</code> <code class="nx">message</code><code class="p">,</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO6-2" id="co_customizing_the_user_login_experience_CO6-2"><img alt="2" src="assets/2.png"/></a>
               <code class="nx">defaultVoice</code><code class="p">,</code> <code class="nx">voiceSpeed</code><code class="p">,</code> <code class="nx">lang</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">utterance</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">SpeechSynthesisUtterance</code><code class="p">(</code><code class="nx">message</code><code class="p">)</code><code class="p">;</code>
    <code class="nx">utterance</code><code class="p">.</code><code class="nx">onend</code> <code class="o">=</code> <code class="nx">e</code> <code class="o">=&gt;</code> <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code><code class="nx">dotnetObj</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">dotnetObj</code><code class="p">.</code><code class="nx">invokeMethodAsync</code><code class="p">(</code><code class="nx">callbackMethodName</code><code class="p">,</code> <code class="nx">e</code><code class="p">.</code><code class="nx">elapsedTime</code><code class="p">)</code>
        <code class="p">}</code>
    <code class="p">}</code><code class="p">;</code>

    <code class="kr">const</code> <code class="nx">voices</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">speechSynthesis</code><code class="p">.</code><code class="nx">getVoices</code><code class="p">(</code><code class="p">)</code><code class="p">;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO6-3" id="co_customizing_the_user_login_experience_CO6-3"><img alt="3" src="assets/3.png"/></a>
    <code class="k">try</code> <code class="p">{</code>
        <code class="nx">utterance</code><code class="p">.</code><code class="nx">voice</code> <code class="o">=</code>
            <code class="o">!</code><code class="o">!</code><code class="nx">defaultVoice</code> <code class="o">&amp;&amp;</code> <code class="nx">defaultVoice</code> <code class="o">!==</code> <code class="s1">'Auto'</code>
                <code class="o">?</code> <code class="nx">voices</code><code class="p">.</code><code class="nx">find</code><code class="p">(</code><code class="nx">v</code> <code class="o">=&gt;</code> <code class="nx">v</code><code class="p">.</code><code class="nx">name</code> <code class="o">===</code> <code class="nx">defaultVoice</code><code class="p">)</code>
                <code class="o">:</code> <code class="nx">voices</code><code class="p">.</code><code class="nx">find</code><code class="p">(</code><code class="nx">v</code> <code class="o">=&gt;</code> <code class="o">!</code><code class="o">!</code><code class="nx">lang</code> <code class="o">&amp;&amp;</code>
                    <code class="nx">v</code><code class="p">.</code><code class="nx">lang</code><code class="p">.</code><code class="nx">startsWith</code><code class="p">(</code><code class="nx">lang</code><code class="p">)</code><code class="p">)</code> <code class="o">||</code> <code class="nx">voices</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">;</code>
    <code class="p">}</code> <code class="k">catch</code> <code class="p">{</code> <code class="p">}</code>
    <code class="nx">utterance</code><code class="p">.</code><code class="nx">volume</code> <code class="o">=</code> <code class="mi">1</code><code class="p">;</code>
    <code class="nx">utterance</code><code class="p">.</code><code class="nx">rate</code> <code class="o">=</code> <code class="nx">voiceSpeed</code> <code class="o">||</code> <code class="mi">1</code><code class="p">;</code>

    <code class="nb">window</code><code class="p">.</code><code class="nx">speechSynthesis</code><code class="p">.</code><code class="nx">speak</code><code class="p">(</code><code class="nx">utterance</code><code class="p">)</code><code class="p">;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO6-4" id="co_customizing_the_user_login_experience_CO6-4"><img alt="4" src="assets/4.png"/></a>
<code class="p">}</code><code class="p">;</code>

<code class="nb">window</code><code class="p">.</code><code class="nx">app</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">assign</code><code class="p">(</code><code class="p">{</code><code class="p">}</code><code class="p">,</code> <code class="nb">window</code><code class="p">.</code><code class="nx">app</code><code class="p">,</code> <code class="p">{</code>
    <code class="nx">speak</code><code class="p">,</code>
    <code class="c1">// omitted for brevity...
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code>

<code class="c1">// Prevent the client from speaking when the user closes the tab or window.
</code><code class="nb">window</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'beforeunload'</code><code class="p">,</code> <code class="nx">_</code> <code class="o">=&gt;</code> <code class="p">{</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO6-5" id="co_customizing_the_user_login_experience_CO6-5"><img alt="5" src="assets/5.png"/></a>
    <code class="nx">cancelPendingSpeech</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
<code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO6-1" id="callout_customizing_the_user_login_experience_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>As a safety net to avoid the browser from speaking when the user closes the tab or window, the <code>cancelPendingSpeech</code> method is <a data-primary="cancelPendingSpeech method" data-type="indexterm" id="idm46365022005616"/><a data-primary="methods" data-secondary="cancelPendingSpeech" data-type="indexterm" id="idm46365022004912"/>defined.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO6-2" id="callout_customizing_the_user_login_experience_CO6-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The <code>speak</code> function creates and prepares an <code>utterance</code> instance for usage.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO6-3" id="callout_customizing_the_user_login_experience_CO6-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The <code>utterance.voice</code> property is set to the <code>voices</code> array, filtered by the <code>defaultVoice</code> and <code>lang</code> parameters.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO6-4" id="callout_customizing_the_user_login_experience_CO6-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The <code>utterance</code> is passed to the <code>speechSynthesis.speak</code> method.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO6-5" id="callout_customizing_the_user_login_experience_CO6-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The <code>beforeunload</code> event handler is defined to cancel any pending speech.</p></dd>
</dl>

<p>The <code>cancelPendingSpeech</code> function checks if the <code>window.speechSynthesis</code> object is truthy (in this case, meaning it’s not <code>null</code> or <code>undefined</code>). If there are any pending utterances in the queue, a call to <code>window.speechSynthesis.cancel()</code> is made, removing all utterances from the queue.</p>

<p>The <code>"app.speak"</code> method is defined <a data-primary="app.speak method" data-type="indexterm" id="idm46365022023504"/><a data-primary="methods" data-secondary="app.speak" data-type="indexterm" id="idm46365022022768"/>as the function named <code>speak</code>. It has six parameters, which feels like too many. You could choose to parameterize this with a single top-level object if you’d like, but that would require a new model and additional serialization. I’d probably limit a parameter list to no more than six, but as with everything in programming, there are trade-offs. The <code>speak</code> method body starts by instantiating a <code>SpeechSynthesisUtterance</code> given the <code>message</code>. This object exposes an <code>end/onend</code> event that is fired when the utterance has finished being spoken. An inline event handler is assigned, which relies on the given <code>dotnetObj</code> instance and <code>callbackMethodName</code>. When the utterance is done being spoken, the event fires and calls back onto the calling component’s given method.</p>

<p>An attempt to assign the desired voice to speak the utterance is made. This can be problematic and error-prone—as such, its attempt is fragile and protected with a <code>try</code>/<code>catch</code>. If it works, great, and if not, it’s not a big deal as the browser will select the default voice. The volume is set to <code>1</code>, and the speed at which the utterance is spoken is set as well.</p>

<p>With an <code>utterance</code> instance prepared, a call to <code>window.speechSynthe⁠sis​.speak(utterance)</code> is made. This will enqueue the utterance into the native speech synthesis queue. When <code>utterance</code> reaches the end of the queue, it is spoken. The <code>"app.speak"</code> name comes from how the <code>speak</code> function <code>const</code> is added to either a new instance of <code>app</code> or the existing one.</p>

<p>If a long utterance is being spoken, and the user closes the app’s browser tab or window but leaves the browser open, the utterance will continue to be spoken. To avoid this behavior, we’ll call <code>cancelPendingSpeech</code> when the window is <em>unloaded</em>.</p>

<p><code>AdditiveSpeechComponent</code> could be bundled into a separate Razor component project and distributed to consuming apps. That approach is beneficial because it exposes functionality and shares it with consumers. All of the functionality of this component is encapsulated and could benefit from being shared via NuGet. At the time of writing, the component remained as part of the Web.Client project, but that’s not to say that this couldn’t easily evolve in complexity or add new functionality. Once on NuGet, it could be used by other .NET developers who consume open source projects.</p>

<p>The Learning Blazor sample app demonstrates how to <a data-primary="Razor" data-secondary="project creation" data-type="indexterm" id="idm46365021944960"/>create Razor projects and consume them from the Blazor web client. The Web.Client project depends on the Web.TwitterComponents Razor class library. The Web.TwitterComponents project encapsulates a few Twitter-specific components. The Web.Client consumes these components and exposes them to the Blazor web client.</p>
</div></section>













<section data-pdf-bookmark="Sharing and Consuming Custom Components" data-type="sect1"><div class="sect1" id="idm46365023199776">
<h1>Sharing and Consuming Custom Components</h1>

<p>To consume a component, you reference it <a data-primary="components" data-secondary="custom" data-type="indexterm" id="cmpcst"/><a data-primary="custom components" data-type="indexterm" id="ustp"/>from a consuming component’s markup. Blazor provides many components out of the box, from layouts to navigation, from standard form controls to error boundaries, from page titles to head outlets, and so on. See Microsoft’s <a href="https://oreil.ly/2RhYY">“ASP.NET Core Built-in Razor Components” documentation</a> for a listing of the available components.</p>

<p>When the built-in components are not enough, you can turn to custom components. There are many other vendor-provided components. Additionally, there is a massive open source community that builds component libraries as well. Chances are you’ll find what you need as a developer when building Blazor apps from all the vendor-provided component libraries out there. Consider the following list of vendor resources:</p>

<ul>
<li>
<p><a href="https://oreil.ly/yvL4B">Telerik: UI for Blazor</a></p>
</li>
<li>
<p><a href="https://oreil.ly/QeFJA">DevExpress: Blazor UI components</a></p>
</li>
<li>
<p><a href="https://oreil.ly/YLO7B">Syncfusion: Blazor components library</a></p>
</li>
<li>
<p><a href="https://oreil.ly/hf29O">Radzen: Blazor components</a></p>
</li>
<li>
<p><a href="https://oreil.ly/IyJ0D">Infragistics: Blazor UI components</a></p>
</li>
<li>
<p><a href="https://oreil.ly/6ysQy">GrapeCity: Blazor UI controls for web apps</a></p>
</li>
<li>
<p><a href="https://oreil.ly/SX6nA">jQWidgets: Smart.Blazor UI component library</a></p>
</li>
<li>
<p><a href="https://oreil.ly/BBGUy">MudBlazor: Blazor component library based on material design</a></p>
</li>
</ul>

<p>There is a community-curated list on GitHub known as <a href="https://oreil.ly/sTodG">Awesome Blazor</a>, which is another great resource. Sometimes, you may require functionality that isn’t available from the framework, from vendors, or even from the community at large. When this happens, you can write your own component 
<span class="keep-together">libraries.</span></p>

<p>Since Blazor is built atop Razor, all of the components <a data-primary="Learning Blazor app" data-secondary="native speech synthesis" data-startref="lztvy" data-type="indexterm" id="idm46365021928560"/><a data-primary="native speech synthesis" data-startref="vpyth" data-type="indexterm" id="idm46365021927472"/><a data-primary="components" data-secondary="custom" data-startref="cmpcst" data-type="indexterm" id="idm46365021926624"/><a data-primary="custom components" data-startref="ustp" data-type="indexterm" id="idm46365021925536"/><a data-primary="components" data-secondary="Razor" data-type="indexterm" id="idm46365021924688"/><a data-primary="Razor" data-secondary="components" data-type="indexterm" id="idm46365021923840"/>are Razor components. They’re easily identifiable by their <em>.razor</em> file extension.</p>
</div></section>













<section data-pdf-bookmark="Chrome: The Overloaded Term" data-type="sect1"><div class="sect1" id="idm46365021922352">
<h1>Chrome: The Overloaded Term</h1>

<p>With GUI apps, there is an old term that’s been overloaded through the years. The term <em>chrome</em> refers to an element of the UI that displays the various commands or capabilities available to the user. For example, the <em>chrome</em> of the Learning Blazor sample app is the <a data-primary="Learning Blazor app" data-secondary="chrome" data-type="indexterm" id="idm46365021920112"/><a data-primary="chrome" data-type="indexterm" id="idm46365021919264"/>top bar. This contains the app’s top-level navigation, the theme display icon, and the buttons for various popup modal components such as the notification toggle, task list toggle, and the log in/out button. This was shown in Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch02.html#dark_navbar">2-2</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch02.html#light_navbar">2-3</a> from <a data-type="xref" href="ch02.html#chapter-two">Chapter 2</a>. When I refer to chrome, I’m not talking about the web browser. We’ve already discussed navigation and routing a bit, so let’s focus on modal modularity.</p>








<section data-pdf-bookmark="Modal Modularity and Blazor Component Hierarchies" data-type="sect2"><div class="sect2" id="idm46365021915456">
<h2>Modal Modularity and Blazor Component Hierarchies</h2>

<p>Most apps need to interact with the user and prompt them for input. The app’s navigation is a user experience, and <a data-primary="modal modularity" data-type="indexterm" id="mdmdl"/><a data-primary="component hierarchies" data-type="indexterm" id="comhch"/>one example of user input is the user clicks a link to a route they want to visit, then the app takes an action. Sometimes we’ll need to prompt the user to use the keyboard instead of the mouse. The questions we ask users vary primarily by domain, for example, “What’s your email address?” or “What’s your message to send?” Answers vary by control type, meaning free-form text line or text area, or a checkbox, select list, or button. All of this is fully supported with Blazor. You can subscribe to native HTML element events and handle them in Razor C# component logic. There are native forms of integration and modal/input binding validation, templating, and component hierarchies.</p>

<p>One such control is <a data-primary="ModalComponent" data-type="indexterm" id="mdcp"/>a custom control named <code>ModalComponent</code>. This component is going to be used throughout the app for various use cases. It will have an inherited component to exemplify component subclass patterns, which are common in C# but were underutilized as a programming pattern for JavaScript SPAs. Consider <a data-primary="ModalComponent.razor" data-type="indexterm" id="mdlpt"/>the <em>ModalComponent.razor</em> markup file:</p>

<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal has-text-left @_isActiveClass"</code><code class="p">&gt;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO7-1" id="co_customizing_the_user_login_experience_CO7-1"><img alt="1" src="assets/1.png"/></a>
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-background"</code> <code class="err">@</code><code class="na">onclick</code><code class="o">=</code><code class="s">@CancelAsync</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-card"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">header</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-card-head"</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">p</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-card-title"</code><code class="p">&gt;</code><code>
                @TitleContent </code><a class="co" href="#callout_customizing_the_user_login_experience_CO7-2" id="co_customizing_the_user_login_experience_CO7-2"><img alt="2" src="assets/2.png"/></a>
            <code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">button</code> <code class="na">class</code><code class="o">=</code><code class="s">"delete"</code> <code class="na">aria-label</code><code class="o">=</code><code class="s">"close"</code> <code class="err">@</code><code class="na">onclick</code><code class="o">=</code><code class="s">@CancelAsync</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">header</code><code class="p">&gt;</code>

        <code class="p">&lt;</code><code class="nt">section</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-card-body"</code><code class="p">&gt;</code><code>
            @BodyContent </code><a class="co" href="#callout_customizing_the_user_login_experience_CO7-3" id="co_customizing_the_user_login_experience_CO7-3"><img alt="3" src="assets/3.png"/></a>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">section</code><code class="p">&gt;</code>

        <code class="p">&lt;</code><code class="nt">footer</code> <code class="na">class</code><code class="o">=</code><code class="s">"modal-card-foot is-justify-content-flex-end"</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code>
                @ButtonContent </code><a class="co" href="#callout_customizing_the_user_login_experience_CO7-4" id="co_customizing_the_user_login_experience_CO7-4"><img alt="4" src="assets/4.png"/></a>
            <code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">footer</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code>
<code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO7-1" id="callout_customizing_the_user_login_experience_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The outermost element is a <code>div</code> with the <code>modal</code> class.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO7-2" id="callout_customizing_the_user_login_experience_CO7-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The title is represented as a <code>header</code> element with the <code>modal-card-title</code> class.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO7-3" id="callout_customizing_the_user_login_experience_CO7-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The body is a <code>section</code> with the <code>modal-card-body</code> class.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO7-4" id="callout_customizing_the_user_login_experience_CO7-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The <code>footer</code> is styled with the <code>modal-card-foot</code> class.</p></dd>
</dl>

<p>The HTML is a modal styled <code>div</code> with an <code>_isActiveClass</code> value bound to the modal’s <code>class</code> attribute, meaning that the state of the modal, whether it is active (shown) or not, is dependent on a component variable. It has a background style that applies an overlay, making this element pop up as a modal dialog displayed to the user. The background <code>div</code> element itself handles user clicks by calling <code>CancelAsync</code> and covers the entire page.</p>

<p>The HTML is semantically accurate, representing an industry-standardized three-part header/body/footer layout. The first template placeholder is the <code>@TitleContent</code>. This is a required <code>RenderFragment</code> that allows for the consuming component to provide custom title markup. The <code>header</code> also contains a <code>button</code> that will call <code>CancelAsync</code> when clicked.</p>

<p><code>BodyContent</code> is styled appropriately as a modal’s body, which is a <code>section</code> HTML element and semantically positioned beneath the <code>header</code> and above the <code>footer</code>.</p>

<p>The modal <code>footer</code> contains the required <code>ButtonContent</code> markup. Collectively, this modal represents a common dialog component where consumers can plug in their customized markup and corresponding <a data-primary="ModalComponent.razor" data-startref="mdlpt" data-type="indexterm" id="idm46365021734016"/>prompts.</p>

<p>The component shadow defines the component’s parameter properties, events, component state, and <a data-primary="ModalComponent.razor.cs" data-type="indexterm" id="mdopzr"/>functionality. Consider the <em>ModalComponent.razor.cs</em> C# file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code> <code class="nn">Learning.Blazor.Components</code><code class="p">;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO8-1" id="co_customizing_the_user_login_experience_CO8-1"><img alt="1" src="assets/1.png"/></a>

<code class="k">public</code> <code class="k">partial</code> <code class="k">class</code> <code class="nc">ModalComponent</code>
<code class="p">{</code>
    <code class="k">private</code> <code class="kt">string</code> <code class="n">_isActiveClass</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">IsActive</code> <code class="p">?</code> <code class="s">"is-active"</code> <code class="p">:</code> <code class="s">""</code><code class="p">;</code>
<code class="na">
    [Parameter]</code>
    <code class="k">public</code> <code class="n">EventCallback</code><code class="p">&lt;</code><code class="n">DismissalReason</code><code class="p">&gt;</code> <code class="n">Dismissed</code> <code class="p">{</code> <code class="k">get</code><code class="p">;</code> <code class="k">set</code><code class="p">;</code> <code class="p">}</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO8-2" id="co_customizing_the_user_login_experience_CO8-2"><img alt="2" src="assets/2.png"/></a>
<code class="na">
    [Parameter]</code>
    <code class="k">public</code> <code class="kt">bool</code> <code class="n">IsActive</code> <code class="p">{</code> <code class="k">get</code><code class="p">;</code> <code class="k">set</code><code class="p">;</code> <code class="p">}</code>
<code class="na">
    [Parameter, EditorRequired]</code>
    <code class="k">public</code> <code class="n">RenderFragment</code> <code class="n">TitleContent</code> <code class="p">{</code> <code class="k">get</code><code class="p">;</code> <code class="k">set</code><code class="p">;</code> <code class="p">}</code> <code class="p">=</code> <code class="k">null</code><code class="p">!</code><code class="p">;</code>
<code class="na">
    [Parameter, EditorRequired]</code>
    <code class="k">public</code> <code class="n">RenderFragment</code> <code class="n">BodyContent</code> <code class="p">{</code> <code class="k">get</code><code class="p">;</code> <code class="k">set</code><code class="p">;</code> <code class="p">}</code> <code class="p">=</code> <code class="k">null</code><code class="p">!</code><code class="p">;</code>
<code class="na">
    [Parameter, EditorRequired]</code>
    <code class="k">public</code> <code class="n">RenderFragment</code> <code class="n">ButtonContent</code> <code class="p">{</code> <code class="k">get</code><code class="p">;</code> <code class="k">set</code><code class="p">;</code> <code class="p">}</code> <code class="p">=</code> <code class="k">null</code><code class="p">!</code><code class="p">;</code>

    <code class="c1">/// &lt;summary&gt;
</code>    <code class="c1">/// Gets the reason that the &lt;see cref="ModalComponent"/&gt; was dismissed.
</code>    <code class="c1">/// &lt;/summary&gt;
</code>    <code class="k">public</code> <code class="n">DismissalReason</code> <code class="n">Reason</code> <code class="p">{</code> <code class="k">get</code><code class="p">;</code> <code class="k">private</code> <code class="k">set</code><code class="p">;</code> <code class="p">}</code>

    <code class="c1">/// &lt;summary&gt;
</code>    <code class="c1">/// Sets the &lt;see cref="ModalComponent"/&gt; instance's
</code>    <code class="c1">/// &lt;see cref="IsActive"/&gt; value to &lt;c&gt;true&lt;/c&gt; and
</code>    <code class="c1">/// &lt;see cref="Reason"/&gt; value as &lt;c&gt;default&lt;/c&gt;.
</code>    <code class="c1">/// It then signals for a change of state; this rerender will
</code>    <code class="c1">/// show the modal.
</code>    <code class="c1">/// &lt;/summary&gt;
</code>    <code class="k">public</code> <code class="n">Task</code> <code class="nf">ShowAsync</code><code class="p">(</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO8-3" id="co_customizing_the_user_login_experience_CO8-3"><img alt="3" src="assets/3.png"/></a>
        <code class="n">InvokeAsync</code><code class="p">(</code><code class="p">(</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code> <code class="p">(</code><code class="n">IsActive</code><code class="p">,</code> <code class="n">Reason</code><code class="p">)</code> <code class="p">=</code> <code class="p">(</code><code class="k">true</code><code class="p">,</code> <code class="k">default</code><code class="p">)</code><code class="p">)</code><code class="p">;</code>

    <code class="c1">/// &lt;summary&gt;
</code>    <code class="c1">/// Sets the &lt;see cref="ModalComponent"/&gt; instance's
</code>    <code class="c1">/// &lt;see cref="IsActive"/&gt; value to &lt;c&gt;false&lt;/c&gt; and
</code>    <code class="c1">/// &lt;see cref="Reason"/&gt; value as given &lt;paramref name="reason"/&gt;
</code>    <code class="c1">/// value. It then signals for a change of state;
</code>    <code class="c1">/// this rerender will cause the modal to be dismissed.
</code>    <code class="c1">/// &lt;/summary&gt;
</code>    <code class="k">public</code> <code class="n">Task</code> <code class="nf">DismissAsync</code><code class="p">(</code><code class="n">DismissalReason</code> <code class="n">reason</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
        <code class="n">InvokeAsync</code><code class="p">(</code><code class="k">async</code> <code class="p">(</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
        <code class="p">{</code>
            <code class="p">(</code><code class="n">IsActive</code><code class="p">,</code> <code class="n">Reason</code><code class="p">)</code> <code class="p">=</code> <code class="p">(</code><code class="k">false</code><code class="p">,</code> <code class="n">reason</code><code class="p">)</code><code class="p">;</code>
            <code class="k">if</code> <code class="p">(</code><code class="n">Dismissed</code><code class="p">.</code><code class="n">HasDelegate</code><code class="p">)</code>
            <code class="p">{</code>
                <code class="k">await</code> <code class="n">Dismissed</code><code class="p">.</code><code class="n">InvokeAsync</code><code class="p">(</code><code class="n">Reason</code><code class="p">)</code><code class="p">;</code>
            <code class="p">}</code>
        <code class="p">}</code><code class="p">)</code><code class="p">;</code>

    <code class="c1">/// &lt;summary&gt;
</code>    <code class="c1">/// Dismisses the shown modal; the &lt;see cref="Reason"/&gt;
</code>    <code class="c1">/// will be set to &lt;see cref="DismissalReason.Confirmed"/&gt;.
</code>    <code class="c1">/// &lt;/summary&gt;
</code>    <code class="k">public</code> <code class="n">Task</code> <code class="nf">ConfirmAsync</code><code class="p">(</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">DismissAsync</code><code class="p">(</code><code class="n">DismissalReason</code><code class="p">.</code><code class="n">Confirmed</code><code class="p">)</code><code class="p">;</code>

    <code class="c1">/// &lt;summary&gt;
</code>    <code class="c1">/// Dismisses the shown modal; the &lt;see cref="Reason"/&gt;
</code>    <code class="c1">/// will be set to &lt;see cref="DismissalReason.Cancelled"/&gt;.
</code>    <code class="c1">/// &lt;/summary&gt;
</code>    <code class="k">public</code> <code class="n">Task</code> <code class="nf">CancelAsync</code><code class="p">(</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">DismissAsync</code><code class="p">(</code><code class="n">DismissalReason</code><code class="p">.</code><code class="n">Cancelled</code><code class="p">)</code><code class="p">;</code>

    <code class="c1">/// &lt;summary&gt;
</code>    <code class="c1">/// Dismisses the shown modal; the &lt;see cref="Reason"/&gt;
</code>    <code class="c1">/// will be set to &lt;see cref="DismissalReason.Verified"/&gt;.
</code>    <code class="c1">/// &lt;/summary&gt;
</code>    <code class="k">public</code> <code class="n">Task</code> <code class="nf">VerifyAsync</code><code class="p">(</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">DismissAsync</code><code class="p">(</code><code class="n">DismissalReason</code><code class="p">.</code><code class="n">Verified</code><code class="p">)</code><code class="p">;</code>
<code class="p">}</code>

<code class="k">public</code> <code class="k">enum</code> <code class="n">DismissalReason</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO8-4" id="co_customizing_the_user_login_experience_CO8-4"><img alt="4" src="assets/4.png"/></a>
<code class="p">{</code>
    <code class="n">Unknown</code><code class="p">,</code> <code class="n">Confirmed</code><code class="p">,</code> <code class="n">Cancelled</code><code class="p">,</code> <code class="n">Verified</code>
<code class="p">}</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO8-1" id="callout_customizing_the_user_login_experience_CO8-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The <code>ModalComponent</code> class is part of the <code>Learning.Blazor.Components</code> 
<span class="keep-together">namespace.</span></p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO8-2" id="callout_customizing_the_user_login_experience_CO8-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>Several properties together represent examples of required component parameters, events, templates, and component state values.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO8-3" id="callout_customizing_the_user_login_experience_CO8-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>As for the functionality and modularity, the modal component can be shown and just as easily dismissed.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO8-4" id="callout_customizing_the_user_login_experience_CO8-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The <code>enum DismissalReason</code> type is defined within the same file-scoped 
<span class="keep-together">namespace.</span></p></dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p>In Blazor, when you define a property that is used as a <code>Parameter</code> and you want that parameter to be required, you can use the framework-provided <code>EditorRequired</code> attribute. This specifies that the component parameter is required to be provided by the user when authoring it in the editor. If a value for this parameter is not provided, editors or build tools may provide warnings prompting the user to specify a value.</p>
</div>

<p>The <code>ModalComponent</code> class defines several properties:</p>
<dl>
<dt><code>_isActiveClass</code></dt>
<dd>
<p>A <code>private string</code> that serves as a computed property, which evaluates the <code>IsActive</code> property and returns <code>"is-active"</code> when <code>true</code>. This was bound to the modal’s markup, where the <code>div</code>’s <code>class</code> attribute had some static classes and a dynamically bound value.</p>
</dd>
<dt><code>Dismissed</code></dt>
<dd>
<p>A component parameter, which is of type <code>EventCallback&lt;DismissalReason&gt;</code>. An event callback accepts delegate assignments from consumers, where events flow from this component to interested recipients.</p>
</dd>
<dt><code>IsActive</code></dt>
<dd>
<p>A <code>bool</code> value, which represents the current state of whether the modal is actively being displayed to the user. This parameter is <em>not</em> required and is typically set implicitly from calls to <code>DismissAsync</code>.</p>
</dd>
<dt><code>TitleContent</code></dt>
<dd>
<p>A named <code>RenderFragment</code> type representing the template placeholder for the header title.</p>
</dd>
<dt><code>BodyContent</code></dt>
<dd>
<p>A named <code>RenderFragment</code> type representing the template placeholder for the body content.</p>
</dd>
<dt><code>ButtonContent</code></dt>
<dd>
<p>A named <code>RenderFragment</code> type representing the template placeholder for the footer controls.</p>
</dd>
<dt><code>Reason</code></dt>
<dd>
<p>The reason for the dismissal of the modal is “unknown,” “confirmed,” “canceled,” or “verified.”</p>
</dd>
</dl>

<p><code>ModalComponent</code> exposes modularity as the functionality is templated, and consumers have hooks into the component. Consumers can call any of these <code>public Task</code> returning asynchronous operational methods:</p>
<dl>
<dt><code>ShowAsync</code></dt>
<dd>
<p>Immediately shows the modal to the user. This method is expressed as a call to <code>InvokeAsync</code> given a lambda expression that sets the values of <code>IsActive</code> to <code>true</code> and assigns <code>default</code> to <code>Reason</code> (or <code>DismissalReason.Unknown</code>). Calling <code>State​Ha⁠sChanged</code> is unnecessary at this point. Asynchronous operational support will automatically rerender the UI components implicitly as needed.</p>
</dd>
<dt><code>DismissAsync</code></dt>
<dd>
<p>Given a dismissal reason, immediately dismisses the modal. The <code>IsActive</code> state is set to <code>false</code>, which will effectively hide the component from the user.</p>
</dd>
<dt><code>ConfirmAsync</code></dt>
<dd>
<p>Sets the dismissal reason as <code>Confirmed</code> and delegates to <code>DismissAsync</code>.</p>
</dd>
<dt><code>CancelAsync</code></dt>
<dd>
<p>Sets the dismissal reason as <code>Cancelled</code> and delegates to <code>DismissAsync</code>.</p>
</dd>
<dt><code>VerifyAsync</code></dt>
<dd>
<p>Sets the dismissal reason as <code>Verified</code> and delegates to <code>DismissAsync</code>.</p>
</dd>
</dl>

<p>The <code>enum DismissalReason</code> type defines four states: <code>Unknown</code> (which is the default), <code>Confirmed</code>, <code>Cancelled</code> (can occur implicitly from the user clicking outside the modal), and <code>Verified</code>. While I will usually place every type definition in its file, I choose to keep the <code>enum DismissalReason</code> within the same file. To me, these are <a data-primary="modal modularity" data-startref="mdmdl" data-type="indexterm" id="idm46365021552272"/><a data-primary="ModalComponent" data-startref="mdcp" data-type="indexterm" id="idm46365021551520"/><a data-primary="component hierarchies" data-startref="comhch" data-type="indexterm" id="idm46365021650880"/><a data-primary="ModalComponent.razor.cs" data-startref="mdopzr" data-type="indexterm" id="idm46365021649936"/>logically cohesive and belong together.</p>
</div></section>













<section data-pdf-bookmark="Exploring Blazor Event Binding" data-type="sect2"><div class="sect2" id="idm46365021914864">
<h2>Exploring Blazor Event Binding</h2>

<p><code>ModalComponent</code> is consumed by <code>VerificationModalComponent</code>. Let’s take a look at how this is <a data-primary="event binding" data-type="indexterm" id="evbdg"/><a data-primary="VerificationModalComponent.razor" data-type="indexterm" id="vfmop"/>achieved in the <em>VerificationModalComponent.razor</em> markup file:</p>

<pre data-code-language="html" data-type="programlisting"><code>@inherits LocalizableComponentBase</code><code class="p">&lt;</code><code class="nt">VerificationModalComponent</code><code class="p">&gt;</code>

<code class="p">&lt;</code><code class="nt">ModalComponent</code> <code class="err">@</code><code class="na">ref</code><code class="o">=</code><code class="s">"_modal"</code> <code class="na">Dismissed</code><code class="o">=</code><code class="s">@OnDismissed</code><code class="p">&gt;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO9-1" id="co_customizing_the_user_login_experience_CO9-1"><img alt="1" src="assets/1.png"/></a>
    <code class="p">&lt;</code><code class="nt">TitleContent</code><code class="p">&gt;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO9-2" id="co_customizing_the_user_login_experience_CO9-2"><img alt="2" src="assets/2.png"/></a>
        <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"icon pr-2"</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-robot"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>@Localizer["AreYouHuman"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="p">/</code><code class="nt">TitleContent</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">BodyContent</code><code class="p">&gt;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO9-3" id="co_customizing_the_user_login_experience_CO9-3"><img alt="3" src="assets/3.png"/></a>
        <code class="p">&lt;</code><code class="nt">form</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"field"</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">label</code> <code class="na">class</code><code class="o">=</code><code class="s">"label"</code><code class="p">&gt;</code><code>@_math.HumanizeQuestion()</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">label</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"field-body"</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"field"</code><code class="p">&gt;</code>
                        <code class="p">&lt;</code><code class="nt">p</code> <code class="na">class</code><code class="o">=</code><code class="s">"control is-expanded has-icons-left"</code><code class="p">&gt;</code><code>
                            @{
                                var inputValidityClass =
                                    _answeredCorrectly is false
                                        ? " invalid"
                                        : "";

                                var inputClasses = $"input{inputValidityClass}";
                            }
                            </code><code class="p">&lt;</code><code class="nt">input</code> <code class="err">@</code><code class="na">bind</code><code class="o">=</code><code class="s">"_attemptedAnswer"</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO9-4" id="co_customizing_the_user_login_experience_CO9-4"><img alt="4" src="assets/4.png"/></a>
                                <code class="na">class</code><code class="o">=</code><code class="s">@inputClasses</code>
                                <code class="na">type</code><code class="o">=</code><code class="s">"text"</code>
                                <code class="na">placeholder</code><code class="o">=</code><code class="s">"@Localizer["</code><code class="na">AnswerFormat</code><code class="err">"</code><code class="err">,</code>
                                    <code class="na">_math</code><code class="err">.</code><code class="na">GetQuestion</code><code class="err">(</code><code class="err">)</code><code class="err">]</code><code class="err">"</code> <code class="p">/</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"icon is-small is-left"</code><code class="p">&gt;</code>
                                <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-info-circle"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code>
                            <code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code>
                        <code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code>
                    <code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">form</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="p">/</code><code class="nt">BodyContent</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">ButtonContent</code><code class="p">&gt;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO9-5" id="co_customizing_the_user_login_experience_CO9-5"><img alt="5" src="assets/5.png"/></a>
        <code class="p">&lt;</code><code class="nt">button</code> <code class="na">class</code><code class="o">=</code><code class="s">"button is-info is-large is-pulled-left"</code> <code class="err">@</code><code class="na">onclick</code><code class="o">=</code><code class="s">Refresh</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"icon"</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-redo"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>@Localizer["Refresh"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">button</code> <code class="na">class</code><code class="o">=</code><code class="s">"button is-success is-large"</code> <code class="err">@</code><code class="na">onclick</code><code class="o">=</code><code class="s">AttemptToVerify</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"icon"</code><code class="p">&gt;</code>
                <code class="p">&lt;</code><code class="nt">i</code> <code class="na">class</code><code class="o">=</code><code class="s">"fas fa-check"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">i</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>@Localizer["Verify"]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="p">/</code><code class="nt">ButtonContent</code><code class="p">&gt;</code>
<code class="p">&lt;</code><code class="p">/</code><code class="nt">ModalComponent</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO9-1" id="callout_customizing_the_user_login_experience_CO9-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p>The <code>_modal</code> reference wires the <code>OnDismissed</code> event handler.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO9-2" id="callout_customizing_the_user_login_experience_CO9-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p><code>TitleContent</code> renders a localized prompt message and a robot icon.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO9-3" id="callout_customizing_the_user_login_experience_CO9-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p><code>BodyContent</code> renders a form with a single input field.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO9-4" id="callout_customizing_the_user_login_experience_CO9-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The <code>_attemptedAnswer</code> property is bound to the input field’s <code>value</code> attribute.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO9-5" id="callout_customizing_the_user_login_experience_CO9-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The buttons are rendered in the <code>ButtonContent</code> template.</p></dd>
</dl>

<p>The <code>VerificationModalComponent</code> markup relies on <code>ModalComponent</code>, and it captures a reference to the modal using the <code>@ref="_modal"</code> syntax. Blazor will automatically assign the <code>_modal</code> field from the instance value of the referenced component markup. Internal to <code>VerificationModalComponent</code>, the dependent <code>ModalComponent.Dismissed</code> event is handled by the <code>OnDismissed</code> handler. In other words, <code>ModalComponent.Dismissed</code> is a required parameter, and it’s an event that the component will fire. The <code>VerificationModalComponent.OnDismissed</code> event handler is assigned to handle it. This is custom event binding, where the consuming component handles the dependent component’s exposed parameterized event.</p>

<p>The verification modal’s title content (<code>TitleContent</code>) prompts the user with an “Are you human?” message.</p>

<p>The <code>BodyContent</code> markup contains a native HTML <code>form</code> element. Within this markup is a simple <code>label</code> and corresponding text <code>input</code> element. The label splats a question into the markup from the evaluated <code>_math.GetQuestion()</code> invocation (more on the <code>_math</code> object in a bit). The attempted answer <code>input</code> element has dynamic CSS classes bound to it based on whether the question was correctly answered.</p>

<p>The <code>input</code> element has its <code>value</code> bound to the <code>_attemptedAnswer</code> variable. It also has a <code>placeholder</code> bound from a localized answer format given the math question, which will serve as a clue to the user about what’s expected.</p>

<p>The <code>ButtonContent</code> markup has two buttons, one for refreshing the question (via the <code>Refresh</code> method) and the other for attempting to verify the answer (via the <code>AttemptToVerify</code> method). This is an example of native event binding, where the <code>button</code> elements have their <code>click</code> events bound to the corresponding event handlers.</p>

<p><code>ModalComponent</code> itself is a base modal, while <code>VerificationModalComponent</code> uses the base modal and employs a very specific verification prompt. <code>VerificationModal​Com⁠ponent</code> will render <a data-primary="VerificationModalComponent.razor" data-startref="vfmop" data-type="indexterm" id="idm46365020871360"/>as shown in <a data-type="xref" href="#are-you-human-modal">Figure 4-3</a>.</p>

<figure><div class="figure" id="are-you-human-modal">
<img alt="" src="assets/lblz_0403.png"/>
<h6><span class="label">Figure 4-3. </span>An example rendering of the <code>VerificationModalComponent</code></h6>
</div></figure>

<p>The component shadow for <code>VerificationModalComponent</code> resides <a data-primary="VerificationModalComponent.cs" data-type="indexterm" id="vfal"/>in the <em>Verification​ModalComponent.cs</em> file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code> <code class="nn">Learning.Blazor.Components</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">sealed</code> <code class="k">partial</code> <code class="k">class</code> <code class="nc">VerificationModalComponent</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO10-1" id="co_customizing_the_user_login_experience_CO10-1"><img alt="1" src="assets/1.png"/></a>
    <code class="p">{</code>
        <code class="k">private</code> <code class="n">AreYouHumanMath</code> <code class="n">_math</code> <code class="p">=</code> <code class="n">AreYouHumanMath</code><code class="p">.</code><code class="n">CreateNew</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="k">private</code> <code class="n">ModalComponent</code> <code class="n">_modal</code> <code class="p">=</code> <code class="k">null</code><code class="p">!</code><code class="p">;</code>
        <code class="k">private</code> <code class="kt">bool?</code> <code class="n">_answeredCorrectly</code> <code class="p">=</code> <code class="k">null</code><code class="p">!</code><code class="p">;</code>
        <code class="k">private</code> <code class="kt">string?</code> <code class="n">_attemptedAnswer</code> <code class="p">=</code> <code class="k">null</code><code class="p">!</code><code class="p">;</code>
        <code class="k">private</code> <code class="kt">object?</code> <code class="n">_state</code> <code class="p">=</code> <code class="k">null</code><code class="p">;</code>
<code class="na">
        [Parameter, EditorRequired]</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO10-2" id="co_customizing_the_user_login_experience_CO10-2"><img alt="2" src="assets/2.png"/></a>
        <code class="k">public</code> <code class="n">EventCallback</code><code class="p">&lt;</code><code class="p">(</code><code class="kt">bool</code> <code class="n">IsVerified</code><code class="p">,</code> <code class="kt">object?</code> <code class="n">State</code><code class="p">)</code><code class="p">&gt;</code>
            <code class="n">OnVerificationAttempted</code>
            <code class="p">{</code>
                <code class="k">get</code><code class="p">;</code>
                <code class="k">set</code><code class="p">;</code>
            <code class="p">}</code>

        <code class="k">public</code> <code class="n">Task</code> <code class="nf">PromptAsync</code><code class="p">(</code><code class="kt">object?</code> <code class="n">state</code> <code class="p">=</code> <code class="k">null</code><code class="p">)</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO10-3" id="co_customizing_the_user_login_experience_CO10-3"><img alt="3" src="assets/3.png"/></a>
        <code class="p">{</code>
            <code class="n">_state</code> <code class="p">=</code> <code class="n">state</code><code class="p">;</code>
            <code class="k">return</code> <code class="n">_modal</code><code class="p">.</code><code class="n">ShowAsync</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
        <code class="p">}</code>

        <code class="k">private</code> <code class="k">void</code> <code class="nf">Refresh</code><code class="p">(</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO10-4" id="co_customizing_the_user_login_experience_CO10-4"><img alt="4" src="assets/4.png"/></a>
            <code class="p">(</code><code class="n">_math</code><code class="p">,</code> <code class="n">_attemptedAnswer</code><code class="p">)</code> <code class="p">=</code> <code class="p">(</code><code class="n">AreYouHumanMath</code><code class="p">.</code><code class="n">CreateNew</code><code class="p">(</code><code class="p">)</code><code class="p">,</code> <code class="k">null</code><code class="p">)</code><code class="p">;</code>

        <code class="k">private</code> <code class="k">async</code> <code class="n">Task</code> <code class="nf">OnDismissed</code><code class="p">(</code><code class="n">DismissalReason</code> <code class="n">reason</code><code class="p">)</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO10-5" id="co_customizing_the_user_login_experience_CO10-5"><img alt="5" src="assets/5.png"/></a>
        <code class="p">{</code>
            <code class="k">if</code> <code class="p">(</code><code class="n">OnVerificationAttempted</code><code class="p">.</code><code class="n">HasDelegate</code><code class="p">)</code>
            <code class="p">{</code>
                <code class="k">await</code> <code class="n">OnVerificationAttempted</code><code class="p">.</code><code class="n">InvokeAsync</code><code class="p">(</code>
                    <code class="p">(</code><code class="n">reason</code> <code class="k">is</code> <code class="n">DismissalReason</code><code class="p">.</code><code class="n">Verified</code><code class="p">,</code> <code class="n">_state</code><code class="p">)</code><code class="p">)</code><code class="p">;</code>
            <code class="p">}</code>
        <code class="p">}</code>

        <code class="k">private</code> <code class="k">async</code> <code class="n">Task</code> <code class="nf">AttemptToVerify</code><code class="p">(</code><code class="p">)</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO10-6" id="co_customizing_the_user_login_experience_CO10-6"><img alt="6" src="assets/6.png"/></a>
        <code class="p">{</code>
            <code class="k">if</code> <code class="p">(</code><code class="kt">int</code><code class="p">.</code><code class="n">TryParse</code><code class="p">(</code><code class="n">_attemptedAnswer</code><code class="p">,</code> <code class="k">out</code> <code class="kt">var</code> <code class="n">attemptedAnswer</code><code class="p">)</code><code class="p">)</code>
            <code class="p">{</code>
                <code class="n">_answeredCorrectly</code> <code class="p">=</code> <code class="n">_math</code><code class="p">.</code><code class="n">IsCorrect</code><code class="p">(</code><code class="n">attemptedAnswer</code><code class="p">)</code><code class="p">;</code>
                <code class="k">if</code> <code class="p">(</code><code class="n">_answeredCorrectly</code> <code class="k">is</code> <code class="k">true</code><code class="p">)</code>
                <code class="p">{</code>
                    <code class="k">await</code> <code class="n">_modal</code><code class="p">.</code><code class="n">DismissAsync</code><code class="p">(</code><code class="n">DismissalReason</code><code class="p">.</code><code class="n">Verified</code><code class="p">)</code><code class="p">;</code>
                <code class="p">}</code>
            <code class="p">}</code>
            <code class="k">else</code>
            <code class="p">{</code>
                <code class="n">_answeredCorrectly</code> <code class="p">=</code> <code class="k">false</code><code class="p">;</code>
            <code class="p">}</code>
        <code class="p">}</code>
    <code class="p">}</code>
<code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO10-1" id="callout_customizing_the_user_login_experience_CO10-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p><code>VerificationModalComponent</code> wraps <code>ModalComponent</code> to add a verification layer.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO10-2" id="callout_customizing_the_user_login_experience_CO10-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>An event callback exposes whether the verification attempt was successful.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO10-3" id="callout_customizing_the_user_login_experience_CO10-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The prompt method delegates to the <code>ModalComponent.ShowAsync</code> method.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO10-4" id="callout_customizing_the_user_login_experience_CO10-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The <code>Refresh</code> method resets the <code>_math</code> and <code>_attemptedAnswer</code> fields.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO10-5" id="callout_customizing_the_user_login_experience_CO10-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The <code>OnDismissed</code> event handler is invoked when the modal is dismissed.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO10-6" id="callout_customizing_the_user_login_experience_CO10-6"><img alt="6" src="assets/6.png"/></a></dt>
<dd><p>The <code>AttemptToVerify</code> method dismisses the modal if the answer is correct.</p></dd>
</dl>

<p>The <code>VerificationModalComponent</code> class defines the following fields:</p>
<dl>
<dt><code>_math</code></dt>
<dd>
<p>The math object is of type <code>AreYouHumanMath</code> and is assigned from the <code>AreYouHumanMath.CreateNew()</code> factory method. This is a custom type that helps to represent a simple mathematical problem that a human could likely figure out in their head.</p>
</dd>
<dt><code>_modal</code></dt>
<dd>
<p>The field representing the <code>ModalComponent</code> instance from the corresponding markup. Methods will be called on this instance, such as <code>ShowAsync</code> to display the modal to the user.</p>
</dd>
<dt><code>_answeredCorrectly</code></dt>
<dd>
<p>The three-state <code>bool</code> is used to determine if the user answered the question correctly.</p>
</dd>
<dt><code>_attemptedAnswer</code></dt>
<dd>
<p>The nullable <code>string</code> bound to the <code>input</code> element, used to store the user-entered value.</p>
</dd>
<dt><code>_state</code></dt>
<dd>
<p>A state object that represents an opaque value, stored on behalf of the consumer. When the consuming component calls <code>PromptAsync</code>, if they pass <code>state</code>, it’s assigned to the <code>_state</code> variable then given back to the caller when the 
<span class="keep-together"><code>OnVerificationAttempted</code></span> event callback is invoked.</p>
</dd>
</dl>

<p><code>OnVerificationAttempted</code> is a required parameter. The callback signature passes a tuple object, where its first value represents whether the verification attempt was successful. This is <code>true</code> when the user correctly entered the correct answer; otherwise it’s <code>false</code>. The second value is an optional state object.</p>

<p>The <code>PromptAsync</code> method is used to display the modal dialog and accepts an optional state object.</p>

<p>The <code>Refresh</code> method is bound to the refresh button and is called to rerandomize the question being asked. The <code>AreYouHumanMath.CreateNew()</code> factory method is reassigned to the <code>_math</code> field, and <code>_attemptedAnswer</code> is set to <code>null</code>.</p>

<p>The <code>OnDismissed</code> method is the handler for the <code>ModalComponent.Dismissed</code> event callback. When the base modal is dismissed, it will have <code>DismissalReason</code>. With the <code>reason</code> and when <code>OnVerificationAttempted</code> has a delegate, it’s invoked passing whether it’s verified and any state that was held on to when prompted.</p>

<p>The <code>AttemptToVerify</code> method is bound to the verify button. When called it will attempt to parse <code>_attemptedAnswer</code> as an <code>int</code> and ask the <code>_math</code> object if the answer is correct. When <code>true</code>, <code>_modal</code> is dismissed as <code>Verified</code>. This will <a data-primary="VerificationModalComponent.cs" data-startref="vfal" data-type="indexterm" id="idm46365020475024"/>indirectly call <code>Dismissed</code>.</p>

<p>I bet you’re wondering what the <code>AreYouHumanMath</code> object <a data-primary="AreYouHumanMath.cs" data-type="indexterm" id="ayhmn"/>looks like—it sure was fun writing this cute little object. Take a look at the <em>AreYouHumanMath.cs</em> C# file:</p>

<pre data-code-language="csharp" data-type="programlisting"><code class="k">namespace</code> <code class="nn">Learning.Blazor.Models</code><code class="p">;</code>

<code class="k">public</code> <code class="k">readonly</code> <code class="n">record</code> <code class="k">struct</code> <code class="nf">AreYouHumanMath</code><code class="p">(</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO11-1" id="co_customizing_the_user_login_experience_CO11-1"><img alt="1" src="assets/1.png"/></a>
    <code class="kt">byte</code> <code class="n">LeftOperand</code><code class="p">,</code>
    <code class="kt">byte</code> <code class="n">RightOperand</code><code class="p">,</code>
    <code class="n">MathOperator</code> <code class="n">Operator</code> <code class="p">=</code> <code class="n">MathOperator</code><code class="p">.</code><code class="n">Addition</code><code class="p">)</code>
<code class="p">{</code>
    <code class="k">private</code> <code class="k">static</code> <code class="k">readonly</code> <code class="n">Random</code> <code class="n">s_random</code> <code class="p">=</code> <code class="n">Random</code><code class="p">.</code><code class="n">Shared</code><code class="p">;</code>

    <code class="c1">/// &lt;summary&gt;
</code>    <code class="c1">/// Determines if the given &lt;paramref name="guess"/&gt; value is correct.
</code>    <code class="c1">/// &lt;/summary&gt;
</code>    <code class="c1">/// &lt;param name="guess"&gt;The value being evaluated for correctness.&lt;/param&gt;
</code>    <code class="c1">/// &lt;returns&gt;
</code>    <code class="c1">/// &lt;c&gt;true&lt;/c&gt; when the given &lt;paramref name="guess"/&gt; is correct,
</code>    <code class="c1">/// otherwise &lt;c&gt;false&lt;/c&gt;.
</code>    <code class="c1">/// &lt;/returns&gt;
</code>    <code class="c1">/// &lt;exception cref="ArgumentException"&gt;
</code>    <code class="c1">/// An &lt;see cref="ArgumentException"/&gt; is thrown when
</code>    <code class="c1">/// the current &lt;see cref="Operator"/&gt; value is not defined.
</code>    <code class="c1">/// &lt;/exception&gt;
</code>    <code class="k">public</code> <code class="kt">bool</code> <code class="nf">IsCorrect</code><code class="p">(</code><code class="kt">int</code> <code class="n">guess</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">guess</code> <code class="p">=</code><code class="p">=</code> <code class="n">Operator</code> <code class="k">switch</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO11-2" id="co_customizing_the_user_login_experience_CO11-2"><img alt="2" src="assets/2.png"/></a>
    <code class="p">{</code>
        <code class="n">MathOperator</code><code class="p">.</code><code class="n">Addition</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">LeftOperand</code> <code class="p">+</code> <code class="n">RightOperand</code><code class="p">,</code>
        <code class="n">MathOperator</code><code class="p">.</code><code class="n">Subtraction</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">LeftOperand</code> <code class="p">-</code> <code class="n">RightOperand</code><code class="p">,</code>
        <code class="n">MathOperator</code><code class="p">.</code><code class="n">Multiplication</code> <code class="p">=</code><code class="p">&gt;</code> <code class="n">LeftOperand</code> <code class="p">*</code> <code class="n">RightOperand</code><code class="p">,</code>

        <code class="n">_</code> <code class="p">=</code><code class="p">&gt;</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">ArgumentException</code><code class="p">(</code>
            <code class="err">$</code><code class="s">"The operator is not supported: {Operator}"</code><code class="p">)</code>
    <code class="p">}</code><code class="p">;</code>

    <code class="c1">/// &lt;summary&gt;
</code>    <code class="c1">/// The string representation of the &lt;see cref="AreYouHumanMath"/&gt; instance.
</code>    <code class="c1">/// &lt;code language="cs"&gt;
</code>    <code class="c1">/// &lt;![CDATA[
</code>    <code class="c1">/// var math = new AreYouHumanMath(7, 3);
</code>    <code class="c1">/// math.ToString(); // "7 + 3 ="
</code>    <code class="c1">/// ]]&gt;
</code>    <code class="c1">/// &lt;/code&gt;
</code>    <code class="c1">/// &lt;/summary&gt;
</code>    <code class="c1">/// &lt;exception cref="ArgumentException"&gt;
</code>    <code class="c1">/// An &lt;see cref="ArgumentException"/&gt; is thrown when
</code>    <code class="c1">/// the current &lt;see cref="Operator"/&gt; value is not defined.
</code>    <code class="c1">/// &lt;/exception&gt;
</code>    <code class="k">public</code> <code class="k">override</code> <code class="kt">string</code> <code class="nf">ToString</code><code class="p">(</code><code class="p">)</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO11-3" id="co_customizing_the_user_login_experience_CO11-3"><img alt="3" src="assets/3.png"/></a>
    <code class="p">{</code>
        <code class="kt">var</code> <code class="n">operatorStr</code> <code class="p">=</code> <code class="n">Operator</code> <code class="k">switch</code>
        <code class="p">{</code>
            <code class="n">MathOperator</code><code class="p">.</code><code class="n">Addition</code> <code class="p">=</code><code class="p">&gt;</code> <code class="s">"+"</code><code class="p">,</code>
            <code class="n">MathOperator</code><code class="p">.</code><code class="n">Subtraction</code> <code class="p">=</code><code class="p">&gt;</code> <code class="s">"-"</code><code class="p">,</code>
            <code class="n">MathOperator</code><code class="p">.</code><code class="n">Multiplication</code> <code class="p">=</code><code class="p">&gt;</code> <code class="s">"*"</code><code class="p">,</code>

            <code class="n">_</code> <code class="p">=</code><code class="p">&gt;</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">ArgumentException</code><code class="p">(</code>
                <code class="err">$</code><code class="s">"The operator is not supported: {Operator}"</code><code class="p">)</code>
        <code class="p">}</code><code class="p">;</code>

        <code class="k">return</code> <code class="err">$</code><code class="s">"{LeftOperand} {operatorStr} {RightOperand} ="</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="kt">string</code> <code class="nf">GetQuestion</code><code class="p">(</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code> <code class="err">$</code><code class="s">"{this} ?"</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">static</code> <code class="n">AreYouHumanMath</code> <code class="nf">CreateNew</code><code class="p">(</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO11-4" id="co_customizing_the_user_login_experience_CO11-4"><img alt="4" src="assets/4.png"/></a>
        <code class="n">MathOperator</code><code class="p">?</code> <code class="n">mathOperator</code> <code class="p">=</code> <code class="k">null</code><code class="p">)</code>
    <code class="p">{</code>
        <code class="kt">var</code> <code class="n">mathOp</code> <code class="p">=</code>
            <code class="n">mathOperator</code><code class="p">.</code><code class="n">GetValueOrDefault</code><code class="p">(</code><code class="n">RandomOperator</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">;</code>

        <code class="kt">var</code> <code class="p">(</code><code class="n">left</code><code class="p">,</code> <code class="n">right</code><code class="p">)</code> <code class="p">=</code> <code class="n">mathOp</code> <code class="k">switch</code>
        <code class="p">{</code>
            <code class="n">MathOperator</code><code class="p">.</code><code class="n">Addition</code> <code class="p">=</code><code class="p">&gt;</code> <code class="p">(</code><code class="n">Next</code><code class="p">(</code><code class="p">)</code><code class="p">,</code> <code class="n">Next</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">,</code>
            <code class="n">MathOperator</code><code class="p">.</code><code class="n">Subtraction</code> <code class="p">=</code><code class="p">&gt;</code> <code class="p">(</code><code class="n">Next</code><code class="p">(</code><code class="m">120</code><code class="p">)</code><code class="p">,</code> <code class="n">Next</code><code class="p">(</code><code class="m">120</code><code class="p">)</code><code class="p">)</code><code class="p">,</code>
            <code class="n">_</code> <code class="p">=</code><code class="p">&gt;</code> <code class="p">(</code><code class="n">Next</code><code class="p">(</code><code class="m">30</code><code class="p">)</code><code class="p">,</code> <code class="n">Next</code><code class="p">(</code><code class="m">30</code><code class="p">)</code><code class="p">)</code><code class="p">,</code>
        <code class="p">}</code><code class="p">;</code>

        <code class="p">(</code><code class="n">left</code><code class="p">,</code> <code class="n">right</code><code class="p">)</code> <code class="p">=</code> <code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="n">Max</code><code class="p">(</code><code class="n">left</code><code class="p">,</code> <code class="n">right</code><code class="p">)</code><code class="p">,</code> <code class="n">Math</code><code class="p">.</code><code class="n">Min</code><code class="p">(</code><code class="n">left</code><code class="p">,</code> <code class="n">right</code><code class="p">)</code><code class="p">)</code><code class="p">;</code>

        <code class="k">return</code> <code class="k">new</code> <code class="nf">AreYouHumanMath</code><code class="p">(</code>
            <code class="p">(</code><code class="kt">byte</code><code class="p">)</code><code class="n">left</code><code class="p">,</code>
            <code class="p">(</code><code class="kt">byte</code><code class="p">)</code><code class="n">right</code><code class="p">,</code>
            <code class="n">mathOp</code><code class="p">)</code><code class="p">;</code>

        <code class="k">static</code> <code class="n">MathOperator</code> <code class="nf">RandomOperator</code><code class="p">(</code><code class="p">)</code>
        <code class="p">{</code>
            <code class="kt">var</code> <code class="n">values</code> <code class="p">=</code> <code class="n">Enum</code><code class="p">.</code><code class="n">GetValues</code><code class="p">&lt;</code><code class="n">MathOperator</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
            <code class="k">return</code> <code class="n">values</code><code class="p">[</code><code class="n">s_random</code><code class="p">.</code><code class="n">Next</code><code class="p">(</code><code class="n">values</code><code class="p">.</code><code class="n">Length</code><code class="p">)</code><code class="p">]</code><code class="p">;</code>
        <code class="p">}</code><code class="p">;</code>

        <code class="k">static</code> <code class="kt">int</code> <code class="nf">Next</code><code class="p">(</code><code class="kt">byte?</code> <code class="n">maxValue</code> <code class="p">=</code> <code class="k">null</code><code class="p">)</code> <code class="p">=</code><code class="p">&gt;</code>
            <code class="n">s_random</code><code class="p">.</code><code class="n">Next</code><code class="p">(</code><code class="m">1</code><code class="p">,</code> <code class="n">maxValue</code> <code class="p">?</code><code class="p">?</code> <code class="kt">byte</code><code class="p">.</code><code class="n">MaxValue</code><code class="p">)</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">public</code> <code class="k">enum</code> <code class="n">MathOperator</code> <code class="p">{</code> <code class="n">Addition</code><code class="p">,</code> <code class="n">Subtraction</code><code class="p">,</code> <code class="n">Multiplication</code> <code class="p">}</code><code class="p">;</code> <a class="co" href="#callout_customizing_the_user_login_experience_CO11-5" id="co_customizing_the_user_login_experience_CO11-5"><img alt="5" src="assets/5.png"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO11-1" id="callout_customizing_the_user_login_experience_CO11-1"><img alt="1" src="assets/1.png"/></a></dt>
<dd><p><code>AreYouHumanMath</code> is a positional <code>record</code> that defines a simple math problem.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO11-2" id="callout_customizing_the_user_login_experience_CO11-2"><img alt="2" src="assets/2.png"/></a></dt>
<dd><p>The ability to test whether a <code>guess</code> is the correct answer is expressed by the <code>IsCorrect</code> method.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO11-3" id="callout_customizing_the_user_login_experience_CO11-3"><img alt="3" src="assets/3.png"/></a></dt>
<dd><p>The <code>ToString</code> method is used to display the math problem.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO11-4" id="callout_customizing_the_user_login_experience_CO11-4"><img alt="4" src="assets/4.png"/></a></dt>
<dd><p>The <code>CreateNew</code> method is used to create a new random math problem.</p></dd>
<dt><a class="co" href="#co_customizing_the_user_login_experience_CO11-5" id="callout_customizing_the_user_login_experience_CO11-5"><img alt="5" src="assets/5.png"/></a></dt>
<dd><p>The <code>MathOperator</code> enum defines whether a problem is addition, subtraction, or multiplication.</p></dd>
</dl>

<p>The <code>AreYouHumanMath</code> object is a <code>readonly record struct</code>. As such, it’s immutable but allows for <code>with</code> expressions, which creates a clone. It’s a positional record, meaning it can be instantiated only using the required parameter constructor. A <code>left</code> and <code>right</code> operand value is required, but the math operator is optional and defaults to addition.</p>

<p><code>Random.Shared</code> was introduced with .NET 6 and is used to assign the <code>static readonly Random</code> instance.</p>

<p>The <code>IsCorrect</code> method accepts a <code>guess</code>. This method will return <code>true</code> only when the given <code>guess</code> equals the evaluated math operation of the left and right operand values. For example, <code>new AreYouHumanMath(7, 3).IsCorrect(10)</code> would evaluate as <code>true</code> because seven plus three equals ten. This method is expressed as a switch expression on the <code>Operator</code>. Each operator case arm is expressed as the corresponding math operation.</p>

<p>The <code>ToString</code> and <code>GetQuestion</code> methods return the mathematical representation of the applied operator and two operands. For example, <code>new AreYouHumanMath​(7, 3).ToString()</code> would evaluate as <code>"7 + 3 ="</code>, whereas <code>new AreYouHumanMath​(7, 3).GetQuestion()</code> would be <code>"7 + 3 = ?"</code>.</p>

<p>The <code>CreateNew</code> method relies heavily on the <code>Random</code> class to help ensure that each time it’s invoked a new question is asked. When the optional <code>mathOperator</code> is provided, it’s used; otherwise, a random one is determined. With an operator, the operands are randomly determined; the maximum number is the left operand, and the minimum is the right.</p>

<p>As for the <code>enum MathOperator</code>, I intentionally decided to avoid division. With the use of random numbers, it would have been a bit more complex, with concerns of dividing by <code>0</code> and precision. Instead, I was hoping for math that you could more than likely do in your head.</p>

<p><code>VerificationModalComponent</code> is used as a spam blocker on the <em>Contact.razor</em> page, as we’ll discuss in detail in <a data-type="xref" href="ch08.html#chapter-eight">Chapter 8</a>. <code>ModalComponent</code> is also used by <code>Audio​De⁠scriptionComponent</code> and <code>LanguageSelectionComponent</code>. These two components are immediately to the <a data-primary="event binding" data-startref="evbdg" data-type="indexterm" id="idm46365020092768"/><a data-primary="AreYouHumanMath.cs" data-startref="ayhmn" data-type="indexterm" id="idm46365020091936"/>right of <code>ThemeIndicatorComponent</code>, discussed in <a data-type="xref" href="ch02.html#theme-indicator-component">“Native theme awareness”</a>.</p>
</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm46365021643232">
<h1>Summary</h1>

<p>You learned a lot more about how extensive and configurable Blazor app development is. You have a much better understanding of how to authenticate a user in the context of a Blazor WebAssembly application. I showed you a familiar web client startup configuration pattern where all the client-side services are registered. We customized the authorization UX. We explored the implementation of browser native speech synthesis. Finally, we read all the markup and C# code for the chrome within the app’s header and modal dialog hierarchical capabilities. We now have a much better understanding of Blazor event management, firing, and consuming.</p>

<p>In the next chapter, I’m going to show you a pattern for localizing the app in 40 different languages. I’ll show you how we use an entirely free GitHub Action combined with Azure Cognitive Services to machine translate resource files on our behalf. You’ll learn exactly how to implement localization using the framework-provided <code>IStrin⁠g​Localizer&lt;T&gt;</code> type along with static resource files. You’ll learn various formatting details as well.</p>
</div></section>







</div></section></body></html>