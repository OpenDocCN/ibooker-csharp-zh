<html><head></head><body><section data-pdf-bookmark="Chapter 6. Inheritance: Your Object&#x2019;s Family Tree" data-type="chapter" epub:type="chapter"><div class="chapter" id="inheritance_your_objectapostrophes_famil">&#13;
<h1><span class="label">Chapter 6. </span>Inheritance: <em>Your Object’s Family Tree</em></h1>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/272fig01a.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>Sometimes you <em>DO</em> want to be just like your parents.</strong> Ever run across a class that <strong><em>almost</em></strong> does exactly what you want <strong><em>your</em></strong> class to do? Found yourself thinking that if you could just <strong><em>change a few things</em></strong>, that class would be perfect? With <strong>inheritance</strong>, you can <strong>extend</strong> an existing class so your new class gets all of its behavior—with the <strong>flexibility</strong> to make changes to that behavior so you can tailor it however you want. Inheritance is one of the most powerful concepts and techniques in the C# language: with it you can <strong>avoid duplicate code, model the real world</strong> more closely, and end up with apps that are <strong>easier to maintain</strong> and <strong>less prone to bugs</strong>.</p>&#13;
<p><strong><em>Do this!</em></strong></p>&#13;
<ul>&#13;
<li><p><span style="color:#9D9EA0;"><em>THE BASE DAMAGE FOR AN ARROW IS THE 1D6 ROLL MULTIPLIED BY .35HP.</em></span></p></li>&#13;
<li><p><span style="color:#9D9EA0;"><em>FOR A MAGIC ARROW, THE BASE DAMAGE IS MULTIPLIED BY 2.5HP.</em></span></p></li>&#13;
<li><p><span style="color:#9D9EA0;"><em>A FLAMING ARROW ADDS AN EXTRA 1.25HP.</em></span></p></li>&#13;
<li><p><span style="color:#9D9EA0;"><em>THE RESULT IS ROUNDED <strong>UP</strong> TO THE NEAREST INTEGER HP.</em></span></p></li>&#13;
</ul>&#13;
<section data-pdf-bookmark="Calculate damage for MORE weapons" data-type="sect1"><div class="sect1" id="calculate_damage_for_more_weapons">&#13;
<h1>Calculate damage for MORE weapons</h1>&#13;
<p><a data-primary="ArrowDamage class" data-type="indexterm" id="idm46402344424360"/><a data-primary="Math.Ceiling method" data-type="indexterm" id="idm46402344418904"/>The updated sword damage calculator was huge a hit on game night! Now Owen wants calculators for all of the weapons. Let’s start with the damage calculation for an arrow, which uses a 1d6 roll. Let’s <strong>create a new ArrowDamage class</strong> to calculate the arrow damage using the arrow formula in Owen’s game master notebook.</p>&#13;
<p>Most of the code in ArrowDamage will be <strong><em>identical to the code</em></strong> in the SwordDamage class. Here’s what we need to do to get started building the new app.</p>&#13;
<ol>&#13;
<li><p><strong>Create a new .NET Console App project.</strong> We want it to do both sword and arrow calculations, so <strong>add the SwordDamage class</strong> to the project.</p></li>&#13;
<li><p><strong>Create an ArrowDamage class that’s an <u>exact copy</u> of SwordDamage.</strong> Create a new class called ArrowDamage, then <strong><u>copy</u> all of the code from SwordDamage and paste it</strong> into the new ArrowDamage class. Then change the constructor name to ArrowDamage so the program builds.</p></li>&#13;
<li><p><strong>Refactor the constants.</strong> The arrow damage formula has different values for the base and flame damage, so let’s rename the BASE_DAMAGE constant to BASE_MULTIPLIER and update the constant values. We think these constants make the code easier to read, so add a MAGIC_MULTIPLIER constant too:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/274fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>ArrowDamage</p>&#13;
<p>Roll</p>&#13;
<p>Magic</p>&#13;
<p>Flaming</p>&#13;
<p>Damage</p>&#13;
</div></li>&#13;
<li><p><strong>Modify the CalculateDamage method</strong>. Now all you need to do to make your new ArrowDamage class work is to update the CalculateDamage method so it does the correct calculation:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/274fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
</ol>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-idd0015">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/brainpower.png"/></span> Brain Power</h5>&#13;
<p>There are <strong>many</strong> different ways to write code that does the same thing. Can you think of another way to write the code to calculate arrow damage?</p>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use a switch statement to match several candidates" data-type="sect1"><div class="sect1" id="use_a_switch_statement_to_match_several">&#13;
<h1>Use a <u>switch statement</u> to match several candidates</h1>&#13;
<p><a data-primary="default keyword" data-type="indexterm" id="idm46402344397784"/><a data-primary="exercises" data-secondary="switch statement" data-type="indexterm" id="idm46402344397048"/><a data-primary="switch statement" data-type="indexterm" id="idm46402344396072"/>Let’s update our console app to prompt the user whether to calculate damage from an arrow or a sword. We’ll ask for a key, and use the static <strong>Char.ToUpper</strong> <strong>method</strong> to convert it to uppercase:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/275fig001.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>We <strong><em>could</em></strong> use <code>if/else</code> statements for this:</p>&#13;
<pre data-type="programlisting">if (weaponKey == ’S’) { <span style="color:#9D9EA0;">/* calculate sword damage */</span> }&#13;
else if (weaponKey == ’A’) { <span style="color:#9D9EA0;">/* calculate arrow damage */</span> }&#13;
else return;</pre>&#13;
<p>That’s how we’ve handled input so far. Comparing one variable against many different values is a really common pattern that you’ll see over and over again. It’s so common that C# has a special kind of statement <em>designed <u>specifically</u> for this situation</em>. A <code>switch</code> <strong>statement</strong> lets you compare one variable against many values in a way that’s compact and easy to read. Here’s a <code><strong>switch</strong></code> <strong>statement</strong> that does <u>exactly the same thing</u> as the <code>if/else</code> statements above:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/275fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0019">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>&#13;
<p>Update the Main method to use a <code>switch</code> statement to let the user choose the type of weapon. Start by copying the Main and RollDice methods from the exercise solution at the end of the last chapter.</p>&#13;
<ol>&#13;
<li><p>Create an instance of ArrowDamage at the top of the method, just after you create the SwordDamage instance.</p></li>&#13;
<li><p>Modify the RollDice method to take an int parameter called numberOfRolls so you can call RollDice(3) to roll 3d6 (so it calls random.Next(1, 7) three times and adds the results), or RollDice(1) to roll 1d6.</p></li>&#13;
<li><p>Add the two lines of code exactly like they appear above that write the sword or arrow prompt to the console, read the input using Console.ReadKey, use Char.ToUpper to convert the key to uppercase, and store it in weaponKey.</p></li>&#13;
<li><p><strong>Add the</strong> <code>switch</code> <strong>statement.</strong> It will be exactly the same as the <code>switch</code> statement above, except you’ll replace each of the <span style="color:#9D9EA0;"><code>/* comments */</code></span> with code that calculates damage and writes a line of output to the console.</p></li>&#13;
</ol>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0008">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<p>We just gave you a totally new piece of C# syntax—the <code>switch</code> <strong>statement</strong>—and asked you to use it in a program. The C# team at Microsoft is constantly improving the language, and being able to incorporate new language elements into your code is <code><strong>a really valuable C# skill</strong></code>.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/276fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="One more thing...can we calculate damage for a dagger? and a mace? and a staff? and..." data-type="sect1"><div class="sect1" id="one_more_thinghellipcan_we_calculate_dam">&#13;
<h1>One more thing...can we calculate damage for a dagger? and a mace? and a staff? and...</h1>&#13;
<p><a data-primary="code" data-secondary="repeating" data-type="indexterm" id="idm46402344365064"/><a data-primary="inheritance" data-secondary="about" data-type="indexterm" id="idm46402344363400"/>We’ve made two classes for sword and arrow damage. But what happens if there are three other weapons? Or four? Or 12? And what if you had to maintain that code and make more changes later? What if you had to make the <strong><em>same exact change</em></strong> to five or six <strong><em>closely related</em></strong> classes? What if you had to keep making changes? It’s inevitable that bugs would slip through—it’s way too easy to update five classes but forget to change the sixth.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/277fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/277fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>You’re right! Having the same code repeated in different classes is inefficient and error-prone.</strong></p>&#13;
<p>Lucky for us, C# gives us a better way to build classes that are related to each other and share behavior: <u><strong><em>inheritance</em></strong></u>.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="When your classes use inheritance, you only need to write your code once" data-type="sect1"><div class="sect1" id="when_your_classes_use_inheritancecomma_y">&#13;
<h1>When your classes use inheritance, you only need to write your code once</h1>&#13;
<p><a data-primary="base classes" data-secondary="about" data-type="indexterm" id="idm46402344353096"/><a data-primary="classes" data-secondary="inheritance and" data-type="indexterm" id="idm46402344351768"/><a data-primary="code" data-secondary="similar" data-type="indexterm" id="idm46402344350536"/><a data-primary="inheritance" data-secondary="classes and" data-type="indexterm" id="idm46402344349496"/><a data-primary="similar behaviors" data-type="indexterm" id="idm46402344348440"/><a data-primary="similar code" data-type="indexterm" id="idm46402344347592"/><a data-primary="subclasses" data-secondary="about" data-type="indexterm" id="idm46402344346744"/>It’s no coincidence that your SwordDamage and ArrowDamage classes have a lot of the same code. When you write C# programs, you often create classes that represent things in the real world, and those things are usually related to each other. Your classes have <strong>similar code</strong> because the things they represent in the real world—two similar calculations from the same role-playing game—have <strong>similar behaviors</strong>.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/278fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>When you have two classes that are specific cases of something more general, you can set them up to <strong>inherit</strong> from the same class. When you do that, each of them is a <strong>subclass</strong> of the same <strong>base class</strong>.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/278fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Build up your class model by starting general and getting more specific" data-type="sect1"><div class="sect1" id="build_up_your_class_model_by_starting_ge">&#13;
<h1>Build up your <u>class model</u> by starting general and getting more specific</h1>&#13;
<p><a data-primary="class hierarchy" data-type="indexterm" id="idm46402344336536"/><a data-primary="class models" data-type="indexterm" id="idm46402344335448"/><a data-primary="hierarchy" data-secondary="about" data-type="indexterm" id="idm46402344334648"/><a data-primary="inheritance" data-secondary="building class models" data-type="indexterm" id="idm46402344333464"/><a data-primary="inherit, defined" data-type="indexterm" id="idm46402344332392"/>When you build a set of classes that represent things (especially things in the real world), you’re building a <strong>class model</strong>. Real-world things are often in a <strong>hierarchy</strong> that goes from more general to more specific, and your programs have their own <strong>class hierarchy</strong> that does the same thing. In your class model, classes further down in the hierarchy <strong>inherit</strong> from those above them.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/279fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="How would you design a zoo simulator?" data-type="sect1"><div class="sect1" id="how_would_you_design_a_zoo_simulatorques">&#13;
<h1>How would you design a zoo simulator?</h1>&#13;
<p><a data-primary="animal inheritance program" data-type="indexterm" id="idm46402344325512"/><a data-primary="base classes" data-secondary="about" data-type="indexterm" id="idm46402344324536"/><a data-primary="child" data-type="indexterm" id="idm46402344323528"/><a data-primary="extend" data-type="indexterm" id="idm46402344322648"/><a data-primary="inheritance" data-secondary="designing zoo simulator" data-type="indexterm" id="idm46402344321816"/><a data-primary="inheritance" data-secondary="terminology" data-type="indexterm" id="idm46402344320632"/><a data-primary="parent" data-type="indexterm" id="idm46402344319560"/><a data-primary="subclasses" data-secondary="child and" data-type="indexterm" id="idm46402344318728"/><a data-primary="superclass" data-type="indexterm" id="idm46402344317592"/><a data-primary="Zoo Simulator project" data-secondary="about" data-type="indexterm" id="idm46402344316728"/>Lions and tigers and bears...oh my! Also, hippos, wolves, and the occasional dog. Your job is to design an app that simulates a zoo. (Don’t get too excited—we’re not going to actually build the code, just design the classes to represent the animals. We bet you’re already thinking about how you’d do this in Unity!)</p>&#13;
<p>We’ve been given a list of some of the animals that will be in the program, but not all of them. We know that each animal will be represented by an object, and that the objects will move around in the simulator, doing whatever it is that each particular animal is programmed to do.</p>&#13;
<p>More importantly, we want the program to be easy for other programmers to maintain, which means they’ll need to be able to add their own classes later on if they want to add new animals to the simulator.</p>&#13;
<p><strong><em>Let’s start by building a <u>class model</u> for the animals we know about.</em></strong></p>&#13;
<p>So what’s the first step? Well, before we can talk about <strong>specific</strong> animals, we need to figure out the <strong>general</strong> things they have in common—the abstract characteristics that <strong><em>all</em></strong> animals have. Then we can build those characteristics into a base class that all animal classes can inherit from.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>The terms <span style="color:#9D9EA0;">parent, superclass</span>, and <span style="color:#9D9EA0;">base class</span> are often used interchangeably. Also, the terms <span style="color:#9D9EA0;">extend</span> and <span style="color:#9D9EA0;">inherit from</span> mean the same thing. The terms <span style="color:#9D9EA0;">child</span> and <span style="color:#9D9EA0;">subclass</span> are also synonymous, but <span style="color:#9D9EA0;">subclass</span> can also be used as a verb.</strong></p>&#13;
</div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">Some people use the term “base class” to specifically mean the class at the top of the inheritance tree...but not the VERY top, because every class inherits from Object or a subclass of Object.</span></p>&#13;
</div>&#13;
<ol>&#13;
<li><p><strong>Look for things the animals have in common.</strong></p>&#13;
<p>Take a look at these six animals. What do a lion, a hippo, a tiger, a bobcat, a wolf, and a dog have in common? How are they related? You’ll need to figure out their relationships so you can come up with a class model that includes all of them.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/280fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p><a data-primary="base classes" data-secondary="building Animal base class for zoo simulator" data-type="indexterm" id="idm46402344298376"/><a data-primary="code" data-secondary="avoiding duplication" data-type="indexterm" id="idm46402344296888"/><a data-primary="inheritance" data-secondary="using to avoid duplicate code in subclasses" data-type="indexterm" id="idm46402344295576"/><a data-primary="subclasses" data-secondary="avoiding duplicate code, using inheritance" data-type="indexterm" id="idm46402344294440"/><strong>Build a base class to give the animals everything they have in common.</strong></p>&#13;
<p>The fields, properties, and methods in the base class will give all of the animals that inherit from it a common state and behavior. They’re all animals, so it makes sense to call the base class Animal.</p>&#13;
<p>You already know that we should avoid duplicate code: it’s hard to maintain, and always leads to headaches down the road. So let’s choose fields and methods for an Animal base class that you <strong>only have to write once</strong>, and each of the animal subclasses can inherit them. Let’s start with the public properties:</p>&#13;
<ul>&#13;
<li><p>Picture: a path to an image file.</p></li>&#13;
<li><p>Food: the type of food this animal eats. Right now, there can be only two values: meat and grass.</p></li>&#13;
<li><p>Hunger: an int representing the hunger level of the animal. It changes depending on when (and how much) the animal eats.</p></li>&#13;
<li><p>Boundaries: a reference to a class that stores the height, width, and location of the pen that the animal will roam around in.</p></li>&#13;
<li><p>Location: the X and Y coordinates where the animal is standing.</p></li>&#13;
</ul>&#13;
<p>In addition, the Animal class has four methods the animals can inherit:</p>&#13;
<ul>&#13;
<li><p>MakeNoise: a method to let the animal make a sound.</p></li>&#13;
<li><p>Eat: behavior for when the animal encounters its preferred food.</p></li>&#13;
<li><p>Sleep: a method to make the animal lie down and take a nap.</p></li>&#13;
<li><p>Roam: a method to make animals wander around their pens.</p></li>&#13;
</ul>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/281fig01.png"/>&#13;
<h6/>&#13;
</div></figure></li>&#13;
</ol>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Different animals have different behaviors" data-type="sect1"><div class="sect1" id="different_animals_have_different_behavio">&#13;
<h1>Different animals have different behaviors</h1>&#13;
<p><a data-primary="methods" data-secondary="overriding" data-type="indexterm" id="idm46402344281032"/>Lions roar, dogs bark, and as far as <em>we</em> know hippos don’t make any sound at all. All of the classes that inherit from Animal will have a MakeNoise method, but each of those methods will work a different way and will have different code. When a subclass changes the behavior of one of the methods that it inherited, we say that it <strong>overrides</strong> the method.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Just because a property or a method is in the Animal base class, that doesn’t mean every subclass has to use it the same way...or at all!</p>&#13;
</div>&#13;
<ol start="3">&#13;
<li><p><strong>Figure out what each animal does that the Animal class does differently—or not at all.</strong></p>&#13;
<p>Every animal needs to eat, but a dog might take small bites of meat while a hippo eats huge mouthfuls of grass. What would the code for that behavior look like? Both the dog and the hippo would override the Eat method. The hippo’s method would have it consume, say, 20 pounds of hay each time it was called. The dog’s Eat method, on the other hand, would reduce the zoo’s food supply by one 12-ounce can of dog food.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><em><span style="color:#9D9EA0;">So when you’ve got a subclass that inherits from a base class, it</span> <strong>must</strong> <span style="color:#9D9EA0;">inherit all of the base class’s behaviors... but you can</span> <strong>modify</strong> <span style="color:#9D9EA0;">them in the subclass so they’re not performed exactly the same way. That’s what overriding is all about.</span></em></p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/282fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-idd0016">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/brainpower.png"/></span> Brain Power</h5>&#13;
<p>We already know that some animals will override the MakeNoise and Eat methods. Which animals will override Sleep or Roam? Will any of them?</p>&#13;
</div></aside></li>&#13;
<li><p><a data-primary="classes" data-secondary="looking for common" data-type="indexterm" id="idm46402344265464"/><a data-primary="inheritance" data-secondary="looking for classes with much in common" data-type="indexterm" id="idm46402344263960"/><strong>Look for classes that have a lot in common.</strong></p>&#13;
<p>Don’t dogs and wolves seem pretty similar? They’re both canines, and it’s a good bet that if you look at their behavior they have a lot in common. They probably eat the same food and sleep the same way. What about bobcats, tigers, and lions? It turns out all three of them move around their habitats in exactly the same way. It’s a good bet that you’ll be able to have a general Feline class that lives between Animal and those three feline classes that can help prevent duplicate code between them.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/283fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p><a data-primary="class hierarchy" data-type="indexterm" id="idm46402344259944"/><a data-primary="hierarchy" data-secondary="creating class hierarchy" data-type="indexterm" id="idm46402344258584"/><a data-primary="inheritance" data-secondary="creating class hierarchy" data-type="indexterm" id="idm46402344257576"/><a data-primary="Zoo Simulator project" data-secondary="class hierarchy" data-type="indexterm" id="idm46402344256424"/><strong>Finish your class hierarchy.</strong></p>&#13;
<p>Now that you know how you’ll organize the animals, you can add the Feline and Canine classes.</p>&#13;
<p>When you create your classes so that there’s a base class at the top with subclasses below it, and those subclasses have their own subclasses that inherit from them, what you’ve built is called a <strong>class hierarchy</strong>. This is about more than just avoiding duplicate code, although that is certainly a great benefit of a sensible hierarchy. One benefit of this is code that’s a lot easier to understand and maintain. When you’re looking at the zoo simulator code and you see a method or property defined in the Feline class, then you <em>immediately know</em> that you’re looking at something that all of the cats share. Your hierarchy becomes a map that helps you find your way through your program.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/284fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
</ol>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Every subclass extends its base class" data-type="sect1"><div class="sect1" id="every_subclass_extends_its_base_class">&#13;
<h1>Every subclass <u>extends</u> its base class</h1>&#13;
<p><a data-primary="base classes" data-secondary="extending" data-type="indexterm" id="idm46402344249256"/><a data-primary="inheritance" data-secondary="each subclass extending its base class" data-type="indexterm" id="idm46402344248040"/><a data-primary="methods" data-secondary="calling most specific" data-type="indexterm" id="idm46402344245720"/><a data-primary="subclasses" data-secondary="about" data-type="indexterm" id="idm46402344244600"/><a data-primary="Zoo Simulator project" data-secondary="extending base class" data-type="indexterm" id="idm46402344243480"/><a data-primary="Zoo Simulator project" data-secondary="inheriting from base class" data-type="indexterm" id="idm46402344242328"/>You’re not limited to the methods that a subclass inherits from its base class...but you already know that! After all, you’ve been building your own classes all along. When you modify a class to make it inherit members—and we’ll see that in C# code soon!—what you’re doing is taking the class you’ve already built and <strong><em>extending</em></strong> it by adding all of the fields, properties, and methods in the base class. So if you want to add a Fetch method to Dog, that’s perfectly normal. It won’t inherit or override anything—only the Dog class will have that method, and it won’t end up in Wolf, Canine, Animal, Hippo, or any other class.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="hi_er_ar_chycomma_noundot">&#13;
<h5>hi-er-ar-chy, noun.</h5>&#13;
<p>an arrangement or classification in which groups or things are ranked one above the other. <em>The president of Dynamco had worked her way up from the mailroom to the top of the corporate <strong>hierarchy</strong>.</em></p>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/285fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<section data-pdf-bookmark="C# always calls the most specific method" data-type="sect2"><div class="sect2" id="chash_always_calls_the_most_specific_met">&#13;
<h2>C# always calls the most specific method</h2>&#13;
<p>If you tell your Dog object to roam, there’s only one method that can be called—the one in the Animal class. What about telling your Dog to make noise? Which MakeNoise is called?</p>&#13;
<p>Well, it’s not too hard to figure it out. A method in the Dog class tells you how dogs make noise. If it’s in the Canine class, it’s telling you how all canines do it. If it’s in Animal, then it’s a description of that behavior that’s so general that it applies to every single animal. So if you ask your Dog to make a noise, first C# will look inside the Dog class to find the behavior that applies specifically to dogs. If Dog didn’t have a MakeNoise method it’d check Canine, and after that it’d check Animal.</p>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Any place where you can use a base class, you can use one of its subclasses instead" data-type="sect1"><div class="sect1" id="any_place_where_you_can_use_a_base_class">&#13;
<h1>Any place where you can use a base class, you can use one of its subclasses instead</h1>&#13;
<p><a data-primary="base classes" data-secondary="using subclasses instead" data-type="indexterm" id="idm46402344232248"/><a data-primary="inheritance" data-secondary="using subclass in place of base class" data-type="indexterm" id="idm46402344229560"/><a data-primary="subclasses" data-secondary="using instead of base classes" data-type="indexterm" id="idm46402344228424"/><a data-primary="superclass" data-type="indexterm" id="idm46402344227384"/>One of the most useful things you can do with inheritance is to <strong>extend</strong> a class. So if your method takes a Bird object, then you can pass an instance of Woodpecker. All that method knows is that it has a bird. It doesn’t know what kind of bird it has, so it can only ask it to do things that all birds do: it can ask the bird to Walk and LayEggs, but it can’t ask it to HitWoodWithBeak, because only Woodpeckers have that behavior—and the method doesn’t know that it’s specifically a Woodpecker, just that it’s a more general Bird. It <strong><em>only has access to the fields, properties, and other methods that are part of the class it knows about</em></strong>.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/286fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/286fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-idd0026">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil</h5>&#13;
<p><a data-primary="class models" data-type="indexterm" id="idm46402344217992"/><a data-primary="exercises" data-secondary="Sharpen your pencil" data-tertiary="class models" data-type="indexterm" id="idm46402344217016"/><a data-primary="Sharpen Your Pencil exercises" data-secondary="class models" data-type="indexterm" id="idm46402344215112"/>The code below is from a program that uses the class model that includes Animal, Hippo, Canine, Wolf, and Dog. Draw a line through each statement that won’t compile, and write an explanation for the problem next to it.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/287fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-idd011">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil Solution</h5>&#13;
<p>Six of the statements below won’t compile because they conflict with the class model. You can test this out yourself! Build your own version of the class model with empty methods, type in the code, and read the compiler errors.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/288fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/289fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-idd0017">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/brainpower.png"/></span> Brain Power</h5>&#13;
<p><a data-primary="superclass" data-type="indexterm" id="idm46402344202072"/>Owen asked a really good question. Go back to the app you built for Owen that calculates sword and arrow damage. How would you use inheritance and subclasses to improve the code? (Spoiler alert: you’ll be doing that later in the chapter!)</p>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-idd0012">&#13;
<h5>Bullet Points</h5>&#13;
<ul>&#13;
<li><p>A <code>switch</code> <strong>statement</strong> lets you compare one variable against many values. Each case executes code if its value matches. The default block runs if no cases match.</p></li>&#13;
<li><p><strong>Inheritance</strong> lets you build classes that are related to each other and share behavior. Use arrows to show inheritance in a class diagram.</p></li>&#13;
<li><p>When you have two classes that are <strong>specific</strong> cases of something more <strong>general</strong>, you can set them up to inherit from the same general class. When you do that, each of them is a <strong>subclass</strong> of the same general <strong>base class</strong>.</p></li>&#13;
<li><p>When you build a set of classes that represent things, it’s called a <strong>class model</strong>. It can include classes that form a <strong>hierarchy</strong> of subclasses and base class.</p></li>&#13;
<li><p>The terms <strong>parent</strong>, <strong>superclass</strong>, and <strong>base class</strong> are often used interchangeably. Also, the terms <strong>extend</strong> and <strong>inherit from</strong> mean the same thing.</p></li>&#13;
<li><p>The terms <strong>child</strong> and <strong>subclass</strong> mean the same thing. We say that a subclass <strong>extends</strong> its base class. (The word <strong>subclass</strong> can also be used as a verb.)</p></li>&#13;
<li><p>When a subclass changes the behavior of one of the methods that it inherited, we say that it <strong>overrides</strong> the method.</p></li>&#13;
<li><p>C# always calls the <strong>most specific method</strong>. If a method in the base class uses a method or property that the subclass overrides, it will call the overridden version in the subclass.</p></li>&#13;
<li><p>Always <strong>use a subclass reference</strong> in place of a base class. If a method takes an Animal parameter and Dog extends Animal, you can pass it a Dog argument.</p></li>&#13;
<li><p>You can always use a subclass <strong>in place of the base class</strong> it inherits from, but you can’t always use a base class in place of a subclass that extends it.</p></li>&#13;
</ul>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use a colon to extend a base class" data-type="sect1"><div class="sect1" id="use_a_colon_to_extend_a_base_class">&#13;
<h1>Use a colon to extend a base class</h1>&#13;
<p><a data-primary="base classes" data-secondary="colon" data-type="indexterm" id="idm46402344182440"/><a data-primary="colon, using to inherit from base class" data-type="indexterm" id="idm46402344179576"/><a data-primary="inheritance" data-secondary="using colon to inherit from a base class" data-type="indexterm" id="idm46402344178808"/><a data-primary="subclasses" data-secondary="inheriting from base class" data-type="indexterm" id="idm46402344177704"/>When you’re writing a class, you use a <strong>colon (:)</strong> to have it inherit from a base class. That makes it a subclass, and gives it <strong>all of the fields, properties, and methods</strong> of the class it inherits from. This Bird class is a subclass of Vertebrate:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/290fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="We know that inheritance adds the base class fields, properties, and methods to the subclass..." data-type="sect1"><div class="sect1" id="we_know_that_inheritance_adds_the_base_c">&#13;
<h1>We know that inheritance adds the base class fields, properties, and methods to the subclass...</h1>&#13;
<p><a data-primary="inheritance" data-secondary="subclasses" data-type="indexterm" id="idm46402344172152"/><a data-primary="subclasses" data-secondary="about" data-type="indexterm" id="idm46402344170296"/><a data-primary="subclasses" data-secondary="modifying" data-type="indexterm" id="idm46402344169320"/>We’ve seen inheritance when a subclass needs to inherit <strong><em>all</em></strong> of the base class’s methods, properties, and fields.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/291fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<section data-pdf-bookmark="...but some birds don’t fly!" data-type="sect2"><div class="sect2" id="hellipbut_some_birds_donapostrophet_flye">&#13;
<h2>...but some birds don’t fly!</h2>&#13;
<p>What do you do if your base class has a method that your subclass needs to <strong><em>modify</em></strong>?</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/291fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>Oops—we’ve got a problem. Penguins are birds, and the Bird class has a Fly method, but we don’t want our penguins to fly. It would be great if we could display a warning if a penguin tries to fly.</strong></p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/291fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-idd0018">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/brainpower.png"/></span> Brain Power</h5>&#13;
<p>If these classes were in your zoo simulator, what would you do about flying penguins?</p>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="A subclass can override methods to change or replace members it inherited" data-type="sect1"><div class="sect1" id="a_subclass_can_override_methods_to_chang">&#13;
<h1>A subclass can override methods to change or replace members it inherited</h1>&#13;
<p><a data-primary="overriding methods" data-secondary="override keyword" data-type="indexterm" id="idm46402344152984"/><a data-primary="subclasses" data-secondary="overriding methods" data-type="indexterm" id="idm46402344151464"/><a data-primary="virtual keyword" data-secondary="about" data-type="indexterm" id="idm46402344150248"/>Sometimes you’ve got a subclass that you’d like to inherit <em>most</em> of the behaviors from the base class, but <em>not all of them</em>. When you want to change the behaviors that a class has inherited, you can <strong>override methods or properties</strong>, replacing them with new members with the same name.</p>&#13;
<p>When you <strong>override a method</strong>, your new method needs to have exactly the same signature as the method in the base class it’s overriding. In the case of the penguin, that means it needs to be called Fly, return void, and have no parameters.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>o-ver-ride, verb.</p>&#13;
<p>to use authority to replace, reject, or cancel. <em>Once she became president of Dynamco, she could <strong>override</strong> poor management decisions.</em></p>&#13;
</div>&#13;
<ol>&#13;
<li><p><strong>Add the virtual keyword to the method in the base class.</strong></p>&#13;
<p>A subclass can only override a method if it’s marked with the <code>virtual</code> keyword. Adding <code>virtual</code> to the Fly method declaration tells C# that a subclass of the Bird class is allowed to override the Fly method.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/292fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p><strong>Add the override keyword to a <u>method with the same name</u> in the subclass.</strong></p>&#13;
<p>The subclass’s method will need to have exactly the same signature—the same return type and parameters—and you’ll need to use the <code><strong>override</strong></code> keyword in the declaration. Now a Penguin object prints a warning when its Fly method is called.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/292fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
</ol>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0019a">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/293fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>A short C# program is listed below. One block of the program is missing! Your challenge is to match the candidate block of code (on the left) with the output—what’s in the message box that the program pops up—that you’d see if the block were inserted. Not all the lines of output will be used, and some of the lines of output might be used more than once. Draw lines connecting the candidate blocks of code with their matching output.</p>&#13;
&#13;
<p><a data-primary="exercises" data-secondary="code blocks" data-type="indexterm" id="idm46402344129928"/><strong>Instructions:</strong></p>&#13;
<ol>&#13;
<li><p><strong>Fill in the four blanks in the code.</strong></p></li>&#13;
<li><p><strong>Match the code candidates to the output.</strong></p></li>&#13;
</ol>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/293fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0009">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/294fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="if/else statements" data-type="indexterm" id="idm46402344119432"/><a data-primary="reference variables" data-secondary="substituting subclass reference in place of base class" data-type="indexterm" id="idm46402344118248"/><a data-primary="switch statement" data-type="indexterm" id="idm46402344117064"/>You can always substitute a reference to a subclass in place of a base class because you’re using something more specific in place of something more general. So this line:</p>&#13;
<pre data-type="programlisting">A a2 = new C();</pre>&#13;
<p>means that you’re instantiating a new C object, and then creating an A reference called <code>a2</code> and pointing it at that object. Names like these make for a good puzzle, but they’re pretty hard to understand. Here are a few lines that follow the same pattern, but have names that are more obvious:</p>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0017">&#13;
<h5>there are no Dumb Questions</h5>&#13;
<p><strong>Q: A <code>switch</code> statement does exactly the same thing as a series of <code>if/else</code> statements, right? Isn’t that redundant?</strong></p>&#13;
<p><strong>A:</strong> Not at all. There are many situations where <code>switch</code> statements are much more readable than <code>if/else</code> statements. For example, let’s say you’re displaying a menu in a console app, and the user can press a key to choose one of 10 different options. What would 10 <code>if/else</code> if statements in a row look like? We think a <code>switch</code> statement would be cleaner and easier to read. You could see at a glance exactly what’s being compared, where each option is handled, and what happens in the default case if the user chooses an unsupported option. Also, it’s surprisingly easy to accidentally leave off an <code>else</code>. If you miss an else in the middle of a long string of <code>if/else</code> statements, you end up with a really annoying bug that’s surprisingly difficult to track down. There are some times when a <code>switch</code> statement is easier to read, and other times when <code>if/else</code> statements are easier. It’s up to you to write code in the way that you think is easiest to understand.</p>&#13;
<p><strong>Q: Why does the arrow point up, from the subclass to the base class? Wouldn’t the diagram look better with the arrow pointing down instead?</strong></p>&#13;
<p><strong>A:</strong> It might <em>seem</em> more intuitive, but it wouldn’t be as accurate. When you set up a class to inherit from another one, you build that relationship into the subclass—the base class remains the same. Its behavior is completely unchanged when you add a class that inherits from it. The base class isn’t even aware of this new class. Its methods, fields, and properties remain entirely intact—but the subclass definitely changes its behavior. Every instance of the subclass automatically gets all of the properties, fields, and methods from the base class, and it all happens just by adding a colon. That’s why you draw the arrow on your diagram so that it points from the subclass to the base class that it inherits from.</p>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0020">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>&#13;
<p><a data-primary="base classes" data-secondary="exercises on" data-type="indexterm" id="idm46402344100872"/><a data-primary="exercises" data-secondary="extending base classes" data-type="indexterm" id="idm46402344099800"/>Let’s get some practice extending a base class. We’ll give you the Main method for a program that tracks birds laying eggs. Your job is to implement two subclasses of the Bird class.</p>&#13;
<ol>&#13;
<li><p>Here’s the Main method. It prompts the user for the type of bird and number of eggs to lay:</p>&#13;
<pre data-type="programlisting">static void Main(string[] args)&#13;
{&#13;
    while (true)&#13;
    {&#13;
        Bird bird;&#13;
        Console.Write("\nPress P for pigeon, O for ostrich: ");&#13;
        char key = Char.ToUpper(Console.ReadKey().KeyChar);&#13;
        if (key == ’P’) bird = new Pigeon();&#13;
        else if (key == ’O’) bird = new Ostrich();&#13;
        else return;&#13;
        Console.Write("\nHow many eggs should it lay? ");&#13;
        if (!int.TryParse(Console.ReadLine(), out int numberOfEggs)) return;&#13;
        Egg[] eggs = bird.LayEggs(numberOfEggs);&#13;
        foreach (Egg egg in eggs)&#13;
        {&#13;
            Console.WriteLine(egg.Description);&#13;
        }&#13;
    }&#13;
}</pre></li>&#13;
<li><p>Add this Egg class—the constructor sets the size and color:</p>&#13;
<pre data-type="programlisting">class Egg&#13;
{&#13;
    public double Size { get; private set; }&#13;
    public string Color { get; private set; }&#13;
    public Egg(double size, string color)&#13;
    {&#13;
        Size = size;&#13;
        Color = color;&#13;
    }&#13;
    public string Description {&#13;
        get { return $"A {Size:0.0}cm {Color} egg"; }&#13;
    }&#13;
}</pre></li>&#13;
<li><p>This is the Bird class that you’ll extend:</p>&#13;
<pre data-type="programlisting">class Bird&#13;
{&#13;
    public static Random Randomizer = new Random();&#13;
    public virtual Egg[] LayEggs(int numberOfEggs)&#13;
    {&#13;
        Console.Error.WriteLine("Bird.LayEggs should never get called");&#13;
        return new Egg[0];&#13;
    }&#13;
}</pre></li>&#13;
<li><p>Create the Pigeon class that extends Bird. Override the LayEggs method and have it lay eggs with the color “white”  and a size between 1 and 3 centimeters.</p></li>&#13;
<li><p>Create the Ostrich class that also extends Bird. Override the LayEggs method and have it lay eggs with the color “speckled” and a size between 12 and 13 centimeters.</p></li>&#13;
</ol>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Here’s what the program output looks like:</p>&#13;
<pre data-type="programlisting">Press P for pigeon, O for ostrich: P&#13;
How many eggs should it lay? 4&#13;
A 3.0cm white egg&#13;
A 1.1cm white egg&#13;
A 2.4cm white egg&#13;
A 1.9cm white egg&#13;
Press P for pigeon, O for ostrich: O&#13;
How many eggs should it lay? 3&#13;
A 12.1cm speckled egg&#13;
A 13.0cm speckled egg&#13;
A 12.8cm speckled egg</pre>&#13;
</div>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0010">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<p>Here are the Pigeon and Ostrich classes. They each have their own version of the LayEggs method that uses the <code>override</code> keyword in the method declaration. The <code>override</code> keyword causes the method in the subclass to replace the one that it inherited.</p>&#13;
<p>Pigeon is a subclass of Bird, so if you override the LayEggs method, when you create a new Pigeon object and assign it to a Bird variable called <code><span style="color:#9D9EA0;"><u>bird, calling bird.LayEggs</u></span></code> will call the LayEggs method <code><span style="color:#9D9EA0;"><u>you defined in Pigeon</u></span></code>.</p>&#13;
<pre data-type="programlisting">class Pigeon : Bird&#13;
{&#13;
    public override Egg[] LayEggs(int numberOfEggs)&#13;
    {&#13;
        Egg[] eggs = new Egg[numberOfEggs];&#13;
        for (int i = 0; i &lt; numberOfEggs; i++)&#13;
        {&#13;
            eggs[i] = new Egg(Bird.Randomizer.NextDouble() * 2 + 1, "white");&#13;
        }&#13;
        return eggs;&#13;
    }&#13;
}</pre>&#13;
<p>The Ostrich subclass works the same way as Pigeon. In both classes, the <code><strong>override</strong></code> <strong>keyword</strong> in the LayEggs method declaration means that this new method will replace the LayEggs that it inherited from Bird. So all we need to do is have it create a set of eggs that are the right size and color.</p>&#13;
<pre data-type="programlisting">class Ostrich : Bird&#13;
{&#13;
    public override Egg[] LayEggs(int numberOfEggs)&#13;
    {&#13;
        Egg[] eggs = new Egg[numberOfEggs];&#13;
        for (int i = 0; i &lt; numberOfEggs; i++)&#13;
        {&#13;
            eggs[i] = new Egg(Bird.Randomizer.NextDouble() + 12, "speckled");&#13;
        }&#13;
        return eggs;&#13;
    }&#13;
}</pre>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/296fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Some members are only implemented in a subclass" data-type="sect1"><div class="sect1" id="some_members_are_only_implemented_in_a_s">&#13;
<h1>Some members are only <u>implemented in a subclass</u></h1>&#13;
<p><a data-primary="protected keyword" data-type="indexterm" id="idm46402344074232"/><a data-primary="subclasses" data-secondary="implementing in" data-type="indexterm" id="idm46402344073464"/>All the code we’ve seen so far that works with subclasses has accessed the members from outside the object—like how the Main method in the code you just wrote calls LayEggs. Inheritance really shines when the base class <strong>uses a method or property that’s implemented in the subclass</strong>. Here’s an example. Our zoo simulator has vending machines that let patrons buy soda, candy, and feed to give to the animals in the petting zoo area.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/297fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>VendingMachine is the base class for all vending machines. It has code to dispense items, but those items aren’t defined. The method to check if the patron put in the right amount always returns false. Why? Because they <strong>will be implemented in the subclass</strong>. Here’s a subclass for dispensing animal feed in the petting zoo:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/297fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use the debugger to understand how overriding works" data-type="sect1"><div class="sect1" id="use_the_debugger_to_understand_how_overr">&#13;
<h1>Use the debugger to understand how overriding works</h1>&#13;
<p><a data-primary="debugger" data-secondary="overriding and" data-type="indexterm" id="idm46402344064632"/>Let’s use the debugger to see exactly what happens when we create an instance of AnimalFeedVendingMachine and ask it to dispense some feed. <strong>Create a new Console App project</strong>, then do this.</p>&#13;
<p><strong><em>Debug this!</em></strong></p>&#13;
<ol>&#13;
<li><p><strong>Add the Main method.</strong> Here’s the code for the method:</p>&#13;
<pre data-type="programlisting">class Program&#13;
{&#13;
    static void Main(string[] args)&#13;
    {&#13;
        VendingMachine vendingMachine = new AnimalFeedVendingMachine();&#13;
        Console.WriteLine(vendingMachine.Dispense(2.00M));&#13;
    }&#13;
}</pre></li>&#13;
<li><p><strong>Add the VendingMachine and AnimalFeedVendingMachine classes.</strong> Once they’re added, try adding this line of code to the Main method:</p>&#13;
<pre data-type="programlisting">    vendingMachine.CheckAmount(1F);</pre>&#13;
<p>You’ll get a compiler error because of the <code>protected</code> keyword, because only the VendingMachine class or subclasses of it can access its protected methods.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/298fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Delete the line so your code builds.</p></li>&#13;
<li><p><strong>Put a breakpoint on the <u>first</u> line of the Main method.</strong> Run your program. When it hits the breakpoint, <strong>use Step Into (F10) to execute every line of code one at a time</strong>. Here’s what happens:</p>&#13;
<ul>&#13;
<li><p>It creates an instance of AnimalFeedVendingMachine and calls its Dispense method.</p></li>&#13;
<li><p>That method is only defined in the base class, so it calls VendingMachine.Dispense.</p></li>&#13;
<li><p>The first line of VendingMachine.Dispense calls the protected CheckAmount method.</p></li>&#13;
<li><p>CheckAmount is overridden in the AnimalFeedVendingMachine subclass, which causes VendingMachine.Dispense to call the CheckAmount method defined in AnimalFeedVendingMachine.</p></li>&#13;
<li><p>This version of CheckAmount returns true, so Dispense returns the Item property. AnimalFeedVendingMachine also overrides this property, it returns “a handful of animal feed.”</p></li>&#13;
</ul>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>You’ve been using the Visual Studio debugger to sleuth out bugs in your code. It’s also a great tool for learning and exploring C#, like in this “Debug this!” where you can explore how overriding works. Can you think of more ways to experiment with overriding subclasses?</p>&#13;
</div></li>&#13;
</ol>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/299fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="overriding methods" data-secondary="override keyword" data-type="indexterm" id="idm46402344047336"/><a data-primary="virtual keyword" data-secondary="about" data-type="indexterm" id="idm46402344044408"/><strong>There’s an important reason for virtual and override!</strong></p>&#13;
<p>The <code>virtual</code> and <code>override</code> keywords aren’t just for decoration. They make a real difference in how your program works. The <code>virtual</code> keyword tells C# that a member (like a method, property, or field) can be extended—without it, you can’t override it at all. The <code>override</code> keyword tells C# that you’re extending the member. If you leave out the <code>override</code> keyword in a subclass, you’re creating a <em>completely unrelated</em> method that just <em>happens to have the same name</em>.</p>&#13;
<p>That sounds a little weird, right? But it actually makes sense—and the best way to really understand how <code>virtual</code> and <code>override</code> work is by writing code. So let’s build a real example to experiment with them.</p>&#13;
<blockquote>&#13;
<p><strong>When a subclass overrides a method in its base class, the more specific version defined in the subclass is always called—even when it’s being called by a method in the base class.</strong></p>&#13;
</blockquote>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Build an app to explore virtual and override" data-type="sect1"><div class="sect1" id="build_an_app_to_explore_virtual_and_over">&#13;
<h1>Build an app to explore virtual and override</h1>&#13;
<p><a data-primary="console applications" data-type="indexterm" id="idm46402344034248"/><a data-primary="override keyword" data-type="indexterm" id="idm46402344033048"/><a data-primary="virtual keyword" data-secondary="apps and" data-type="indexterm" id="idm46402344032312"/>A really important part of inheritance in C# is extending class members. That’s how a subclass can inherit some of its behavior from its base class, but override certain members where it needs to—and that’s where the <code>virtual</code> <strong>and</strong> <code>override</code> <strong>keywords</strong> come in. The <code>virtual</code> keyword determines which class members can be extended. When you want to extend a member, you <strong><em>must</em></strong> use the <code>override</code> keyword. Let’s create some classes to experiment with <code>virtual</code> and <code>override</code>. You’re going to create a class that represents a safe containing valuable jewels—you’ll build a class for some sneaky thieves to steal the jewels.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/300fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<ol>&#13;
<li><p><strong>Create a new console app and add the Safe class.</strong></p>&#13;
<p>Here’s the code for the Safe class:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/300fig001.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p><strong>Add a class for the person who owns the safe.</strong></p>&#13;
<p>The safe owner is forgetful and occasionally forgets their extremely secure safe password. Add a SafeOwner class to represent them:</p>&#13;
<pre data-type="programlisting">class SafeOwner&#13;
{&#13;
    private string valuables = "";&#13;
    public void ReceiveContents(string safeContents)&#13;
    {&#13;
        valuables = safeContents;&#13;
        Console.WriteLine($"Thank you for returning my {valuables}!");&#13;
    }&#13;
}</pre></li>&#13;
<li><p><strong>Add Locksmith class that can pick the lock.</strong></p>&#13;
<p>If a safe owner hires a professional locksmith to open their safe, they expect that locksmith to return the contents safe and sound. That’s exactly what the Locksmith.OpenSafe method does:</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The Locksmith’s OpenSafe method picks the lock, opens the safe, and then calls ReturnContents to get the valuables safely back to the owner.</p>&#13;
</div>&#13;
<pre data-type="programlisting">class Locksmith&#13;
{&#13;
    public void OpenSafe(Safe safe, SafeOwner owner)&#13;
    {&#13;
        safe.PickLock(this);&#13;
        string safeContents = safe.Open(Combination);&#13;
        ReturnContents(safeContents, owner);&#13;
    }&#13;
    public string Combination { private get; set; }&#13;
    protected void ReturnContents(string safeContents, SafeOwner owner)&#13;
    {&#13;
        owner.ReceiveContents(safeContents);&#13;
    }&#13;
}</pre>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/301fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p><strong>Add a JewelThief class that wants to steal the valuables.</strong></p>&#13;
<p>Uh-oh. Looks like there’s a burglar—and the worst kind, one who’s also a highly skilled locksmith able to open safes. Add this JewelThief class that extends Locksmith:</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">JewelThief extends Locksmith and inherits the OpenSafe method and Combination property, but its ReturnContents method steals the jewels instead of returning them. INGENIOUS!</span></p>&#13;
</div>&#13;
<pre data-type="programlisting">class JewelThief : Locksmith&#13;
{&#13;
    private string stolenJewels;&#13;
    protected void ReturnContents(string safeContents, SafeOwner owner)&#13;
    {&#13;
        stolenJewels = safeContents;&#13;
        Console.WriteLine($"I’m stealing the jewels! I stole: {stolenJewels}");&#13;
    }&#13;
}</pre>&#13;
</li>&#13;
<li><p><strong>Add a Main method that makes the JewelThief steal the jewels.</strong></p>&#13;
<p>It’s time for the big heist! In this Main method, the JewelThief sneaks into the house and uses its inherited Locksmith.OpenSafe method to get the safe combination. <strong>What do you think will happen when it runs?</strong></p>&#13;
<pre data-type="programlisting">static void Main(string[] args)&#13;
{&#13;
    SafeOwner owner = new SafeOwner();&#13;
    Safe safe = new Safe();&#13;
    JewelThief jewelThief = new JewelThief();&#13;
    jewelThief.OpenSafe(safe, owner);&#13;
    Console.ReadKey(true);&#13;
}</pre></li>&#13;
</ol>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="mini_sharpen_your_pencil-idd0200">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/Common.png"/></span> Mini Sharpen your pencil</h5>&#13;
<p>Read through the code for your program. Before you run it, write down what you think it will print to the console. (Hint: figure out what the JewelThief class inherits from Locksmith.)</p>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="A subclass can hide methods in the base class" data-type="sect1"><div class="sect1" id="a_subclass_can_hide_methods_in_the_base">&#13;
<h1>A subclass can <u>hide</u> methods in the base class</h1>&#13;
<p><a data-primary="hiding methods" data-secondary="overriding versus" data-type="indexterm" id="idm46402344001400"/><a data-primary="hiding methods" data-secondary="using new keyword" data-type="indexterm" id="idm46402343999704"/><a data-primary="methods" data-secondary="hiding versus overriding" data-type="indexterm" id="idm46402343998632"/><a data-primary="new keyword" data-secondary="using when hiding methods" data-type="indexterm" id="idm46402343997512"/><a data-primary="overriding methods" data-secondary="hiding versus" data-type="indexterm" id="idm46402343996440"/>Go ahead and run the JewelThief program. Here’s what you should see:</p>&#13;
<p><strong>Thank you for returning my precious jewels!</strong></p>&#13;
<p>Did you expect the program’s output to be different? Maybe something like this:</p>&#13;
<pre data-type="programlisting">I’m stealing the jewels! I stole: precious jewels</pre>&#13;
<p>It looks like the JewelThief object acted just like a Locksmith object! So what happened?</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="mini_sharpen_your_pencil_solution">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> MiNi Sharpen your pencil Solution</h5>&#13;
<p><span style="color:#9D9EA0;">C# is supposed to call the most specific method, right? Then why didn’t it call JewelThief.ReturnContents?</span></p>&#13;
</div></aside>&#13;
<section data-pdf-bookmark="Hiding methods versus overriding methods" data-type="sect2"><div class="sect2" id="hiding_methods_versus_overriding_methods">&#13;
<h2>Hiding methods versus overriding methods</h2>&#13;
<p>The reason the JewelThief object acted like a Locksmith object when its ReturnContents method was called was because of the way the JewelThief class declared its ReturnContents method. There’s a big hint in that warning message you got when you compiled your program:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/302fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Since the JewelThief class inherits from Locksmith and replaces the ReturnContents method with its own method, it looks like JewelThief is overriding Locksmith’s ReturnContents method—but that’s not actually what’s happening. You probably expected JewelThief to override the method (which we’ll talk about in a minute), but instead JewelThief is hiding it.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>JewelThief</p>&#13;
<p><em>Locksmith.</em> ReturnContents</p>&#13;
<p><em>JewelThief.</em> ReturnContents</p>&#13;
</div>&#13;
<p>There’s a big difference. When a subclass <strong>hides</strong> a method, it replaces (technically, it redeclares) a method in its base class <strong><em>that has the same name</em></strong>. So now our subclass really has <u>two</u> different methods that share a name: one that it inherits from its base class, and another brand-new one that’s defined in that class.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use the new keyword when you’re hiding methods" data-type="sect2"><div class="sect2" id="use_the_new_keyword_when_youapostrophere">&#13;
<h2>Use the <u>new</u> keyword when you’re hiding methods</h2>&#13;
<p>Take a close look at that warning message. Sure, we know we <em>should</em> read our warnings, but sometimes we don’t...right? This time, actually read what it says: <code><strong>Use the new keyword if hiding was intended</strong></code>.</p>&#13;
<p>So go back to your program and add the <code>new</code> keyword:</p>&#13;
<pre data-type="programlisting"><strong>new</strong> public void ReturnContents(Jewels safeContents, Owner owner)</pre>&#13;
<p>As soon as you add <code>new</code> to your JewelThief class’s ReturnContents method declaration, that warning message will go away—but your code still won’t act the way you expect it to!</p>&#13;
<p>It still calls the ReturnContents method defined in the Locksmith class. Why? Because the ReturnContents method is being called <strong>from a method defined by the Locksmith class</strong>—specifically, from inside Locksmith.OpenSafe—even though it’s being initiated by a JewelThief object. If JewelThief only hides Locksmith’s ReturnContents method, its own ReturnContents method will never be called.</p>&#13;
<blockquote>&#13;
<p>If a subclass just adds a method with the same name as a method in its base class, it only hides the base class method instead of overriding it.</p>&#13;
</blockquote>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use different references to call hidden methods" data-type="sect2"><div class="sect2" id="use_different_references_to_call_hidden">&#13;
<h2>Use different references to call hidden methods</h2>&#13;
<p><a data-primary="hiding methods" data-secondary="using different reference to call hidden methods" data-type="indexterm" id="idm46402343971368"/><a data-primary="methods" data-secondary="hidden, using different references to call" data-type="indexterm" id="idm46402343967272"/><a data-primary="superclass" data-type="indexterm" id="idm46402343966232"/><a data-primary="virtual methods" data-type="indexterm" id="idm46402343965416"/>Now we know that JewelThief only <strong><em>hides</em></strong> the ReturnContents method (as opposed to <strong><em>overriding</em></strong> it). That causes it to act like a Locksmith object <strong><em>whenever it’s called like a Locksmith object</em></strong>. JewelThief inherits one version of ReturnContents from Locksmith, and it defines a second version of it, which means that there are two different methods with the same name. That means your class needs <strong>two different ways to call it</strong>.</p>&#13;
<p>There are two different ways to call the ReturnContents method. If you’ve got an instance of JewelThief, you can use a JewelThief reference variable to call the new ReturnContents method. If you use a Locksmith reference variable to call it, it will call the hidden Locksmith ReturnContents method.</p>&#13;
<p>Here’s how that works:</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">// The JewelThief subclass hides a method in the Locksmith base class,</span>&#13;
<span style="color:#9D9EA0;">// so you can get different behavior from the same object based on the</span>&#13;
<span style="color:#9D9EA0;">// reference you use to call it!</span>&#13;
&#13;
<span style="color:#9D9EA0;">// Declaring your JewelThief object as a Locksmith reference causes it to</span>&#13;
<span style="color:#9D9EA0;">// call the base class ReturnContents() method.</span>&#13;
Locksmith calledAsLocksmith = new JewelThief();&#13;
calledAsLocksmith.ReturnContents(safeContents, owner);&#13;
&#13;
<span style="color:#9D9EA0;">// Declaring your JewelThief object as a JewelThief reference causes it to</span>&#13;
<span style="color:#9D9EA0;">// call JewelThief’s ReturnContents() method instead, because it hides</span>&#13;
<span style="color:#9D9EA0;">// the base class’s method of the same name.</span>&#13;
JewelThief calledAsJewelThief = new JewelThief();&#13;
calledAsJewelThief.ReturnContents(safeContents, owner);</pre>&#13;
</div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>Can you figure out how to get JewelThief to override the ReturnContents method instead of just hiding it? See if you can do it before reading the next section!</strong></p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0018">&#13;
<h5>there are no Dumb Questions</h5>&#13;
<p><strong>Q: I still don’t get why they’re called “virtual” methods—they seem real to me. What’s virtual about them?</strong></p>&#13;
<p><strong>A:</strong> The name “virtual” has to do with how .NET handles the virtual methods behind the scenes. It uses something called a <em>virtual method table</em> (or <em>vtable</em>). That’s a table that .NET uses to keep track of which methods are inherited and which ones have been overridden. Don’t worry—you don’t need to know how it works to use virtual methods.</p>&#13;
<p><strong>Q: You talked about replacing a superclass with a reference to a subclass. Can you go over that one more time?</strong></p>&#13;
<p><strong>A:</strong> When you’ve got a diagram with one class that’s above another one, the class that’s higher up is <strong>more abstract</strong> than the one that’s lower down. More <strong>specific</strong> or <strong>concrete</strong> classes (like Shirt or Car) inherit from more abstract ones (like Clothing or Vehicle). If all you need is a vehicle, a car or van or motorcycle will do. If you need a car, a motorcycle won’t be useful to you.</p>&#13;
<p>Inheritance works exactly the same way. If you have a method with Vehicle as a parameter, and if the Motorcycle class inherits from the Vehicle class, then you can pass an instance of Motorcycle to the method. If the method takes Motorcycle as a parameter, you can’t pass any Vehicle object, because it may be a Van instance. Then C# won’t know what to do when the method tries to access the Handlebars property.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Use the override and virtual keywords to inherit behavior" data-type="sect1"><div class="sect1" id="use_the_override_and_virtual_keywords_to">&#13;
<h1>Use the <u>override</u> and <u>virtual</u> keywords to inherit behavior</h1>&#13;
<p><a data-primary="inheritance" data-secondary="using override and virtual keywords to inherit behavior" data-type="indexterm" id="idm46402343936184"/><a data-primary="methods" data-secondary="using override and virtual keywords" data-type="indexterm" id="idm46402343938888"/><a data-primary="overriding methods" data-secondary="override keyword" data-type="indexterm" id="idm46402343937880"/><a data-primary="virtual keyword" data-secondary="using to inherit behavior" data-type="indexterm" id="idm46402343942504"/>We really want our JewelThief class to always use its own ReturnContents method, no matter how it’s called. This is the way we expect inheritance to work most of the time: a subclass can <strong>override</strong> a method in the base class so the method in the subclass is called instead. Start by using the <code>override</code> keyword when you declare the ReturnContents method:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/304fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>But that’s not everything you need to do. If you just add the <code>override</code> keyword to the class declaration, you’ll get a compiler error:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/304fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Again, take a really close look and read what the error says. JewelThief can’t override the inherited member ReturnContents <strong>because it’s not marked</strong> <code>virtual, abstract</code>, or <code>override</code> in Locksmith. Well, that’s an error we can fix with a quick change. Mark Locksmith’s ReturnContents with the <code>virtual</code> keyword:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/304fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Now run your program again. Here’s the output we’ve been looking for:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/304fig04.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-idd0027">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil</h5>&#13;
<p>Draw a line from each of the following descriptions to the keyword it describes.</p>&#13;
<table>&#13;
<tbody>&#13;
<tr>&#13;
<td><ol>&#13;
<li><p>A method that can only be <strong>accessed by an instance of the same class</strong></p></li></ol></td>&#13;
<td><code>virtual</code></td>&#13;
</tr>&#13;
<tr>&#13;
<td><ol start="2">&#13;
<li><p>A method that <strong>a subclass can replace</strong> with a method of the same name</p></li></ol></td>&#13;
<td><code>new</code></td>&#13;
</tr>&#13;
<tr>&#13;
<td><ol start="3">&#13;
<li><p>A method that can be <strong>accessed by an instance of any other class</strong></p></li></ol></td>&#13;
<td><code>override</code></td>&#13;
</tr>&#13;
<tr>&#13;
<td><ol start="4">&#13;
<li><p>A method that <strong>hides another method in the superclass</strong> with the same name</p></li></ol></td>&#13;
<td><code>protected</code></td>&#13;
</tr>&#13;
<tr>&#13;
<td><ol start="5">&#13;
<li><p>A method that <strong>replaces a method in the superclass</strong></p></li></ol></td>&#13;
<td><code>private</code></td>&#13;
</tr>&#13;
<tr>&#13;
<td><ol start="6">&#13;
<li><p>A method that can only be <strong>accessed by a member of the class or its subclass</strong></p></li></ol></td>&#13;
<td><code>public</code></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<ol>&#13;
<li><span style="color:#9D9EA0;">private</span></li>&#13;
<li><span style="color:#9D9EA0;">virtual</span></li>&#13;
<li><span style="color:#9D9EA0;">public</span></li>&#13;
<li><span style="color:#9D9EA0;">new</span></li>&#13;
<li><span style="color:#9D9EA0;">override</span></li>&#13;
<li><span style="color:#9D9EA0;">protecte</span></li>&#13;
</ol>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/305fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="hiding methods" data-secondary="about" data-type="indexterm" id="idm46402343895816"/><a data-primary="overriding methods" data-secondary="about" data-type="indexterm" id="idm46402343894840"/><strong>Exactly. Most of the time you want to override methods, but hiding them is an option.</strong></p>&#13;
<p>When you’re working with a subclass that extends a base class, you’re much more likely to use overriding than you are to use hiding. So when you see that compiler warning about hiding a method, pay attention to it! Make sure you really want to hide the method, and didn’t just forget to use the <code>virtual</code> and <code>override</code> keywords. If you always use the <code>virtual</code>, <code>override</code>, and <code>new</code> keywords correctly, you’ll never run into a problem like this again!</p>&#13;
<blockquote>&#13;
<p>If you want to override a method in a base class, always mark it with the <span style="color:#9D9EA0;">virtual</span> keyword, and always use the <span style="color:#9D9EA0;">override</span> keyword any time you want to override the method in a subclass. If you don’t, you’ll end up accidentally hiding methods instead.</p>&#13;
</blockquote>&#13;
</div></section>&#13;
<section data-pdf-bookmark="A subclass can access its base class using the base keyword" data-type="sect1"><div class="sect1" id="a_subclass_can_access_its_base_class_usi">&#13;
<h1>A subclass can access its <u>base</u> class using the base keyword</h1>&#13;
<p><a data-primary="base classes" data-secondary="subclasses accessing with base keyword" data-type="indexterm" id="idm46402343888872"/><a data-primary="base keyword" data-type="indexterm" id="idm46402343884872"/><a data-primary="inheritance" data-secondary="subclass accessing base class using base keyword" data-type="indexterm" id="idm46402343884104"/><a data-primary="subclasses" data-secondary="about" data-type="indexterm" id="idm46402343882968"/>Even when you override a method or property in your base class, sometimes you’ll still want to access it. Luckily, we can use <code>base</code>, which lets us access any member of the base class.</p>&#13;
<ol>&#13;
<li><p><strong>All animals eat, so the Vertebrate class has an Eat method that takes a Food object as its parameter.</strong></p>&#13;
<pre data-type="programlisting">class Vertebrate {&#13;
   public virtual void Eat(Food morsel) {&#13;
      Swallow(morsel);&#13;
      Digest();&#13;
   }&#13;
}</pre>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/306fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/306fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p><strong>Chameleons eat by catching food with their tongues. So the Chameleon class inherits from Vertebrate but overrides Eat.</strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/306fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p><strong>Instead of duplicating the code, we can use the <code>base</code> keyword to call the method that was overridden. Now we have access to both the old and the new version of Eat.</strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/306fig04.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
</ol>&#13;
</div></section>&#13;
<section data-pdf-bookmark="When a base class has a constructor, your subclass needs to call it" data-type="sect1"><div class="sect1" id="when_a_base_class_has_a_constructorcomma">&#13;
<h1>When a base class has a constructor, your subclass needs to call it</h1>&#13;
<p><a data-primary="base classes" data-secondary="with constructors" data-type="indexterm" id="idm46402343866616"/><a data-primary="constructors" data-secondary="in base classes" data-type="indexterm" id="idm46402343865144"/>Let’s go back to the code you wrote with the Bird, Pigeon, Ostrich, and Egg classes. We want to add a BrokenEgg class that extends Egg, and make 25% of the eggs that the Pigeon lays broken. <strong>Replace the</strong> <code>new</code> <strong>statement</strong> in Pigeon.LayEgg with this <code>if/else</code> that creates a new instance of either Egg or BrokenEgg:</p>&#13;
<p><strong><em>Add this!</em></strong></p>&#13;
<pre data-type="programlisting">    if (Bird.Randomizer.Next(4) == 0)&#13;
        eggs[i] = new <code>BrokenEgg</code>(Bird.Randomizer.NextDouble() * 2 + 1, "white");&#13;
    else&#13;
        eggs[i] = new Egg(Bird.Randomizer.NextDouble() * 2 + 1, "white");</pre>&#13;
<p>Now we just need a BrokenEgg class that extends Egg. Let’s make it identical to the Egg class, except that it has a constructor that writes a message to the console letting us know that an egg is broken:</p>&#13;
<pre data-type="programlisting">class BrokenEgg : Egg&#13;
{&#13;
    public BrokenEgg()&#13;
    {&#13;
        Console.WriteLine("A bird laid a broken egg");&#13;
    }&#13;
}</pre>&#13;
<p>Go ahead and <strong>make those two changes</strong> to your Egg program.</p>&#13;
<p>Uh-oh—looks like those new lines of code caused compiler errors:</p>&#13;
<ul>&#13;
<li><p>The first error is on the line where you create a new BrokenEgg: <em>CS1729 – ’BrokenEgg’ does not contain a constructor that takes 2 arguments</em></p></li>&#13;
<li><p>The second error is in the BrokenEgg constructor: <em>CS7036 – There is no argument given that corresponds to the required formal parameter ’size’ of ’Egg.Egg(double, string)’</em></p></li>&#13;
</ul>&#13;
<p>This is another great opportunity to <strong><em>read those errors</em></strong> and figure out what went wrong. The first error is pretty clear: the statement that creates a BrokenEgg instance is trying to pass two arguments to the constructor, but the BrokenEgg class has a parameterless constructor. So go ahead and <strong>add parameters to the constructor</strong>:</p>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">public BrokenEgg</span>(<strong>double size, string color</strong>)</pre>&#13;
<p>That takes care of the first error—now the Main method compiles just fine. What about the other error?</p>&#13;
<p>Let’s break down what that error says:</p>&#13;
<ul>&#13;
<li><p>It’s complaining about <em>Egg.Egg(double, string)</em>—this refers to the Egg class constructor.</p></li>&#13;
<li><p>It says something about <em>parameter ’size’</em>, which the Egg class needs in order to set its Size property.</p></li>&#13;
<li><p>But there is <em>no argument given</em>, because it’s not enough to just modify the BrokenEgg constructor to take arguments that match the parameter. It also needs to <strong>call that base class constructor.</strong></p></li>&#13;
</ul>&#13;
<p>Modify the BrokenEgg class to <strong>use the <code>base</code> keyword to call the base class constructor:</strong></p>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">public BrokenEgg(double size, string color)</span>: base(size, color)</pre>&#13;
<p>Now your code compiles. Try running it—now when a Pigeon lays an egg, about a quarter of them will print a message about being broken when they’re <u>instantiated</u> (but after that, the rest of the output is the same as before).</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span class="inlineimage"><img alt="Images" src="assets/relax.png"/></span></p>&#13;
<p><strong>It’s easy to go back to an old project.</strong></p>&#13;
<p>You can get the IDE to load a previous project by choosing <em>Recent Projects and Solutions</em> (Windows) or <em>Recent Solutions</em> (Mac) from the File menu.</p>&#13;
</div>&#13;
</div></section>&#13;
<section data-pdf-bookmark="A subclass and base class can have different constructors" data-type="sect1"><div class="sect1" id="a_subclass_and_base_class_can_have_diffe">&#13;
<h1>A subclass and base class can have <u>different</u> constructors</h1>&#13;
<p><a data-primary="base classes" data-secondary="constructors in" data-type="indexterm" id="idm46402343836488"/><a data-primary="subclasses" data-secondary="constructors in" data-type="indexterm" id="idm46402343835256"/>When we modified BrokenEgg to call the base class constructor, we made its constructor match the one in the Egg base class. What if we want all broken eggs to have a size of zero and a color that starts with the word “broken”? <strong>Modify the statement that instantiates BrokenEgg</strong> so it only takes the color argument:</p>&#13;
<pre data-type="programlisting"><span style="color:#9D9EA0;">   if (Bird.Randomizer.Next(4) == 0)</span>&#13;
<span style="color:#9D9EA0;">        eggs[i] =</span> <strong>new BrokenEgg("white");</strong>&#13;
<span style="color:#9D9EA0;">    else</span>&#13;
<span style="color:#9D9EA0;">        eggs[i] = new Egg(Bird.Randomizer.NextDouble() * 2 + 1, "white");</span></pre>&#13;
<p><strong><em>Modify this!</em></strong></p>&#13;
<p>When you make that change you’ll get the “required formal parameter” compiler error again—which makes sense, because the BrokenEgg constructor has two parameters, but you’re only passing it one argument.</p>&#13;
<p>Fix your code <strong>by modifying the BrokenEgg constructor to take one parameter</strong>:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/308fig001.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Now run your program again. The BrokenEgg constructor will still write its message to the console during the for loop in the Pigeon constructor, but now it will also cause the Egg to initialize its Size and Color fields. When the foreach loop in the Main method writes egg.Description to the console, it writes this message for each broken egg:</p>&#13;
<pre data-type="programlisting">Press P for pigeon, O for ostrich:&#13;
p&#13;
How many eggs should it lay? 7&#13;
A bird laid a broken egg&#13;
A bird laid a broken egg&#13;
A bird laid a broken egg&#13;
A 2.4cm white egg&#13;
A 0.0cm broken White egg&#13;
A 3.0cm white egg&#13;
A 1.4cm white egg&#13;
A 0.0cm broken White egg&#13;
A 0.0cm broken White egg&#13;
A 2.7cm white egg</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Did you know that pigeons typically only lay one or two eggs? How would you modify the Pigeon class to take this into account?</p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/308fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/308fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="It’s time to finish the job for Owen" data-type="sect1"><div class="sect1" id="itapostrophes_time_to_finish_the_job_for">&#13;
<h1>It’s time to finish the job for Owen</h1>&#13;
<p><a data-primary="class models" data-type="indexterm" id="idm46402343817064"/><a data-primary="exercises" data-secondary="Sharpen your pencil" data-tertiary="class models" data-type="indexterm" id="idm46402343815944"/><a data-primary="Sharpen Your Pencil exercises" data-secondary="class models" data-type="indexterm" id="idm46402343814488"/>The first thing you did in this chapter was modify the damage calculator you built for Owen to roll for damage for either a sword or an arrow. It worked, and your SwordDamage and ArrowDamage classes were well-encapsulated. But aside from a few lines of code, <strong><em>those two classes were identical</em></strong>. You’ve learned that having code repeated in different classes is inefficient and error-prone, especially if you want to keep extending the program to add more classes for different kinds of weapons. Now you have a new tool to solve this problem: <strong>inheritance</strong>. So it’s time for you to finish the damage calculator app. You’ll do it in two steps: first you’ll design the new class model on paper, and then you’ll implement it in code.</p>&#13;
<p><strong>Building your class model on paper before you write code helps you <span style="color:#9D9EA0;">understand your problem better</span> so you can solve it more effectively.</strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/309fig001.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-idd0028">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil</h5>&#13;
<p>Great code starts in your head, not an IDE. So let’s take the time to design the class model on paper <em>before</em> we start writing code.</p>&#13;
<p>We’ve started you out by filling in the class names. Your job is to add the members to all three classes, and draw the arrows between the boxes.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/309fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>For reference, we included diagrams for the SwordDamage and ArrowDamage classes that you built earlier. We included the private CalculateDamage method for each class. Make sure to include all public, private, and protected class members when you fill in the class diagram. Write the access modifier (public, private, or protected) next to each class member.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The SwordDamage and ArrowDamage classes looked like this at the start of the chapter. They’re well-encapsulated, but most of the code in SwordDamage is duplicated in ArrowDamage.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/309fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/309fig04.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="When your classes overlap as little as possible, that’s an important design principle called separation of concerns" data-type="sect1"><div class="sect1" id="when_your_classes_overlap_as_little_as_p">&#13;
<h1>When your classes overlap as little as possible, that’s an important design principle called <u>separation of concerns</u></h1>&#13;
<p><a data-primary="classes" data-secondary="designing separation of concerns" data-type="indexterm" id="idm46402343794696"/><a data-primary="design" data-secondary="separation of concerns" data-type="indexterm" id="idm46402343792936"/><a data-primary="separation of concerns" data-type="indexterm" id="idm46402343791896"/>If you design your classes well today, they’ll be easier to modify later. Imagine if you had a dozen different classes to calculate damage for different weapons. What if you wanted to change Magic from a bool to an int, so you could have weapons with enchantment bonuses (like a +3 magic mace or +1 magic dagger)? With inheritance, you’d just have to change the Magic property in the superclass. Of course, you’d have to modify the CalculateDamage method for each class—but it would be a lot less work, and there’s no danger of accidentally forgetting to modify one of the classes. (That happens in professional software development <em>all the time!</em>)</p>&#13;
<p>This is an example of <strong>separation of concerns</strong>, because each class has only the code that concerns one specific part of the problem that your program solves. Code that only concerns swords goes in SwordDamage, code only for arrows goes in ArrowDamage, and code that’s shared between them goes in WeaponDamage.</p>&#13;
<p>When you’re designing classes, separation of concerns is one of the first things you should think about. If one class seems to be doing two different things, try to figure out if you can split it into two classes.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-idd012">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/pencil.png"/></span> Sharpen your pencil Solution</h5>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/310fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0021">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>&#13;
<p><a data-primary="exercises" data-secondary="writing code" data-type="indexterm" id="idm46402343781064"/>Now that you’ve <strong>designed</strong> the class model, you’re ready to write the code to <strong>implement</strong> it. That’s a great habit to get into—design your classes first, then turn them into code.</p>&#13;
<p>Here’s what you’ll do to finish the job for Owen. You can reopen the project that you created at the beginning of the chapter, or you can create an entirely new one and copy the relevant parts into it. If your code is very different from the exercise solution earlier in the chapter, you might want to start with the solution code. You can download the code from <a href="https://github.com/head-first-csharp/fourth-edition">https://github.com/head-first-csharp/fourth-edition</a> if you don’t want to type it in.</p>&#13;
<ol>&#13;
<li><p><strong>Don’t make any changes to the Main method.</strong> It will use the new SwordDamage and ArrowDamage classes exactly like it did at the beginning of the chapter.</p></li>&#13;
<li><p><strong>Implement the WeaponDamage class.</strong> Add a new WeaponDamage class and make it match the class diagram in the “Sharpen your pencil” solution. Here are a few things to consider:</p>&#13;
<ul>&#13;
<li><p>The properties in WeaponDamage are <strong><em>almost</em></strong> identical to the properties in the SwordDamage and ArrowDamage classes at the beginning of the chapter. There’s just a single keyword that’s different.</p></li>&#13;
<li><p>Don’t put any code in the CalculateDamage class (you can include a comment: <code>/* the subclass overrides this */</code>). It needs to be virtual, it can’t be private—otherwise you’ll get a compiler error:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/311fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p>Add a constructor that sets the starting roll.</p></li>&#13;
</ul></li>&#13;
<li><p><strong>Implement the SwordDamage class.</strong> Here are a few things you need to think about:</p>&#13;
<ul>&#13;
<li><p>The constructor has a single parameter, which it passes to the base class constructor.</p></li>&#13;
<li><p>C# always calls the most specific method. That means you’ll need to override CalculateDamage and make it do the sword damage calculation.</p></li>&#13;
<li><p>It’s worth taking a minute to think about how CalculateDamage works. The Roll, Magic, or Flaming setters call CalculateDamage to make sure the Damage field is updated automatically. Since C# always calls the most specific method, they’ll call SwordDamage.CalculateDamage <em>even though they’re part of the WeaponDamage superclass</em>.</p></li>&#13;
</ul></li>&#13;
<li><p><strong>Implement the ArrowDamage class.</strong> It works exactly like SwordDamage, except that its CalculateDamage method does the arrow calculation and not the sword calculation.</p></li>&#13;
</ol>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/311fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>When your classes are well-encapsulated, it makes your code <span style="color:#9D9EA0;">much easier to modify</span>.</strong></p>&#13;
<p>If you know a professional developer, ask them the most annoying thing they’ve had to do at work in the last year. There’s a good chance they’ll talk about having to make a change to a class, but to do that they had to change these two other classes, which required three other changes, and it was hard just to keep track of all the changes. Designing your classes with encapsulation in mind is a great way to avoid ending up in that situation.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0011">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<p>Here’s the code for the WeaponDamage class. The properties are <strong><em>almost</em></strong> identical to the properties in the old sword and arrow classes. It also has a constructor to set the starting roll, and a CalculateDamage method for the subclasses to override.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/312fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></aside>&#13;
<section data-pdf-bookmark="Use the debugger to really understand how these classes work" data-type="sect2"><div class="sect2" id="use_the_debugger_to_really_understand_ho">&#13;
<h2>Use the debugger to <u>really understand</u> how these classes work</h2>&#13;
<p><a data-primary="classes" data-secondary="debugger and" data-type="indexterm" id="idm46402343753288"/><a data-primary="debugger" data-secondary="classes and" data-type="indexterm" id="idm46402343749944"/>One of the most important ideas in this chapter is that when you extend a class, you can override its methods to make pretty significant changes to the way it behaves. Use the debugger to really understand how that works:</p>&#13;
<ul>&#13;
<li><p><strong>Set breakpoints</strong> on the lines in the Roll, Magic, and Flaming setters that call CalculateDamage.</p></li>&#13;
<li><p>Add a Console.WriteLine statement to WeaponDamage.CalculateDamage. <em>This statement will <u>never</u> get called.</em></p></li>&#13;
<li><p>Run your program. When it hits any of the breakpoints, use <strong>Step Into</strong> to enter the CalculateDamage method. <strong><em>It will step into the subclass</em></strong>—the WeaponDamage.CalculateDamage method is never called.</p></li>&#13;
</ul>&#13;
<p>Do This!</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0012">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<p>The SwordDamage class extends WeaponDamage and overrides its CalculateDamage method to implement the sword damage calculation. Here’s the code:</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>All the constructor needs to do is use the base keyword to call the superclass’s constructor, using its startingRoll parameter as the argument.</p>&#13;
</div>&#13;
<pre data-type="programlisting">class SwordDamage : WeaponDamge&#13;
{&#13;
   public const int BASE_DAMAGE = 3;&#13;
   public const int FLAME_DAMAGE = 2;&#13;
&#13;
   public SwordDamage(int startingRoll) : base(startingRoll) { }&#13;
&#13;
   protected override void CalculateDamage()&#13;
   {&#13;
&#13;
       decimal magicMultiplier = 1M;&#13;
       if (Magic) magicMultiplier = 1.75M;&#13;
&#13;
       Damage = BASE_DAMAGE;&#13;
       Damage = (int)(Roll * magicMultiplier) + BASE_DAMAGE;&#13;
       if (Flaming) Damage += FLAME_DAMAGE;&#13;
   }&#13;
}</pre>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/313fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>And here’s the code for the ArrowDamage class. It works just like the SwordDamage class, except it does the calculation for arrows instead:</p>&#13;
<pre data-type="programlisting">class ArrowDamage : WeaponDamage&#13;
{&#13;
    private const decimal BASE_MULTIPLIER = 0.35M;&#13;
    private const decimal MAGIC_MULTIPLIER = 2.5M;&#13;
    private const decimal FLAME_DAMAGE = 1.25M;&#13;
&#13;
    public ArrowDamage(int startingRoll) : base(startingRoll) { }&#13;
&#13;
    protected override void CalculateDamage()&#13;
    {&#13;
&#13;
        decimal baseDamage = Roll * BASE_MULTIPLIER;&#13;
        if (Magic) baseDamage *= MAGIC_MULTIPLIER;&#13;
        if (Flaming) Damage = (int)Math.Ceiling(baseDamage + FLAME_DAMAGE);&#13;
        else Damage = (int)Math.Ceiling(baseDamage);&#13;
    }&#13;
}</pre>&#13;
</div></aside>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><a data-primary="Dynamics Game design...and beyond element" data-type="indexterm" id="idm46402343733848"/><a data-primary="emergence" data-type="indexterm" id="idm46402343732552"/><a data-primary="Game design... and beyond elements" data-secondary="Dynamics" data-type="indexterm" id="idm46402343731784"/><a data-primary="mechanics" data-type="indexterm" id="idm46402343730632"/><span style="color:#9D9EA0;">We’re about to talk about an important element of game design: dynamics. It’s actually such an important concept that it goes beyond game design. In fact, you can find dynamics in almost any kind of app.</span></p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="dynamics_game_designhellip_and_beyond">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/game.png"/></span> <strong>Dynamics Game design... and beyond</strong></h5>&#13;
<p>The <strong>dynamics</strong> of a game describe how the mechanics combine and cooperate to drive the gameplay. Any time you have game mechanics, they lead to dynamics. That’s not limited to video games—all games have mechanics, and dynamics arise out of those mechanics.</p>&#13;
<ul>&#13;
<li><p>We’ve already seen a <strong>good example of mechanics</strong>: in Owen’s role-playing game, he uses formulas (the ones you built into your damage classes) to calculate damage for various weapons. That’s a good starting point to think about how a change in those mechanics would affect dynamics.</p></li>&#13;
<li><p>What happens if you change the mechanics of the arrow formula so that it multiplies the base damage by 10? That’s a small change in mechanics, but it leads to a <strong>huge change in the dynamics</strong> of the game. Suddenly, arrows are much more powerful than swords. Players will stop using swords and start shooting arrows, even at close range—that’s a change in dynamics.</p></li>&#13;
<li><p>Once the players start <strong>behaving differently</strong>, Owen will need to change his campaigns. For example, some battles designed to be difficult may suddenly become too easy for the players. That makes the players change again.</p></li>&#13;
</ul>&#13;
<p><strong>Take a minute to think about all of that.</strong> A tiny change to the rules leads to a huge change in the way the players behave. A <em>small change</em> in mechanics caused a <em>very large change in dynamics</em>. Owen didn’t make those changes to gameplay directly; they were follow-on effects from his small rule change. In technical terms, the change in dynamics <strong><em>emerged</em></strong> from the change in mechanics.</p>&#13;
<ul>&#13;
<li><p>If you haven’t come across the idea of <strong>emergence</strong> before it may seem a little odd, so let’s look at a concrete example from a classic video game.</p></li>&#13;
<li><p>The <strong>mechanics of Space Invaders</strong> are simple. Aliens march back and forth and fire shots down; if a shot hits the player, they lose a life. The player moves the ship left and right and fires shots up. If a shot hits an alien, it’s destroyed. A mothership occasionally flies across the top of the screen for more points. Shields slowly get eaten away by shots. Different aliens add different scores. The aliens march faster as the game goes on. And that’s pretty much it.</p></li>&#13;
<li><p>The <strong>dynamics of Space Invaders</strong> are more complex. The game starts off very easy—most players can get much of the first wave—but it quickly gets harder and harder. The only thing that changes is the speed at which the invaders march. Somehow as the invaders get faster and faster, it changes the entire game. The <strong>tempo</strong>—how fast the game feels—drastically changes.</p></li>&#13;
<li><p>Some players try to shoot the aliens starting at the edge of the formation, because the gap at the side of the formation slows down their descent. That’s not written anywhere in the code, which just has simple rules for how the invaders march. That’s a dynamic, and it’s <strong>emergent</strong> because it’s a side effect of how the mechanics combine—specifically, the mechanics of how the player shots work combined with the rules for how the invaders march. None of that is programmed into the code of the game. It’s not part of the mechanics. It’s all dynamics.</p></li>&#13;
</ul>&#13;
</div></aside>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">Dynamics can feel like a really abstract concept at first! We’ll spend more time on it later in the chapter—but for now, keep all of this stuff about dynamics in mind when you’re doing the next project. See if you can spot how dynamics come into play as you’re coding it.</span></p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/315fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>Video games</strong> <span style="color:#9D9EA0;"><em><u>are</u></em></span> serious business.</p>&#13;
<p>The video game industry is growing globally every year, and employs hundreds of thousands of people all over the world, and it’s a business that a talented game designer can break into! There’s an entire ecosystem of <strong>independent game developers</strong> who build and sell games, either as individuals or on small teams.</p>&#13;
<p>But you’re right—C# is a serious language, and it’s used for all sorts of serious, non-gaming applications. In fact, while C# is a favorite language among game developers, it’s also one of the most common languages found in businesses across many different industries.</p>&#13;
<p>So for this next project, let’s get some practice with inheritance by building a <strong><em>serious business application</em></strong>.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Go to the <span style="color:#9D9EA0;">Visual Studio for Mac Learner’s Guide</span> for the Mac version of ths project.</p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Build a beehive management system" data-type="sect1"><div class="sect1" id="build_a_beehive_management_system">&#13;
<h1>Build a beehive management system</h1>&#13;
<p><a data-primary="bees" data-type="indexterm" id="idm46402343700136"/><strong><em>The queen bee needs your help!</em></strong> Her hive is out of control, and she needs a program to help manage her honey production business. She’s got a beehive full of workers, and a whole bunch of jobs that need to be done around the hive, but somehow she’s lost control of which bee is doing what, and whether or not she’s got the beepower to do the jobs that need to be done. It’s up to you to build a <strong>beehive management system</strong> to help her keep track of her workers. Here’s how it’ll work.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/316fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<ol>&#13;
<li><p><strong>The queen assigns jobs to her workers.</strong></p>&#13;
<p>There are three different jobs that the workers can do. <strong>Nectar collector</strong> bees fly out and bring nectar back to the hive. <strong>Honey manufacturer</strong> bees turn that nectar into honey, which bees eat to keep working. Finally, the queen is constantly laying eggs, and <strong>egg care</strong> bees make sure they become workers.</p></li>&#13;
<li><p><strong>When the jobs are all assigned, it’s time to work.</strong></p>&#13;
<p>Once the queen’s done assigning the work, she’ll tell the bees to work the next shift by clicking the “Work the next shift” button in her Beehive Management System app, which generates a shift report that tells her how many bees are assigned to each job and the status of the nectar and honey in the <strong>honey vault</strong>.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/316fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
<li><p>Like all business leaders, the queen is focused on <strong>growth</strong>. The beehive business is hard work, and she measures her hive in the total number of workers. Can you help the queen keep adding workers? How big can she grow the hive before it runs out of honey and she has to file for bee-nkruptcy?</p></li>&#13;
</ol>&#13;
</div></section>&#13;
<section data-pdf-bookmark="The beehive management system class model" data-type="sect1"><div class="sect1" id="the_beehive_management_system_class_mode">&#13;
<h1>The beehive management system class model</h1>&#13;
<p><a data-primary="Beehive Management System project" data-secondary="class model" data-type="indexterm" id="idm46402343686312"/>Here are the classes that you’ll build for the beehive management system. There’s an inheritance model with a base class and four subclasses, a static class to manage the honey and nectar that drive the hive business, and the MainWindow class with the code-behind for the main window.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/317fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span class="inlineimage"><img alt="Images" src="assets/relax.png"/></span></p>&#13;
<p><strong>This class model is just the start. We’ll give more details so you can write the code.</strong></p>&#13;
<p>Examine this class model really carefully. It has a lot of information about the app you’re about to build. Next, we’ll give you all of the details you need to write the code for these classes.</p>&#13;
</div>&#13;
</div></section>&#13;
<section data-pdf-bookmark="The Queen class: how she manages the worker bees" data-type="sect1"><div class="sect1" id="the_queen_class_how_she_manages_the_work">&#13;
<h1>The Queen class: how she manages the worker bees</h1>&#13;
<p><a data-primary="Array instance" data-type="indexterm" id="idm46402343677240"/><a data-primary="Beehive Management System project" data-secondary="Queen class" data-type="indexterm" id="idm46402343675992"/>When you <strong>press the button to work the next shift</strong>, the button’s Click event handler calls the Queen object’s WorkTheNextShift method, which is inherited from the Bee base class. Here’s what happens next:</p>&#13;
<ul>&#13;
<li><p>Bee.WorkTheNextShift calls HoneyVault.ConsumeHoney(HoneyConsumed), using the CostPerShift property (which each subclass overrides with a different value) to determine how much honey she needs to work.</p></li>&#13;
<li><p>Bee.WorkTheNextShift then calls DoJob, which the Queen also overrides.</p></li>&#13;
<li><p>Queen.DoJob adds 0.45 eggs to her private eggs field (using a const called EGGS_PER_SHIFT). The EggCare bee will call her CareForEggs method, which decreases eggs and increases unassignedWorkers.</p></li>&#13;
<li><p>Then it uses a foreach loop to call each worker’s WorkTheNextShift method.</p></li>&#13;
<li><p>It consumes honey for each unassigned worker. The HONEY_PER_UNASSIGNED_WORKER const tracks how much each one consumes per shift.</p></li>&#13;
<li><p>Finally, it calls its UpdateStatusReport method.</p></li>&#13;
</ul>&#13;
<p>When you <strong>press the button to assign a job</strong> to a bee, the event handler calls the Queen object’s AssignBee method, which takes a string with the job name (you’ll get that name from jobSelector.text). It uses a <code>switch</code> statement to create a new instance of the appropriate Bee subclass and pass it to AddWorker, so make sure you <strong>add the AddWorker method</strong> below to your Queen class.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/318fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>The length of an Array instance can’t be changed during its lifetime. That’s why C# has this useful static <span style="color:#9D9EA0;"><strong><u>Array.Resize method.</u></strong></span> It doesn’t actually resize the array. Instead, it creates a new one and copies the contents of the old one into it. Notice how it uses the ref keyword—we’ll learn more about that later in the book.</strong></p>&#13;
</div>&#13;
<pre data-type="programlisting">/// &lt;summary&gt;&#13;
/// Expand the workers array by one slot and add a Bee reference.&#13;
/// &lt;/summary&gt;&#13;
/// &lt;param name="worker"&gt;Worker to add to the workers array.&lt;/param&gt;&#13;
private void AddWorker(Bee worker)&#13;
{&#13;
    if (unassignedWorkers &gt;= 1)&#13;
    {&#13;
        unassignedWorkers--;&#13;
        <strong>Array.Resize(ref workers, workers.Length + 1);</strong>&#13;
        workers[workers.Length - 1] = worker;&#13;
    }&#13;
}</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">You’ll need this AddWorker method to add a new worker to the Queen’s worker array. It calls Array.Resize to expand the array, then adds the new worker Bee to it.</span></p>&#13;
</div>&#13;
</div></section>&#13;
<section data-pdf-bookmark="The UI: add the XAML for the main window" data-type="sect1"><div class="sect1" id="the_ui_add_the_xaml_for_the_main_window">&#13;
<h1>The UI: add the XAML for the main window</h1>&#13;
<p><a data-primary="Beehive Management System project" data-secondary="user interface for" data-type="indexterm" id="idm46402343658664"/><a data-primary="ComboBoxes" data-type="indexterm" id="idm46402343656808"/><a data-primary="tags (XAML)" data-type="indexterm" id="idm46402343655992"/><a data-primary="TextBox" data-type="indexterm" id="idm46402343655192"/><a data-primary="WPF (Windows Presentation Foundation)" data-type="indexterm" id="idm46402343654280"/>Create a <strong>new WPF app called BeehiveManagementSystem</strong>. The main window is laid out with a grid, with <code>Title="Beehive Management System" Height="325" Width="625"</code>. It uses the same Label, StackPanel, and Button controls you’ve used in previous chapters, and introduces two new controls. The dropdown list under Job Assignments is a <strong>ComboBox</strong> control, which lets users choose from a list of options. The status report under Queen’s Report is displayed in a <strong>TextBox</strong> control.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/319fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/319fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><a data-primary="Beehive Management System project" data-secondary="exercises for" data-type="indexterm" id="idm46402343646968"/><a data-primary="exercises" data-secondary="Beehive Management System project" data-type="indexterm" id="idm46402343645496"/><span style="color:#9D9EA0;">Don’t get overwhelmed or intimidated by the length of this exercise! Just break it down into small steps. Once you start working on it, you’ll see it’s all review of things you’ve learned.</span></p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="long_exercise">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/com-l.png"/></span> Long Exercise</h5>&#13;
<p>Build the <strong>Beehive Management</strong> <strong>System</strong>. The purpose of the system is to <strong>maximize the number of workers assigned to jobs in the hive</strong>, and keep the hive running as long as possible until the honey runs out.</p>&#13;
<p><strong>Rules of the hive</strong></p>&#13;
<p>Workers can be assigned one of three jobs: nectar collectors add nectar to the honey vault, honey manufacturers convert the nectar into honey, and egg care bees turn eggs into workers who can be assigned to jobs. During each shift, the Queen lays eggs (just under two shifts per egg). The Queen updates her status report at the end of the shift. It shows the honey vault status and the number of eggs, unassigned workers, and bees assigned to each job.</p>&#13;
<p><strong>Start by building the static HoneyVault class</strong></p>&#13;
<ul>&#13;
<li><p>The HoneyVault class is a good starting point because it has no <strong>dependencies</strong>—it doesn’t call methods or use properties or fields from any other class. Start by creating a new class called HoneyVault. Make it <code>static</code>, then look at the class diagram and add the class members.</p></li>&#13;
<li><p>HoneyVault has <strong>two constants</strong> (NECTAR_CONVERSION_RATIO = .19f and LOW_LEVEL_WARNING = 10f) that are used in the methods. Its private honey field is initialized to 25f and its private nectar field is initialized to 100f.</p></li>&#13;
<li><p>The <strong>ConvertNectarToHoney method</strong> converts nectar to honey. It takes a float parameter called amount, subtracts that amount from its nectar field, and adds amount x NECTAR_CONVERSION_RATIO to the honey field. (If the amount passed to the method is less than the nectar left in the vault, it converts all of the remaining nectar.)</p></li>&#13;
<li><p>The <strong>ConsumeHoney method</strong> is how the bees use honey to do their jobs. It takes a parameter, amount. If it’s greater than the honey field it subtracts amount from honey and returns true; otherwise it returns false.</p></li>&#13;
<li><p>The <strong>CollectNectar method</strong> is called by the NectarCollector bee each shift. It takes a parameter, amount. If amount is greater than zero, it adds it to the honey field.</p></li>&#13;
<li><p>The <strong>StatusReport property</strong> only has a get accessor that returns a string with separate lines with the amount of honey and the amount of nectar in the vault. If the honey is below LOW_LEVEL_WARNING, it adds a warning (<code>"LOW HONEY - ADD A HONEY MANUFACTURER"</code>). It does the same for the nectar field.</p></li>&#13;
</ul>&#13;
<p>Create the Bee class and <code>start</code> building the Queen, HoneyManufacturer, NectarCollector, and EggCare classes</p>&#13;
<ul>&#13;
<li><p>Create the Bee base class. Its <strong>constructor</strong> takes a string, which it uses to set the <strong>read-only Job property</strong>. Each Bee subclass passes a string to the base constructor—<code>"Queen"</code>, <code>"Nectar Collector"</code>, <code>"Honey Manufacturer"</code>, or <code>"Egg Care"</code>—so the Queen class has this code: <code>public Queen() : base("Queen"</code>)</p></li>&#13;
<li><p>The virtual read-only <strong>CostPerShift property</strong> lets each Bee subclass define the amount of honey it consumes each shift. The <strong>WorkTheNextShift method</strong> passes HoneyConsumed to the HoneyVault.ConsumeHoney method. If ConsumeHoney returns true there’s enough honey left in the hive, so WorkTheNextShift then calls DoJob.</p></li>&#13;
<li><p><strong>Create empty</strong> HoneyManufacturer, NectarCollector, and EggCare classes that just extend Bee—you’ll need them to build the Queen class. You’ll <strong>finish the Queen class first</strong>, then come back and finish the other Bee subclasses.</p></li>&#13;
<li><p>Each Bee subclass <strong>overrides the DoJob method</strong> with code to do its job, and <strong>overrides the CostPerShift property</strong> with the amount of honey it consumes each shift.</p></li>&#13;
<li><p>Here are all of the <strong>values for the read-only Bee.CostPerShift property</strong> for each Bee subclass: Queen.CostPerShift returns 2.15f, NectarCollector.CostPerShift returns 1.95f, HoneyManufacturer.CostPerShift returns 1.7f, and EggCare.CostPerShift returns 1.35f.</p></li>&#13;
</ul>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">Every single part of this exercise is something you’ve seen before. You CAN do this!</span></p>&#13;
</div>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="long_exercise_solution">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/com-l.png"/></span> Long Exercise Solution</h5>&#13;
<p><strong>This is a long exercise, <u><em>but that’s OK</em></u>! Just build it class by class. Finish building the Queen class first. Once you’re done, you’ll go back to the other Bee subclasses.</strong></p>&#13;
<ul>&#13;
<li><p>The Queen class has a <strong>private Bee[] field</strong> called workers. It starts off as an empty array. We gave you the AddWorker method to add Bee references to it.</p></li>&#13;
<li><p>Her <strong>AssignBee method</strong> takes a parameter with a job name (like <code>"Egg Care"</code>). It has <code>switch (job)</code> with cases that call AddWorker. For example, if <code>job</code> is <code>"Egg Care"</code> then it calls AddWorker(new EggCare(this)).</p></li>&#13;
<li><p>There are two <strong>private float fields</strong> called eggs and unassignedWorkers to keep track of the number of eggs (which she adds to each shift) and the number of workers waiting to be assigned.</p></li>&#13;
<li><p>She overrides the <strong>DoJob method</strong> to add eggs, tell the worker bees to work, and feed honey to the unassigned workers waiting for work. The EGGS_PER_SHIFT constant (set to 0.45f) is added to the eggs field. She uses a foreach loop to call each worker’s WorkTheNextShift method. Then she calls HoneyVault.ConsumeHoney, passing it the constant HONEY_PER_UNASSIGNED_WORKER (set to 0.5f) x workers.Length.</p></li>&#13;
<li><p>She starts off with three unassigned workers—her <strong>constructor</strong> calls the AssignBee method three times to create three worker bees, one of each type.</p></li>&#13;
<li><p>The EggCare bees call the Queen’s <strong>CareForEggs method</strong>. It takes a float parameter called eggsToConvert. If the eggs field is &gt;= eggsToConvert, it subtracts eggsToConvert from eggs and adds it to unassignedWorkers.</p></li>&#13;
<li><p>Look carefully at the status reports in the screenshot—her private <strong>UpdateStatusReport method</strong> generates it (using HoneyVault.StatusReport). She calls UpdateStatusReport at the end of her DoJob and AssignBee methods.</p></li>&#13;
</ul>&#13;
<p>Finish building the other Bee subclasses</p>&#13;
<ul>&#13;
<li><p>The <strong>NectarCollector class</strong> has a const NECTAR_COLLECTED_PER_SHIFT = 33.25f. Its <strong>DoJob method</strong> passes that const to HoneyVault.CollectNectar.</p></li>&#13;
<li><p>The <strong>HoneyManufacturer class</strong> has a const NECTAR_PROCESSED_PER_SHIFT = 33.15f, and its DoJob method passes that const to HoneyVault.ConvertNectarToHoney.</p></li>&#13;
<li><p>The <strong>EggCare class</strong> has a const CARE_PROGRESS_PER_SHIFT = 0.15f, and its DoJob method passes that const to queen.CareForEggs, using a private Queen reference that’s <strong>initialized in the EggCare constructor</strong>.</p></li>&#13;
</ul>&#13;
<p>Build the code-behind for the main window</p>&#13;
<ul>&#13;
<li><p>We gave you the XAML for the <strong>main window</strong>. Your job is to add the code-behind. It has a private Queen field called <code>queen</code> that’s initialized in the constructor, and event handlers for the buttons and combo box.</p></li>&#13;
<li><p>Hook up the <strong>event handlers</strong>. The “assign job” button calls queen.AssignBee(jobSelector.Text). The “Work the next shift” button calls queen.WorkTheNextShift. They both set statusReport.Text equal to queen.StatusReport.</p></li>&#13;
</ul>&#13;
<p>Some more details about how the Beehive Management System works</p>&#13;
<ul>&#13;
<li><p>The goal is to get the TOTAL WORKERS line in the status report (which lists the total number of assigned workers) to go as high as possible—and that all depends on <strong>which workers you add and when you add them</strong>. Workers drain honey: if you’ve got too many of one kind of worker, the honey starts to go down. As you run the program, watch the honey and nectar numbers. After the first few shifts, you’ll get a low honey warning (so add a honey manufacturer); after a few more, you’ll get a low nectar warning (so add a nectar collector)—after that, you need to figure out how to staff the hive. How high can you get TOTAL WORKERS to go before the honey runs out?</p></li>&#13;
</ul>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="long_exercise_solution-idd0001">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/com-l.png"/></span> Long Exercise Solution</h5>&#13;
<p>This project is big, and it has <strong>a lot of different parts</strong>. If you run into trouble, just take it piece by piece. None of it is magic—you already have the tools to understand every part of it.</p>&#13;
<p>Here’s the code for the <strong>static HoneyVault class:</strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/322fig001.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>The behavior of this program is driven by the way the different classes interact with each other—especially the ones in the Bee class hierarchy. And at the top of that hierarchy is the <strong>Bee superclass</strong> that all of the other Bee classes extend:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/323fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>The <strong>NectarCollector class</strong> collects nectar each shift and adds it to the vault:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/323fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Each of the Bee subclasses has a different job, but they have <strong>shared behaviors</strong>—even the Queen. They all work during each shift, but only do their jobs if there’s enough honey.</p>&#13;
<p>The <strong>Queen class</strong> manages the workers and generates the status reports:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/324fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="ComboBoxes" data-type="indexterm" id="idm46402343572136"/>The <strong>Queen class drives all of the work in the program</strong>—she keeps track of the instances of the worker Bee objects, creates new ones when they need to be assigned to their jobs, and tells them to start working their shifts:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/325fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>The <strong>constants at the top of each of the Bee subclasses</strong> are really important. We came up with the values for those constants through trial and error: we tweaked one of the numbers, then ran the program to see what effect it had. We tried to come up with a good balance between the classes. Do you think we did a good job? <em>Can you do better? We bet you can!</em></p>&#13;
<p>The <strong>EggCare class</strong> uses a reference to the Queen object to call her CareForEggs method to turn eggs into workers:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/326fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Here’s the <strong>code-behind for the main window</strong>. It doesn’t do much—all of the intelligence is in the other classes:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/326fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>If you run into trouble writing the code, it’s absolutely OK to look at the solution!</strong></p>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/327fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="resource management game" data-type="indexterm" id="idm46402343559496"/><strong>OK, you got us. Yes, you’re right. This is a game.</strong></p>&#13;
<p>Specifically, it’s a <strong>resource management game</strong>, or a game where the mechanics are focused on collecting, monitoring, and using resources. If you’ve played a simulation game like SimCity or strategy game like Civilization, you’ll recognize resource management as a big part of the game, where you need resources like money, metal, fuel, wood, or water to run a city or build an empire.</p>&#13;
<p>Resource management games are a great way to experiment with the relationship between <strong><em>mechanics, dynamics, and aesthetics</em></strong>:</p>&#13;
<ul>&#13;
<li><p>The <strong>mechanics</strong> are simple: the player assigns workers and then initiates the next shift. Then each bee either adds nectar, reduces nectar/increases honey, or reduces eggs/increases workers. The egg count increases, and the report is displayed.</p></li>&#13;
<li><p>The <strong>aesthetics</strong> are more complex. Players feel stress as the honey or nectar levels fall and the low level warning is displayed. They feel excitement when they make a choice, and satisfaction when it affects the game—and then stress again, as the numbers stop increasing and start decreasing again.</p></li>&#13;
<li><p>The game is driven by the <strong>dynamics</strong>. There’s nothing in the code that makes the honey or nectar scarce—they’re just consumed by the bees and eggs.</p></li>&#13;
</ul>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">Really take a minute and think about this, because it gets to the heart of what dynamics are about. Do you see any way to use some of these ideas in other kinds of programs, and not just games?</span></p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-idd0019">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/brainpower.png"/></span> Brain Power</h5>&#13;
<p>A small change in HoneyVault.NECTAR_CONVERSION_RATIO can make the game much easier or much harder by making the honey drain slowly or quickly. What other numbers affect gameplay? What do you think is driving those relationships?</p>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Feedback drives your Beehive Management game" data-type="sect1"><div class="sect1" id="feedback_drives_your_beehive_management">&#13;
<h1>Feedback drives your Beehive Management game</h1>&#13;
<p><a data-primary="Beehive Management System project" data-secondary="feedback in" data-type="indexterm" id="idm46402343545208"/><a data-primary="feedback loop" data-type="indexterm" id="idm46402343543912"/>Let’s take a few minutes and really understand how this game works. The nectar conversion ratio has a big impact on your game. If you change the constants, it can make really big differences in gameplay. If it takes just a little honey to convert an egg to a worker, the game gets really easy. If it takes a lot, the game gets much harder. But if you go through the classes, you won’t find a difficulty setting. There’s no Difficultly field on any of them. Your Queen doesn’t get special power-ups to help make the game easier, or tough enemies or boss battles to make it more difficult. In other words, there’s <strong><em>no code that explicitly creates a relationship</em></strong> between the number of eggs or workers and the difficulty of the game. So what’s going on?</p>&#13;
<p>You’ve probably played with <strong>feedback</strong> before. Start a video call between your phone and your computer. Hold the phone near the computer speaker and you’ll hear noisy echoes. Point the camera at the computer screen and you’ll see a picture of the screen inside the picture of the screen inside the picture of the screen, and it will turn into a crazy pattern if you tilt the phone. This is feedback: you’re taking the live video or audio <u>output</u> and <em>feed</em>ing it right <em>back</em> into the <u>input</u>. There’s nothing in the code of the video call app that specifically generates those crazy sounds or images. Instead, they <strong>emerge</strong> from the feedback.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/328fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<section data-pdf-bookmark="Workers and honey are in a feedback loop" data-type="sect2"><div class="sect2" id="workers_and_honey_are_in_a_feedback_loop">&#13;
<h2>Workers and honey are in a feedback loop</h2>&#13;
<p>Your Beehive Management game is based on a series of <strong>feedback loops</strong>: lots of little cycles where parts of the game interact with each other. For example, honey manufacturers add honey to the vault, which is consumed by honey manufacturers, who make more honey.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/328fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>And that’s just one feedback loop. There are many different feedback loops in your game, and they make the whole game more complex, more interesting, and (hopefully!) more fun.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/328fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="mechanicscomma_aestheticscomma_and_dynam">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/zoom.png"/></span> Mechanics, Aesthetics, and Dynamics Up Close</h5>&#13;
<p><a data-primary="MDA (Mechanics-Dynamics-Aesthetics) framework" data-type="indexterm" id="idm46402343525832"/>Feedback loops...equilibrium...making your code do something indirectly by creating a system...does all this have your head spinning a little? Here’s another opportunity to <strong><em>use game design to explore a <u>larger programming concept</u></em>.</strong></p>&#13;
<p>You’ve learned about mechanics, dynamics, and aesthetics—now it’s time to bring them all together. The <strong>Mechanics-Dynamics-Aesthetics framework</strong>, or <strong>MDA framework</strong>, is a formal tool (“formal” just means it’s written down) that’s used by researchers and academics to analyze and understand games. It defines the relationship between mechanics, dynamics, and aesthetics, and gives us a way to talk about how they create feedback loops to influence each other.</p>&#13;
<p>The MDA framework was developed by Robin Hunicke, Marc LeBlanc, and Robert Zubek, and published in a 2004 paper called “MDA: A Formal Approach to Game Design and Game Research”—it’s quite readable, without a ton of academic jargon. (Remember back in <a href="ch05.html#encapsulation_keep_your_privateshellippr">#encapsulation_keep_your_privateshellippr</a>, when we talked about how aesthetics includes challenge, narrative, sensation, fantasy, and expression? That came from this paper.) Take a few minutes and look through it, it’s actually a great read: <a href="http://bit.ly/mda-paper">http://bit.ly/mda-paper</a>.</p>&#13;
<p>The goal of the MDA framework is to give us a formal way to think about and analyze video games. This may sound like something that’s only important in an academic setting, like a college course on game design. But it’s actually really valuable to us as everyday game developers, because it can help us understand how people perceive the games we create, and give us a deeper insight into <strong>what makes those games fun</strong>.</p>&#13;
<p>Game designers had been using the terms mechanics, dynamics, and aesthetics informally, but the paper really gave them a solid definition, and established the relationship between them.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/329fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>One thing that the MDA framework tackles is the <strong>difference in perspective</strong> between gamers and game designers. Players, first and foremost, want the game to be fun—but we’ve already seen how “fun” can differ wildly from player to player. Game designers, on the other hand, typically see a game through the lens of its mechanics, because they spend their time writing code, designing levels, creating graphics, and tinkering with the mechanical aspects of the game.</p>&#13;
<p><strong>All developers (not just game developers!) can use the MDA framework to get a handle on feedback loops</strong></p>&#13;
<p>Let’s use the MDA framework to analyze a classic game, Space Invaders, so we can better understand feedback loops.</p>&#13;
<ul>&#13;
<li><p>Start with mechanics of the game: the player’s ship moves left and right and fires shots up; the invaders march in formation and fire shots down; the shields block shots. The fewer enemies there are on screen, the faster they go.</p></li>&#13;
<li><p>Players figure out strategies: shoot where the invaders will be, pick off enemies on the sides of the formation, hide behind the shields. The code for the game doesn’t have an <code>if/else</code> or <code>switch</code> statement for these strategies; they emerge as the player figures out the game. Players learn the rules, then start to understand the system, which helps them better take advantage of the rules. In other words, <strong><em>the mechanics and dynamics form a feedback loop.</em></strong></p></li>&#13;
<li><p>The invaders get faster, the marching sounds speed up, and the player gets a rush of adrenaline. The game gets more exciting—and in turn, the player has to make decisions more quickly, makes mistakes, and changes strategy, which has an effect on the system. <strong><em>The dynamics and aesthetics form another feedback loop.</em></strong></p></li>&#13;
<li><p>None of this happened by accident. The speed of the invaders, the rate at which they increase, the sounds, the graphics...these were all carefully balanced by the game’s creator, Tomohiro Nishikado, who spent over a year designing it, drawing inspiration from earlier games, H. G. Wells, even his own dreams to create a classic game.</p></li>&#13;
</ul>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="The Beehive Management System is turn-based...now let’s convert it to real-time" data-type="sect1"><div class="sect1" id="the_beehive_management_system_is_turn_ba">&#13;
<h1>The Beehive Management System is <u>turn-based</u>...now let’s convert it to <u>real-time</u></h1>&#13;
<p><a data-primary="Beehive Management System project" data-secondary="converting from turn-based to real-time" data-type="indexterm" id="idm46402343511768"/><a data-primary="real-time game" data-type="indexterm" id="idm46402343503032"/><a data-primary="turn-based game" data-type="indexterm" id="idm46402343502296"/>A <strong>turn-based game</strong> is a game where the flow is broken down into parts—in the case of the Beehive Management System, into shifts. The next shift doesn’t start until you click a button, so you can take all the time you want to assign workers. We can use a DispatcherTimer (like the one you used in <a href="ch01.html#start_building_with_chash_build_somethin">#start_building_with_chash_build_somethin</a>) to <strong>convert it to a real-time game</strong> where time progresses continuously—and we can do it with just a few lines of code.</p>&#13;
<ol>&#13;
<li><p><strong>Add a using line to the top of your MainWindow.xaml.cs file.</strong></p>&#13;
<p>We’ll be using a DispatcherTimer to force the game to work the next shift every second and a half. DispatcherTimer is in the System.Windows.Threading namespace, so you’ll need to add this <code>using</code> line to the top of your <em>MainWindow.xaml.cs</em> file:</p>&#13;
<pre data-type="programlisting"><strong>using System.Windows.Threading;</strong></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>You used a DispatcherTimer in <a href="ch01.html#start_building_with_chash_build_somethin">#start_building_with_chash_build_somethin</a> to add a timer to your animal matching game. This code is very similar to the code you used in <a href="ch01.html#start_building_with_chash_build_somethin">#start_building_with_chash_build_somethin</a>. Take a few minutes and flip back to that project to remind yourself how the DispatcherTimer works.</strong></p>&#13;
</div>&#13;
</li>&#13;
<li><p><strong>Add a private field with a DispatcherTimer reference.</strong></p>&#13;
<p>Now you’ll need to create a new DispatcherTimer. Put it in a private field at the top of the MainWindow class:</p>&#13;
<pre data-type="programlisting"><strong>private DispatcherTimer timer = new DispatcherTimer();</strong></pre>&#13;
</li>&#13;
<li><p><strong>Make the timer call the WorkShift button’s Click event handler method.</strong></p>&#13;
<p>We want the timer to keep the game moving forward, so if the player doesn’t click the button quickly enough it will automatically trigger the next shift. Start by adding this code:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/330fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
</ol>&#13;
<p>Now run your game. A new shift starts every 1.5 seconds, whether or not you click the button. This is a small change to the mechanics, but it <strong><em>dramatically changes the dynamics of the game</em></strong>, which leads to a huge difference in aesthetics. It’s up to you to decide if the game is better as a turn-based or real-time simulation.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/331fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>Yes! The timer changed the mechanics, which altered the dynamics, which in turn impacted the aesthetics.</strong></p>&#13;
<p>Let’s take a minute and think about that feedback loop. The change in mechanics (a timer that automatically clicks the “Work the next shift” button every 1.5 seconds) creates a totally new dynamic: a window when players must make decisions, or else the game makes the decision for them. That increases the pressure, which gives some players a satisfying shot of adrenaline, but just causes stress in other players—the aesthetics changed, which makes the game more fun for some people but less fun for others.</p>&#13;
<p>But you only added half a dozen lines of code to your game, and none of them included “make this decision or else” logic. That’s an example of behavior that <strong>emerged</strong> from how the timer and the button work together.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">There’s a feedback loop here, too. As players feels more stress, they make worse decisions, changing the game... aesthetics feeds back into mechanics.</span></p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/331fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>Feedback loops and emergence are important programming concepts.</strong></p>&#13;
<p>We designed this project to give you practice with inheritance, but <em>also</em> to let you explore and experiment with <strong>emergent</strong> behavior. That’s behavior that comes not just from what your objects do individually, but also out of <strong><em>the way objects interact with each other</em></strong>. The constants in the game (like the nectar conversion ratio) are an important part of that emergent interaction. When we created this exercise, we started out by setting those constants to some initial values, then we tweaked them by making tiny adjustments until we ended up with a system that’s <u>not quite</u> in <strong>equilibrium</strong>—a state where everything is perfectly balanced—so the player needs to keep making decisions in order to make the game last as long as possible. That’s all driven by the feedback loops between the eggs, workers, nectar, honey, and queen.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">Try experimenting with these feedback loops. Add more eggs per shift or start the hive with more honey, for example, and the game gets easier. Go ahead, give it a try! You can change the entire feel of the game just by making small changes to a few constants.</span></p>&#13;
</div>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Some classes should never be instantiated" data-type="sect1"><div class="sect1" id="some_classes_should_never_be_instantiate">&#13;
<h1>Some classes should never be instantiated</h1>&#13;
<p><a data-primary="classes" data-secondary="never instantiated" data-type="indexterm" id="idm46402343471336"/>Remember our zoo simulator class hierarchy? You’ll definitely end up instantiating a bunch of Hippos, Dogs, and Lions. What about the Canine and Feline classes? How about the Animal class? It turns out that <strong>there are some classes that just don’t need to be instantiated</strong>...and, in fact, <em>don’t make any sense</em> if they are.</p>&#13;
<p>Does that sound weird? Actually, it happens all the time—in fact, you created several classes earlier in the chapter that should never be instantiated.</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/332fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<pre data-type="programlisting">class Bird&#13;
{&#13;
    public static Random Randomizer = new Random();&#13;
    public virtual Egg[] LayEggs(int numberOfEggs)&#13;
    {&#13;
        Console.Error.WriteLine&#13;
             ("Bird.LayEggs should never get called");&#13;
        return new Egg[0];&#13;
    }&#13;
}</pre>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/332fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<pre data-type="programlisting">class WeaponDamage&#13;
{&#13;
     /* ... code for the properties ... */  }&#13;
    protected virtual void CalculateDamage()&#13;
    {&#13;
        /* the subclass overrides this */ &#13;
    }&#13;
    public WeaponDamage(int startingRoll)&#13;
    {&#13;
        roll = startingRoll;&#13;
        CalculateDamage();&#13;
    }&#13;
}</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>Your Bird class was tiny—it just had a shared instance of Random and a LayEggs method that only existed so the subclasses could override it. Your WeaponDamage class was a lot bigger—it had a lot of properties. It also had a CalculateDamage class for the subclasses to override, which it called from its WeaponDamage method.</strong></p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/333fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<pre data-type="programlisting">class Bee&#13;
{&#13;
    public virtual float CostPerShift { get; }&#13;
    public string Job { get; private set; }&#13;
    public Bee(string job)&#13;
    {&#13;
        Job = job;&#13;
    }&#13;
    public void WorkTheNextShift()&#13;
    {&#13;
        if (HoneyVault.ConsumeHoney(CostPerShift))&#13;
        {&#13;
            DoJob();&#13;
        }&#13;
    }&#13;
    protected virtual void DoJob() { /* the subclass overrides this */  }&#13;
}</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><strong>The Bee class had a WorkTheNextShift method that consumed honey and then did whatever job the bee was supposed to do—so it expected the subclass to override the DoJob method to actually do the job.</strong></p>&#13;
</div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-idd0020">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/brainpower.png"/></span> Brain Power</h5>&#13;
<p>So what happens when you instantiate the Bird, WeaponDamage, or Bee classes? Does it ever make sense to do it? Do all of their methods even work?</p>&#13;
</div></aside>&#13;
</div></section>&#13;
<section data-pdf-bookmark="An abstract class is an intentionally incomplete class" data-type="sect1"><div class="sect1" id="an_abstract_class_is_an_intentionally_in">&#13;
<h1>An <u>abstract class</u> is an intentionally incomplete class</h1>&#13;
<p><a data-primary="abstract classes" data-secondary="about" data-type="indexterm" id="idm46402343450456"/><a data-primary="abstract methods" data-type="indexterm" id="idm46402343448856"/><a data-primary="classes" data-secondary="concrete" data-type="indexterm" id="idm46402343448024"/><a data-primary="concrete classes" data-type="indexterm" id="idm46402343446888"/><a data-primary="methods" data-secondary="abstract" data-type="indexterm" id="idm46402343446088"/><a data-primary="methods" data-secondary="body" data-type="indexterm" id="idm46402343444952"/>It’s really common to have a class with “placeholder” members that it expects the subclasses to implement. It could be at the top of the hierarchy (like your Bee, WeaponDamage, or Bird classes) or in the middle (like Feline or Canine in the zoo simulator class model). They take advantage of the fact that C# always calls the most specific method, like how WeaponDamage calls the CalculateDamage method that’s only implemented in SwordDamage or ArrowDamage, or how Bee.WorkTheNextShift depends on the subclasses to implement the DoJob method.</p>&#13;
<p>C# has a tool that’s built specifically for this: an <strong>abstract class</strong>. It’s a class that’s <u>intentionally incomplete</u>, with empty class members that serve as placeholders for the subclasses to implement. To make a class abstract, <strong>add the</strong> <code>abstract</code> <strong>keyword to the class declaration</strong>. Here’s what you need to know about abstract classes.</p>&#13;
<ul>&#13;
<li><p><strong>An abstract class works just like a normal class.</strong></p>&#13;
<p>You define an abstract class just like a normal one. It has fields and methods, and it can inherit from other classes, too, exactly like a normal class. There’s almost nothing new to learn.</p></li>&#13;
<li><p><strong>An abstract class can have incomplete “placeholder” members.</strong></p>&#13;
<p>An abstract class can include declarations of properties and methods that must be implemented by inheriting classes. A method that has a declaration but no statements or method body is called an <strong>abstract method</strong>, and a property that only declares its accessors but doesn’t define them is called an <strong>abstract property</strong>. Subclasses that extend it <u>must</u> implement all abstract methods and properties unless they’re also abstract.</p></li>&#13;
<li><p><strong><u>Only</u> abstract classes can have abstract members.</strong></p>&#13;
<p>If you put an abstract method or property into a class, then you’ll have to mark that class abstract or your code won’t compile. You’ll learn more about how to mark a class abstract in a minute.</p></li>&#13;
<li><p><strong>An abstract class can’t be instantiated.</strong></p>&#13;
<p>The opposite of abstract is <strong>concrete</strong>. A concrete method is one that has a body, and all the classes you’ve been working with so far are concrete classes. The biggest difference between an <strong>abstract</strong> class and a <strong>concrete</strong> class is that you can’t use <code>new</code> to create an instance of an abstract class. If you do, C# will give you an error when you try to compile your code.</p>&#13;
<p>Try it now! <strong>Create a new console app</strong>, add an empty abstract class, and try to instantiate it:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/334fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</li>&#13;
</ul>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/335fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="abstract classes" data-secondary="usefulness" data-type="indexterm" id="idm46402343425880"/><strong>Because you want to provide some of the code, but still require that subclasses fill in the rest of the code.</strong></p>&#13;
<p>Sometimes <strong><em>bad things happen</em></strong> when you create objects that should never be instantiated. The class at the top of your class diagram usually has some fields that it expects its subclasses to set. An Animal class may have a calculation that depends on a Boolean called HasTail or Vertebrate, but there’s no way for it to set that itself. <strong><em>Here’s a quick example of a class that’s problematic when instantiated...</em></strong></p>&#13;
<p><strong><em>Do this!</em></strong></p>&#13;
<pre data-type="programlisting">class PlanetMission&#13;
{&#13;
    protected float fuelPerKm;&#13;
    protected long kmPerHour;&#13;
    protected long kmToPlanet;&#13;
    public string MissionInfo()&#13;
    {&#13;
        long fuel = (long)(kmToPlanet * fuelPerKm);&#13;
        long time = kmToPlanet / kmPerHour;&#13;
        return $"We’ll burn {fuel} units of fuel in {time} hours";&#13;
    }&#13;
}&#13;
class Mars : PlanetMission&#13;
{&#13;
    public Mars()&#13;
    {&#13;
        kmToPlanet = 92000000;&#13;
        fuelPerKm = 1.73f;&#13;
        kmPerHour = 37000;&#13;
    }&#13;
}&#13;
class Venus : PlanetMission&#13;
{&#13;
    public Venus()&#13;
    {&#13;
        kmToPlanet = 41000000;&#13;
        fuelPerKm = 2.11f;&#13;
        kmPerHour = 29500;&#13;
    }&#13;
}&#13;
class Program&#13;
{&#13;
    public static void Main(string[] args)&#13;
    {&#13;
        Console.WriteLine(new Venus().MissionInfo());&#13;
        Console.WriteLine(new Mars().MissionInfo());&#13;
        Console.WriteLine(new PlanetMission().MissionInfo());&#13;
    }&#13;
}</pre>&#13;
<p><strong>Before you run this code, can you figure out what it will print to the console?</strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/336fig001.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Like we said, some classes should never be instantiated" data-type="sect1"><div class="sect1" id="like_we_saidcomma_some_classes_should_ne">&#13;
<h1>Like we said, some classes should never be instantiated</h1>&#13;
<p><a data-primary="classes" data-secondary="why some should never be instantiated" data-type="indexterm" id="idm46402343416104"/>Try running the PlanetMission console app. Did it do what you expected? It printed two lines to the console:</p>&#13;
<pre data-type="programlisting">We’ll burn 86509992 units of fuel in 1389 hours&#13;
We’ll burn 159160000 units of fuel in 2486 hours</pre>&#13;
<p>But then it threw an exception.</p>&#13;
<p>The problems all started when you created an instance of the PlanetMission class. Its FuelNeeded method expects the fields to be set by the subclass. When they aren’t, they get their default values—zero. When C# tries to divide a number by zero...</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/336fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<section data-pdf-bookmark="Solution: use an abstract class" data-type="sect2"><div class="sect2" id="solution_use_an_abstract_class">&#13;
<h2>Solution: use an abstract class</h2>&#13;
<p>When you mark a class <code>abstract</code>, C# won’t let you write code to instantiate it. So how does that fix this problem? It’s like the old saying goes—prevention is better than cure. Add the <code>abstract</code> keyword to the PlanetMission class declaration:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/336fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>As soon as you make the change, the compiler gives you an error:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/336fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Your code won’t compile at all—and no compiled code means no exception. This is really similar to the way you used the <code>private</code> keyword in <a href="ch05.html#encapsulation_keep_your_privateshellippr">#encapsulation_keep_your_privateshellippr</a>, or <code>virtual</code> and <code>override</code> earlier in this chapter. Making some members private doesn’t change the behavior. It just prevents your code from building if you break the encapsulation. The <code>abstract</code> keyword works the same way: you’ll never get an exception instantiating an abstract class because the C# compiler <em>won’t let you instantiate one in the first place</em>.</p>&#13;
<blockquote>&#13;
<p>When you add the <u>abstract</u> keyword to a class declaration, the compiler gives you an error any time you try to create an instance of that class.</p>&#13;
</blockquote>&#13;
</div></section>&#13;
</div></section>&#13;
<section data-pdf-bookmark="An abstract method doesn’t have a body" data-type="sect1"><div class="sect1" id="an_abstract_method_doesnapostrophet_have">&#13;
<h1>An abstract method doesn’t have a body</h1>&#13;
<p><a data-primary="{ } (curly brackets)" data-type="indexterm" id="idm46402343398952"/><a data-primary="abstract methods" data-type="indexterm" id="idm46402343395272"/><a data-primary="methods" data-secondary="body" data-type="indexterm" id="idm46402343394472"/>The Bird class that you built was never meant to be instantiated. That’s why it uses Console.Error to write an error message if a program tries to instantiate it and call its LayEggs method:</p>&#13;
<pre data-type="programlisting">class Bird&#13;
{&#13;
    public static Random Randomizer = new Random();&#13;
    public virtual Egg[] LayEggs(int numberOfEggs)&#13;
    {&#13;
        Console.Error.WriteLine&#13;
             ("Bird.LayEggs should never get called");&#13;
        return new Egg[0];&#13;
    }&#13;
}</pre>&#13;
<p>Since we don’t ever want to instantiate the Bird class, let’s add the <code>abstract</code> keyword to its declaration. But that’s not enough—not only should this class never be instantiated, but we want to <strong>require</strong> that every subclass that extends Bird <u><strong>must override the LayEggs method</strong></u>.</p>&#13;
<p>And that’s exactly what happens when you add the <code>abstract</code> keyword to a class member. An <strong>abstract method</strong> only has a class declaration but <strong><em>no method body</em></strong> that <u>must be implemented</u> by any subclass that extends the abstract class. The <strong>body</strong> of a method is the code between the curly braces that comes after the declaration—and it’s something abstract methods can’t have.</p>&#13;
<p>Go back to your Bird project from earlier and <strong>replace the Bird class</strong> with this abstract class:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/337fig03.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<pre data-type="programlisting"><strong>abstract</strong> class Bird&#13;
{&#13;
    public static Random Randomizer = new Random();&#13;
    public <strong>abstract</strong> Egg[] LayEggs(int numberOfEggs);&#13;
}</pre>&#13;
<p>Your program still runs exactly like it did before! But try adding this line to the Main method:</p>&#13;
<pre data-type="programlisting">Bird abstractBird = new Bird();</pre>&#13;
<p>and you’ll get a compiler error:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/337fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p>Try to add a body to the LayEggs method:</p>&#13;
<pre data-type="programlisting">    public abstract Egg[] LayEggs(int numberOfEggs)&#13;
    {&#13;
        return new Egg[0];&#13;
    }</pre>&#13;
<p>and you’ll get a different compiler error:</p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/337fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<blockquote>&#13;
<p><strong>If an abstract class has virtual members, every subclass must override all of those members.</strong></p>&#13;
</blockquote>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Abstract properties work just like abstract methods" data-type="sect1"><div class="sect1" id="abstract_properties_work_just_like_abstr">&#13;
<h1>Abstract properties work just like abstract methods</h1>&#13;
<p><a data-primary="abstract properties" data-type="indexterm" id="idm46402343372328"/>Let’s go back to the Bee class from our earlier example. We already know that we don’t want the class to be instantiated, so let’s modify it to turn it into an abstract class. We can do that just by adding the <code>abstract</code> modifier to the class declaration, and changing the DoJob method to an abstract method without a body:</p>&#13;
<pre data-type="programlisting"><strong>abstract</strong> class Bee&#13;
{&#13;
   <span style="color:#9D9EA0;">/* the rest of the class stays the same */</span>&#13;
   protected <strong>abstract</strong> void DoJob();&#13;
}</pre>&#13;
<p>But there’s one other virtual member—and it’s not a method. It’s the CostPerShift property, which the Bee.WorkTheNextShift method calls to figure out how much honey the bee will require this shift:</p>&#13;
<pre data-type="programlisting">   public virtual float CostPerShift { get; }</pre>&#13;
<p>We learned in <a href="ch05.html#encapsulation_keep_your_privateshellippr">#encapsulation_keep_your_privateshellippr</a> that properties are really just methods that are called like fields. Use the <code>abstract</code> <strong>keyword to create an abstract property</strong> just like you do with a method:</p>&#13;
<pre data-type="programlisting">   public <strong>abstract</strong> float CostPerShift { get; }</pre>&#13;
<p>Abstract properties can have a get accessor, a set accessor, or both get and set accessors. Setters and getters in abstract properties <strong>can’t have method bodies</strong>. Their declarations look just like automatic properties—but they’re not, because they don’t have any implementation at all. Like abstract methods, abstract properties are placeholders for properties that must be implemented by any subclass that extends their class.</p>&#13;
<p>Here’s the whole abstract Bee class, complete with abstract method and property:</p>&#13;
<pre data-type="programlisting"><strong>abstract</strong> class Bee&#13;
{&#13;
    public <strong>abstract</strong> float CostPerShift { get; }&#13;
    <span style="color:#9D9EA0;">public string Job { get; private set; }</span>&#13;
&#13;
    <span style="color:#9D9EA0;">public Bee(string job)</span>&#13;
    <span style="color:#9D9EA0;">{</span>&#13;
        <span style="color:#9D9EA0;">Job = job;</span>&#13;
    <span style="color:#9D9EA0;">}</span>&#13;
&#13;
    <span style="color:#9D9EA0;">public void WorkTheNextShift()</span>&#13;
    <span style="color:#9D9EA0;">{</span>&#13;
        <span style="color:#9D9EA0;">if (HoneyVault.ConsumeHoney(CostPerShift))</span>&#13;
        <span style="color:#9D9EA0;">{</span>&#13;
            <span style="color:#9D9EA0;">DoJob();</span>&#13;
        <span style="color:#9D9EA0;">}</span>&#13;
    <span style="color:#9D9EA0;">}</span>&#13;
&#13;
    protected <strong>abstract</strong> void DoJob();&#13;
}</pre>&#13;
<p><strong><em>Replace this!</em></strong></p>&#13;
<p><strong>Replace the Bee class</strong> in your Beehive Management System app with this new abstract one. It will still work! But now if you try to instantiate the Bee class with <code>new Bee()</code>; you’ll get a compiler error. Even more importantly, <strong><em>you’ll get an error if you extend Bee but forget to implement CostPerShift</em></strong>.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-idd0022">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise</h5>&#13;
<p><a data-primary="abstract classes" data-secondary="exercises on" data-type="indexterm" id="idm46402343341976"/><a data-primary="exercises" data-secondary="abstract classes" data-type="indexterm" id="idm46402343340472"/>It’s time to get some practice with abstract classes—and you don’t have to look far to find good candidates for classes to make abstract.</p>&#13;
<p>Earlier in the chapter you modified your SwordDamage and ArrowDamage classes to extend a new class called WeaponDamage. Make the WeaponDamage class abstract. There’s a good candidate for an abstract method in WeaponDamage—make that abstract as well.</p>&#13;
</div></aside>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-idd0019">&#13;
<h5>there are no Dumb Questions</h5>&#13;
<p><strong>Q: When I mark a class abstract, does that change the way it behaves? Do the methods or properties work differently than they do in a concrete class?</strong></p>&#13;
<p><strong>A:</strong> No, abstract classes work exactly like any other kind of class. When you add the <code>abstract</code> keyword to the class declaration, it causes the C# compiler to do two things: prevent you from using the class in a <code>new</code> statement, and allow you to include abstract members.</p>&#13;
<p><strong>Q: Some of the abstract classes you showed me are public, others are protected. Does that make a difference? And does the order of those keywords in the class declaration matter?</strong></p>&#13;
<p><strong>A:</strong> Abstract methods can have any access modifier. If you make an abstract method private, then the classes that implement that abstract method also need to make it private. The keyword order doesn’t matter. <code>protected abstract void DoJob();</code> and <code>abstract protected void DoJob();</code> do exactly the same thing.</p>&#13;
<p><strong>Q: I’m confused about the way you’re using the word “implement” or “implementation.” What do you mean when you’re talking about implementing an abstract method?</strong></p>&#13;
<p><strong>A:</strong> When you use the <code>abstract</code> keyword to declare an abstract method or property, we say that you’re <strong>defining</strong> the abstract member. Later on, when you add a complete method or property with the same declaration to a concrete class, we say that you’re <strong>implementing</strong> the member. So you define abstract methods or properties in an abstract class, and implement them in concrete classes that extend it.</p>&#13;
<p><strong>Q: I’m still having trouble with the idea that the <code>abstract</code> keyword keeps my code from compiling if I try to instantiate an instance of an abstract class. I already have trouble finding and fixing all of the compiler errors. Why do I want to make it even harder to get my code to build?</strong></p>&#13;
<p><strong>A:</strong> Sometimes when you’re first learning to code, those “CS” compiler errors can be a little frustrating. Everyone has spent time trying to track down a missing comma, period, or quotation mark to try to clear out the Errors List. So why would you ever use a keyword like <code>abstract</code> or <code>private</code> that puts even more restrictions on your code and makes those compiler errors even more common? It seems a little counterintuitive. If you never use the <code>abstract</code> keyword, you’ll never see a “Cannot create an instance of the abstract class” compiler error. So why ever use it?</p>&#13;
<p>The reason you use keywords like <code>abstract</code> or <code>private</code> that keep your code from building in certain cases is that it’s a lot easier to fix a “Cannot create an instance of the abstract class” compiler error than it is to track down the error that it prevents. If you have a class that should never be instantiated, it’s because the bug you get when you create an instance of it instead of a subclass can be subtle and difficult to find. Adding <code>abstract</code> to the base class causes your code to <strong>fail fast</strong> with an error that’s easier to fix.</p>&#13;
<blockquote>&#13;
<p><strong>Bugs caused by instantiating a base class that should never be instantiated can be subtle and hard to find. Making it abstract makes your code <u>fail fast</u> if you try to create an instance of it.</strong></p>&#13;
</blockquote>&#13;
</div></aside>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/340fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-idd0013">&#13;
<h5><span class="inlineimage"><img alt="Images" src="assets/exercise.png"/></span> Exercise Solution</h5>&#13;
<p>The WeaponDamage class should never be instantiated—the only reason it exists is so that the SwordDamage and ArrowDamage classes can inherit its properties and methods. So it makes sense to mark this class abstract. Have a look at its CalculateDamage method:</p>&#13;
<pre data-type="programlisting">   protected virtual void CalculateDamage() {&#13;
<span style="color:#9D9EA0;">     /* the subclass overrides this */</span>&#13;
   }</pre>&#13;
<p>This method is a great candidate to convert to an abstract class, because it only exists so that subclasses will override it with their own implementations that update the Damage property. Here’s everything that you needed to change in the WeaponDamage class:</p>&#13;
<pre data-type="programlisting"><strong>abstract class WeaponDamage</strong>&#13;
<strong>{</strong>&#13;
    <span style="color:#9D9EA0;">/* the Damage, Roll, Flaming, and Magic properties</span>&#13;
       <span style="color:#9D9EA0;">stay the same */</span>&#13;
&#13;
    <strong>protected abstract void CalculateDamage();</strong>&#13;
&#13;
    <span style="color:#9D9EA0;">public WeaponDamage(int startingRoll)</span>&#13;
    <span style="color:#9D9EA0;">{</span>&#13;
        <span style="color:#9D9EA0;">roll = startingRoll;</span>&#13;
        <span style="color:#9D9EA0;">CalculateDamage();</span>&#13;
    <span style="color:#9D9EA0;">}</span>&#13;
<span style="color:#9D9EA0;">}</span></pre>&#13;
</div></aside>&#13;
<p><strong>Was this the first time you’ve read through the code you wrote for previous exercises?</strong></p>&#13;
<p>It may feel a little weird to go back to code you wrote before—but that’s actually something a lot of developers do, and it’s a habit you should get used to. Did you find things that you would do differently the second time around? Are there improvements or changes that you might make? It’s always a good idea to take the time to refactor your code. That’s exactly what you did in this exercise: you changed the structure of the code without modifying its behavior. <strong><em>That’s refactoring.</em></strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/341fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><a data-primary="inheritance" data-secondary="multiple" data-type="indexterm" id="idm46402343317592"/><a data-primary="multiple inheritance" data-type="indexterm" id="idm46402343303944"/><strong>That sounds great! But there’s a problem.</strong></p>&#13;
<p>If C# let you inherit from more than one base class, it would open up a whole can of worms. When a language lets one subclass inherit from two base classes, it’s called <strong>multiple inheritance</strong>. If C# supported multiple inheritance, you would end up in a big fat class conundrum called...</p>&#13;
<p><em>The Deadly Diamond of Death</em></p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><span style="color:#9D9EA0;">That’s its real name! Some developers just call it the “diamond problem.”</span></p>&#13;
</div>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/341fig02.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<p><strong>What would happen in a CRAZY world where C# allowed multiple inheritance? Let’s play a little game of “what if” and find out.</strong></p>&#13;
<p><strong><em>What if...</em></strong> you had a class called Appliance that had an abstract method called TurnOn?</p>&#13;
<p><strong><em>And what if...</em></strong> it had two subclasses: Oven with a Temperature property, and Toaster with a SicesOfBread property?</p>&#13;
<p><strong><em>And what if...</em></strong> you wanted to create a ToasterOven class that inherited both Temperature and SlicesOfBread?</p>&#13;
<p><strong><em>And what if...</em></strong>C# supported multiple inheritance, so you could do that?</p>&#13;
<p>Then there’s only one more question...</p>&#13;
<p><strong><em>Which TurnOn does ToasterOven inherit?</em></strong></p>&#13;
<p>Does it get the version from Oven? Or does it get the version from Toaster?</p>&#13;
<p><strong><em>There’s <u>no way</u> to know!</em></strong></p>&#13;
<p><strong>And that’s why C# doesn’t allow multiple inheritance.</strong></p>&#13;
<figure class="informal"><div class="figure">&#13;
<img alt="Images" src="assets/342fig01.png"/>&#13;
<h6/>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-idd0013">&#13;
<h5>Bullet Points</h5>&#13;
<ul>&#13;
<li><p><a data-primary="methods" data-secondary="body" data-type="indexterm" id="idm46402343283752"/>A subclass can override members it inherits, replacing them with new methods or properties with the same names.</p></li>&#13;
<li><p>To override a method or property, add the <code>virtual</code> <strong>keyword</strong> to the base class, then add the <code>override</code> <strong>keyword</strong> to the member with the same name in the subclass.</p></li>&#13;
<li><p>The <code>protected</code> <strong>keyword</strong> is an access modifier that makes a member public only to its subclasses, but private to every other class.</p></li>&#13;
<li><p>When a subclass overrides a method in its base class, the <strong>more specific version</strong> defined in the subclass is always called—even if the base class is calling it.</p></li>&#13;
<li><p>If a subclass just adds a method with the same name as a method in its base class, it only <strong>hides</strong> the base class method instead of overriding it. Use the <code>new</code> <strong>keyword</strong> when you’re hiding methods.</p></li>&#13;
<li><p>The <strong>dynamics</strong> of a game describe how the mechanics combine and cooperate to drive the gameplay.</p></li>&#13;
<li><p>A subclass can access its base class using the <code>base</code> <strong>keyword</strong>. When a base class has a constructor, your subclass needs to use the <code>base</code> keyword to call it.</p></li>&#13;
<li><p>A subclass and base class can have <strong>different constructors</strong>. The subclass can choose what values to pass to the base class constructor.</p></li>&#13;
<li><p>Build your <strong>class model on paper</strong> before you write code to help you understand and solve your problem.</p></li>&#13;
<li><p>When your classes overlap as little as possible, that’s an important design principle called <strong>separation of concerns</strong>.</p></li>&#13;
<li><p><strong>Emergent behavior</strong> occurs when objects interact with each other, beyond the logic directly coded into them.</p></li>&#13;
<li><p><strong>Abstract classes</strong> are intentionally incomplete classes that cannot be instantiated.</p></li>&#13;
<li><p>Adding the <code>abstract</code> <strong>keyword</strong> to a method or property and leaving out the body makes it abstract. Any concrete subclass of the abstract class must implement it.</p></li>&#13;
<li><p><strong>Refactoring</strong> means reading code you already wrote and making improvements without modifying its behavior.</p></li>&#13;
<li><p>C# does not allow for multiple inheritance because of the <strong>diamond problem</strong>: it can’t determine which version of a member inherited from two base classes to use.</p></li>&#13;
</ul>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section></body></html>